<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>rippled: rocksdb::VersionSet Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">rippled
   &#160;<span id="projectnumber">0.24.0-rc1</span>
   </div>
   <div id="projectbrief">Reference implementation of the Ripple Protocol</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="../../classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="../../inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d1/d42/a01800.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="../../d4/d38/a08657.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">rocksdb::VersionSet Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for rocksdb::VersionSet:</div>
<div class="dyncontent">
<div class="center"><img src="../../de/d8f/a08658.png" border="0" usemap="#rocksdb_1_1_version_set_coll__map" alt="Collaboration graph"/></div>
<map name="rocksdb_1_1_version_set_coll__map" id="rocksdb_1_1_version_set_coll__map">
<area shape="rect" id="node86" href="../../d4/dd1/a01797.html" title="rocksdb::Version" alt="" coords="2079,908,2199,937"/><area shape="rect" id="node4" href="../../da/d18/a01850.html" title="rocksdb::log::Writer" alt="" coords="1008,132,1144,161"/><area shape="rect" id="node8" href="../../d9/d75/a01843.html" title="rocksdb::WritableFile" alt="" coords="219,13,363,43"/><area shape="rect" id="node10" href="../../d5/d5f/a00461.html" title="rocksdb::EnvOptions" alt="" coords="1004,1076,1148,1105"/><area shape="rect" id="node104" href="../../de/df9/a01624.html" title="rocksdb::TableCache" alt="" coords="1420,959,1567,988"/><area shape="rect" id="node14" href="../../d7/db6/a00940.html" title="rocksdb::VersionSet\l::ManifestWriter" alt="" coords="1007,1275,1145,1322"/><area shape="rect" id="node16" href="../../d0/db9/a01552.html" title="rocksdb::Status" alt="" coords="604,1247,719,1276"/><area shape="rect" id="node18" href="../../d2/d86/a01798.html" title="rocksdb::VersionEdit" alt="" coords="591,1459,732,1488"/><area shape="rect" id="node80" href="../../d9/d5e/a00295.html" title="rocksdb::Compaction" alt="" coords="2356,801,2503,831"/><area shape="rect" id="node22" title="STL class. " alt="" coords="251,901,331,931"/><area shape="rect" id="node38" href="../../de/de6/a00723.html" title="rocksdb::InternalKey" alt="" coords="591,75,732,104"/><area shape="rect" id="node43" href="../../dd/d57/a01054.html" title="rocksdb::Options" alt="" coords="1016,676,1136,705"/><area shape="rect" id="node98" href="../../d0/d72/a00724.html" title="rocksdb::InternalKeyComparator" alt="" coords="971,185,1181,215"/><area shape="rect" id="node24" title="STL class. " alt="" coords="7,893,132,939"/><area shape="rect" id="node30" href="../../d0/d39/a00314.html" title="rocksdb::port::CondVar" alt="" coords="583,1300,740,1329"/><area shape="rect" id="node32" href="../../d9/d9a/a00998.html" title="rocksdb::port::Mutex" alt="" coords="220,1299,361,1328"/><area shape="rect" id="node36" href="../../d0/ddb/a00542.html" title="rocksdb::FileMetaData" alt="" coords="999,79,1153,108"/><area shape="rect" id="node41" href="../../db/db1/a00460.html" title="rocksdb::Env" alt="" coords="612,1097,711,1127"/><area shape="rect" id="node57" href="../../dd/de9/a00552.html" title="rocksdb::FilterPolicy" alt="" coords="591,385,732,415"/><area shape="rect" id="node59" href="../../d9/d0d/a00298.html" title="rocksdb::CompactionOptions\lUniversal" alt="" coords="567,438,756,485"/><area shape="rect" id="node61" href="../../d1/d67/a00310.html" title="rocksdb::CompressionOptions" alt="" coords="563,508,760,537"/><area shape="rect" id="node67" href="../../d0/d7d/a01419.html" title="rocksdb::SliceTransform" alt="" coords="580,561,743,591"/><area shape="rect" id="node69" href="../../db/d7b/a00296.html" title="rocksdb::CompactionFilter" alt="" coords="575,615,748,644"/><area shape="rect" id="node71" href="../../d0/d61/a00302.html" title="rocksdb::Comparator" alt="" coords="589,128,733,157"/></map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d27/a00239.html">Builder</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d8b/a00547.html">FileSummaryStorage</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d9b/a00577.html">fsize</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d7b/a00865.html">LevelSummaryStorage</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db6/a00940.html">ManifestWriter</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a93216c2493a57123cc76f732c97908fb"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="../../d8/d9b/a00577.html">rocksdb::VersionSet::fsize</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a93216c2493a57123cc76f732c97908fb">Fsize</a></td></tr>
<tr class="separator:a93216c2493a57123cc76f732c97908fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a83b61f7b0a60a303e2b412acf0f270f1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a83b61f7b0a60a303e2b412acf0f270f1">VersionSet</a> (const std::string &amp;<a class="el" href="../../d1/d03/a02560.html#a75d845559336df6843f3b599960f89d2">dbname</a>, const <a class="el" href="../../dd/d57/a01054.html">Options</a> *options, const <a class="el" href="../../d5/d5f/a00461.html">EnvOptions</a> &amp;storage_options, <a class="el" href="../../de/df9/a01624.html">TableCache</a> *table_cache, const <a class="el" href="../../d0/d72/a00724.html">InternalKeyComparator</a> *)</td></tr>
<tr class="separator:a83b61f7b0a60a303e2b412acf0f270f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8a65d59d4d9114c52113a08d2adb147"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ae8a65d59d4d9114c52113a08d2adb147">~VersionSet</a> ()</td></tr>
<tr class="separator:ae8a65d59d4d9114c52113a08d2adb147"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d4bdcc8a079afc6fcac4f19fbaf1d50"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50">LogAndApply</a> (<a class="el" href="../../d2/d86/a01798.html">VersionEdit</a> *edit, <a class="el" href="../../d9/d9a/a00998.html">port::Mutex</a> *<a class="el" href="../../db/d44/a02564.html#a900dad9ea326bf70a183d88a8ab50a13">mu</a>, bool new_descriptor_log=false)</td></tr>
<tr class="separator:a8d4bdcc8a079afc6fcac4f19fbaf1d50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf04defe0d794e6933785aad628ab9b6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#acf04defe0d794e6933785aad628ab9b6">Recover</a> ()</td></tr>
<tr class="separator:acf04defe0d794e6933785aad628ab9b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a788a71e004c7a132a2fea2a82eedccd6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6">ReduceNumberOfLevels</a> (int new_levels, <a class="el" href="../../d9/d9a/a00998.html">port::Mutex</a> *<a class="el" href="../../db/d44/a02564.html#a900dad9ea326bf70a183d88a8ab50a13">mu</a>)</td></tr>
<tr class="separator:a788a71e004c7a132a2fea2a82eedccd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae52f5390be942a7fc5b906074a33805b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/dd1/a01797.html">Version</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ae52f5390be942a7fc5b906074a33805b">current</a> () const </td></tr>
<tr class="separator:ae52f5390be942a7fc5b906074a33805b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b987b310c14d06c2b2d63b5d4c69a0d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a2b987b310c14d06c2b2d63b5d4c69a0d">ManifestFileNumber</a> () const </td></tr>
<tr class="separator:a2b987b310c14d06c2b2d63b5d4c69a0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a39a05ce05a65f4ccaabf59d18c0162"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a1a39a05ce05a65f4ccaabf59d18c0162">NewFileNumber</a> ()</td></tr>
<tr class="separator:a1a39a05ce05a65f4ccaabf59d18c0162"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea18ea584f40b5752beb02354969c8d8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#aea18ea584f40b5752beb02354969c8d8">ReuseFileNumber</a> (<a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> file_number)</td></tr>
<tr class="separator:aea18ea584f40b5752beb02354969c8d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46a07e37f062ed0919878d92fb69a090"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a46a07e37f062ed0919878d92fb69a090">NumLevelFiles</a> (int level) const </td></tr>
<tr class="separator:a46a07e37f062ed0919878d92fb69a090"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0315528b5040a26724d06e9707692b4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ab0315528b5040a26724d06e9707692b4">NumLevelBytes</a> (int level) const </td></tr>
<tr class="separator:ab0315528b5040a26724d06e9707692b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53c324dec1c1d73477851c6ffa05fd35"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a53c324dec1c1d73477851c6ffa05fd35">LastSequence</a> () const </td></tr>
<tr class="separator:a53c324dec1c1d73477851c6ffa05fd35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac223fcd2a8723749b17ab7360828112d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ac223fcd2a8723749b17ab7360828112d">SetLastSequence</a> (<a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> s)</td></tr>
<tr class="separator:ac223fcd2a8723749b17ab7360828112d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e1d11c285967cb347b090f67e5b34dd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a5e1d11c285967cb347b090f67e5b34dd">MarkFileNumberUsed</a> (<a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> number)</td></tr>
<tr class="separator:a5e1d11c285967cb347b090f67e5b34dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fa7a7fa8e9f744c1fd8089a2c87c7e5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a7fa7a7fa8e9f744c1fd8089a2c87c7e5">LogNumber</a> () const </td></tr>
<tr class="separator:a7fa7a7fa8e9f744c1fd8089a2c87c7e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fd748ec8ea9e958a86f194171482773"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a9fd748ec8ea9e958a86f194171482773">PrevLogNumber</a> () const </td></tr>
<tr class="separator:a9fd748ec8ea9e958a86f194171482773"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ae62b8394f58801a6340323b2c37185"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a> () const </td></tr>
<tr class="separator:a6ae62b8394f58801a6340323b2c37185"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18db5b74de66aa2038d11902bbd1f348"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348">PickCompaction</a> ()</td></tr>
<tr class="separator:a18db5b74de66aa2038d11902bbd1f348"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace5e7f4084293eb426653ea279392111"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ace5e7f4084293eb426653ea279392111">CompactRange</a> (int level, const <a class="el" href="../../de/de6/a00723.html">InternalKey</a> *begin, const <a class="el" href="../../de/de6/a00723.html">InternalKey</a> *end)</td></tr>
<tr class="separator:ace5e7f4084293eb426653ea279392111"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac412ddba42cd8fc7e7472004bdf5d351"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ac412ddba42cd8fc7e7472004bdf5d351">MaxNextLevelOverlappingBytes</a> ()</td></tr>
<tr class="separator:ac412ddba42cd8fc7e7472004bdf5d351"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b2787a7f9d43a6141ff02cc823c5374"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/d02/a00777.html">Iterator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a9b2787a7f9d43a6141ff02cc823c5374">MakeInputIterator</a> (<a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *c)</td></tr>
<tr class="separator:a9b2787a7f9d43a6141ff02cc823c5374"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03e008d1840cd489452ec18094f96c69"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a03e008d1840cd489452ec18094f96c69">NeedsSizeCompaction</a> () const </td></tr>
<tr class="separator:a03e008d1840cd489452ec18094f96c69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacf23c27ccf421a224f961ad96dca7bc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#aacf23c27ccf421a224f961ad96dca7bc">NeedsCompaction</a> () const </td></tr>
<tr class="separator:aacf23c27ccf421a224f961ad96dca7bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4db09546c98f26bf219164f016e4fb4"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ab4db09546c98f26bf219164f016e4fb4">MaxCompactionScore</a> () const </td></tr>
<tr class="separator:ab4db09546c98f26bf219164f016e4fb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbe56ed3b3594280ddeb30ca78b8ef76"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#abbe56ed3b3594280ddeb30ca78b8ef76">MaxCompactionScoreLevel</a> () const </td></tr>
<tr class="separator:abbe56ed3b3594280ddeb30ca78b8ef76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad966a25099780a5da3327ed06c81713e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ad966a25099780a5da3327ed06c81713e">AddLiveFiles</a> (std::vector&lt; <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> &gt; *live_list)</td></tr>
<tr class="separator:ad966a25099780a5da3327ed06c81713e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5f832bd9d8a2cfda48e82bc4db8bd94"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#aa5f832bd9d8a2cfda48e82bc4db8bd94">AddLiveFilesCurrentVersion</a> (std::set&lt; <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> &gt; *live)</td></tr>
<tr class="separator:aa5f832bd9d8a2cfda48e82bc4db8bd94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0764ce8698d7d5b1ace2e0f6710c0f0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#aa0764ce8698d7d5b1ace2e0f6710c0f0">ApproximateOffsetOf</a> (<a class="el" href="../../d4/dd1/a01797.html">Version</a> *v, const <a class="el" href="../../de/de6/a00723.html">InternalKey</a> &amp;key)</td></tr>
<tr class="separator:aa0764ce8698d7d5b1ace2e0f6710c0f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d9d66f1d05b0e3351f1cca8b72552cb"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a4d9d66f1d05b0e3351f1cca8b72552cb">LevelSummary</a> (<a class="el" href="../../dd/d7b/a00865.html">LevelSummaryStorage</a> *scratch) const </td></tr>
<tr class="separator:a4d9d66f1d05b0e3351f1cca8b72552cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a345ce36535de042e2e0d254ff66a5a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a6a345ce36535de042e2e0d254ff66a5a">DumpManifest</a> (<a class="el" href="../../dd/d57/a01054.html">Options</a> &amp;options, std::string &amp;manifestFileName, bool verbose, bool hex=false)</td></tr>
<tr class="separator:a6a345ce36535de042e2e0d254ff66a5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ed02b6e79c2fde606142311ba7f3fd0"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a9ed02b6e79c2fde606142311ba7f3fd0">LevelDataSizeSummary</a> (<a class="el" href="../../dd/d7b/a00865.html">LevelSummaryStorage</a> *scratch) const </td></tr>
<tr class="separator:a9ed02b6e79c2fde606142311ba7f3fd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6adf63444a6a5f7dc4ad0bd751a0c13"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ae6adf63444a6a5f7dc4ad0bd751a0c13">LevelFileSummary</a> (<a class="el" href="../../d9/d8b/a00547.html">FileSummaryStorage</a> *scratch, int level) const </td></tr>
<tr class="separator:ae6adf63444a6a5f7dc4ad0bd751a0c13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada29c0c7f280e7125db24c0d5dd9298b"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ada29c0c7f280e7125db24c0d5dd9298b">ManifestFileSize</a> ()</td></tr>
<tr class="separator:ada29c0c7f280e7125db24c0d5dd9298b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a176e677ba6676e5160bbf1cd712d48e3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a176e677ba6676e5160bbf1cd712d48e3">PickCompactionBySize</a> (int level, double score)</td></tr>
<tr class="separator:a176e677ba6676e5160bbf1cd712d48e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a809a5b39c87ab02b0e3a438609e2bdfb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a809a5b39c87ab02b0e3a438609e2bdfb">PickCompactionUniversal</a> (int level, double score)</td></tr>
<tr class="separator:a809a5b39c87ab02b0e3a438609e2bdfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1dc555d20916566e713d4ec5a623160"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ab1dc555d20916566e713d4ec5a623160">PickCompactionUniversalReadAmp</a> (int level, double score, unsigned int ratio, unsigned int num_files)</td></tr>
<tr class="separator:ab1dc555d20916566e713d4ec5a623160"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2aed822db8d2f7096ef3aa1773bb946"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#aa2aed822db8d2f7096ef3aa1773bb946">PickCompactionUniversalSizeAmp</a> (int level, double score)</td></tr>
<tr class="separator:aa2aed822db8d2f7096ef3aa1773bb946"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fc1a928a1fe6381f942be6588ea697b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a1fc1a928a1fe6381f942be6588ea697b">ReleaseCompactionFiles</a> (<a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *c, <a class="el" href="../../d0/db9/a01552.html">Status</a> status)</td></tr>
<tr class="separator:a1fc1a928a1fe6381f942be6588ea697b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70c2cca8ce9d7c0e133e96f952111d40"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a70c2cca8ce9d7c0e133e96f952111d40">VerifyCompactionFileConsistency</a> (<a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *c)</td></tr>
<tr class="separator:a70c2cca8ce9d7c0e133e96f952111d40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1161ffbcf7b18cde8bed5e361c7d3f0f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a1161ffbcf7b18cde8bed5e361c7d3f0f">UpdateFilesBySize</a> (<a class="el" href="../../d4/dd1/a01797.html">Version</a> *v)</td></tr>
<tr class="separator:a1161ffbcf7b18cde8bed5e361c7d3f0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51725970659718a612480286843b0ad5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5">MaxFileSizeForLevel</a> (int level)</td></tr>
<tr class="separator:a51725970659718a612480286843b0ad5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1639228385c42402a661292f6a27a818"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a1639228385c42402a661292f6a27a818">MaxBytesForLevel</a> (int level)</td></tr>
<tr class="separator:a1639228385c42402a661292f6a27a818"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4adc0625af13d9bbe2ed45960942e910"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a4adc0625af13d9bbe2ed45960942e910">GetMetadataForFile</a> (<a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> number, int *filelevel, <a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> *metadata)</td></tr>
<tr class="separator:a4adc0625af13d9bbe2ed45960942e910"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7916db473b10047e2acae9d12d1ff817"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a7916db473b10047e2acae9d12d1ff817">GetLiveFilesMetaData</a> (std::vector&lt; <a class="el" href="../../d2/dab/a00886.html">LiveFileMetaData</a> &gt; *metadata)</td></tr>
<tr class="separator:a7916db473b10047e2acae9d12d1ff817"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c83b4ba80213628c2b9771f8b6c9039"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a8c83b4ba80213628c2b9771f8b6c9039">GetObsoleteFiles</a> (std::vector&lt; <a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> * &gt; *files)</td></tr>
<tr class="separator:a8c83b4ba80213628c2b9771f8b6c9039"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:add78f5ab4cff29b479bed39a64406732"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#add78f5ab4cff29b479bed39a64406732">Init</a> (int num_levels)</td></tr>
<tr class="separator:add78f5ab4cff29b479bed39a64406732"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69fd2eaa5b9d9f087b21d46d0a2a27e3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3">Finalize</a> (<a class="el" href="../../d4/dd1/a01797.html">Version</a> *v, std::vector&lt; <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> &gt; &amp;)</td></tr>
<tr class="separator:a69fd2eaa5b9d9f087b21d46d0a2a27e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49822736d0cb083b87cca21346af7588"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588">GetRange</a> (const std::vector&lt; <a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> * &gt; &amp;inputs, <a class="el" href="../../de/de6/a00723.html">InternalKey</a> *smallest, <a class="el" href="../../de/de6/a00723.html">InternalKey</a> *largest)</td></tr>
<tr class="separator:a49822736d0cb083b87cca21346af7588"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a300d694d7eba66eb5bb129ddfea015fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a300d694d7eba66eb5bb129ddfea015fa">GetRange2</a> (const std::vector&lt; <a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> * &gt; &amp;inputs1, const std::vector&lt; <a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> * &gt; &amp;inputs2, <a class="el" href="../../de/de6/a00723.html">InternalKey</a> *smallest, <a class="el" href="../../de/de6/a00723.html">InternalKey</a> *largest)</td></tr>
<tr class="separator:a300d694d7eba66eb5bb129ddfea015fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec0ea29ca7b511b74376486592307d70"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#aec0ea29ca7b511b74376486592307d70">ExpandWhileOverlapping</a> (<a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *c)</td></tr>
<tr class="separator:aec0ea29ca7b511b74376486592307d70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae62effcc413a67f9941cfc18a5d3bd93"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ae62effcc413a67f9941cfc18a5d3bd93">SetupOtherInputs</a> (<a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *c)</td></tr>
<tr class="separator:ae62effcc413a67f9941cfc18a5d3bd93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1e1ece4fbaa4098f0e08154f773cb61"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ab1e1ece4fbaa4098f0e08154f773cb61">WriteSnapshot</a> (<a class="el" href="../../da/d18/a01850.html">log::Writer</a> *log)</td></tr>
<tr class="separator:ab1e1ece4fbaa4098f0e08154f773cb61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5b2b44d11b6085ed5deeb7a562d30a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#aa5b2b44d11b6085ed5deeb7a562d30a7">AppendVersion</a> (<a class="el" href="../../d4/dd1/a01797.html">Version</a> *v)</td></tr>
<tr class="separator:aa5b2b44d11b6085ed5deeb7a562d30a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af55acbe3f8a2077614c6d8374eb24c04"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#af55acbe3f8a2077614c6d8374eb24c04">ManifestContains</a> (const std::string &amp;record) const </td></tr>
<tr class="separator:af55acbe3f8a2077614c6d8374eb24c04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31739d9b6c47d04ec18b7e717796c4ed"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a31739d9b6c47d04ec18b7e717796c4ed">ExpandedCompactionByteSizeLimit</a> (int level)</td></tr>
<tr class="separator:a31739d9b6c47d04ec18b7e717796c4ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f278dfbc54cda6dccee7d56f54e78ac"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a4f278dfbc54cda6dccee7d56f54e78ac">MaxGrandParentOverlapBytes</a> (int level)</td></tr>
<tr class="separator:a4f278dfbc54cda6dccee7d56f54e78ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45d87a8d36c9dd222c36d61c046da34f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a45d87a8d36c9dd222c36d61c046da34f">VersionSet</a> (const <a class="el" href="../../d1/d42/a01800.html">VersionSet</a> &amp;)</td></tr>
<tr class="separator:a45d87a8d36c9dd222c36d61c046da34f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90a321a7d55d6a3cab7b1a63366b59f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a90a321a7d55d6a3cab7b1a63366b59f4">operator=</a> (const <a class="el" href="../../d1/d42/a01800.html">VersionSet</a> &amp;)</td></tr>
<tr class="separator:a90a321a7d55d6a3cab7b1a63366b59f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac723248f990dd0f5de3eca23b292a501"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ac723248f990dd0f5de3eca23b292a501">SizeBeingCompacted</a> (std::vector&lt; <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> &gt; &amp;)</td></tr>
<tr class="separator:ac723248f990dd0f5de3eca23b292a501"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62eb602d1ca2dc2a9f0a87dfe184fb2c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a62eb602d1ca2dc2a9f0a87dfe184fb2c">ParentRangeInCompaction</a> (const <a class="el" href="../../de/de6/a00723.html">InternalKey</a> *smallest, const <a class="el" href="../../de/de6/a00723.html">InternalKey</a> *largest, int level, int *index)</td></tr>
<tr class="separator:a62eb602d1ca2dc2a9f0a87dfe184fb2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a512e8e76628bdb9c867f6309d68fd412"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a512e8e76628bdb9c867f6309d68fd412">FilesInCompaction</a> (std::vector&lt; <a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> * &gt; &amp;files)</td></tr>
<tr class="separator:a512e8e76628bdb9c867f6309d68fd412"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfc3ec9be932533630087e672fce75b3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#abfc3ec9be932533630087e672fce75b3">LogAndApplyHelper</a> (<a class="el" href="../../d0/d27/a00239.html">Builder</a> *b, <a class="el" href="../../d4/dd1/a01797.html">Version</a> *v, <a class="el" href="../../d2/d86/a01798.html">VersionEdit</a> *edit, <a class="el" href="../../d9/d9a/a00998.html">port::Mutex</a> *<a class="el" href="../../db/d44/a02564.html#a900dad9ea326bf70a183d88a8ab50a13">mu</a>)</td></tr>
<tr class="separator:abfc3ec9be932533630087e672fce75b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ae22040b4a38e203468c16912223420de"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/db1/a00460.html">Env</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ae22040b4a38e203468c16912223420de">env_</a></td></tr>
<tr class="separator:ae22040b4a38e203468c16912223420de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46b2347fce13fe13dff6c57867a64d37"><td class="memItemLeft" align="right" valign="top">const std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a46b2347fce13fe13dff6c57867a64d37">dbname_</a></td></tr>
<tr class="separator:a46b2347fce13fe13dff6c57867a64d37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea259a26e9ad3d2ca39ea1a5f4858878"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../dd/d57/a01054.html">Options</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a></td></tr>
<tr class="separator:aea259a26e9ad3d2ca39ea1a5f4858878"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbe852ae17cbb6c37d4b9dfbe9f44bb2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/df9/a01624.html">TableCache</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#acbe852ae17cbb6c37d4b9dfbe9f44bb2">table_cache_</a></td></tr>
<tr class="separator:acbe852ae17cbb6c37d4b9dfbe9f44bb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9f3871481ba903b57737941a72115c7"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../d0/d72/a00724.html">InternalKeyComparator</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a></td></tr>
<tr class="separator:aa9f3871481ba903b57737941a72115c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3729aabcbf981b8262e9987d61429244"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a></td></tr>
<tr class="separator:a3729aabcbf981b8262e9987d61429244"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab02f581e1b243a5d4e421a85ecc36f76"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a></td></tr>
<tr class="separator:ab02f581e1b243a5d4e421a85ecc36f76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9813d4953bf5d62a1bbd8f94ede1a15"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ac9813d4953bf5d62a1bbd8f94ede1a15">last_sequence_</a></td></tr>
<tr class="separator:ac9813d4953bf5d62a1bbd8f94ede1a15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8efe3b4907507a75117c3148fe888f9e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a8efe3b4907507a75117c3148fe888f9e">log_number_</a></td></tr>
<tr class="separator:a8efe3b4907507a75117c3148fe888f9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fb8190a6ca751167dc288649b8849c3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a7fb8190a6ca751167dc288649b8849c3">prev_log_number_</a></td></tr>
<tr class="separator:a7fb8190a6ca751167dc288649b8849c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a707d774d0f01630acd6caaf633514324"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a707d774d0f01630acd6caaf633514324">num_levels_</a></td></tr>
<tr class="separator:a707d774d0f01630acd6caaf633514324"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6a954cbe510f1e5f1f6049b933b88a3"><td class="memItemLeft" align="right" valign="top">unique_ptr&lt; <a class="el" href="../../da/d18/a01850.html">log::Writer</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ac6a954cbe510f1e5f1f6049b933b88a3">descriptor_log_</a></td></tr>
<tr class="separator:ac6a954cbe510f1e5f1f6049b933b88a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed497293c513f1060753fdb66493da3d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/dd1/a01797.html">Version</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#aed497293c513f1060753fdb66493da3d">dummy_versions_</a></td></tr>
<tr class="separator:aed497293c513f1060753fdb66493da3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2f098a7fdc59cda85bda47538bf6b30"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/dd1/a01797.html">Version</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a></td></tr>
<tr class="separator:af2f098a7fdc59cda85bda47538bf6b30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73592373481ef75a5aa62e5c51c398c7"><td class="memItemLeft" align="right" valign="top">std::string *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a73592373481ef75a5aa62e5c51c398c7">compact_pointer_</a></td></tr>
<tr class="separator:a73592373481ef75a5aa62e5c51c398c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a118a633a8d1ff038ab5506ad9044d086"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a118a633a8d1ff038ab5506ad9044d086">max_file_size_</a></td></tr>
<tr class="separator:a118a633a8d1ff038ab5506ad9044d086"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e79f8d904167a1092d337c82093a629"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a8e79f8d904167a1092d337c82093a629">level_max_bytes_</a></td></tr>
<tr class="separator:a8e79f8d904167a1092d337c82093a629"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c4a4e38b597d39024dd2192adceb3b3"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::set<br class="typebreak"/>
&lt; <a class="el" href="../../d9/d5e/a00295.html">Compaction</a> * &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a6c4a4e38b597d39024dd2192adceb3b3">compactions_in_progress_</a></td></tr>
<tr class="separator:a6c4a4e38b597d39024dd2192adceb3b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33937b18365def065cbb16d930d47c81"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a33937b18365def065cbb16d930d47c81">current_version_number_</a></td></tr>
<tr class="separator:a33937b18365def065cbb16d930d47c81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c2f30ab49313fa28edcca51fb13acd0"><td class="memItemLeft" align="right" valign="top">std::deque&lt; <a class="el" href="../../d7/db6/a00940.html">ManifestWriter</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a5c2f30ab49313fa28edcca51fb13acd0">manifest_writers_</a></td></tr>
<tr class="separator:a5c2f30ab49313fa28edcca51fb13acd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12b0bca04f0781f79326d4de43cff810"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a12b0bca04f0781f79326d4de43cff810">last_observed_manifest_size_</a></td></tr>
<tr class="separator:a12b0bca04f0781f79326d4de43cff810"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abae36f2c040724d34e2ef7c4a4ae2013"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#abae36f2c040724d34e2ef7c4a4ae2013">obsolete_files_</a></td></tr>
<tr class="separator:abae36f2c040724d34e2ef7c4a4ae2013"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa455bb240de0e461dbab37045dcc3e1c"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../d5/d5f/a00461.html">EnvOptions</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#aa455bb240de0e461dbab37045dcc3e1c">storage_options_</a></td></tr>
<tr class="separator:aa455bb240de0e461dbab37045dcc3e1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1fa9d94ea404bcb28cb8ceff339d769"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../d5/d5f/a00461.html">EnvOptions</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ab1fa9d94ea404bcb28cb8ceff339d769">storage_options_compactions_</a></td></tr>
<tr class="separator:ab1fa9d94ea404bcb28cb8ceff339d769"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:a9372e882b35d27c78356228e4b758917"><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a></td></tr>
<tr class="separator:a9372e882b35d27c78356228e4b758917"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace162f32d4abb584945d3a55a389b0a3"><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d42/a01800.html#ace162f32d4abb584945d3a55a389b0a3">Version</a></td></tr>
<tr class="separator:ace162f32d4abb584945d3a55a389b0a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00221">221</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="a93216c2493a57123cc76f732c97908fb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="../../d8/d9b/a00577.html">rocksdb::VersionSet::fsize</a>  <a class="el" href="../../d1/d42/a01800.html#a93216c2493a57123cc76f732c97908fb">rocksdb::VersionSet::Fsize</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a83b61f7b0a60a303e2b412acf0f270f1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rocksdb::VersionSet::VersionSet </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>dbname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../dd/d57/a01054.html">Options</a> *&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d5/d5f/a00461.html">EnvOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>storage_options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/df9/a01624.html">TableCache</a> *&#160;</td>
          <td class="paramname"><em>table_cache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/d72/a00724.html">InternalKeyComparator</a> *&#160;</td>
          <td class="paramname"><em>cmp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01133">1133</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d6/dfc/a02612_source.html#l01193">AppendVersion()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00491">compact_pointer_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00503">current_version_number_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01173">Init()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00268">rocksdb::Options::num_levels</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00441">Version</a>.</p>
<div class="fragment"><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    : <a class="code" href="../../d1/d42/a01800.html#ae22040b4a38e203468c16912223420de">env_</a>(options-&gt;env),</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a46b2347fce13fe13dff6c57867a64d37">dbname_</a>(<a class="code" href="../../d1/d03/a02560.html#a75d845559336df6843f3b599960f89d2">dbname</a>),</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>(options),</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#acbe852ae17cbb6c37d4b9dfbe9f44bb2">table_cache_</a>(table_cache),</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a>(*cmp),</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a>(2),</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a>(0),  <span class="comment">// Filled by Recover()</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#ac9813d4953bf5d62a1bbd8f94ede1a15">last_sequence_</a>(0),</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a8efe3b4907507a75117c3148fe888f9e">log_number_</a>(0),</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a7fb8190a6ca751167dc288649b8849c3">prev_log_number_</a>(0),</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a707d774d0f01630acd6caaf633514324">num_levels_</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a4eae6dfafa0a0574fba2d8a3209122c4">num_levels</a>),</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#aed497293c513f1060753fdb66493da3d">dummy_versions_</a>(<span class="keyword">this</span>),</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>(<span class="keyword">nullptr</span>),</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a6c4a4e38b597d39024dd2192adceb3b3">compactions_in_progress_</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a4eae6dfafa0a0574fba2d8a3209122c4">num_levels</a>),</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a33937b18365def065cbb16d930d47c81">current_version_number_</a>(0),</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a12b0bca04f0781f79326d4de43cff810">last_observed_manifest_size_</a>(0),</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#aa455bb240de0e461dbab37045dcc3e1c">storage_options_</a>(storage_options),</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#ab1fa9d94ea404bcb28cb8ceff339d769">storage_options_compactions_</a>(<a class="code" href="../../d1/d42/a01800.html#aa455bb240de0e461dbab37045dcc3e1c">storage_options_</a>)  {</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a73592373481ef75a5aa62e5c51c398c7">compact_pointer_</a> = <span class="keyword">new</span> std::string[<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a4eae6dfafa0a0574fba2d8a3209122c4">num_levels</a>];</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#add78f5ab4cff29b479bed39a64406732">Init</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a4eae6dfafa0a0574fba2d8a3209122c4">num_levels</a>);</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#aa5b2b44d11b6085ed5deeb7a562d30a7">AppendVersion</a>(<span class="keyword">new</span> <a class="code" href="../../d1/d42/a01800.html#ace162f32d4abb584945d3a55a389b0a3">Version</a>(<span class="keyword">this</span>, <a class="code" href="../../d1/d42/a01800.html#a33937b18365def065cbb16d930d47c81">current_version_number_</a>++));</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a83b61f7b0a60a303e2b412acf0f270f1_cgraph.png" border="0" usemap="#d1/d42/a01800_a83b61f7b0a60a303e2b412acf0f270f1_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a83b61f7b0a60a303e2b412acf0f270f1_cgraph" id="d1/d42/a01800_a83b61f7b0a60a303e2b412acf0f270f1_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#aa5b2b44d11b6085ed5deeb7a562d30a7" title="rocksdb::VersionSet\l::AppendVersion" alt="" coords="196,23,335,70"/><area shape="rect" id="node9" href="../../d1/d42/a01800.html#add78f5ab4cff29b479bed39a64406732" title="rocksdb::VersionSet\l::Init" alt="" coords="196,93,335,139"/><area shape="rect" id="node5" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="384,5,544,35"/><area shape="rect" id="node7" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="389,59,539,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae8a65d59d4d9114c52113a08d2adb147"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rocksdb::VersionSet::~VersionSet </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01161">1161</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00491">compact_pointer_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00486">dummy_versions_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00497">level_max_bytes_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00494">max_file_size_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00160">rocksdb::Version::next_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00512">obsolete_files_</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l00595">rocksdb::Version::Unref()</a>.</p>
<div class="fragment"><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                        {</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d">Unref</a>();</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  assert(<a class="code" href="../../d1/d42/a01800.html#aed497293c513f1060753fdb66493da3d">dummy_versions_</a>.<a class="code" href="../../d4/dd1/a01797.html#ab7aea6ae95e0b04f9c84738f06636176">next_</a> == &amp;<a class="code" href="../../d1/d42/a01800.html#aed497293c513f1060753fdb66493da3d">dummy_versions_</a>);  <span class="comment">// List must be empty</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> file : <a class="code" href="../../d1/d42/a01800.html#abae36f2c040724d34e2ef7c4a4ae2013">obsolete_files_</a>) {</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keyword">delete</span> file;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  }</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  obsolete_files_.clear();</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  <span class="keyword">delete</span>[] <a class="code" href="../../d1/d42/a01800.html#a73592373481ef75a5aa62e5c51c398c7">compact_pointer_</a>;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="keyword">delete</span>[] <a class="code" href="../../d1/d42/a01800.html#a118a633a8d1ff038ab5506ad9044d086">max_file_size_</a>;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="keyword">delete</span>[] <a class="code" href="../../d1/d42/a01800.html#a8e79f8d904167a1092d337c82093a629">level_max_bytes_</a>;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ae8a65d59d4d9114c52113a08d2adb147_cgraph.png" border="0" usemap="#d1/d42/a01800_ae8a65d59d4d9114c52113a08d2adb147_cgraph" alt=""/></div>
<map name="d1/d42/a01800_ae8a65d59d4d9114c52113a08d2adb147_cgraph" id="d1/d42/a01800_ae8a65d59d4d9114c52113a08d2adb147_cgraph">
<area shape="rect" id="node3" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="195,13,355,43"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a45d87a8d36c9dd222c36d61c046da34f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rocksdb::VersionSet::VersionSet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d1/d42/a01800.html">VersionSet</a> &amp;&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ad966a25099780a5da3327ed06c81713e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::AddLiveFiles </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> &gt; *&#160;</td>
          <td class="paramname"><em>live_list</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01967">1967</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00486">dummy_versions_</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00160">rocksdb::Version::next_</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>.</p>
<div class="fragment"><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;                                                            {</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  <span class="comment">// pre-calculate space requirement</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;  <a class="code" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> total_files = 0;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="../../d1/d42/a01800.html#ace162f32d4abb584945d3a55a389b0a3">Version</a>* v = <a class="code" href="../../d1/d42/a01800.html#aed497293c513f1060753fdb66493da3d">dummy_versions_</a>.<a class="code" href="../../d4/dd1/a01797.html#ab7aea6ae95e0b04f9c84738f06636176">next_</a>;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;       v != &amp;<a class="code" href="../../d1/d42/a01800.html#aed497293c513f1060753fdb66493da3d">dummy_versions_</a>;</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;       v = v-&gt;<a class="code" href="../../d4/dd1/a01797.html#ab7aea6ae95e0b04f9c84738f06636176">next_</a>) {</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(); level++) {</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      total_files += v-&gt;files_[level].size();</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    }</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  }</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;  <span class="comment">// just one time extension to the right size</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;  live_list-&gt;reserve(live_list-&gt;size() + total_files);</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="../../d1/d42/a01800.html#ace162f32d4abb584945d3a55a389b0a3">Version</a>* v = <a class="code" href="../../d1/d42/a01800.html#aed497293c513f1060753fdb66493da3d">dummy_versions_</a>.<a class="code" href="../../d4/dd1/a01797.html#ab7aea6ae95e0b04f9c84738f06636176">next_</a>;</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;       v != &amp;<a class="code" href="../../d1/d42/a01800.html#aed497293c513f1060753fdb66493da3d">dummy_versions_</a>;</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;       v = v-&gt;<a class="code" href="../../d4/dd1/a01797.html#ab7aea6ae95e0b04f9c84738f06636176">next_</a>) {</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(); level++) {</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> : v-&gt;files_[level]) {</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        live_list-&gt;push_back(<a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a>-&gt;number);</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      }</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;    }</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;  }</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ad966a25099780a5da3327ed06c81713e_cgraph.png" border="0" usemap="#d1/d42/a01800_ad966a25099780a5da3327ed06c81713e_cgraph" alt=""/></div>
<map name="d1/d42/a01800_ad966a25099780a5da3327ed06c81713e_cgraph" id="d1/d42/a01800_ad966a25099780a5da3327ed06c81713e_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="196,5,335,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa5f832bd9d8a2cfda48e82bc4db8bd94"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::AddLiveFilesCurrentVersion </td>
          <td>(</td>
          <td class="paramtype">std::set&lt; <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> &gt; *&#160;</td>
          <td class="paramname"><em>live</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01992">1992</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>.</p>
<div class="fragment"><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                                                                  {</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#ace162f32d4abb584945d3a55a389b0a3">Version</a>* v = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>;</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(); level++) {</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <span class="keyword">const</span> std::vector&lt;FileMetaData*&gt;&amp; files = v-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level];</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; files.size(); i++) {</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      live-&gt;insert(files[i]-&gt;number);</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    }</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;  }</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_aa5f832bd9d8a2cfda48e82bc4db8bd94_cgraph.png" border="0" usemap="#d1/d42/a01800_aa5f832bd9d8a2cfda48e82bc4db8bd94_cgraph" alt=""/></div>
<map name="d1/d42/a01800_aa5f832bd9d8a2cfda48e82bc4db8bd94_cgraph" id="d1/d42/a01800_aa5f832bd9d8a2cfda48e82bc4db8bd94_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="247,5,385,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa5b2b44d11b6085ed5deeb7a562d30a7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::AppendVersion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/dd1/a01797.html">Version</a> *&#160;</td>
          <td class="paramname"><em>v</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01193">1193</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00486">dummy_versions_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00160">rocksdb::Version::next_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00161">rocksdb::Version::prev_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00591">rocksdb::Version::Ref()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00162">rocksdb::Version::refs_</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l00595">rocksdb::Version::Unref()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01133">VersionSet()</a>.</p>
<div class="fragment"><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                                         {</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <span class="comment">// Make &quot;v&quot; current</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  assert(v-&gt;refs_ == 0);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  assert(v != <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>);</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    assert(<a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a3f99da90656722a1d3ea52dd56778ce7">refs_</a> &gt; 0);</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d">Unref</a>();</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  }</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a> = v;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  v-&gt;<a class="code" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2">Ref</a>();</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="comment">// Append to linked list</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  v-&gt;prev_ = <a class="code" href="../../d1/d42/a01800.html#aed497293c513f1060753fdb66493da3d">dummy_versions_</a>.<a class="code" href="../../d4/dd1/a01797.html#a1f7f80410802560378686253fd151be2">prev_</a>;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  v-&gt;<a class="code" href="../../d4/dd1/a01797.html#ab7aea6ae95e0b04f9c84738f06636176">next_</a> = &amp;<a class="code" href="../../d1/d42/a01800.html#aed497293c513f1060753fdb66493da3d">dummy_versions_</a>;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  v-&gt;<a class="code" href="../../d4/dd1/a01797.html#a1f7f80410802560378686253fd151be2">prev_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#ab7aea6ae95e0b04f9c84738f06636176">next_</a> = v;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  v-&gt;<a class="code" href="../../d4/dd1/a01797.html#ab7aea6ae95e0b04f9c84738f06636176">next_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a1f7f80410802560378686253fd151be2">prev_</a> = v;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_aa5b2b44d11b6085ed5deeb7a562d30a7_cgraph.png" border="0" usemap="#d1/d42/a01800_aa5b2b44d11b6085ed5deeb7a562d30a7_cgraph" alt=""/></div>
<map name="d1/d42/a01800_aa5b2b44d11b6085ed5deeb7a562d30a7_cgraph" id="d1/d42/a01800_aa5b2b44d11b6085ed5deeb7a562d30a7_cgraph">
<area shape="rect" id="node3" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="200,5,349,35"/><area shape="rect" id="node5" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="195,59,355,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_aa5b2b44d11b6085ed5deeb7a562d30a7_icgraph.png" border="0" usemap="#d1/d42/a01800_aa5b2b44d11b6085ed5deeb7a562d30a7_icgraph" alt=""/></div>
<map name="d1/d42/a01800_aa5b2b44d11b6085ed5deeb7a562d30a7_icgraph" id="d1/d42/a01800_aa5b2b44d11b6085ed5deeb7a562d30a7_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6a345ce36535de042e2e0d254ff66a5a" title="rocksdb::VersionSet\l::DumpManifest" alt="" coords="196,1431,335,1478"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="196,1561,335,1607"/><area shape="rect" id="node102" href="../../d1/d42/a01800.html#acf04defe0d794e6933785aad628ab9b6" title="rocksdb::VersionSet\l::Recover" alt="" coords="2272,1650,2411,1697"/><area shape="rect" id="node109" href="../../d1/d42/a01800.html#a83b61f7b0a60a303e2b412acf0f270f1" title="rocksdb::VersionSet\l::VersionSet" alt="" coords="196,1710,335,1757"/><area shape="rect" id="node5" href="../../dd/d20/a00939.html#a0a4996198d709bec7b49eec50ba36567" title="rocksdb::ManifestDumpCommand\l::DoCommand" alt="" coords="384,1401,605,1447"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2519,1547,2697,1576"/><area shape="rect" id="node13" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="396,1470,593,1517"/><area shape="rect" id="node99" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="661,1590,835,1637"/><area shape="rect" id="node11" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2871,1547,2921,1576"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="653,987,843,1034"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1187,909,1384,955"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1187,1013,1384,1059"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="892,969,1137,999"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1432,909,1629,955"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1677,923,1925,952"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1973,823,2195,870"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2243,1013,2440,1059"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2255,59,2428,88"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2244,249,2439,295"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2253,595,2429,624"/><area shape="rect" id="node46" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2275,856,2408,885"/><area shape="rect" id="node89" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2260,717,2423,763"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2503,1493,2713,1523"/><area shape="rect" id="node34" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2533,59,2683,88"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2505,5,2711,35"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2529,112,2687,141"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2553,165,2663,195"/><area shape="rect" id="node48" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2527,549,2689,595"/><area shape="rect" id="node50" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2537,618,2679,665"/><area shape="rect" id="node52" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2508,688,2708,717"/><area shape="rect" id="node54" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2512,741,2704,771"/><area shape="rect" id="node56" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2553,795,2663,824"/><area shape="rect" id="node59" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2528,847,2688,894"/><area shape="rect" id="node61" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2547,917,2669,947"/><area shape="rect" id="node63" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2540,970,2676,1017"/><area shape="rect" id="node65" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2512,1039,2704,1086"/><area shape="rect" id="node67" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2512,1109,2704,1155"/><area shape="rect" id="node69" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2500,1179,2716,1208"/><area shape="rect" id="node71" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2527,1231,2689,1278"/><area shape="rect" id="node73" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2583,1301,2633,1331"/><area shape="rect" id="node75" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2539,1354,2677,1401"/><area shape="rect" id="node77" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2519,287,2697,334"/><area shape="rect" id="node79" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2527,1423,2689,1470"/><area shape="rect" id="node83" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2525,357,2691,387"/><area shape="rect" id="node85" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2539,410,2677,457"/><area shape="rect" id="node87" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2536,479,2680,526"/><area shape="rect" id="node81" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="2777,1625,3015,1671"/><area shape="rect" id="node91" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="2517,218,2699,265"/><area shape="rect" id="node105" href="../../d0/d58/a01230.html#a769cf9f08028648f2cb824dbbf695de7" title="rocksdb::ReduceDBLevelsCommand\l::GetOldNumOfLevels" alt="" coords="2489,1650,2727,1697"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa0764ce8698d7d5b1ace2e0f6710c0f0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::ApproximateOffsetOf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/dd1/a01797.html">Version</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/de6/a00723.html">InternalKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01934">1934</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d0/da4/a01631.html#acf6498d1cc1177d73dcef8cd00062501">rocksdb::TableReader::ApproximateOffsetOf()</a>, <a class="el" href="../../d2/ddf/a02573_source.html#l00056">rocksdb::InternalKeyComparator::Compare()</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00136">rocksdb::InternalKey::Encode()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00475">icmp_</a>, <a class="el" href="../../d3/dce/a02602_source.html#l00092">rocksdb::TableCache::NewIterator()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00515">storage_options_</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00474">table_cache_</a>.</p>
<div class="fragment"><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                                                                            {</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> result = 0;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(); level++) {</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    <span class="keyword">const</span> std::vector&lt;FileMetaData*&gt;&amp; files = v-&gt;files_[level];</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; files.size(); i++) {</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a>.<a class="code" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8">Compare</a>(files[i]-&gt;largest, ikey) &lt;= 0) {</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;        <span class="comment">// Entire file is before &quot;ikey&quot;, so just add the file size</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        result += files[i]-&gt;file_size;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a>.<a class="code" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8">Compare</a>(files[i]-&gt;smallest, ikey) &gt; 0) {</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        <span class="comment">// Entire file is after &quot;ikey&quot;, so ignore</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;        <span class="keywordflow">if</span> (level &gt; 0) {</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;          <span class="comment">// Files other than level 0 are sorted by meta-&gt;smallest, so</span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;          <span class="comment">// no further files in this level will contain data for</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;          <span class="comment">// &quot;ikey&quot;.</span></div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;        }</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;        <span class="comment">// &quot;ikey&quot; falls in the range for this table.  Add the</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        <span class="comment">// approximate offset of &quot;ikey&quot; within the table.</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        TableReader* table_reader_ptr;</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;        Iterator* iter = <a class="code" href="../../d1/d42/a01800.html#acbe852ae17cbb6c37d4b9dfbe9f44bb2">table_cache_</a>-&gt;<a class="code" href="../../de/df9/a01624.html#a59b62bf2644f7cf62feb7275085a9185">NewIterator</a>(</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;            ReadOptions(), <a class="code" href="../../d1/d42/a01800.html#aa455bb240de0e461dbab37045dcc3e1c">storage_options_</a>, files[i]-&gt;number,</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;            files[i]-&gt;file_size, &amp;table_reader_ptr);</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        <span class="keywordflow">if</span> (table_reader_ptr != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;          result += table_reader_ptr-&gt;ApproximateOffsetOf(ikey.Encode());</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        }</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        <span class="keyword">delete</span> iter;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      }</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    }</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  }</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_aa0764ce8698d7d5b1ace2e0f6710c0f0_cgraph.png" border="0" usemap="#d1/d42/a01800_aa0764ce8698d7d5b1ace2e0f6710c0f0_cgraph" alt=""/></div>
<map name="d1/d42/a01800_aa0764ce8698d7d5b1ace2e0f6710c0f0_cgraph" id="d1/d42/a01800_aa0764ce8698d7d5b1ace2e0f6710c0f0_cgraph">
<area shape="rect" id="node3" href="../../d0/da4/a01631.html#acf6498d1cc1177d73dcef8cd00062501" title="rocksdb::TableReader\l::ApproximateOffsetOf" alt="" coords="237,127,389,174"/><area shape="rect" id="node5" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="208,197,419,243"/><area shape="rect" id="node23" href="../../de/de6/a00723.html#a6d86d2cfbd4205b41f29f84cdedf3c22" title="rocksdb::InternalKey\l::Encode" alt="" coords="243,379,384,426"/><area shape="rect" id="node25" href="../../de/df9/a01624.html#a59b62bf2644f7cf62feb7275085a9185" title="rocksdb::TableCache\l::NewIterator" alt="" coords="240,535,387,582"/><area shape="rect" id="node72" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="244,605,383,651"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#aab29434ed2c251eae44fdb498e4d8dcc" title="rocksdb::BumpPerfCount" alt="" coords="469,5,637,35"/><area shape="rect" id="node9" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="481,58,625,105"/><area shape="rect" id="node11" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="743,127,881,156"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="471,283,636,312"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ae015f9b23bbadef7eb4e3796c2d4fb46" title="rocksdb::ExtractUserKey" alt="" coords="469,179,637,208"/><area shape="rect" id="node20" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="744,180,880,209"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="729,233,895,263"/><area shape="rect" id="node27" href="../../de/df9/a01624.html#aed7ec4f6ca046cd127813d39e75dee0c" title="rocksdb::TableCache\l::FindTable" alt="" coords="480,423,627,470"/><area shape="rect" id="node39" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="744,607,880,636"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#a7b03495439285fb3fb42a3208b01a3d7" title="rocksdb::NewErrorIterator" alt="" coords="468,544,639,573"/><area shape="rect" id="node49" href="../../d0/da4/a01631.html#ab457fa9a28a505dcd52222b12e331a6c" title="rocksdb::TableReader\l::NewIterator" alt="" coords="479,597,628,643"/><area shape="rect" id="node52" href="../../d2/d02/a00777.html#a668d7cfe0b950c1ee2806a3a3d21bb90" title="rocksdb::Iterator::\lRegisterCleanup" alt="" coords="491,666,616,713"/><area shape="rect" id="node66" href="../../d0/da4/a01631.html#a8b065eafa65a8d1e8b69b6300370b744" title="rocksdb::TableReader\l::SetupForCompaction" alt="" coords="477,735,629,782"/><area shape="rect" id="node68" href="../../d4/d87/a03436.html#a71b6611372242bca71af15eb1e4c2a78" title="rocksdb::UnrefEntry" alt="" coords="484,805,623,835"/><area shape="rect" id="node29" href="../../d4/d87/a03436.html#a25709ac27a5b4b9ca699413c90036eed" title="rocksdb::DeleteEntry" alt="" coords="740,287,884,316"/><area shape="rect" id="node31" href="../../d4/d87/a03436.html#a0a6b5f485f1b3d6f33ead2fc4d7c891c" title="rocksdb::EncodeFixed64" alt="" coords="729,340,895,369"/><area shape="rect" id="node33" href="../../d0/db9/a01552.html#a223ccba0dce26cd4539d6fd2c28ae364" title="rocksdb::Status::Incomplete" alt="" coords="719,393,905,423"/><area shape="rect" id="node37" href="../../db/db1/a00460.html#a6e6619074ecb6b5ba4e4a23ffb2e4974" title="rocksdb::Env::NewRandomAccessFile" alt="" coords="688,447,936,476"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="741,500,883,529"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="731,553,893,583"/><area shape="rect" id="node35" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="987,393,1147,423"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="985,553,1148,583"/><area shape="rect" id="node54" href="../../da/d6b/a02352.html#ae3e0dbf7ac3255e91d16cd24fd2c2b1d" title="Cleanup" alt="" coords="777,675,847,704"/><area shape="rect" id="node56" href="../../da/d6b/a02352.html#ac70ab821a6607b4a1b909582dc37a069" title="sqlite3DbFree" alt="" coords="1016,675,1117,704"/><area shape="rect" id="node58" href="../../da/d6b/a02352.html#a770fa05ff9717b75e16f4d968a77b897" title="isLookaside" alt="" coords="1409,636,1500,665"/><area shape="rect" id="node60" href="../../da/d6b/a02352.html#acf77da68932b6bc163c5e68547ecc3e7" title="sqlite3_mutex_held" alt="" coords="1388,701,1521,731"/><area shape="rect" id="node62" href="../../da/d6b/a02352.html#aa397e5a8a03495203a0767abf0a71f86" title="sqlite3DbMallocSize" alt="" coords="1197,675,1339,704"/><area shape="rect" id="node70" href="../../d4/d9a/a00246.html#a0c407981dfc226d8ec65e6b076aab42d" title="rocksdb::Cache::Release" alt="" coords="727,805,897,835"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ace5e7f4084293eb426653ea279392111"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> * rocksdb::VersionSet::CompactRange </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/de6/a00723.html">InternalKey</a> *&#160;</td>
          <td class="paramname"><em>begin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/de6/a00723.html">InternalKey</a> *&#160;</td>
          <td class="paramname"><em>end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02904">2904</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00438">Compaction</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00576">rocksdb::Options::compaction_style</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02727">ExpandWhileOverlapping()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00646">rocksdb::Version::GetOverlappingInputs()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00611">rocksdb::Compaction::input_version_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00619">rocksdb::Compaction::inputs_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00057">rocksdb::kCompactionStyleUniversal</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03067">rocksdb::Compaction::MarkFilesBeingCompacted()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02107">MaxFileSizeForLevel()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02119">MaxGrandParentOverlapBytes()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00591">rocksdb::Version::Ref()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03079">rocksdb::Compaction::SetupBottomMostLevel()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02774">SetupOtherInputs()</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00339">rocksdb::Options::source_compaction_factor</a>.</p>
<div class="fragment"><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;                            {</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;  std::vector&lt;FileMetaData*&gt; inputs;</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;  <span class="comment">// All files are &#39;overlapping&#39; in universal style compaction.</span></div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;  <span class="comment">// We have to compact the entire range in one shot.</span></div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> == <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a>) {</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;    begin = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;    end = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;  }</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060">GetOverlappingInputs</a>(level, begin, end, &amp;inputs);</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;  <span class="keywordflow">if</span> (inputs.empty()) {</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;  }</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;  <span class="comment">// Avoid compacting too much in one shot in case the range is large.</span></div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;  <span class="comment">// But we cannot do this for level-0 since level-0 files can overlap</span></div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;  <span class="comment">// and we must not pick one file and drop another older file if the</span></div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;  <span class="comment">// two files overlap.</span></div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;  <span class="keywordflow">if</span> (level &gt; 0) {</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> limit = <a class="code" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5">MaxFileSizeForLevel</a>(level) *</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;                         <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a798495f44c8510270aac50a18135bd60">source_compaction_factor</a>;</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> total = 0;</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; inputs.size(); ++i) {</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;      <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> s = inputs[i]-&gt;file_size;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;      total += s;</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;      <span class="keywordflow">if</span> (total &gt;= limit) {</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;        inputs.resize(i + 1);</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;      }</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;    }</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;  }</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;  <span class="keywordtype">int</span> out_level = (<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> == <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a>) ?</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;                  level : level+1;</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a>* c = <span class="keyword">new</span> <a class="code" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a>(level, out_level, <a class="code" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5">MaxFileSizeForLevel</a>(out_level),</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a4f278dfbc54cda6dccee7d56f54e78ac">MaxGrandParentOverlapBytes</a>(level), <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>());</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;  c-&gt;inputs_[0] = inputs;</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#aec0ea29ca7b511b74376486592307d70">ExpandWhileOverlapping</a>(c);</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;  <span class="keywordflow">if</span> (c == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Could not compact due to expansion failure.\n&quot;</span>);</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;  }</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;  c-&gt;input_version_ = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>;</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;  c-&gt;input_version_-&gt;<a class="code" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2">Ref</a>();</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#ae62effcc413a67f9941cfc18a5d3bd93">SetupOtherInputs</a>(c);</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;  <span class="comment">// These files that are to be manaully compacted do not trample</span></div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;  <span class="comment">// upon other files because manual compactions are processed when</span></div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;  <span class="comment">// the system has a max of 1 background compaction thread.</span></div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;  c-&gt;MarkFilesBeingCompacted(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;  <span class="comment">// Is this compaction creating a file at the bottommost level</span></div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  c-&gt;SetupBottomMostLevel(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;  <span class="keywordflow">return</span> c;</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ace5e7f4084293eb426653ea279392111_cgraph.png" border="0" usemap="#d1/d42/a01800_ace5e7f4084293eb426653ea279392111_cgraph" alt=""/></div>
<map name="d1/d42/a01800_ace5e7f4084293eb426653ea279392111_cgraph" id="d1/d42/a01800_ace5e7f4084293eb426653ea279392111_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#aec0ea29ca7b511b74376486592307d70" title="rocksdb::VersionSet\l::ExpandWhileOverlapping" alt="" coords="211,81,387,127"/><area shape="rect" id="node29" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060" title="rocksdb::Version::GetOverlapping\lInputs" alt="" coords="720,182,939,229"/><area shape="rect" id="node58" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="513,625,609,655"/><area shape="rect" id="node60" href="../../d9/d5e/a00295.html#a11fbf1653e0ebe7db8c6e709de649557" title="rocksdb::Compaction\l::MarkFilesBeingCompacted" alt="" coords="205,403,392,450"/><area shape="rect" id="node62" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5" title="rocksdb::VersionSet\l::MaxFileSizeForLevel" alt="" coords="753,593,905,639"/><area shape="rect" id="node64" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="1027,671,1165,718"/><area shape="rect" id="node66" href="../../d1/d42/a01800.html#a4f278dfbc54cda6dccee7d56f54e78ac" title="rocksdb::VersionSet\l::MaxGrandParentOverlapBytes" alt="" coords="196,678,401,725"/><area shape="rect" id="node70" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="224,625,373,655"/><area shape="rect" id="node72" href="../../d9/d5e/a00295.html#a92210e9ffc40a91ed85a1068e9033f0a" title="rocksdb::Compaction\l::SetupBottomMostLevel" alt="" coords="216,313,381,359"/><area shape="rect" id="node79" href="../../d1/d42/a01800.html#ae62effcc413a67f9941cfc18a5d3bd93" title="rocksdb::VersionSet\l::SetupOtherInputs" alt="" coords="229,867,368,914"/><area shape="rect" id="node5" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="488,353,635,399"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588" title="rocksdb::VersionSet\l::GetRange" alt="" coords="760,919,899,966"/><area shape="rect" id="node51" href="../../d1/d42/a01800.html#a512e8e76628bdb9c867f6309d68fd412" title="rocksdb::VersionSet\l::FilesInCompaction" alt="" coords="760,30,899,77"/><area shape="rect" id="node53" href="../../d1/d42/a01800.html#a62eb602d1ca2dc2a9f0a87dfe184fb2c" title="rocksdb::VersionSet\l::ParentRangeInCompaction" alt="" coords="468,30,655,77"/><area shape="rect" id="node9" href="../../de/de6/a00723.html#af2bf0f2689f28795fc9d0533b6f04acf" title="rocksdb::InternalKey\l::Clear" alt="" coords="1025,859,1167,906"/><area shape="rect" id="node11" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="1253,842,1464,889"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#aab29434ed2c251eae44fdb498e4d8dcc" title="rocksdb::BumpPerfCount" alt="" coords="1533,785,1701,815"/><area shape="rect" id="node15" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="1545,662,1689,709"/><area shape="rect" id="node17" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="2040,836,2179,865"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1535,940,1700,969"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#ae015f9b23bbadef7eb4e3796c2d4fb46" title="rocksdb::ExtractUserKey" alt="" coords="1797,836,1965,865"/><area shape="rect" id="node26" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="2041,967,2177,996"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="1799,940,1964,969"/><area shape="rect" id="node32" href="../../d4/dd1/a01797.html#adadffeaebb14efe4d6af9c401e919e1e" title="rocksdb::Version::GetOverlapping\lInputsBinarySearch" alt="" coords="987,338,1205,385"/><area shape="rect" id="node38" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="1512,311,1723,358"/><area shape="rect" id="node40" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="1547,535,1688,582"/><area shape="rect" id="node35" href="../../d4/dd1/a01797.html#a8861eeaa29b1b1dd83c413f2da2b8738" title="rocksdb::Version::Extend\lOverlappingInputs" alt="" coords="1275,450,1443,497"/><area shape="rect" id="node43" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="1316,293,1401,323"/><area shape="rect" id="node45" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="1317,347,1400,376"/><area shape="rect" id="node76" href="../../d1/d42/a01800.html#a46a07e37f062ed0919878d92fb69a090" title="rocksdb::VersionSet\l::NumLevelFiles" alt="" coords="760,353,899,399"/><area shape="rect" id="node84" href="../../d1/d42/a01800.html#a300d694d7eba66eb5bb129ddfea015fa" title="rocksdb::VersionSet\l::GetRange2" alt="" coords="492,937,631,983"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="485,1007,637,1036"/><area shape="rect" id="node89" href="../../d1/d42/a01800.html#a31739d9b6c47d04ec18b7e717796c4ed" title="rocksdb::VersionSet\l::ExpandedCompactionByteSize\lLimit" alt="" coords="456,729,667,793"/><area shape="rect" id="node93" href="../../d4/dd1/a01797.html#a8ba59d2bda530f588042dcbad00d3b9d" title="rocksdb::Version::HasOverlapping\lUserKey" alt="" coords="451,867,672,914"/><area shape="rect" id="node98" href="../../de/de6/a00723.html#a6d86d2cfbd4205b41f29f84cdedf3c22" title="rocksdb::InternalKey\l::Encode" alt="" coords="1025,1027,1167,1074"/><area shape="rect" id="node103" href="../../de/de6/a00723.html#a1f29087f48fd168fe431e4b884f5aed1" title="rocksdb::InternalKey\l::DebugString" alt="" coords="1025,1113,1167,1159"/><area shape="rect" id="node107" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="1536,1180,1699,1209"/><area shape="rect" id="node121" href="../../d2/d86/a01798.html#ad1b747cb4b2572325d2622a9bcfb242d" title="rocksdb::VersionEdit\l::SetCompactPointer" alt="" coords="489,1262,633,1309"/><area shape="rect" id="node96" href="../../d4/d87/a03436.html#a382fc0a9bad90fe4253c354dd309f083" title="rocksdb::FindFile" alt="" coords="768,1020,891,1049"/><area shape="rect" id="node105" href="../../d6/d80/a01076.html#a36870425cc00e160004d62bd6118a24d" title="rocksdb::ParsedInternalKey\l::DebugString" alt="" coords="1268,1142,1449,1189"/><area shape="rect" id="node109" href="../../d4/d87/a03436.html#a4bf89f1a48c96450ef0d88b5c9f0a1ec" title="rocksdb::EscapeString" alt="" coords="1540,1095,1695,1124"/><area shape="rect" id="node114" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2" title="rocksdb::ParseInternalKey" alt="" coords="1271,1015,1447,1044"/><area shape="rect" id="node111" href="../../d4/d87/a03436.html#abd1b2064e9379d3df8f49bcdd26d7de0" title="rocksdb::AppendEscapedStringTo" alt="" coords="1772,1095,1991,1124"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae52f5390be942a7fc5b906074a33805b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/dd1/a01797.html">Version</a>* rocksdb::VersionSet::current </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00250">250</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>.</p>
<div class="fragment"><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>; }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ae52f5390be942a7fc5b906074a33805b_icgraph.png" border="0" usemap="#d1/d42/a01800_ae52f5390be942a7fc5b906074a33805b_icgraph" alt=""/></div>
<map name="d1/d42/a01800_ae52f5390be942a7fc5b906074a33805b_icgraph" id="d1/d42/a01800_ae52f5390be942a7fc5b906074a33805b_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#acf04defe0d794e6933785aad628ab9b6" title="rocksdb::VersionSet\l::Recover" alt="" coords="196,58,335,105"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="415,5,593,35"/><area shape="rect" id="node9" href="../../d0/d58/a01230.html#a769cf9f08028648f2cb824dbbf695de7" title="rocksdb::ReduceDBLevelsCommand\l::GetOldNumOfLevels" alt="" coords="385,58,623,105"/><area shape="rect" id="node11" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="673,87,911,134"/><area shape="rect" id="node7" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="767,5,817,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6a345ce36535de042e2e0d254ff66a5a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::VersionSet::DumpManifest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d57/a01054.html">Options</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string &amp;&#160;</td>
          <td class="paramname"><em>manifestFileName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>verbose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>hex</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01539">1539</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d6/dfc/a02612_source.html#l01193">AppendVersion()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01033">rocksdb::VersionSet::Builder::Apply()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00112">rocksdb::VersionEdit::comparator_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00042">rocksdb::Status::Corruption()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../df/d40/a02609_source.html#l00247">rocksdb::VersionEdit::DebugString()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00859">rocksdb::Version::DebugString()</a>, <a class="el" href="../../df/d40/a02609_source.html#l00122">rocksdb::VersionEdit::DecodeFrom()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00130">rocksdb::Options::env</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01674">Finalize()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00117">rocksdb::VersionEdit::has_comparator_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00121">rocksdb::VersionEdit::has_last_sequence_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00118">rocksdb::VersionEdit::has_log_number_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00120">rocksdb::VersionEdit::has_next_file_number_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00119">rocksdb::VersionEdit::has_prev_log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00475">icmp_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00048">rocksdb::Status::InvalidArgument()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00116">rocksdb::VersionEdit::last_sequence_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00478">last_sequence_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00113">rocksdb::VersionEdit::log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00479">log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00477">manifest_file_number_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01668">MarkFileNumberUsed()</a>, <a class="el" href="../../d0/d61/a00302.html#a3ef0d8f8f4fe04540c00cd4a9c9d5e84">rocksdb::Comparator::Name()</a>, <a class="el" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3">rocksdb::Env::NewSequentialFile()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00115">rocksdb::VersionEdit::next_file_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00476">next_file_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00114">rocksdb::VersionEdit::prev_log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00480">prev_log_number_</a>, <a class="el" href="../../d6/dae/a02581_source.html#l00064">rocksdb::log::Reader::ReadRecord()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01082">rocksdb::VersionSet::Builder::SaveTo()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02185">SizeBeingCompacted()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00515">storage_options_</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00107">rocksdb::InternalKeyComparator::user_comparator()</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00441">Version</a>.</p>

<p>Referenced by <a class="el" href="../../d6/d0b/a02741_source.html#l00491">rocksdb::ManifestDumpCommand::DoCommand()</a>.</p>
<div class="fragment"><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                            {</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <span class="keyword">struct </span>LogReporter : <span class="keyword">public</span> log::Reader::Reporter {</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a>* status;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> Corruption(<span class="keywordtype">size_t</span> bytes, <span class="keyword">const</span> <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a>&amp; s) {</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;      <span class="keywordflow">if</span> (this-&gt;status-&gt;ok()) *this-&gt;status = s;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    }</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  };</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  <span class="comment">// Open the specified manifest file.</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  unique_ptr&lt;SequentialFile&gt; file;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = options.env-&gt;NewSequentialFile(dscname, &amp;file, <a class="code" href="../../d1/d42/a01800.html#aa455bb240de0e461dbab37045dcc3e1c">storage_options_</a>);</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  }</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="keywordtype">bool</span> have_log_number = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  <span class="keywordtype">bool</span> have_prev_log_number = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <span class="keywordtype">bool</span> have_next_file = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  <span class="keywordtype">bool</span> have_last_sequence = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> next_file = 0;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> last_sequence = 0;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> log_number = 0;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> prev_log_number = 0;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  <span class="keywordtype">int</span> count = 0;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  VersionSet::Builder builder(<span class="keyword">this</span>, <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>);</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  {</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    LogReporter reporter;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    reporter.status = &amp;s;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    log::Reader reader(std::move(file), &amp;reporter, <span class="keyword">true</span><span class="comment">/*checksum*/</span>,</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                       0<span class="comment">/*initial_offset*/</span>);</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    Slice record;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    std::string scratch;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    <span class="keywordflow">while</span> (reader.ReadRecord(&amp;record, &amp;scratch) &amp;&amp; s.ok()) {</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;      VersionEdit edit(<a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>());</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;      s = edit.DecodeFrom(record);</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;      <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        <span class="keywordflow">if</span> (edit.has_comparator_ &amp;&amp;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;            edit.comparator_ != <a class="code" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a>.<a class="code" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a">user_comparator</a>()-&gt;<a class="code" href="../../d0/d61/a00302.html#a3ef0d8f8f4fe04540c00cd4a9c9d5e84">Name</a>()) {</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;          s = <a class="code" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba">Status::InvalidArgument</a>(<a class="code" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a>.<a class="code" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a">user_comparator</a>()-&gt;<a class="code" href="../../d0/d61/a00302.html#a3ef0d8f8f4fe04540c00cd4a9c9d5e84">Name</a>(),</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                                      <span class="stringliteral">&quot;does not match existing comparator &quot;</span> +</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                                      edit.comparator_);</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        }</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      }</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      <span class="comment">// Write out each individual edit</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <span class="keywordflow">if</span> (verbose) {</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        printf(<span class="stringliteral">&quot;*************************Edit[%d] = %s\n&quot;</span>,</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                count, edit.DebugString(hex).c_str());</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      }</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      count++;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;      <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        builder.Apply(&amp;edit);</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;      }</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;      <span class="keywordflow">if</span> (edit.has_log_number_) {</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        log_number = edit.log_number_;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;        have_log_number = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      }</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;      <span class="keywordflow">if</span> (edit.has_prev_log_number_) {</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        prev_log_number = edit.prev_log_number_;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        have_prev_log_number = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      }</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="keywordflow">if</span> (edit.has_next_file_number_) {</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        next_file = edit.next_file_number_;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        have_next_file = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      }</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      <span class="keywordflow">if</span> (edit.has_last_sequence_) {</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        last_sequence = edit.last_sequence_;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;        have_last_sequence = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;      }</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    }</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  }</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  file.reset();</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <span class="keywordflow">if</span> (!have_next_file) {</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      s = <a class="code" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d">Status::Corruption</a>(<span class="stringliteral">&quot;no meta-nextfile entry in descriptor&quot;</span>);</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      printf(<span class="stringliteral">&quot;no meta-nextfile entry in descriptor&quot;</span>);</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!have_log_number) {</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      s = <a class="code" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d">Status::Corruption</a>(<span class="stringliteral">&quot;no meta-lognumber entry in descriptor&quot;</span>);</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;      printf(<span class="stringliteral">&quot;no meta-lognumber entry in descriptor&quot;</span>);</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!have_last_sequence) {</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;      printf(<span class="stringliteral">&quot;no last-sequence-number entry in descriptor&quot;</span>);</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;      s = <a class="code" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d">Status::Corruption</a>(<span class="stringliteral">&quot;no last-sequence-number entry in descriptor&quot;</span>);</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    }</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    <span class="keywordflow">if</span> (!have_prev_log_number) {</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      prev_log_number = 0;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    }</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a5e1d11c285967cb347b090f67e5b34dd">MarkFileNumberUsed</a>(prev_log_number);</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a5e1d11c285967cb347b090f67e5b34dd">MarkFileNumberUsed</a>(log_number);</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  }</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;  <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#ace162f32d4abb584945d3a55a389b0a3">Version</a>* v = <span class="keyword">new</span> <a class="code" href="../../d1/d42/a01800.html#ace162f32d4abb584945d3a55a389b0a3">Version</a>(<span class="keyword">this</span>, 0);</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    builder.SaveTo(v);</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="comment">// Install recovered version</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    std::vector&lt;uint64_t&gt; size_being_compacted(<a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>()-1);</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#ac723248f990dd0f5de3eca23b292a501">SizeBeingCompacted</a>(size_being_compacted);</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3">Finalize</a>(v, size_being_compacted);</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#aa5b2b44d11b6085ed5deeb7a562d30a7">AppendVersion</a>(v);</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a> = next_file;</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a> = next_file + 1;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#ac9813d4953bf5d62a1bbd8f94ede1a15">last_sequence_</a> = last_sequence;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a8efe3b4907507a75117c3148fe888f9e">log_number_</a> = log_number;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a7fb8190a6ca751167dc288649b8849c3">prev_log_number_</a> = prev_log_number;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    printf(<span class="stringliteral">&quot;manifest_file_number %lu next_file_number %lu last_sequence &quot;</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;           <span class="stringliteral">&quot;%lu log_number %lu  prev_log_number %lu\n&quot;</span>,</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;           (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a>,</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;           (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a>,</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;           (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)last_sequence,</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;           (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)log_number,</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;           (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)prev_log_number);</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    printf(<span class="stringliteral">&quot;%s \n&quot;</span>, v-&gt;DebugString(hex).c_str());</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;  }</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a6a345ce36535de042e2e0d254ff66a5a_cgraph.png" border="0" usemap="#d1/d42/a01800_a6a345ce36535de042e2e0d254ff66a5a_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a6a345ce36535de042e2e0d254ff66a5a_cgraph" id="d1/d42/a01800_a6a345ce36535de042e2e0d254ff66a5a_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#aa5b2b44d11b6085ed5deeb7a562d30a7" title="rocksdb::VersionSet\l::AppendVersion" alt="" coords="233,46,372,93"/><area shape="rect" id="node9" href="../../d0/d27/a00239.html#a2ebf4c9e22b9adce7919b255dcb80393" title="rocksdb::VersionSet\l::Builder::Apply" alt="" coords="233,806,372,853"/><area shape="rect" id="node13" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="732,399,871,446"/><area shape="rect" id="node31" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="956,1076,1137,1105"/><area shape="rect" id="node35" href="../../d2/d86/a01798.html#ad5660b607bf9c559211211e0a63173f7" title="rocksdb::VersionEdit\l::DebugString" alt="" coords="232,530,373,577"/><area shape="rect" id="node42" href="../../d4/dd1/a01797.html#a182d34a1f180b6f3e93b910df003257a" title="rocksdb::Version::DebugString" alt="" coords="203,460,403,489"/><area shape="rect" id="node46" href="../../d2/d86/a01798.html#aa96a614beb016ddb66fa3fd0b2cc8a3f" title="rocksdb::VersionEdit\l::DecodeFrom" alt="" coords="232,1539,373,1586"/><area shape="rect" id="node70" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3" title="rocksdb::VersionSet\l::Finalize" alt="" coords="233,289,372,335"/><area shape="rect" id="node80" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba" title="rocksdb::Status::Invalid\lArgument" alt="" coords="967,677,1127,723"/><area shape="rect" id="node83" href="../../d1/d42/a01800.html#a5e1d11c285967cb347b090f67e5b34dd" title="rocksdb::VersionSet\l::MarkFileNumberUsed" alt="" coords="224,1678,381,1725"/><area shape="rect" id="node85" href="../../d0/d61/a00302.html#a3ef0d8f8f4fe04540c00cd4a9c9d5e84" title="rocksdb::Comparator\l::Name" alt="" coords="231,1747,375,1794"/><area shape="rect" id="node87" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="195,1817,411,1847"/><area shape="rect" id="node90" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="733,1060,869,1089"/><area shape="rect" id="node92" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="232,1217,373,1263"/><area shape="rect" id="node111" href="../../d0/d27/a00239.html#a61a3b1cccd9c3d386297a9cf999781d6" title="rocksdb::VersionSet\l::Builder::SaveTo" alt="" coords="233,875,372,922"/><area shape="rect" id="node118" href="../../d1/d42/a01800.html#ac723248f990dd0f5de3eca23b292a501" title="rocksdb::VersionSet\l::SizeBeingCompacted" alt="" coords="225,1609,380,1655"/><area shape="rect" id="node127" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="197,1870,408,1917"/><area shape="rect" id="node5" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="479,59,628,88"/><area shape="rect" id="node7" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="473,5,633,35"/><area shape="rect" id="node11" href="../../d0/d27/a00239.html#a70c9fbc2ead82d8e2e4722161341eb49" title="rocksdb::VersionSet\l::Builder::CheckConsistency" alt="" coords="459,806,648,853"/><area shape="rect" id="node29" href="../../d0/d27/a00239.html#aa80eab37c10d6aecd296315cd0e210de" title="rocksdb::VersionSet\l::Builder::CheckConsistency\lForDeletes" alt="" coords="459,668,648,732"/><area shape="rect" id="node15" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="696,901,907,947"/><area shape="rect" id="node21" href="../../de/de6/a00723.html#a1f29087f48fd168fe431e4b884f5aed1" title="rocksdb::InternalKey\l::DebugString" alt="" coords="731,806,872,853"/><area shape="rect" id="node17" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="977,1437,1116,1467"/><area shape="rect" id="node19" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="979,1336,1115,1365"/><area shape="rect" id="node23" href="../../d6/d80/a01076.html#a36870425cc00e160004d62bd6118a24d" title="rocksdb::ParsedInternalKey\l::DebugString" alt="" coords="956,959,1137,1006"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#a4bf89f1a48c96450ef0d88b5c9f0a1ec" title="rocksdb::EscapeString" alt="" coords="969,815,1124,844"/><area shape="rect" id="node25" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="1187,1199,1349,1228"/><area shape="rect" id="node33" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1188,881,1348,911"/><area shape="rect" id="node37" href="../../d4/d87/a03436.html#a6046b2d705859a672e4e63320133ee8e" title="rocksdb::AppendNumberTo" alt="" coords="463,460,644,489"/><area shape="rect" id="node40" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e" title="beast.util.Iter.first" alt="" coords="492,513,615,543"/><area shape="rect" id="node48" href="../../d2/d86/a01798.html#a9a7a27d2f256bfadb0b538c97c5524a1" title="rocksdb::VersionEdit\l::Clear" alt="" coords="483,1710,624,1757"/><area shape="rect" id="node51" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="479,1780,628,1809"/><area shape="rect" id="node53" href="../../d4/d87/a03436.html#a030ed538894432d224c6b2646fdde92e" title="rocksdb::GetInternalKey" alt="" coords="472,1833,635,1863"/><area shape="rect" id="node55" href="../../d4/d87/a03436.html#adeae0144b8eaea4c370172d4f6edaf48" title="rocksdb::GetLengthPrefixed\lSlice" alt="" coords="709,1850,893,1897"/><area shape="rect" id="node58" href="../../d2/d86/a01798.html#a734cb8f3cec65c72f32045b3449a6708" title="rocksdb::VersionEdit\l::GetLevel" alt="" coords="483,1539,624,1586"/><area shape="rect" id="node60" href="../../d4/d87/a03436.html#ad2427e2124d28ef6468f035303fcb22d" title="rocksdb::GetVarint32" alt="" coords="729,1545,873,1575"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#abef3500551ebbb64ab50e4abde1ab3b9" title="rocksdb::GetVarint64" alt="" coords="729,1489,873,1519"/><area shape="rect" id="node73" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="484,289,623,335"/><area shape="rect" id="node75" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="477,167,629,196"/><area shape="rect" id="node77" href="../../d1/d42/a01800.html#a1639228385c42402a661292f6a27a818" title="rocksdb::VersionSet\l::MaxBytesForLevel" alt="" coords="484,219,623,266"/><area shape="rect" id="node94" href="../../d5/d54/a01213.html#acb5bb46275c505b8eab7bceac8affd36" title="rocksdb::log::Reader\l::SkipToInitialBlock" alt="" coords="483,1097,624,1143"/><area shape="rect" id="node97" href="../../de/daf/a01417.html#a8f740f146e792dc89409f8402a61ad04" title="rocksdb::Slice::clear" alt="" coords="731,1284,872,1313"/><area shape="rect" id="node100" href="../../d5/d54/a01213.html#a57eb93a86418bd4a2b32ee163aecea5d" title="rocksdb::log::Reader\l::ReadPhysicalRecord" alt="" coords="477,1217,629,1263"/><area shape="rect" id="node105" href="../../d5/d54/a01213.html#a7db406791cb13477c816733858ea1e51" title="rocksdb::log::Reader\l::ReportCorruption" alt="" coords="731,1113,872,1159"/><area shape="rect" id="node115" href="../../d0/d27/a00239.html#a39f8d86429df9529e2d5e8dd2c6bc14f" title="rocksdb::VersionSet\l::Builder::MaybeAddFile" alt="" coords="473,875,633,922"/><area shape="rect" id="node121" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="480,2075,627,2122"/><area shape="rect" id="node123" href="../../d9/d5e/a00295.html#ae0e14955026684df1c7e261dc31fcb70" title="rocksdb::Compaction\l::num_input_files" alt="" coords="480,1937,627,1983"/><area shape="rect" id="node125" href="../../d9/d5e/a00295.html#a31e5be150c385f6df320ee7f7daf7a9a" title="rocksdb::Compaction\l::input" alt="" coords="480,2006,627,2053"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a6a345ce36535de042e2e0d254ff66a5a_icgraph.png" border="0" usemap="#d1/d42/a01800_a6a345ce36535de042e2e0d254ff66a5a_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a6a345ce36535de042e2e0d254ff66a5a_icgraph" id="d1/d42/a01800_a6a345ce36535de042e2e0d254ff66a5a_icgraph">
<area shape="rect" id="node3" href="../../dd/d20/a00939.html#a0a4996198d709bec7b49eec50ba36567" title="rocksdb::ManifestDumpCommand\l::DoCommand" alt="" coords="195,5,416,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a31739d9b6c47d04ec18b7e717796c4ed"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::ExpandedCompactionByteSizeLimit </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02113">2113</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d2/de3/a02637_source.html#l00330">rocksdb::Options::expanded_compaction_factor</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02107">MaxFileSizeForLevel()</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02774">SetupOtherInputs()</a>.</p>
<div class="fragment"><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                                                              {</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> result = <a class="code" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5">MaxFileSizeForLevel</a>(level);</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;  result *= <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#aae5cd3ec6a63cd19f616d09d1887639a">expanded_compaction_factor</a>;</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a31739d9b6c47d04ec18b7e717796c4ed_cgraph.png" border="0" usemap="#d1/d42/a01800_a31739d9b6c47d04ec18b7e717796c4ed_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a31739d9b6c47d04ec18b7e717796c4ed_cgraph" id="d1/d42/a01800_a31739d9b6c47d04ec18b7e717796c4ed_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5" title="rocksdb::VersionSet\l::MaxFileSizeForLevel" alt="" coords="264,14,416,61"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="465,14,604,61"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a31739d9b6c47d04ec18b7e717796c4ed_icgraph.png" border="0" usemap="#d1/d42/a01800_a31739d9b6c47d04ec18b7e717796c4ed_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a31739d9b6c47d04ec18b7e717796c4ed_icgraph" id="d1/d42/a01800_a31739d9b6c47d04ec18b7e717796c4ed_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#ae62effcc413a67f9941cfc18a5d3bd93" title="rocksdb::VersionSet\l::SetupOtherInputs" alt="" coords="265,39,404,86"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="455,5,593,51"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#ace5e7f4084293eb426653ea279392111" title="rocksdb::VersionSet\l::CompactRange" alt="" coords="455,74,593,121"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aec0ea29ca7b511b74376486592307d70"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::ExpandWhileOverlapping </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *&#160;</td>
          <td class="paramname"><em>c</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02727">2727</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02708">FilesInCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00646">rocksdb::Version::GetOverlappingInputs()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02029">GetRange()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00619">rocksdb::Compaction::inputs_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00547">rocksdb::Compaction::level()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l02698">ParentRangeInCompaction()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02904">CompactRange()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;                                                     {</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;  <span class="comment">// If inputs are empty then there is nothing to expand.</span></div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;  <span class="keywordflow">if</span> (!c || c-&gt;inputs_[0].empty()) {</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;  }</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;  <span class="comment">// GetOverlappingInputs will always do the right thing for level-0.</span></div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;  <span class="comment">// So we don&#39;t need to do any expansion if level == 0.</span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;  <span class="keywordflow">if</span> (c-&gt;level() == 0) {</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;  }</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> level = c-&gt;level();</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;  InternalKey smallest, largest;</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;  <span class="comment">// Keep expanding c-&gt;inputs_[0] until we are sure that there is a</span></div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;  <span class="comment">// &quot;clean cut&quot; boundary between the files in input and the surrounding files.</span></div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;  <span class="comment">// This will ensure that no parts of a key are lost during compaction.</span></div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;  <span class="keywordtype">int</span> hint_index = -1;</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;  <span class="keywordtype">size_t</span> old_size;</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;    old_size = c-&gt;inputs_[0].size();</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588">GetRange</a>(c-&gt;inputs_[0], &amp;smallest, &amp;largest);</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;    c-&gt;inputs_[0].clear();</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060">GetOverlappingInputs</a>(level, &amp;smallest, &amp;largest, &amp;c-&gt;inputs_[0],</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;                                   hint_index, &amp;hint_index);</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;  } <span class="keywordflow">while</span>(c-&gt;inputs_[0].size() &gt; old_size);</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;  <span class="comment">// Get the new range</span></div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588">GetRange</a>(c-&gt;inputs_[0], &amp;smallest, &amp;largest);</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;  <span class="comment">// If, after the expansion, there are files that are already under</span></div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;  <span class="comment">// compaction, then we must drop/cancel this compaction.</span></div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;  <span class="keywordtype">int</span> parent_index = -1;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#a512e8e76628bdb9c867f6309d68fd412">FilesInCompaction</a>(c-&gt;inputs_[0]) ||</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a62eb602d1ca2dc2a9f0a87dfe184fb2c">ParentRangeInCompaction</a>(&amp;smallest, &amp;largest, level, &amp;parent_index)) {</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;    c-&gt;inputs_[0].clear();</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    c-&gt;inputs_[1].clear();</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;    <span class="keyword">delete</span> c;</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    c = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;  }</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_aec0ea29ca7b511b74376486592307d70_cgraph.png" border="0" usemap="#d1/d42/a01800_aec0ea29ca7b511b74376486592307d70_cgraph" alt=""/></div>
<map name="d1/d42/a01800_aec0ea29ca7b511b74376486592307d70_cgraph" id="d1/d42/a01800_aec0ea29ca7b511b74376486592307d70_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a512e8e76628bdb9c867f6309d68fd412" title="rocksdb::VersionSet\l::FilesInCompaction" alt="" coords="504,267,643,314"/><area shape="rect" id="node5" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060" title="rocksdb::Version::GetOverlapping\lInputs" alt="" coords="464,337,683,383"/><area shape="rect" id="node33" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588" title="rocksdb::VersionSet\l::GetRange" alt="" coords="771,447,909,494"/><area shape="rect" id="node49" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="249,498,396,545"/><area shape="rect" id="node51" href="../../d1/d42/a01800.html#a62eb602d1ca2dc2a9f0a87dfe184fb2c" title="rocksdb::VersionSet\l::ParentRangeInCompaction" alt="" coords="229,327,416,374"/><area shape="rect" id="node7" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="1289,333,1433,379"/><area shape="rect" id="node9" href="../../d4/dd1/a01797.html#adadffeaebb14efe4d6af9c401e919e1e" title="rocksdb::Version::GetOverlapping\lInputsBinarySearch" alt="" coords="731,183,949,230"/><area shape="rect" id="node15" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="1256,9,1467,55"/><area shape="rect" id="node17" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="1291,258,1432,305"/><area shape="rect" id="node12" href="../../d4/dd1/a01797.html#a8861eeaa29b1b1dd83c413f2da2b8738" title="rocksdb::Version::Extend\lOverlappingInputs" alt="" coords="1019,69,1187,115"/><area shape="rect" id="node25" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="1060,139,1145,168"/><area shape="rect" id="node27" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="1061,192,1144,221"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#ae015f9b23bbadef7eb4e3796c2d4fb46" title="rocksdb::ExtractUserKey" alt="" coords="1516,465,1684,495"/><area shape="rect" id="node21" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1733,519,1872,548"/><area shape="rect" id="node23" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1735,440,1871,469"/><area shape="rect" id="node35" href="../../de/de6/a00723.html#af2bf0f2689f28795fc9d0533b6f04acf" title="rocksdb::InternalKey\l::Clear" alt="" coords="1032,447,1173,494"/><area shape="rect" id="node37" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="997,517,1208,563"/><area shape="rect" id="node39" href="../../d4/d87/a03436.html#aab29434ed2c251eae44fdb498e4d8dcc" title="rocksdb::BumpPerfCount" alt="" coords="1277,623,1445,652"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1279,519,1444,548"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="1517,519,1683,548"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_aec0ea29ca7b511b74376486592307d70_icgraph.png" border="0" usemap="#d1/d42/a01800_aec0ea29ca7b511b74376486592307d70_icgraph" alt=""/></div>
<map name="d1/d42/a01800_aec0ea29ca7b511b74376486592307d70_icgraph" id="d1/d42/a01800_aec0ea29ca7b511b74376486592307d70_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#ace5e7f4084293eb426653ea279392111" title="rocksdb::VersionSet\l::CompactRange" alt="" coords="231,5,369,51"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="231,74,369,121"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a512e8e76628bdb9c867f6309d68fd412"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::VersionSet::FilesInCompaction </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>files</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02708">2708</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02727">ExpandWhileOverlapping()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02698">ParentRangeInCompaction()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l02774">SetupOtherInputs()</a>.</p>
<div class="fragment"><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;                                                                  {</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; files.size(); i++) {</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;    <span class="keywordflow">if</span> (files[i]-&gt;being_compacted) {</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;    }</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  }</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a512e8e76628bdb9c867f6309d68fd412_icgraph.png" border="0" usemap="#d1/d42/a01800_a512e8e76628bdb9c867f6309d68fd412_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a512e8e76628bdb9c867f6309d68fd412_icgraph" id="d1/d42/a01800_a512e8e76628bdb9c867f6309d68fd412_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#aec0ea29ca7b511b74376486592307d70" title="rocksdb::VersionSet\l::ExpandWhileOverlapping" alt="" coords="429,74,605,121"/><area shape="rect" id="node9" href="../../d1/d42/a01800.html#a62eb602d1ca2dc2a9f0a87dfe184fb2c" title="rocksdb::VersionSet\l::ParentRangeInCompaction" alt="" coords="195,134,381,181"/><area shape="rect" id="node16" href="../../d1/d42/a01800.html#ae62effcc413a67f9941cfc18a5d3bd93" title="rocksdb::VersionSet\l::SetupOtherInputs" alt="" coords="448,5,587,51"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#ace5e7f4084293eb426653ea279392111" title="rocksdb::VersionSet\l::CompactRange" alt="" coords="655,21,793,67"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="655,119,793,166"/><area shape="rect" id="node11" href="../../d1/d42/a01800.html#a176e677ba6676e5160bbf1cd712d48e3" title="rocksdb::VersionSet\l::PickCompactionBySize" alt="" coords="433,194,601,241"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a69fd2eaa5b9d9f087b21d46d0a2a27e3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::Finalize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/dd1/a01797.html">Version</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>size_being_compacted</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01674">1674</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00195">rocksdb::Version::compaction_level_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00194">rocksdb::Version::compaction_score_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00576">rocksdb::Options::compaction_style</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00057">rocksdb::kCompactionStyleUniversal</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00272">rocksdb::Options::level0_file_num_compaction_trigger</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00277">rocksdb::Options::level0_slowdown_writes_trigger</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00280">rocksdb::Options::level0_stop_writes_trigger</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00196">rocksdb::Version::max_compaction_score_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00197">rocksdb::Version::max_compaction_score_level_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02099">MaxBytesForLevel()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, <a class="el" href="../../d5/d1b/a01971_source.html#l00116">beast::hash_metrics::detail::score()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l00031">rocksdb::TotalFileSize()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>.</p>
<div class="fragment"><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                                             {</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  <span class="keywordtype">double</span> max_score = 0;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;  <span class="keywordtype">int</span> max_score_level = 0;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  <span class="keywordtype">int</span> num_levels_to_check =</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      (<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> != <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a>) ?</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;          <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>() - 1 : 1;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; num_levels_to_check; level++) {</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527">score</a>;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <span class="keywordflow">if</span> (level == 0) {</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      <span class="comment">// We treat level-0 specially by bounding the number of files</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      <span class="comment">// instead of number of bytes for two reasons:</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      <span class="comment">// (1) With larger write-buffer sizes, it is nice not to do too</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;      <span class="comment">// many level-0 compactions.</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;      <span class="comment">// (2) The files in level-0 are merged on every read and</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      <span class="comment">// therefore we wish to avoid too many files when the individual</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      <span class="comment">// file size is small (perhaps because of a small write-buffer</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      <span class="comment">// setting, or very high compression ratios, or lots of</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      <span class="comment">// overwrites/deletions).</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;      <span class="keywordtype">int</span> numfiles = 0;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; v-&gt;files_[level].size(); i++) {</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        <span class="keywordflow">if</span> (!v-&gt;files_[level][i]-&gt;being_compacted) {</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;          numfiles++;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        }</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;      }</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;      <span class="comment">// If we are slowing down writes, then we better compact that first</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      <span class="keywordflow">if</span> (numfiles &gt;= <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a87841920dd59354a972c6e748c1a8232">level0_stop_writes_trigger</a>) {</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;        score = 1000000;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        <span class="comment">// Log(options_-&gt;info_log, &quot;XXX score l0 = 1000000000 max&quot;);</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (numfiles &gt;= <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#adf7dd332263dc0c5f23b08840a4c866b">level0_slowdown_writes_trigger</a>) {</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        score = 10000;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;        <span class="comment">// Log(options_-&gt;info_log, &quot;XXX score l0 = 1000000 medium&quot;);</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        score = numfiles /</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;          <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a61b4f31fe3214e38548552cac20bd3ae">level0_file_num_compaction_trigger</a>);</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        <span class="keywordflow">if</span> (score &gt;= 1) {</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;          <span class="comment">// Log(options_-&gt;info_log, &quot;XXX score l0 = %d least&quot;, (int)score);</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        }</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      }</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;      <span class="comment">// Compute the ratio of current size to size limit.</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> level_bytes = <a class="code" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e">TotalFileSize</a>(v-&gt;files_[level]) -</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;                                   size_being_compacted[level];</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      score = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(level_bytes) / <a class="code" href="../../d1/d42/a01800.html#a1639228385c42402a661292f6a27a818">MaxBytesForLevel</a>(level);</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      <span class="keywordflow">if</span> (score &gt; 1) {</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        <span class="comment">// Log(options_-&gt;info_log, &quot;XXX score l%d = %d &quot;, level, (int)score);</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      }</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      <span class="keywordflow">if</span> (max_score &lt; score) {</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        max_score = <a class="code" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527">score</a>;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        max_score_level = level;</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;      }</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    }</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    v-&gt;compaction_level_[level] = level;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    v-&gt;compaction_score_[level] = <a class="code" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527">score</a>;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  }</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  <span class="comment">// update the max compaction score in levels 1 to n-1</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  v-&gt;max_compaction_score_ = max_score;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;  v-&gt;max_compaction_score_level_ = max_score_level;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;  <span class="comment">// sort all the levels based on their score. Higher scores get listed</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  <span class="comment">// first. Use bubble sort because the number of entries are small.</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;  <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>()-2; i++) {</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = i+1; j &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>()-1; j++) {</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;      <span class="keywordflow">if</span> (v-&gt;compaction_score_[i] &lt; v-&gt;compaction_score_[j]) {</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        <span class="keywordtype">double</span> score = v-&gt;compaction_score_[i];</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        <span class="keywordtype">int</span> level = v-&gt;compaction_level_[i];</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        v-&gt;compaction_score_[i] = v-&gt;compaction_score_[j];</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;        v-&gt;compaction_level_[i] = v-&gt;compaction_level_[j];</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        v-&gt;compaction_score_[j] = <a class="code" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527">score</a>;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;        v-&gt;compaction_level_[j] = level;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      }</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    }</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  }</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a69fd2eaa5b9d9f087b21d46d0a2a27e3_cgraph.png" border="0" usemap="#d1/d42/a01800_a69fd2eaa5b9d9f087b21d46d0a2a27e3_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a69fd2eaa5b9d9f087b21d46d0a2a27e3_cgraph" id="d1/d42/a01800_a69fd2eaa5b9d9f087b21d46d0a2a27e3_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a1639228385c42402a661292f6a27a818" title="rocksdb::VersionSet\l::MaxBytesForLevel" alt="" coords="201,5,340,51"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="396,30,535,77"/><area shape="rect" id="node8" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="201,125,340,171"/><area shape="rect" id="node12" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="195,195,347,224"/><area shape="rect" id="node10" href="../../d0/dbf/a03363.html#a75c05654caed31bf91b09dbc14e681d1" title="beast::hash_metrics\l::detail::sqr" alt="" coords="396,125,535,171"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a69fd2eaa5b9d9f087b21d46d0a2a27e3_icgraph.png" border="0" usemap="#d1/d42/a01800_a69fd2eaa5b9d9f087b21d46d0a2a27e3_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a69fd2eaa5b9d9f087b21d46d0a2a27e3_icgraph" id="d1/d42/a01800_a69fd2eaa5b9d9f087b21d46d0a2a27e3_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6a345ce36535de042e2e0d254ff66a5a" title="rocksdb::VersionSet\l::DumpManifest" alt="" coords="196,1431,335,1478"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="196,1561,335,1607"/><area shape="rect" id="node102" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="196,1710,335,1757"/><area shape="rect" id="node104" href="../../d1/d42/a01800.html#acf04defe0d794e6933785aad628ab9b6" title="rocksdb::VersionSet\l::Recover" alt="" coords="2272,1650,2411,1697"/><area shape="rect" id="node5" href="../../dd/d20/a00939.html#a0a4996198d709bec7b49eec50ba36567" title="rocksdb::ManifestDumpCommand\l::DoCommand" alt="" coords="384,1401,605,1447"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2519,1547,2697,1576"/><area shape="rect" id="node13" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="396,1470,593,1517"/><area shape="rect" id="node99" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="661,1590,835,1637"/><area shape="rect" id="node11" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2871,1547,2921,1576"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="653,987,843,1034"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1187,909,1384,955"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1187,1013,1384,1059"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="892,969,1137,999"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1432,909,1629,955"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1677,923,1925,952"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1973,823,2195,870"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2243,1013,2440,1059"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2255,59,2428,88"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2244,249,2439,295"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2253,595,2429,624"/><area shape="rect" id="node46" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2275,856,2408,885"/><area shape="rect" id="node89" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2260,717,2423,763"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2503,1493,2713,1523"/><area shape="rect" id="node34" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2533,59,2683,88"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2505,5,2711,35"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2529,112,2687,141"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2553,165,2663,195"/><area shape="rect" id="node48" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2527,549,2689,595"/><area shape="rect" id="node50" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2537,618,2679,665"/><area shape="rect" id="node52" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2508,688,2708,717"/><area shape="rect" id="node54" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2512,741,2704,771"/><area shape="rect" id="node56" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2553,795,2663,824"/><area shape="rect" id="node59" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2528,847,2688,894"/><area shape="rect" id="node61" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2547,917,2669,947"/><area shape="rect" id="node63" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2540,970,2676,1017"/><area shape="rect" id="node65" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2512,1039,2704,1086"/><area shape="rect" id="node67" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2512,1109,2704,1155"/><area shape="rect" id="node69" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2500,1179,2716,1208"/><area shape="rect" id="node71" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2527,1231,2689,1278"/><area shape="rect" id="node73" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2583,1301,2633,1331"/><area shape="rect" id="node75" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2539,1354,2677,1401"/><area shape="rect" id="node77" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2519,287,2697,334"/><area shape="rect" id="node79" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2527,1423,2689,1470"/><area shape="rect" id="node83" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2525,357,2691,387"/><area shape="rect" id="node85" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2539,410,2677,457"/><area shape="rect" id="node87" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2536,479,2680,526"/><area shape="rect" id="node81" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="2777,1625,3015,1671"/><area shape="rect" id="node91" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="2517,218,2699,265"/><area shape="rect" id="node107" href="../../d0/d58/a01230.html#a769cf9f08028648f2cb824dbbf695de7" title="rocksdb::ReduceDBLevelsCommand\l::GetOldNumOfLevels" alt="" coords="2489,1650,2727,1697"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7916db473b10047e2acae9d12d1ff817"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::GetLiveFilesMetaData </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d2/dab/a00886.html">LiveFileMetaData</a> &gt; *&#160;</td>
          <td class="paramname"><em>metadata</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02879">2879</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../d8/d70/a02629_source.html#l00043">rocksdb::LiveFileMetaData::largest_seqno</a>, <a class="el" href="../../d8/d70/a02629_source.html#l00041">rocksdb::LiveFileMetaData::largestkey</a>, <a class="el" href="../../d8/d70/a02629_source.html#l00038">rocksdb::LiveFileMetaData::level</a>, <a class="el" href="../../d8/d70/a02629_source.html#l00037">rocksdb::LiveFileMetaData::name</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../d8/d70/a02629_source.html#l00039">rocksdb::LiveFileMetaData::size</a>, <a class="el" href="../../d8/d70/a02629_source.html#l00042">rocksdb::LiveFileMetaData::smallest_seqno</a>, <a class="el" href="../../d8/d70/a02629_source.html#l00040">rocksdb::LiveFileMetaData::smallestkey</a>, and <a class="el" href="../../da/d03/a02577_source.html#l00073">rocksdb::TableFileName()</a>.</p>
<div class="fragment"><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;                                            {</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(); level++) {</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;    <span class="keyword">const</span> std::vector&lt;FileMetaData*&gt;&amp; files = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level];</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; files.size(); i++) {</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;      LiveFileMetaData filemetadata;</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;      filemetadata.name = <a class="code" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a">TableFileName</a>(<span class="stringliteral">&quot;&quot;</span>, files[i]-&gt;number);</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;      filemetadata.level = level;</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;      filemetadata.size = files[i]-&gt;file_size;</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;      filemetadata.smallestkey = files[i]-&gt;smallest.user_key().ToString();</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;      filemetadata.largestkey = files[i]-&gt;largest.user_key().ToString();</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;      filemetadata.smallest_seqno = files[i]-&gt;smallest_seqno;</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;      filemetadata.largest_seqno = files[i]-&gt;largest_seqno;</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;      metadata-&gt;push_back(filemetadata);</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;    }</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;  }</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a7916db473b10047e2acae9d12d1ff817_cgraph.png" border="0" usemap="#d1/d42/a01800_a7916db473b10047e2acae9d12d1ff817_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a7916db473b10047e2acae9d12d1ff817_cgraph" id="d1/d42/a01800_a7916db473b10047e2acae9d12d1ff817_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="227,5,365,51"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="215,75,377,104"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="428,75,591,104"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4adc0625af13d9bbe2ed45960942e910"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::VersionSet::GetMetadataForFile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td>
          <td class="paramname"><em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>filelevel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> *&#160;</td>
          <td class="paramname"><em>metadata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02862">2862</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00039">rocksdb::Status::NotFound()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, and <a class="el" href="../../d5/d96/a02642_source.html#l00036">rocksdb::Status::OK()</a>.</p>
<div class="fragment"><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;                        {</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(); level++) {</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;    <span class="keyword">const</span> std::vector&lt;FileMetaData*&gt;&amp; files = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level];</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; files.size(); i++) {</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;      <span class="keywordflow">if</span> (files[i]-&gt;number == number) {</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;        *<a class="code" href="../../de/d94/a02597.html#a6b8f1f5fc8f36aa1678fff8fa5aecd0b">meta</a> = *files[i];</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;        *filelevel = level;</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00">Status::OK</a>();</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;      }</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    }</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;  }</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#a415510a7cc15542538c80c790d2bb4af">Status::NotFound</a>(<span class="stringliteral">&quot;File not present in any level&quot;</span>);</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a4adc0625af13d9bbe2ed45960942e910_cgraph.png" border="0" usemap="#d1/d42/a01800_a4adc0625af13d9bbe2ed45960942e910_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a4adc0625af13d9bbe2ed45960942e910_cgraph" id="d1/d42/a01800_a4adc0625af13d9bbe2ed45960942e910_cgraph">
<area shape="rect" id="node3" href="../../d0/db9/a01552.html#a415510a7cc15542538c80c790d2bb4af" title="rocksdb::Status::NotFound" alt="" coords="200,5,379,35"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="220,58,359,105"/><area shape="rect" id="node9" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="219,128,360,157"/><area shape="rect" id="node5" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="427,67,587,96"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8c83b4ba80213628c2b9771f8b6c9039"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::GetObsoleteFiles </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> * &gt; *&#160;</td>
          <td class="paramname"><em>files</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02897">2897</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00512">obsolete_files_</a>.</p>
<div class="fragment"><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;                                                                 {</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;  files-&gt;insert(files-&gt;end(),</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;                <a class="code" href="../../d1/d42/a01800.html#abae36f2c040724d34e2ef7c4a4ae2013">obsolete_files_</a>.begin(),</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;                <a class="code" href="../../d1/d42/a01800.html#abae36f2c040724d34e2ef7c4a4ae2013">obsolete_files_</a>.end());</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#abae36f2c040724d34e2ef7c4a4ae2013">obsolete_files_</a>.clear();</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a49822736d0cb083b87cca21346af7588"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::GetRange </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>inputs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/de6/a00723.html">InternalKey</a> *&#160;</td>
          <td class="paramname"><em>smallest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/de6/a00723.html">InternalKey</a> *&#160;</td>
          <td class="paramname"><em>largest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02029">2029</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../dc/db2/a02574_source.html#l00148">rocksdb::InternalKey::Clear()</a>, <a class="el" href="../../d2/ddf/a02573_source.html#l00056">rocksdb::InternalKeyComparator::Compare()</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00475">icmp_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00026">rocksdb::FileMetaData::largest</a>, and <a class="el" href="../../de/d3b/a02610_source.html#l00025">rocksdb::FileMetaData::smallest</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02727">ExpandWhileOverlapping()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02054">GetRange2()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l02774">SetupOtherInputs()</a>.</p>
<div class="fragment"><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                                                {</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  assert(!inputs.empty());</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;  smallest-&gt;Clear();</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  largest-&gt;Clear();</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; inputs.size(); i++) {</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    FileMetaData* <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> = inputs[i];</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;      *smallest = f-&gt;smallest;</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;      *largest = f-&gt;largest;</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a>.<a class="code" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8">Compare</a>(f-&gt;smallest, *smallest) &lt; 0) {</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;        *smallest = f-&gt;smallest;</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      }</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a>.<a class="code" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8">Compare</a>(f-&gt;largest, *largest) &gt; 0) {</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        *largest = f-&gt;largest;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      }</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    }</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;  }</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a49822736d0cb083b87cca21346af7588_cgraph.png" border="0" usemap="#d1/d42/a01800_a49822736d0cb083b87cca21346af7588_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a49822736d0cb083b87cca21346af7588_cgraph" id="d1/d42/a01800_a49822736d0cb083b87cca21346af7588_cgraph">
<area shape="rect" id="node3" href="../../de/de6/a00723.html#af2bf0f2689f28795fc9d0533b6f04acf" title="rocksdb::InternalKey\l::Clear" alt="" coords="229,77,371,123"/><area shape="rect" id="node5" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="195,146,405,193"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#aab29434ed2c251eae44fdb498e4d8dcc" title="rocksdb::BumpPerfCount" alt="" coords="455,5,623,35"/><area shape="rect" id="node9" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="467,58,611,105"/><area shape="rect" id="node11" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="687,195,825,224"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="456,128,621,157"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ae015f9b23bbadef7eb4e3796c2d4fb46" title="rocksdb::ExtractUserKey" alt="" coords="455,232,623,261"/><area shape="rect" id="node20" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="688,272,824,301"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="673,128,839,157"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a49822736d0cb083b87cca21346af7588_icgraph.png" border="0" usemap="#d1/d42/a01800_a49822736d0cb083b87cca21346af7588_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a49822736d0cb083b87cca21346af7588_icgraph" id="d1/d42/a01800_a49822736d0cb083b87cca21346af7588_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#aec0ea29ca7b511b74376486592307d70" title="rocksdb::VersionSet\l::ExpandWhileOverlapping" alt="" coords="384,110,560,157"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="609,110,748,157"/><area shape="rect" id="node9" href="../../d1/d42/a01800.html#a300d694d7eba66eb5bb129ddfea015fa" title="rocksdb::VersionSet\l::GetRange2" alt="" coords="196,5,335,51"/><area shape="rect" id="node11" href="../../d1/d42/a01800.html#ae62effcc413a67f9941cfc18a5d3bd93" title="rocksdb::VersionSet\l::SetupOtherInputs" alt="" coords="403,41,541,87"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#ace5e7f4084293eb426653ea279392111" title="rocksdb::VersionSet\l::CompactRange" alt="" coords="609,41,748,87"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a300d694d7eba66eb5bb129ddfea015fa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::GetRange2 </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>inputs1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>inputs2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/de6/a00723.html">InternalKey</a> *&#160;</td>
          <td class="paramname"><em>smallest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/de6/a00723.html">InternalKey</a> *&#160;</td>
          <td class="paramname"><em>largest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02054">2054</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d6/dfc/a02612_source.html#l02029">GetRange()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02774">SetupOtherInputs()</a>.</p>
<div class="fragment"><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;                                                 {</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;  std::vector&lt;FileMetaData*&gt; all = inputs1;</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;  all.insert(all.end(), inputs2.begin(), inputs2.end());</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588">GetRange</a>(all, smallest, largest);</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a300d694d7eba66eb5bb129ddfea015fa_cgraph.png" border="0" usemap="#d1/d42/a01800_a300d694d7eba66eb5bb129ddfea015fa_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a300d694d7eba66eb5bb129ddfea015fa_cgraph" id="d1/d42/a01800_a300d694d7eba66eb5bb129ddfea015fa_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588" title="rocksdb::VersionSet\l::GetRange" alt="" coords="196,111,335,158"/><area shape="rect" id="node5" href="../../de/de6/a00723.html#af2bf0f2689f28795fc9d0533b6f04acf" title="rocksdb::InternalKey\l::Clear" alt="" coords="419,77,560,123"/><area shape="rect" id="node7" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="384,146,595,193"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#aab29434ed2c251eae44fdb498e4d8dcc" title="rocksdb::BumpPerfCount" alt="" coords="644,5,812,35"/><area shape="rect" id="node11" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="656,58,800,105"/><area shape="rect" id="node13" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="876,195,1015,224"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="645,128,811,157"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#ae015f9b23bbadef7eb4e3796c2d4fb46" title="rocksdb::ExtractUserKey" alt="" coords="644,232,812,261"/><area shape="rect" id="node22" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="877,272,1013,301"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="863,128,1028,157"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a300d694d7eba66eb5bb129ddfea015fa_icgraph.png" border="0" usemap="#d1/d42/a01800_a300d694d7eba66eb5bb129ddfea015fa_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a300d694d7eba66eb5bb129ddfea015fa_icgraph" id="d1/d42/a01800_a300d694d7eba66eb5bb129ddfea015fa_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#ae62effcc413a67f9941cfc18a5d3bd93" title="rocksdb::VersionSet\l::SetupOtherInputs" alt="" coords="196,39,335,86"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="385,5,524,51"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#ace5e7f4084293eb426653ea279392111" title="rocksdb::VersionSet\l::CompactRange" alt="" coords="385,74,524,121"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="add78f5ab4cff29b479bed39a64406732"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::Init </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_levels</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01173">1173</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d2/de3/a02637_source.html#l00576">rocksdb::Options::compaction_style</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00057">rocksdb::kCompactionStyleUniversal</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00497">level_max_bytes_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00316">rocksdb::Options::max_bytes_for_level_base</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00318">rocksdb::Options::max_bytes_for_level_multiplier</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00324">rocksdb::Options::max_bytes_for_level_multiplier_additional</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00494">max_file_size_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00300">rocksdb::Options::target_file_size_base</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00303">rocksdb::Options::target_file_size_multiplier</a>, and <a class="el" href="../../d8/d24/a02001_source.html#l00033">ULLONG_MAX</a>.</p>

<p>Referenced by <a class="el" href="../../dc/dd5/a02614_source.html#l00020">ReduceNumberOfLevels()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01133">VersionSet()</a>.</p>
<div class="fragment"><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                                    {</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a118a633a8d1ff038ab5506ad9044d086">max_file_size_</a> = <span class="keyword">new</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>[num_levels];</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a8e79f8d904167a1092d337c82093a629">level_max_bytes_</a> = <span class="keyword">new</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>[num_levels];</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <span class="keywordtype">int</span> target_file_size_multiplier = <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a9b3f43fe0792c8c00994a972f183dcde">target_file_size_multiplier</a>;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <span class="keywordtype">int</span> max_bytes_multiplier = <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#aba06b711c0c7f1e1906a245d8cf74443">max_bytes_for_level_multiplier</a>;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num_levels; i++) {</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordflow">if</span> (i == 0 &amp;&amp; <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> == <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a>) {</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a118a633a8d1ff038ab5506ad9044d086">max_file_size_</a>[i] = <a class="code" href="../../d8/d24/a02001.html#aa1dd7166a75b73ad62b111ae6fc17c59">ULLONG_MAX</a>;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a8e79f8d904167a1092d337c82093a629">level_max_bytes_</a>[i] = <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#ac70bd2b7080a7f1856d4df18f2c756ba">max_bytes_for_level_base</a>;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &gt; 1) {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a118a633a8d1ff038ab5506ad9044d086">max_file_size_</a>[i] = <a class="code" href="../../d1/d42/a01800.html#a118a633a8d1ff038ab5506ad9044d086">max_file_size_</a>[i-1] * target_file_size_multiplier;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a8e79f8d904167a1092d337c82093a629">level_max_bytes_</a>[i] = <a class="code" href="../../d1/d42/a01800.html#a8e79f8d904167a1092d337c82093a629">level_max_bytes_</a>[i-1] * max_bytes_multiplier *</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a2467cd908bf2283db8cd64514a271044">max_bytes_for_level_multiplier_additional</a>[i-1];</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a118a633a8d1ff038ab5506ad9044d086">max_file_size_</a>[i] = <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a47cc74b33236b7c55672d7e35e110a20">target_file_size_base</a>;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a8e79f8d904167a1092d337c82093a629">level_max_bytes_</a>[i] = <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#ac70bd2b7080a7f1856d4df18f2c756ba">max_bytes_for_level_base</a>;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    }</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  }</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_add78f5ab4cff29b479bed39a64406732_icgraph.png" border="0" usemap="#d1/d42/a01800_add78f5ab4cff29b479bed39a64406732_icgraph" alt=""/></div>
<map name="d1/d42/a01800_add78f5ab4cff29b479bed39a64406732_icgraph" id="d1/d42/a01800_add78f5ab4cff29b479bed39a64406732_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="195,5,368,51"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a83b61f7b0a60a303e2b412acf0f270f1" title="rocksdb::VersionSet\l::VersionSet" alt="" coords="212,74,351,121"/><area shape="rect" id="node5" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="417,5,655,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a53c324dec1c1d73477851c6ffa05fd35"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::LastSequence </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00274">274</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00478">last_sequence_</a>.</p>
<div class="fragment"><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#ac9813d4953bf5d62a1bbd8f94ede1a15">last_sequence_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9ed02b6e79c2fde606142311ba7f3fd0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * rocksdb::VersionSet::LevelDataSizeSummary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d7b/a00865.html">LevelSummaryStorage</a> *&#160;</td>
          <td class="paramname"><em>scratch</em>)</td><td></td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01870">1870</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00366">rocksdb::VersionSet::LevelSummaryStorage::buffer</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l02002">NumLevelBytes()</a>.</p>
<div class="fragment"><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                                        {</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;  <span class="keywordtype">int</span> len = snprintf(scratch-&gt;buffer, <span class="keyword">sizeof</span>(scratch-&gt;buffer), <span class="stringliteral">&quot;files_size[&quot;</span>);</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(); i++) {</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(scratch-&gt;buffer) - len;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keywordtype">int</span> ret = snprintf(scratch-&gt;buffer + len, sz, <span class="stringliteral">&quot;%lu &quot;</span>,</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="../../d1/d42/a01800.html#ab0315528b5040a26724d06e9707692b4">NumLevelBytes</a>(i));</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordflow">if</span> (ret &lt; 0 || ret &gt;= sz)</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    len += ret;</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;  }</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;  snprintf(scratch-&gt;buffer + len, <span class="keyword">sizeof</span>(scratch-&gt;buffer) - len, <span class="stringliteral">&quot;]&quot;</span>);</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;  <span class="keywordflow">return</span> scratch-&gt;buffer;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a9ed02b6e79c2fde606142311ba7f3fd0_cgraph.png" border="0" usemap="#d1/d42/a01800_a9ed02b6e79c2fde606142311ba7f3fd0_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a9ed02b6e79c2fde606142311ba7f3fd0_cgraph" id="d1/d42/a01800_a9ed02b6e79c2fde606142311ba7f3fd0_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="420,5,559,51"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#ab0315528b5040a26724d06e9707692b4" title="rocksdb::VersionSet\l::NumLevelBytes" alt="" coords="225,65,364,111"/><area shape="rect" id="node8" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="413,75,565,104"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae6adf63444a6a5f7dc4ad0bd751a0c13"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * rocksdb::VersionSet::LevelFileSummary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d8b/a00547.html">FileSummaryStorage</a> *&#160;</td>
          <td class="paramname"><em>scratch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01885">1885</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../de/d3b/a02610_source.html#l00027">rocksdb::FileMetaData::being_compacted</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00369">rocksdb::VersionSet::FileSummaryStorage::buffer</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00024">rocksdb::FileMetaData::file_size</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00023">rocksdb::FileMetaData::number</a>, and <a class="el" href="../../de/d3b/a02610_source.html#l00028">rocksdb::FileMetaData::smallest_seqno</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02443">PickCompactionUniversal()</a>.</p>
<div class="fragment"><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                                                  {</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  <span class="keywordtype">int</span> len = snprintf(scratch-&gt;buffer, <span class="keyword">sizeof</span>(scratch-&gt;buffer), <span class="stringliteral">&quot;files_size[&quot;</span>);</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level].size(); i++) {</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    FileMetaData* <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][i];</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(scratch-&gt;buffer) - len;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    <span class="keywordtype">int</span> ret = snprintf(scratch-&gt;buffer + len, sz,</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                       <span class="stringliteral">&quot;#%lu(seq=%lu,sz=%lu,%lu) &quot;</span>,</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                       (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;number,</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                       (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;smallest_seqno,</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                       (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;file_size,</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;                       (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;being_compacted);</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    <span class="keywordflow">if</span> (ret &lt; 0 || ret &gt;= sz)</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    len += ret;</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;  }</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;  snprintf(scratch-&gt;buffer + len, <span class="keyword">sizeof</span>(scratch-&gt;buffer) - len, <span class="stringliteral">&quot;]&quot;</span>);</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  <span class="keywordflow">return</span> scratch-&gt;buffer;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ae6adf63444a6a5f7dc4ad0bd751a0c13_icgraph.png" border="0" usemap="#d1/d42/a01800_ae6adf63444a6a5f7dc4ad0bd751a0c13_icgraph" alt=""/></div>
<map name="d1/d42/a01800_ae6adf63444a6a5f7dc4ad0bd751a0c13_icgraph" id="d1/d42/a01800_ae6adf63444a6a5f7dc4ad0bd751a0c13_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a809a5b39c87ab02b0e3a438609e2bdfb" title="rocksdb::VersionSet\l::PickCompactionUniversal" alt="" coords="195,5,376,51"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="425,5,564,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4d9d66f1d05b0e3351f1cca8b72552cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * rocksdb::VersionSet::LevelSummary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d7b/a00865.html">LevelSummaryStorage</a> *&#160;</td>
          <td class="paramname"><em>scratch</em>)</td><td></td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01856">1856</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00366">rocksdb::VersionSet::LevelSummaryStorage::buffer</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>.</p>
<div class="fragment"><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                                                                       {</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;  <span class="keywordtype">int</span> len = snprintf(scratch-&gt;buffer, <span class="keyword">sizeof</span>(scratch-&gt;buffer), <span class="stringliteral">&quot;files[&quot;</span>);</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(); i++) {</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(scratch-&gt;buffer) - len;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    <span class="keywordtype">int</span> ret = snprintf(scratch-&gt;buffer + len, sz, <span class="stringliteral">&quot;%d &quot;</span>,</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        <span class="keywordtype">int</span>(<a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[i].size()));</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="keywordflow">if</span> (ret &lt; 0 || ret &gt;= sz)</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    len += ret;</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;  }</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;  snprintf(scratch-&gt;buffer + len, <span class="keyword">sizeof</span>(scratch-&gt;buffer) - len, <span class="stringliteral">&quot;]&quot;</span>);</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;  <span class="keywordflow">return</span> scratch-&gt;buffer;</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a4d9d66f1d05b0e3351f1cca8b72552cb_cgraph.png" border="0" usemap="#d1/d42/a01800_a4d9d66f1d05b0e3351f1cca8b72552cb_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a4d9d66f1d05b0e3351f1cca8b72552cb_cgraph" id="d1/d42/a01800_a4d9d66f1d05b0e3351f1cca8b72552cb_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="196,5,335,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8d4bdcc8a079afc6fcac4f19fbaf1d50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::VersionSet::LogAndApply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d2/d86/a01798.html">VersionEdit</a> *&#160;</td>
          <td class="paramname"><em>edit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/a00998.html">port::Mutex</a> *&#160;</td>
          <td class="paramname"><em>mu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>new_descriptor_log</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01211">1211</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d6/dfc/a02612_source.html#l01193">AppendVersion()</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00503">current_version_number_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00891">rocksdb::VersionSet::ManifestWriter::cv</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00472">dbname_</a>, <a class="el" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">rocksdb::Env::DeleteFile()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00485">descriptor_log_</a>, <a class="el" href="../../da/d03/a02577_source.html#l00078">rocksdb::DescriptorFileName()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00890">rocksdb::VersionSet::ManifestWriter::done</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00892">rocksdb::VersionSet::ManifestWriter::edit</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00471">env_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01674">Finalize()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00143">rocksdb::Version::GetVersionNumber()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00510">last_observed_manifest_size_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00113">rocksdb::VersionEdit::log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00479">log_number_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01379">LogAndApplyHelper()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00477">manifest_file_number_</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00172">rocksdb::MANIFEST_FILE_SYNC_MICROS</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00506">manifest_writers_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01907">ManifestContains()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00452">rocksdb::Options::max_manifest_file_size</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00256">NewFileNumber()</a>, <a class="el" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47">rocksdb::Env::NewWritableFile()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00476">next_file_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00200">rocksdb::Version::offset_manifest_file_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00036">rocksdb::Status::OK()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00114">rocksdb::VersionEdit::prev_log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00480">prev_log_number_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01082">rocksdb::VersionSet::Builder::SaveTo()</a>, <a class="el" href="../../da/d03/a02577_source.html#l00233">rocksdb::SetCurrentFile()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00057">rocksdb::VersionEdit::SetNextFile()</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00063">rocksdb::port::CondVar::Signal()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02185">SizeBeingCompacted()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00348">rocksdb::Options::statistics</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00889">rocksdb::VersionSet::ManifestWriter::status</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00515">storage_options_</a>, <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01776">UpdateFilesBySize()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00363">rocksdb::Options::use_fsync</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00441">Version</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00059">rocksdb::port::CondVar::Wait()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01819">WriteSnapshot()</a>.</p>

<p>Referenced by <a class="el" href="../../d9/de7/a02572_source.html#l04863">rocksdb::BM_LogAndApply()</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00073">rocksdb::MemTableList::InstallMemtableFlushResults()</a>, and <a class="el" href="../../dc/dd5/a02614_source.html#l00020">ReduceNumberOfLevels()</a>.</p>
<div class="fragment"><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                             {</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  <a class="code" href="../../db/d44/a02564.html#a900dad9ea326bf70a183d88a8ab50a13">mu</a>-&gt;AssertHeld();</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <span class="comment">// queue our request</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  ManifestWriter w(<a class="code" href="../../db/d44/a02564.html#a900dad9ea326bf70a183d88a8ab50a13">mu</a>, edit);</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a5c2f30ab49313fa28edcca51fb13acd0">manifest_writers_</a>.push_back(&amp;w);</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  <span class="keywordflow">while</span> (!w.done &amp;&amp; &amp;w != <a class="code" href="../../d1/d42/a01800.html#a5c2f30ab49313fa28edcca51fb13acd0">manifest_writers_</a>.front()) {</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    w.cv.Wait();</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="keywordflow">if</span> (w.done) {</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="keywordflow">return</span> w.status;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  }</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  std::vector&lt;VersionEdit*&gt; batch_edits;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#ace162f32d4abb584945d3a55a389b0a3">Version</a>* v = <span class="keyword">new</span> <a class="code" href="../../d1/d42/a01800.html#ace162f32d4abb584945d3a55a389b0a3">Version</a>(<span class="keyword">this</span>, <a class="code" href="../../d1/d42/a01800.html#a33937b18365def065cbb16d930d47c81">current_version_number_</a>++);</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  Builder builder(<span class="keyword">this</span>, <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>);</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="comment">// process all requests in the queue</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  ManifestWriter* last_writer = &amp;w;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  assert(!<a class="code" href="../../d1/d42/a01800.html#a5c2f30ab49313fa28edcca51fb13acd0">manifest_writers_</a>.empty());</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  assert(<a class="code" href="../../d1/d42/a01800.html#a5c2f30ab49313fa28edcca51fb13acd0">manifest_writers_</a>.front() == &amp;w);</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  std::deque&lt;ManifestWriter*&gt;::iterator iter = <a class="code" href="../../d1/d42/a01800.html#a5c2f30ab49313fa28edcca51fb13acd0">manifest_writers_</a>.begin();</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <span class="keywordflow">for</span> (; iter != <a class="code" href="../../d1/d42/a01800.html#a5c2f30ab49313fa28edcca51fb13acd0">manifest_writers_</a>.end(); ++iter) {</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    last_writer = *iter;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#abfc3ec9be932533630087e672fce75b3">LogAndApplyHelper</a>(&amp;builder, v, last_writer-&gt;edit, <a class="code" href="../../db/d44/a02564.html#a900dad9ea326bf70a183d88a8ab50a13">mu</a>);</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    batch_edits.push_back(last_writer-&gt;edit);</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  builder.SaveTo(v);</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="comment">// Initialize new descriptor log file if necessary by creating</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="comment">// a temporary file that contains a snapshot of the current version.</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  std::string new_manifest_file;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> new_manifest_file_size = 0;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="comment">// we will need this if we are creating new manifest</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> old_manifest_file_number = <a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a>;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="comment">//  No need to perform this check if a new Manifest is being created anyways.</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d42/a01800.html#ac6a954cbe510f1e5f1f6049b933b88a3">descriptor_log_</a> ||</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a12b0bca04f0781f79326d4de43cff810">last_observed_manifest_size_</a> &gt; <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a482e459884f4c83f682bdb7859becaa0">max_manifest_file_size</a>) {</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    new_descriptor_log = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a> = <a class="code" href="../../d1/d42/a01800.html#a1a39a05ce05a65f4ccaabf59d18c0162">NewFileNumber</a>(); <span class="comment">// Change manifest file no.</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  }</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  <span class="keywordflow">if</span> (new_descriptor_log) {</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    new_manifest_file = <a class="code" href="../../d4/d87/a03436.html#addb687ba13b100fdc18a512b23ba195b">DescriptorFileName</a>(<a class="code" href="../../d1/d42/a01800.html#a46b2347fce13fe13dff6c57867a64d37">dbname_</a>, <a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a>);</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    edit-&gt;SetNextFile(<a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a>);</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  }</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="comment">// Unlock during expensive MANIFEST log write. New writes cannot get here</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  <span class="comment">// because &amp;w is ensuring that all new writes get queued.</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  {</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="comment">// calculate the amount of data being compacted at every level</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    std::vector&lt;uint64_t&gt; size_being_compacted(<a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>()-1);</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#ac723248f990dd0f5de3eca23b292a501">SizeBeingCompacted</a>(size_being_compacted);</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <a class="code" href="../../db/d44/a02564.html#a900dad9ea326bf70a183d88a8ab50a13">mu</a>-&gt;Unlock();</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <span class="comment">// This is fine because everything inside of this block is serialized --</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <span class="comment">// only one thread can be here at the same time</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="keywordflow">if</span> (!new_manifest_file.empty()) {</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      unique_ptr&lt;WritableFile&gt; descriptor_file;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;      s = <a class="code" href="../../d1/d42/a01800.html#ae22040b4a38e203468c16912223420de">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47">NewWritableFile</a>(new_manifest_file, &amp;descriptor_file,</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                                <a class="code" href="../../d1/d42/a01800.html#aa455bb240de0e461dbab37045dcc3e1c">storage_options_</a>);</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <a class="code" href="../../d1/d42/a01800.html#ac6a954cbe510f1e5f1f6049b933b88a3">descriptor_log_</a>.reset(<span class="keyword">new</span> log::Writer(std::move(descriptor_file)));</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        s = <a class="code" href="../../d1/d42/a01800.html#ab1e1ece4fbaa4098f0e08154f773cb61">WriteSnapshot</a>(<a class="code" href="../../d1/d42/a01800.html#ac6a954cbe510f1e5f1f6049b933b88a3">descriptor_log_</a>.get());</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      }</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    }</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="comment">// The calls to Finalize and UpdateFilesBySize are cpu-heavy</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    <span class="comment">// and is best called outside the mutex.</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3">Finalize</a>(v, size_being_compacted);</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a1161ffbcf7b18cde8bed5e361c7d3f0f">UpdateFilesBySize</a>(v);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="comment">// Write new record to MANIFEST log</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      std::string record;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; batch_edits.size(); i++) {</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        batch_edits[i]-&gt;EncodeTo(&amp;record);</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        s = <a class="code" href="../../d1/d42/a01800.html#ac6a954cbe510f1e5f1f6049b933b88a3">descriptor_log_</a>-&gt;AddRecord(record);</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        }</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      }</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a6244d1e80d67ab065f2f7262ee2d8135">use_fsync</a>) {</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;          StopWatch sw(<a class="code" href="../../d1/d42/a01800.html#ae22040b4a38e203468c16912223420de">env_</a>, <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aeab50fbc6efdac12a17f22184b211a30bf">MANIFEST_FILE_SYNC_MICROS</a>);</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;          s = <a class="code" href="../../d1/d42/a01800.html#ac6a954cbe510f1e5f1f6049b933b88a3">descriptor_log_</a>-&gt;file()-&gt;Fsync();</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;          StopWatch sw(<a class="code" href="../../d1/d42/a01800.html#ae22040b4a38e203468c16912223420de">env_</a>, <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aeab50fbc6efdac12a17f22184b211a30bf">MANIFEST_FILE_SYNC_MICROS</a>);</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;          s = <a class="code" href="../../d1/d42/a01800.html#ac6a954cbe510f1e5f1f6049b933b88a3">descriptor_log_</a>-&gt;file()-&gt;Sync();</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        }</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      }</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;MANIFEST write: %s\n&quot;</span>, s.ToString().c_str());</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#af55acbe3f8a2077614c6d8374eb24c04">ManifestContains</a>(record)) {</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;          <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;              <span class="stringliteral">&quot;MANIFEST contains log record despite error; advancing to new &quot;</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;              <span class="stringliteral">&quot;version to prevent mismatch between in-memory and logged state&quot;</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;              <span class="stringliteral">&quot; If paranoid is set, then the db is now in readonly mode.&quot;</span>);</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;          s = <a class="code" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00">Status::OK</a>();</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        }</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      }</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    }</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="comment">// If we just created a new descriptor file, install it by writing a</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="comment">// new CURRENT file that points to it.</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="keywordflow">if</span> (s.ok() &amp;&amp; !new_manifest_file.empty()) {</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      s = <a class="code" href="../../d4/d87/a03436.html#a387951cc646ab45c3ef918e66797e0d6">SetCurrentFile</a>(<a class="code" href="../../d1/d42/a01800.html#ae22040b4a38e203468c16912223420de">env_</a>, <a class="code" href="../../d1/d42/a01800.html#a46b2347fce13fe13dff6c57867a64d37">dbname_</a>, <a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a>);</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;      <span class="keywordflow">if</span> (s.ok() &amp;&amp; old_manifest_file_number &lt; <a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a>) {</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="comment">// delete old manifest file</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <span class="stringliteral">&quot;Deleting manifest %lu current manifest %lu\n&quot;</span>,</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)old_manifest_file_number,</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a>);</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        <span class="comment">// we don&#39;t care about an error here, PurgeObsoleteFiles will take care</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <span class="comment">// of it later</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        <a class="code" href="../../d1/d42/a01800.html#ae22040b4a38e203468c16912223420de">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">DeleteFile</a>(<a class="code" href="../../d4/d87/a03436.html#addb687ba13b100fdc18a512b23ba195b">DescriptorFileName</a>(<a class="code" href="../../d1/d42/a01800.html#a46b2347fce13fe13dff6c57867a64d37">dbname_</a>, old_manifest_file_number));</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      }</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    }</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="comment">// find offset in manifest file where this version is stored.</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    new_manifest_file_size = <a class="code" href="../../d1/d42/a01800.html#ac6a954cbe510f1e5f1f6049b933b88a3">descriptor_log_</a>-&gt;file()-&gt;GetFileSize();</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <a class="code" href="../../db/d44/a02564.html#a900dad9ea326bf70a183d88a8ab50a13">mu</a>-&gt;Lock();</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <span class="comment">// cache the manifest_file_size so that it can be used to rollover in the</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <span class="comment">// next call to LogAndApply</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a12b0bca04f0781f79326d4de43cff810">last_observed_manifest_size_</a> = new_manifest_file_size;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  }</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  <span class="comment">// Install the new version</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    v-&gt;offset_manifest_file_ = new_manifest_file_size;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#aa5b2b44d11b6085ed5deeb7a562d30a7">AppendVersion</a>(v);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a8efe3b4907507a75117c3148fe888f9e">log_number_</a> = edit-&gt;log_number_;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a7fb8190a6ca751167dc288649b8849c3">prev_log_number_</a> = edit-&gt;prev_log_number_;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Error in committing version %lu&quot;</span>,</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)v-&gt;GetVersionNumber());</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keyword">delete</span> v;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="keywordflow">if</span> (!new_manifest_file.empty()) {</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#ac6a954cbe510f1e5f1f6049b933b88a3">descriptor_log_</a>.reset();</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#ae22040b4a38e203468c16912223420de">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">DeleteFile</a>(new_manifest_file);</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    }</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  }</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <span class="comment">// wake up all the waiting writers</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    ManifestWriter* ready = <a class="code" href="../../d1/d42/a01800.html#a5c2f30ab49313fa28edcca51fb13acd0">manifest_writers_</a>.front();</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a5c2f30ab49313fa28edcca51fb13acd0">manifest_writers_</a>.pop_front();</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="keywordflow">if</span> (ready != &amp;w) {</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;      ready-&gt;status = s;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      ready-&gt;done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;      ready-&gt;cv.Signal();</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="keywordflow">if</span> (ready == last_writer) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  }</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="comment">// Notify new head of write queue</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d42/a01800.html#a5c2f30ab49313fa28edcca51fb13acd0">manifest_writers_</a>.empty()) {</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a5c2f30ab49313fa28edcca51fb13acd0">manifest_writers_</a>.front()-&gt;cv.Signal();</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  }</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a8d4bdcc8a079afc6fcac4f19fbaf1d50_cgraph.png" border="0" usemap="#d1/d42/a01800_a8d4bdcc8a079afc6fcac4f19fbaf1d50_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a8d4bdcc8a079afc6fcac4f19fbaf1d50_cgraph" id="d1/d42/a01800_a8d4bdcc8a079afc6fcac4f19fbaf1d50_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#aa5b2b44d11b6085ed5deeb7a562d30a7" title="rocksdb::VersionSet\l::AppendVersion" alt="" coords="227,50,365,97"/><area shape="rect" id="node9" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="483,111,624,158"/><area shape="rect" id="node11" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="471,1275,636,1304"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#addb687ba13b100fdc18a512b23ba195b" title="rocksdb::DescriptorFileName" alt="" coords="457,1168,649,1197"/><area shape="rect" id="node15" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3" title="rocksdb::VersionSet\l::Finalize" alt="" coords="484,818,623,865"/><area shape="rect" id="node19" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="948,659,1087,706"/><area shape="rect" id="node26" href="../../d4/dd1/a01797.html#aeb022110f00e15d30e0600d5252e0392" title="rocksdb::Version::GetVersion\lNumber" alt="" coords="200,1371,392,1418"/><area shape="rect" id="node28" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="225,1441,367,1487"/><area shape="rect" id="node32" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="505,939,601,968"/><area shape="rect" id="node34" href="../../d1/d42/a01800.html#abfc3ec9be932533630087e672fce75b3" title="rocksdb::VersionSet\l::LogAndApplyHelper" alt="" coords="224,319,368,366"/><area shape="rect" id="node41" href="../../d2/d86/a01798.html#a5eca07307a1eb4123a2b4d3370495d02" title="rocksdb::VersionEdit\l::SetNextFile" alt="" coords="483,458,624,505"/><area shape="rect" id="node50" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="232,1719,360,1748"/><area shape="rect" id="node52" href="../../d1/d42/a01800.html#af55acbe3f8a2077614c6d8374eb24c04" title="rocksdb::VersionSet\l::ManifestContains" alt="" coords="227,1046,365,1093"/><area shape="rect" id="node58" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="485,1221,621,1251"/><area shape="rect" id="node60" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="468,1115,639,1144"/><area shape="rect" id="node64" href="../../d1/d42/a01800.html#a1a39a05ce05a65f4ccaabf59d18c0162" title="rocksdb::VersionSet\l::NewFileNumber" alt="" coords="227,1771,365,1818"/><area shape="rect" id="node66" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="195,1841,397,1871"/><area shape="rect" id="node69" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="225,1895,367,1924"/><area shape="rect" id="node74" href="../../d0/d27/a00239.html#a61a3b1cccd9c3d386297a9cf999781d6" title="rocksdb::VersionSet\l::Builder::SaveTo" alt="" coords="484,749,623,795"/><area shape="rect" id="node80" href="../../d4/d87/a03436.html#a387951cc646ab45c3ef918e66797e0d6" title="rocksdb::SetCurrentFile" alt="" coords="216,1319,376,1348"/><area shape="rect" id="node100" href="../../d0/d39/a00314.html#a84d028d8d526b7ce592433ba836a1853" title="rocksdb::port::CondVar\l::Signal" alt="" coords="217,1510,375,1557"/><area shape="rect" id="node103" href="../../d1/d42/a01800.html#ac723248f990dd0f5de3eca23b292a501" title="rocksdb::VersionSet\l::SizeBeingCompacted" alt="" coords="219,629,373,675"/><area shape="rect" id="node109" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="225,1579,367,1626"/><area shape="rect" id="node112" href="../../d1/d42/a01800.html#a1161ffbcf7b18cde8bed5e361c7d3f0f" title="rocksdb::VersionSet\l::UpdateFilesBySize" alt="" coords="733,439,875,486"/><area shape="rect" id="node115" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="217,1649,375,1695"/><area shape="rect" id="node118" href="../../d1/d42/a01800.html#ab1e1ece4fbaa4098f0e08154f773cb61" title="rocksdb::VersionSet\l::WriteSnapshot" alt="" coords="735,559,873,606"/><area shape="rect" id="node5" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="479,5,628,35"/><area shape="rect" id="node7" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="473,59,633,88"/><area shape="rect" id="node17" href="../../d1/d42/a01800.html#a1639228385c42402a661292f6a27a818" title="rocksdb::VersionSet\l::MaxBytesForLevel" alt="" coords="735,991,873,1038"/><area shape="rect" id="node22" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="735,818,873,865"/><area shape="rect" id="node24" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="728,888,880,917"/><area shape="rect" id="node30" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="467,1717,640,1747"/><area shape="rect" id="node37" href="../../d2/d86/a01798.html#a8d557cf30bde88010eff4307cc3d385f" title="rocksdb::VersionEdit\l::SetLogNumber" alt="" coords="483,319,624,366"/><area shape="rect" id="node39" href="../../d2/d86/a01798.html#ab2a5ed0c015e8ccecf147de0bf2a6d12" title="rocksdb::VersionEdit\l::SetPrevLogNumber" alt="" coords="481,181,625,227"/><area shape="rect" id="node43" href="../../d2/d86/a01798.html#a576049674a35517dc121fe6e1838b550" title="rocksdb::VersionEdit\l::SetLastSequence" alt="" coords="483,250,624,297"/><area shape="rect" id="node45" href="../../d0/d27/a00239.html#a2ebf4c9e22b9adce7919b255dcb80393" title="rocksdb::VersionSet\l::Builder::Apply" alt="" coords="484,389,623,435"/><area shape="rect" id="node47" href="../../d0/d27/a00239.html#a70c9fbc2ead82d8e2e4722161341eb49" title="rocksdb::VersionSet\l::Builder::CheckConsistency" alt="" coords="709,629,899,675"/><area shape="rect" id="node56" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="445,992,661,1021"/><area shape="rect" id="node62" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="483,1045,624,1091"/><area shape="rect" id="node71" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="473,1895,633,1924"/><area shape="rect" id="node78" href="../../d0/d27/a00239.html#a39f8d86429df9529e2d5e8dd2c6bc14f" title="rocksdb::VersionSet\l::Builder::MaybeAddFile" alt="" coords="724,749,884,795"/><area shape="rect" id="node82" href="../../d4/d87/a03436.html#a112e8c44dec6475699006a7f68830b1a" title="rocksdb::CurrentFileName" alt="" coords="467,1541,640,1571"/><area shape="rect" id="node87" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="476,1594,631,1641"/><area shape="rect" id="node89" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="465,1328,641,1357"/><area shape="rect" id="node91" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="465,1381,641,1411"/><area shape="rect" id="node93" href="../../d4/d87/a03436.html#aab2522c126c1764a6be83c9756465d7b" title="rocksdb::TempFileName" alt="" coords="471,1435,636,1464"/><area shape="rect" id="node95" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="472,1488,635,1517"/><area shape="rect" id="node97" href="../../d4/d87/a03436.html#ae8468f39019126b0e12d6059ada48e6b" title="rocksdb::WriteStringToFileSync" alt="" coords="451,1664,656,1693"/><area shape="rect" id="node106" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="480,629,627,675"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a8d4bdcc8a079afc6fcac4f19fbaf1d50_icgraph.png" border="0" usemap="#d1/d42/a01800_a8d4bdcc8a079afc6fcac4f19fbaf1d50_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a8d4bdcc8a079afc6fcac4f19fbaf1d50_icgraph" id="d1/d42/a01800_a8d4bdcc8a079afc6fcac4f19fbaf1d50_icgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2296,5,2475,35"/><area shape="rect" id="node7" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="196,799,393,846"/><area shape="rect" id="node106" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="451,57,624,103"/><area shape="rect" id="node5" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2636,5,2687,35"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="443,1475,632,1522"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="976,1497,1173,1543"/><area shape="rect" id="node100" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="976,1621,1173,1667"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="681,1509,927,1539"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1221,1482,1419,1529"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1467,1499,1715,1528"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1763,1490,1984,1537"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2032,1663,2229,1710"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2044,1368,2217,1397"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2033,1490,2228,1537"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2043,1560,2219,1589"/><area shape="rect" id="node50" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2064,677,2197,707"/><area shape="rect" id="node94" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2049,1421,2212,1467"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2280,1661,2491,1691"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2311,1315,2460,1344"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2283,1368,2488,1397"/><area shape="rect" id="node30" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2579,1395,2744,1424"/><area shape="rect" id="node32" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2611,1288,2712,1317"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2559,1235,2764,1264"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2607,1341,2716,1371"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="2607,1448,2716,1477"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2307,1544,2464,1573"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2331,1597,2440,1627"/><area shape="rect" id="node52" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2304,301,2467,347"/><area shape="rect" id="node54" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2315,370,2456,417"/><area shape="rect" id="node56" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2285,440,2485,469"/><area shape="rect" id="node58" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2289,493,2481,523"/><area shape="rect" id="node60" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2331,547,2440,576"/><area shape="rect" id="node63" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2305,599,2465,646"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2324,1261,2447,1291"/><area shape="rect" id="node68" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2317,738,2453,785"/><area shape="rect" id="node70" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2289,807,2481,854"/><area shape="rect" id="node72" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2289,877,2481,923"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2277,947,2493,976"/><area shape="rect" id="node76" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2304,999,2467,1046"/><area shape="rect" id="node78" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2360,1069,2411,1099"/><area shape="rect" id="node80" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2316,1122,2455,1169"/><area shape="rect" id="node82" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2296,1191,2475,1238"/><area shape="rect" id="node84" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2304,669,2467,715"/><area shape="rect" id="node88" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2303,109,2468,139"/><area shape="rect" id="node90" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2316,162,2455,209"/><area shape="rect" id="node92" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2313,231,2457,278"/><area shape="rect" id="node86" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="2543,363,2780,410"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="2295,1421,2476,1467"/><area shape="rect" id="node98" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="2331,1491,2440,1520"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abfc3ec9be932533630087e672fce75b3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::LogAndApplyHelper </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d27/a00239.html">Builder</a> *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/dd1/a01797.html">Version</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d86/a01798.html">VersionEdit</a> *&#160;</td>
          <td class="paramname"><em>edit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/a00998.html">port::Mutex</a> *&#160;</td>
          <td class="paramname"><em>mu</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01379">1379</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d6/dfc/a02612_source.html#l01033">rocksdb::VersionSet::Builder::Apply()</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00118">rocksdb::VersionEdit::has_log_number_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00119">rocksdb::VersionEdit::has_prev_log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00478">last_sequence_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00113">rocksdb::VersionEdit::log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00479">log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00476">next_file_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00480">prev_log_number_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00061">rocksdb::VersionEdit::SetLastSequence()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00049">rocksdb::VersionEdit::SetLogNumber()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00057">rocksdb::VersionEdit::SetNextFile()</a>, and <a class="el" href="../../de/d3b/a02610_source.html#l00053">rocksdb::VersionEdit::SetPrevLogNumber()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>.</p>
<div class="fragment"><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;                                    {</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <a class="code" href="../../db/d44/a02564.html#a900dad9ea326bf70a183d88a8ab50a13">mu</a>-&gt;AssertHeld();</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="keywordflow">if</span> (edit-&gt;has_log_number_) {</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    assert(edit-&gt;log_number_ &gt;= <a class="code" href="../../d1/d42/a01800.html#a8efe3b4907507a75117c3148fe888f9e">log_number_</a>);</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    assert(edit-&gt;log_number_ &lt; <a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a>);</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    edit-&gt;SetLogNumber(<a class="code" href="../../d1/d42/a01800.html#a8efe3b4907507a75117c3148fe888f9e">log_number_</a>);</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  }</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  <span class="keywordflow">if</span> (!edit-&gt;has_prev_log_number_) {</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    edit-&gt;SetPrevLogNumber(<a class="code" href="../../d1/d42/a01800.html#a7fb8190a6ca751167dc288649b8849c3">prev_log_number_</a>);</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  }</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  edit-&gt;SetNextFile(<a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a>);</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  edit-&gt;SetLastSequence(<a class="code" href="../../d1/d42/a01800.html#ac9813d4953bf5d62a1bbd8f94ede1a15">last_sequence_</a>);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  builder-&gt;Apply(edit);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_abfc3ec9be932533630087e672fce75b3_cgraph.png" border="0" usemap="#d1/d42/a01800_abfc3ec9be932533630087e672fce75b3_cgraph" alt=""/></div>
<map name="d1/d42/a01800_abfc3ec9be932533630087e672fce75b3_cgraph" id="d1/d42/a01800_abfc3ec9be932533630087e672fce75b3_cgraph">
<area shape="rect" id="node3" href="../../d0/d27/a00239.html#a2ebf4c9e22b9adce7919b255dcb80393" title="rocksdb::VersionSet\l::Builder::Apply" alt="" coords="203,242,341,289"/><area shape="rect" id="node45" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="201,311,343,358"/><area shape="rect" id="node47" href="../../d2/d86/a01798.html#a576049674a35517dc121fe6e1838b550" title="rocksdb::VersionEdit\l::SetLastSequence" alt="" coords="201,381,343,427"/><area shape="rect" id="node49" href="../../d2/d86/a01798.html#a8d557cf30bde88010eff4307cc3d385f" title="rocksdb::VersionEdit\l::SetLogNumber" alt="" coords="201,450,343,497"/><area shape="rect" id="node51" href="../../d2/d86/a01798.html#a5eca07307a1eb4123a2b4d3370495d02" title="rocksdb::VersionEdit\l::SetNextFile" alt="" coords="201,519,343,566"/><area shape="rect" id="node53" href="../../d2/d86/a01798.html#ab2a5ed0c015e8ccecf147de0bf2a6d12" title="rocksdb::VersionEdit\l::SetPrevLogNumber" alt="" coords="200,589,344,635"/><area shape="rect" id="node5" href="../../d0/d27/a00239.html#a70c9fbc2ead82d8e2e4722161341eb49" title="rocksdb::VersionSet\l::Builder::CheckConsistency" alt="" coords="392,203,581,250"/><area shape="rect" id="node43" href="../../d0/d27/a00239.html#aa80eab37c10d6aecd296315cd0e210de" title="rocksdb::VersionSet\l::Builder::CheckConsistency\lForDeletes" alt="" coords="392,273,581,337"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="632,143,771,190"/><area shape="rect" id="node9" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="821,170,1032,217"/><area shape="rect" id="node27" href="../../de/de6/a00723.html#a1f29087f48fd168fe431e4b884f5aed1" title="rocksdb::InternalKey\l::DebugString" alt="" coords="631,330,772,377"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#aab29434ed2c251eae44fdb498e4d8dcc" title="rocksdb::BumpPerfCount" alt="" coords="1107,5,1275,35"/><area shape="rect" id="node13" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="1119,58,1263,105"/><area shape="rect" id="node15" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1364,179,1503,208"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1108,232,1273,261"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#ae015f9b23bbadef7eb4e3796c2d4fb46" title="rocksdb::ExtractUserKey" alt="" coords="1107,179,1275,208"/><area shape="rect" id="node24" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1365,360,1501,389"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="1351,232,1516,261"/><area shape="rect" id="node29" href="../../d6/d80/a01076.html#a36870425cc00e160004d62bd6118a24d" title="rocksdb::ParsedInternalKey\l::DebugString" alt="" coords="836,470,1017,517"/><area shape="rect" id="node33" href="../../d4/d87/a03436.html#a4bf89f1a48c96450ef0d88b5c9f0a1ec" title="rocksdb::EscapeString" alt="" coords="849,372,1004,401"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2" title="rocksdb::ParseInternalKey" alt="" coords="839,296,1015,325"/><area shape="rect" id="node31" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="1109,491,1272,520"/><area shape="rect" id="node35" href="../../d4/d87/a03436.html#abd1b2064e9379d3df8f49bcdd26d7de0" title="rocksdb::AppendEscapedStringTo" alt="" coords="1081,437,1300,467"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_abfc3ec9be932533630087e672fce75b3_icgraph.png" border="0" usemap="#d1/d42/a01800_abfc3ec9be932533630087e672fce75b3_icgraph" alt=""/></div>
<map name="d1/d42/a01800_abfc3ec9be932533630087e672fce75b3_icgraph" id="d1/d42/a01800_abfc3ec9be932533630087e672fce75b3_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="201,57,340,103"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2491,5,2669,35"/><area shape="rect" id="node9" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="391,799,588,846"/><area shape="rect" id="node106" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="645,57,819,103"/><area shape="rect" id="node7" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2831,5,2881,35"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="637,1475,827,1522"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1171,1497,1368,1543"/><area shape="rect" id="node100" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1171,1621,1368,1667"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="876,1509,1121,1539"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1416,1482,1613,1529"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1661,1499,1909,1528"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1957,1490,2179,1537"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2227,1663,2424,1710"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2239,1368,2412,1397"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2228,1490,2423,1537"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2237,1560,2413,1589"/><area shape="rect" id="node50" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2259,677,2392,707"/><area shape="rect" id="node94" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2244,1421,2407,1467"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2475,1661,2685,1691"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2505,1315,2655,1344"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2477,1368,2683,1397"/><area shape="rect" id="node32" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2773,1421,2939,1451"/><area shape="rect" id="node34" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2805,1315,2907,1344"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2753,1261,2959,1291"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2801,1368,2911,1397"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2501,1544,2659,1573"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2525,1597,2635,1627"/><area shape="rect" id="node52" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2499,301,2661,347"/><area shape="rect" id="node54" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2509,370,2651,417"/><area shape="rect" id="node56" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2480,440,2680,469"/><area shape="rect" id="node58" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2484,493,2676,523"/><area shape="rect" id="node60" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2525,547,2635,576"/><area shape="rect" id="node63" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2500,599,2660,646"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2519,1261,2641,1291"/><area shape="rect" id="node68" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2512,738,2648,785"/><area shape="rect" id="node70" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2484,807,2676,854"/><area shape="rect" id="node72" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2484,877,2676,923"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2472,947,2688,976"/><area shape="rect" id="node76" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2499,999,2661,1046"/><area shape="rect" id="node78" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2555,1069,2605,1099"/><area shape="rect" id="node80" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2511,1122,2649,1169"/><area shape="rect" id="node82" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2491,1191,2669,1238"/><area shape="rect" id="node84" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2499,669,2661,715"/><area shape="rect" id="node88" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2497,109,2663,139"/><area shape="rect" id="node90" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2511,162,2649,209"/><area shape="rect" id="node92" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2508,231,2652,278"/><area shape="rect" id="node86" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="2737,363,2975,410"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="2489,1421,2671,1467"/><area shape="rect" id="node98" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="2525,1491,2635,1520"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7fa7a7fa8e9f744c1fd8089a2c87c7e5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::LogNumber </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00286">286</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00479">log_number_</a>.</p>
<div class="fragment"><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#a8efe3b4907507a75117c3148fe888f9e">log_number_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9b2787a7f9d43a6141ff02cc823c5374"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d2/d02/a00777.html">Iterator</a> * rocksdb::VersionSet::MakeInputIterator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *&#160;</td>
          <td class="paramname"><em>c</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02063">2063</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d2/de3/a02637_source.html#l00652">rocksdb::ReadOptions::fill_cache</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00187">rocksdb::GetFileIterator()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00475">icmp_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00619">rocksdb::Compaction::inputs_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00547">rocksdb::Compaction::level()</a>, <a class="el" href="../../d3/dce/a02602_source.html#l00092">rocksdb::TableCache::NewIterator()</a>, <a class="el" href="../../de/db4/a02684_source.html#l00217">rocksdb::NewMergingIterator()</a>, <a class="el" href="../../d4/dfe/a02688_source.html#l00194">rocksdb::NewTwoLevelIterator()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00125">rocksdb::Options::paranoid_checks</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00515">storage_options_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00519">storage_options_compactions_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00474">table_cache_</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00646">rocksdb::ReadOptions::verify_checksums</a>.</p>
<div class="fragment"><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;                                                     {</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;  ReadOptions options;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  options.verify_checksums = <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a3caefadde126ce359200ea7742e3dba7">paranoid_checks</a>;</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;  options.fill_cache = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  <span class="comment">// Level-0 files have to be merged together.  For other levels,</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  <span class="comment">// we will make a concatenating iterator per level.</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;  <span class="comment">// TODO(opt): use concatenating iterator for level-0 if there is no overlap</span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> space = (c-&gt;level() == 0 ? c-&gt;inputs_[0].size() + 1 : 2);</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;  Iterator** list = <span class="keyword">new</span> Iterator*[space];</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;  <span class="keywordtype">int</span> num = 0;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> which = 0; which &lt; 2; which++) {</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    <span class="keywordflow">if</span> (!c-&gt;inputs_[which].empty()) {</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <span class="keywordflow">if</span> (c-&gt;level() + which == 0) {</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        <span class="keyword">const</span> std::vector&lt;FileMetaData*&gt;&amp; files = c-&gt;inputs_[which];</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; files.size(); i++) {</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;          list[num++] = <a class="code" href="../../d1/d42/a01800.html#acbe852ae17cbb6c37d4b9dfbe9f44bb2">table_cache_</a>-&gt;<a class="code" href="../../de/df9/a01624.html#a59b62bf2644f7cf62feb7275085a9185">NewIterator</a>(</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;              options, <a class="code" href="../../d1/d42/a01800.html#ab1fa9d94ea404bcb28cb8ceff339d769">storage_options_compactions_</a>,</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;              files[i]-&gt;number, files[i]-&gt;file_size, <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;              <span class="keyword">true</span> <span class="comment">/* for compaction */</span>);</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;        }</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        <span class="comment">// Create concatenating iterator for the files from this level</span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;        list[num++] = <a class="code" href="../../d4/d87/a03436.html#a9084f5e3d1304b9b7acedced66a3adaa">NewTwoLevelIterator</a>(</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;            <span class="keyword">new</span> Version::LevelFileNumIterator(<a class="code" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a>, &amp;c-&gt;inputs_[which]),</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;            &amp;<a class="code" href="../../d4/d87/a03436.html#a1f46302f3532999ef4aa03b9de20a5f2">GetFileIterator</a>, <a class="code" href="../../d1/d42/a01800.html#acbe852ae17cbb6c37d4b9dfbe9f44bb2">table_cache_</a>, options, <a class="code" href="../../d1/d42/a01800.html#aa455bb240de0e461dbab37045dcc3e1c">storage_options_</a>,</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;            <span class="keyword">true</span> <span class="comment">/* for compaction */</span>);</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;      }</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    }</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;  }</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;  assert(num &lt;= space);</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;  Iterator* result = <a class="code" href="../../d4/d87/a03436.html#a678cf0fa28a2449c444344ea1feef654">NewMergingIterator</a>(&amp;<a class="code" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a>, list, num);</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;  <span class="keyword">delete</span>[] list;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a9b2787a7f9d43a6141ff02cc823c5374_cgraph.png" border="0" usemap="#d1/d42/a01800_a9b2787a7f9d43a6141ff02cc823c5374_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a9b2787a7f9d43a6141ff02cc823c5374_cgraph" id="d1/d42/a01800_a9b2787a7f9d43a6141ff02cc823c5374_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a1f46302f3532999ef4aa03b9de20a5f2" title="rocksdb::GetFileIterator" alt="" coords="216,501,373,531"/><area shape="rect" id="node17" href="../../de/df9/a01624.html#a59b62bf2644f7cf62feb7275085a9185" title="rocksdb::TableCache\l::NewIterator" alt="" coords="461,278,608,325"/><area shape="rect" id="node64" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="221,554,368,601"/><area shape="rect" id="node67" href="../../d4/d87/a03436.html#a678cf0fa28a2449c444344ea1feef654" title="rocksdb::NewMergingIterator" alt="" coords="200,423,389,452"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a9084f5e3d1304b9b7acedced66a3adaa" title="rocksdb::NewTwoLevelIterator" alt="" coords="195,624,395,653"/><area shape="rect" id="node5" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="444,673,625,703"/><area shape="rect" id="node9" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="465,620,604,649"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="452,513,617,543"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#a7b03495439285fb3fb42a3208b01a3d7" title="rocksdb::NewErrorIterator" alt="" coords="676,471,847,500"/><area shape="rect" id="node62" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="467,567,603,596"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1195,599,1355,628"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="679,524,844,553"/><area shape="rect" id="node19" href="../../de/df9/a01624.html#aed7ec4f6ca046cd127813d39e75dee0c" title="rocksdb::TableCache\l::FindTable" alt="" coords="688,347,835,394"/><area shape="rect" id="node30" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="952,227,1088,256"/><area shape="rect" id="node39" href="../../d0/da4/a01631.html#ab457fa9a28a505dcd52222b12e331a6c" title="rocksdb::TableReader\l::NewIterator" alt="" coords="687,105,836,151"/><area shape="rect" id="node42" href="../../d2/d02/a00777.html#a668d7cfe0b950c1ee2806a3a3d21bb90" title="rocksdb::Iterator::\lRegisterCleanup" alt="" coords="699,35,824,82"/><area shape="rect" id="node56" href="../../d0/da4/a01631.html#a8b065eafa65a8d1e8b69b6300370b744" title="rocksdb::TableReader\l::SetupForCompaction" alt="" coords="685,278,837,325"/><area shape="rect" id="node58" href="../../d4/d87/a03436.html#a71b6611372242bca71af15eb1e4c2a78" title="rocksdb::UnrefEntry" alt="" coords="692,175,831,204"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a25709ac27a5b4b9ca699413c90036eed" title="rocksdb::DeleteEntry" alt="" coords="948,493,1092,523"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#a0a6b5f485f1b3d6f33ead2fc4d7c891c" title="rocksdb::EncodeFixed64" alt="" coords="937,547,1103,576"/><area shape="rect" id="node25" href="../../d0/db9/a01552.html#a223ccba0dce26cd4539d6fd2c28ae364" title="rocksdb::Status::Incomplete" alt="" coords="927,387,1113,416"/><area shape="rect" id="node28" href="../../db/db1/a00460.html#a6e6619074ecb6b5ba4e4a23ffb2e4974" title="rocksdb::Env::NewRandomAccessFile" alt="" coords="896,333,1144,363"/><area shape="rect" id="node32" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="949,440,1091,469"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="939,280,1101,309"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1193,280,1356,309"/><area shape="rect" id="node44" href="../../da/d6b/a02352.html#ae3e0dbf7ac3255e91d16cd24fd2c2b1d" title="Cleanup" alt="" coords="985,44,1055,73"/><area shape="rect" id="node46" href="../../da/d6b/a02352.html#ac70ab821a6607b4a1b909582dc37a069" title="sqlite3DbFree" alt="" coords="1224,44,1325,73"/><area shape="rect" id="node48" href="../../da/d6b/a02352.html#a770fa05ff9717b75e16f4d968a77b897" title="isLookaside" alt="" coords="1617,5,1708,35"/><area shape="rect" id="node50" href="../../da/d6b/a02352.html#acf77da68932b6bc163c5e68547ecc3e7" title="sqlite3_mutex_held" alt="" coords="1596,71,1729,100"/><area shape="rect" id="node52" href="../../da/d6b/a02352.html#aa397e5a8a03495203a0767abf0a71f86" title="sqlite3DbMallocSize" alt="" coords="1405,44,1547,73"/><area shape="rect" id="node60" href="../../d4/d9a/a00246.html#a0c407981dfc226d8ec65e6b076aab42d" title="rocksdb::Cache::Release" alt="" coords="935,173,1105,203"/><area shape="rect" id="node69" href="../../d4/d87/a03436.html#abf92c452806fb54068f27e6034878f16" title="rocksdb::NewEmptyIterator" alt="" coords="444,409,625,439"/><area shape="rect" id="node71" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="691,417,832,447"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af55acbe3f8a2077614c6d8374eb24c04"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::VersionSet::ManifestContains </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>record</em>)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01907">1907</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00472">dbname_</a>, <a class="el" href="../../da/d03/a02577_source.html#l00078">rocksdb::DescriptorFileName()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00471">env_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00477">manifest_file_number_</a>, <a class="el" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3">rocksdb::Env::NewSequentialFile()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, <a class="el" href="../../d6/dae/a02581_source.html#l00064">rocksdb::log::Reader::ReadRecord()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00515">storage_options_</a>, and <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>.</p>
<div class="fragment"><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                                                               {</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;  std::string fname = <a class="code" href="../../d4/d87/a03436.html#addb687ba13b100fdc18a512b23ba195b">DescriptorFileName</a>(<a class="code" href="../../d1/d42/a01800.html#a46b2347fce13fe13dff6c57867a64d37">dbname_</a>, <a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a>);</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;ManifestContains: checking %s\n&quot;</span>, fname.c_str());</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  unique_ptr&lt;SequentialFile&gt; file;</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../d1/d42/a01800.html#ae22040b4a38e203468c16912223420de">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3">NewSequentialFile</a>(fname, &amp;file, <a class="code" href="../../d1/d42/a01800.html#aa455bb240de0e461dbab37045dcc3e1c">storage_options_</a>);</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;ManifestContains: %s\n&quot;</span>, s.ToString().c_str());</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        <span class="stringliteral">&quot;ManifestContains: is unable to reopen the manifest file  %s&quot;</span>,</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        fname.c_str());</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;  }</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  log::Reader reader(std::move(file), <span class="keyword">nullptr</span>, <span class="keyword">true</span><span class="comment">/*checksum*/</span>, 0);</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;  Slice r;</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;  std::string scratch;</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;  <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  <span class="keywordflow">while</span> (reader.ReadRecord(&amp;r, &amp;scratch)) {</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    <span class="keywordflow">if</span> (r == Slice(record)) {</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      result = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    }</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;  }</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;ManifestContains: result = %d\n&quot;</span>, result ? 1 : 0);</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_af55acbe3f8a2077614c6d8374eb24c04_cgraph.png" border="0" usemap="#d1/d42/a01800_af55acbe3f8a2077614c6d8374eb24c04_cgraph" alt=""/></div>
<map name="d1/d42/a01800_af55acbe3f8a2077614c6d8374eb24c04_cgraph" id="d1/d42/a01800_af55acbe3f8a2077614c6d8374eb24c04_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#addb687ba13b100fdc18a512b23ba195b" title="rocksdb::DescriptorFileName" alt="" coords="207,5,399,35"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="255,59,351,88"/><area shape="rect" id="node7" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="195,112,411,141"/><area shape="rect" id="node9" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="680,164,816,193"/><area shape="rect" id="node11" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="232,369,373,415"/><area shape="rect" id="node72" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="217,519,388,548"/><area shape="rect" id="node13" href="../../d5/d54/a01213.html#acb5bb46275c505b8eab7bceac8affd36" title="rocksdb::log::Reader\l::SkipToInitialBlock" alt="" coords="465,215,607,262"/><area shape="rect" id="node18" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1131,409,1267,439"/><area shape="rect" id="node22" href="../../de/daf/a01417.html#a8f740f146e792dc89409f8402a61ad04" title="rocksdb::Slice::clear" alt="" coords="677,697,819,727"/><area shape="rect" id="node25" href="../../d5/d54/a01213.html#a57eb93a86418bd4a2b32ee163aecea5d" title="rocksdb::log::Reader\l::ReadPhysicalRecord" alt="" coords="460,454,612,501"/><area shape="rect" id="node31" href="../../d5/d54/a01213.html#a7db406791cb13477c816733858ea1e51" title="rocksdb::log::Reader\l::ReportCorruption" alt="" coords="677,369,819,415"/><area shape="rect" id="node38" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="679,751,817,780"/><area shape="rect" id="node16" href="../../d5/d54/a01213.html#a49fd67047e3128cc471e7c31c5db6f9c" title="rocksdb::log::Reader\l::ReportDrop" alt="" coords="904,319,1045,366"/><area shape="rect" id="node20" href="../../d7/d04/a01246.html#a3489a71709b9f8a459daf7761fc8658e" title="rocksdb::log::Reader\l::Reporter::Corruption" alt="" coords="1125,319,1272,366"/><area shape="rect" id="node40" href="../../d7/db0/a03467.html#a8c50508656b8faef53619a2d4097eaf0" title="rocksdb::crc32c::Unmask" alt="" coords="663,540,833,569"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="2188,652,2353,681"/><area shape="rect" id="node44" href="../../d7/db0/a03467.html#a90a67ab6517f594a989c6cb4f3ff67f9" title="rocksdb::crc32c::Value" alt="" coords="671,644,825,673"/><area shape="rect" id="node67" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="897,470,1052,517"/><area shape="rect" id="node34" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="884,540,1065,569"/><area shape="rect" id="node36" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1119,540,1279,569"/><area shape="rect" id="node46" href="../../d7/db0/a03467.html#aba0a720f8204028aa9b0f78f969d5f97" title="rocksdb::crc32c::Extend" alt="" coords="893,653,1056,683"/><area shape="rect" id="node48" href="../../d7/db0/a03467.html#a174fe9c8cf3cb558b7accfdc10c6c04c" title="rocksdb::crc32c::CRC32" alt="" coords="1116,664,1281,693"/><area shape="rect" id="node50" href="../../d7/db0/a03467.html#aeb8537c518a4a8ac7e1d8f8ac1c6bb63" title="rocksdb::crc32c::Choose\l_CRC32" alt="" coords="1331,689,1499,735"/><area shape="rect" id="node52" href="../../d7/db0/a03467.html#a6abc7c8ed18979f0e12fcfb6460f9285" title="rocksdb::crc32c::isSSE42" alt="" coords="1548,768,1721,797"/><area shape="rect" id="node54" href="../../d7/db0/a03467.html#ab6bf1f9041f7859fe1aae6312f650115" title="rocksdb::crc32c::Fast\l_CRC32" alt="" coords="1560,647,1709,694"/><area shape="rect" id="node61" href="../../d7/db0/a03467.html#aabbb4470a0a8566fff676e40a5c3a491" title="rocksdb::crc32c::Slow\l_CRC32" alt="" coords="1771,713,1923,759"/><area shape="rect" id="node56" href="../../d7/db0/a03467.html#aa5eeccea7be6cc99acab7223cc1c7baf" title="rocksdb::crc32c::LE\l_LOAD64" alt="" coords="1777,643,1916,690"/><area shape="rect" id="node58" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1972,652,2137,681"/><area shape="rect" id="node63" href="../../d7/db0/a03467.html#a72b216c9d4dfeeaea89e2410eec06ff9" title="rocksdb::crc32c::LE\l_LOAD32" alt="" coords="1985,709,2124,755"/><area shape="rect" id="node74" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="461,625,611,655"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_af55acbe3f8a2077614c6d8374eb24c04_icgraph.png" border="0" usemap="#d1/d42/a01800_af55acbe3f8a2077614c6d8374eb24c04_icgraph" alt=""/></div>
<map name="d1/d42/a01800_af55acbe3f8a2077614c6d8374eb24c04_icgraph" id="d1/d42/a01800_af55acbe3f8a2077614c6d8374eb24c04_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="196,57,335,103"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2485,5,2664,35"/><area shape="rect" id="node9" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="385,799,583,846"/><area shape="rect" id="node106" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="640,57,813,103"/><area shape="rect" id="node7" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2825,5,2876,35"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="632,1475,821,1522"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1165,1497,1363,1543"/><area shape="rect" id="node100" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1165,1621,1363,1667"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="871,1509,1116,1539"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1411,1482,1608,1529"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1656,1499,1904,1528"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1952,1490,2173,1537"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2221,1663,2419,1710"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2233,1368,2407,1397"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2223,1490,2417,1537"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2232,1560,2408,1589"/><area shape="rect" id="node50" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2253,677,2387,707"/><area shape="rect" id="node94" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2239,1421,2401,1467"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2469,1661,2680,1691"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2500,1315,2649,1344"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2472,1368,2677,1397"/><area shape="rect" id="node32" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2768,1421,2933,1451"/><area shape="rect" id="node34" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2800,1315,2901,1344"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2748,1261,2953,1291"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2796,1368,2905,1397"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2496,1544,2653,1573"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2520,1597,2629,1627"/><area shape="rect" id="node52" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2493,301,2656,347"/><area shape="rect" id="node54" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2504,370,2645,417"/><area shape="rect" id="node56" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2475,440,2675,469"/><area shape="rect" id="node58" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2479,493,2671,523"/><area shape="rect" id="node60" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2520,547,2629,576"/><area shape="rect" id="node63" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2495,599,2655,646"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2513,1261,2636,1291"/><area shape="rect" id="node68" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2507,738,2643,785"/><area shape="rect" id="node70" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2479,807,2671,854"/><area shape="rect" id="node72" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2479,877,2671,923"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2467,947,2683,976"/><area shape="rect" id="node76" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2493,999,2656,1046"/><area shape="rect" id="node78" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2549,1069,2600,1099"/><area shape="rect" id="node80" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2505,1122,2644,1169"/><area shape="rect" id="node82" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2485,1191,2664,1238"/><area shape="rect" id="node84" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2493,669,2656,715"/><area shape="rect" id="node88" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2492,109,2657,139"/><area shape="rect" id="node90" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2505,162,2644,209"/><area shape="rect" id="node92" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2503,231,2647,278"/><area shape="rect" id="node86" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="2732,363,2969,410"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="2484,1421,2665,1467"/><area shape="rect" id="node98" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="2520,1491,2629,1520"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2b987b310c14d06c2b2d63b5d4c69a0d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::ManifestFileNumber </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00253">253</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00477">manifest_file_number_</a>.</p>
<div class="fragment"><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ada29c0c7f280e7125db24c0d5dd9298b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::ManifestFileSize </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00386">386</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00200">rocksdb::Version::offset_manifest_file_</a>.</p>
<div class="fragment"><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#aa24cda35355dd4e91421ec643ad07e19">offset_manifest_file_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5e1d11c285967cb347b090f67e5b34dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::MarkFileNumberUsed </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td>
          <td class="paramname"><em>number</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01668">1668</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00476">next_file_number_</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>.</p>
<div class="fragment"><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                                                   {</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a> &lt;= number) {</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a> = number + 1;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  }</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a5e1d11c285967cb347b090f67e5b34dd_icgraph.png" border="0" usemap="#d1/d42/a01800_a5e1d11c285967cb347b090f67e5b34dd_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a5e1d11c285967cb347b090f67e5b34dd_icgraph" id="d1/d42/a01800_a5e1d11c285967cb347b090f67e5b34dd_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6a345ce36535de042e2e0d254ff66a5a" title="rocksdb::VersionSet\l::DumpManifest" alt="" coords="212,18,351,65"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#acf04defe0d794e6933785aad628ab9b6" title="rocksdb::VersionSet\l::Recover" alt="" coords="212,114,351,161"/><area shape="rect" id="node5" href="../../dd/d20/a00939.html#a0a4996198d709bec7b49eec50ba36567" title="rocksdb::ManifestDumpCommand\l::DoCommand" alt="" coords="409,5,631,51"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="431,75,609,104"/><area shape="rect" id="node13" href="../../d0/d58/a01230.html#a769cf9f08028648f2cb824dbbf695de7" title="rocksdb::ReduceDBLevelsCommand\l::GetOldNumOfLevels" alt="" coords="401,127,639,174"/><area shape="rect" id="node15" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="689,157,927,203"/><area shape="rect" id="node11" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="783,75,833,104"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1639228385c42402a661292f6a27a818"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double rocksdb::VersionSet::MaxBytesForLevel </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02099">2099</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00497">level_max_bytes_</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01674">Finalize()</a>.</p>
<div class="fragment"><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;                                             {</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;  <span class="comment">// Note: the result for level zero is not really used since we set</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;  <span class="comment">// the level-0 compaction threshold based on number of files.</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;  assert(level &gt;= 0);</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;  assert(level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>());</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#a8e79f8d904167a1092d337c82093a629">level_max_bytes_</a>[level];</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a1639228385c42402a661292f6a27a818_cgraph.png" border="0" usemap="#d1/d42/a01800_a1639228385c42402a661292f6a27a818_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a1639228385c42402a661292f6a27a818_cgraph" id="d1/d42/a01800_a1639228385c42402a661292f6a27a818_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="196,5,335,51"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a1639228385c42402a661292f6a27a818_icgraph.png" border="0" usemap="#d1/d42/a01800_a1639228385c42402a661292f6a27a818_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a1639228385c42402a661292f6a27a818_icgraph" id="d1/d42/a01800_a1639228385c42402a661292f6a27a818_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3" title="rocksdb::VersionSet\l::Finalize" alt="" coords="196,95,335,142"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a6a345ce36535de042e2e0d254ff66a5a" title="rocksdb::VersionSet\l::DumpManifest" alt="" coords="385,5,524,51"/><area shape="rect" id="node9" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="385,125,524,171"/><area shape="rect" id="node102" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="385,194,524,241"/><area shape="rect" id="node104" href="../../d1/d42/a01800.html#acf04defe0d794e6933785aad628ab9b6" title="rocksdb::VersionSet\l::Recover" alt="" coords="2461,65,2600,111"/><area shape="rect" id="node7" href="../../dd/d20/a00939.html#a0a4996198d709bec7b49eec50ba36567" title="rocksdb::ManifestDumpCommand\l::DoCommand" alt="" coords="573,5,795,51"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2708,185,2887,215"/><area shape="rect" id="node15" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="585,815,783,862"/><area shape="rect" id="node99" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="851,125,1024,171"/><area shape="rect" id="node13" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="3060,185,3111,215"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="843,1393,1032,1439"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1376,1462,1573,1509"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1376,1377,1573,1423"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="1081,1479,1327,1508"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1621,1515,1819,1562"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1867,1516,2115,1545"/><area shape="rect" id="node25" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="2163,1507,2384,1554"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2432,1395,2629,1442"/><area shape="rect" id="node34" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2444,1516,2617,1545"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2433,1569,2628,1615"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2443,1639,2619,1668"/><area shape="rect" id="node48" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2464,823,2597,852"/><area shape="rect" id="node91" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2449,1691,2612,1738"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2692,1444,2903,1473"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2723,1497,2872,1527"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2695,1551,2900,1580"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2719,1604,2876,1633"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2743,1657,2852,1687"/><area shape="rect" id="node50" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2716,814,2879,861"/><area shape="rect" id="node52" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2727,883,2868,930"/><area shape="rect" id="node54" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2697,953,2897,983"/><area shape="rect" id="node56" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2701,1007,2893,1036"/><area shape="rect" id="node58" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2743,1060,2852,1089"/><area shape="rect" id="node61" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2717,1113,2877,1159"/><area shape="rect" id="node63" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2736,1183,2859,1212"/><area shape="rect" id="node65" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2729,1235,2865,1282"/><area shape="rect" id="node67" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2701,1305,2893,1351"/><area shape="rect" id="node69" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2701,1374,2893,1421"/><area shape="rect" id="node71" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2689,308,2905,337"/><area shape="rect" id="node73" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2716,361,2879,407"/><area shape="rect" id="node75" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2772,431,2823,460"/><area shape="rect" id="node77" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2728,483,2867,530"/><area shape="rect" id="node79" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2708,553,2887,599"/><area shape="rect" id="node81" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2716,238,2879,285"/><area shape="rect" id="node85" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2715,623,2880,652"/><area shape="rect" id="node87" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2728,675,2867,722"/><area shape="rect" id="node89" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2725,745,2869,791"/><area shape="rect" id="node83" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="2967,95,3204,142"/><area shape="rect" id="node107" href="../../d0/d58/a01230.html#a769cf9f08028648f2cb824dbbf695de7" title="rocksdb::ReduceDBLevelsCommand\l::GetOldNumOfLevels" alt="" coords="2679,14,2916,61"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab4db09546c98f26bf219164f016e4fb4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double rocksdb::VersionSet::MaxCompactionScore </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00344">344</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00196">rocksdb::Version::max_compaction_score_</a>.</p>
<div class="fragment"><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                                    {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a576c1be204ef90b3c0df1dcfb6a9bad9">max_compaction_score_</a>;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abbe56ed3b3594280ddeb30ca78b8ef76"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rocksdb::VersionSet::MaxCompactionScoreLevel </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00349">349</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00197">rocksdb::Version::max_compaction_score_level_</a>.</p>
<div class="fragment"><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                                      {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a69ec0f3548d90ff58485075a120971f3">max_compaction_score_level_</a>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a51725970659718a612480286843b0ad5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::MaxFileSizeForLevel </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02107">2107</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00494">max_file_size_</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02904">CompactRange()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02113">ExpandedCompactionByteSizeLimit()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02119">MaxGrandParentOverlapBytes()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02522">PickCompactionBySize()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02313">PickCompactionUniversalReadAmp()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l02209">PickCompactionUniversalSizeAmp()</a>.</p>
<div class="fragment"><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                                                  {</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;  assert(level &gt;= 0);</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;  assert(level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>());</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#a118a633a8d1ff038ab5506ad9044d086">max_file_size_</a>[level];</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a51725970659718a612480286843b0ad5_cgraph.png" border="0" usemap="#d1/d42/a01800_a51725970659718a612480286843b0ad5_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a51725970659718a612480286843b0ad5_cgraph" id="d1/d42/a01800_a51725970659718a612480286843b0ad5_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="207,5,345,51"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a51725970659718a612480286843b0ad5_icgraph.png" border="0" usemap="#d1/d42/a01800_a51725970659718a612480286843b0ad5_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a51725970659718a612480286843b0ad5_icgraph" id="d1/d42/a01800_a51725970659718a612480286843b0ad5_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#ace5e7f4084293eb426653ea279392111" title="rocksdb::VersionSet\l::CompactRange" alt="" coords="757,1173,896,1219"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a31739d9b6c47d04ec18b7e717796c4ed" title="rocksdb::VersionSet\l::ExpandedCompactionByteSize\lLimit" alt="" coords="220,1164,431,1228"/><area shape="rect" id="node9" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="757,1334,896,1381"/><area shape="rect" id="node12" href="../../d1/d42/a01800.html#a4f278dfbc54cda6dccee7d56f54e78ac" title="rocksdb::VersionSet\l::MaxGrandParentOverlapBytes" alt="" coords="223,1334,428,1381"/><area shape="rect" id="node99" href="../../d1/d42/a01800.html#a176e677ba6676e5160bbf1cd712d48e3" title="rocksdb::VersionSet\l::PickCompactionBySize" alt="" coords="503,1394,671,1441"/><area shape="rect" id="node106" href="../../d1/d42/a01800.html#ab1dc555d20916566e713d4ec5a623160" title="rocksdb::VersionSet\l::PickCompactionUniversalReadAmp" alt="" coords="207,1530,444,1577"/><area shape="rect" id="node111" href="../../d1/d42/a01800.html#aa2aed822db8d2f7096ef3aa1773bb946" title="rocksdb::VersionSet\l::PickCompactionUniversalSizeAmp" alt="" coords="208,1458,443,1505"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#ae62effcc413a67f9941cfc18a5d3bd93" title="rocksdb::VersionSet\l::SetupOtherInputs" alt="" coords="517,1173,656,1219"/><area shape="rect" id="node14" href="../../d4/dd1/a01797.html#a8cd69a62e51d319948e7e85cdc5686c3" title="rocksdb::Version::PickLevel\lForMemTableOutput" alt="" coords="495,1463,679,1510"/><area shape="rect" id="node16" href="../../dd/df5/a00386.html#ac3d320a145d5d36cb2bbf9e57b39ae8a" title="rocksdb::DBImpl::WriteLevel0\lTable" alt="" coords="728,1463,925,1510"/><area shape="rect" id="node18" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="973,1463,1163,1510"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1507,1411,1704,1458"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1507,1529,1704,1575"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="1212,1472,1457,1501"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1752,1351,1949,1398"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1997,1316,2245,1345"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="2293,1359,2515,1406"/><area shape="rect" id="node29" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2563,1531,2760,1578"/><area shape="rect" id="node35" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2575,1305,2748,1335"/><area shape="rect" id="node41" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2564,1358,2759,1405"/><area shape="rect" id="node45" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2573,1428,2749,1457"/><area shape="rect" id="node49" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2595,659,2728,688"/><area shape="rect" id="node91" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2580,1235,2743,1282"/><area shape="rect" id="node31" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2811,1511,3021,1540"/><area shape="rect" id="node37" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2841,1264,2991,1293"/><area shape="rect" id="node39" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2813,1317,3019,1347"/><area shape="rect" id="node43" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2837,1371,2995,1400"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2861,1428,2971,1457"/><area shape="rect" id="node51" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2835,650,2997,697"/><area shape="rect" id="node53" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2845,719,2987,766"/><area shape="rect" id="node55" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2816,789,3016,819"/><area shape="rect" id="node57" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2820,843,3012,872"/><area shape="rect" id="node59" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2861,896,2971,925"/><area shape="rect" id="node61" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2827,949,3005,979"/><area shape="rect" id="node63" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2836,1002,2996,1049"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2855,1072,2977,1101"/><area shape="rect" id="node67" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2848,1125,2984,1171"/><area shape="rect" id="node69" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2820,1194,3012,1241"/><area shape="rect" id="node71" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2820,5,3012,51"/><area shape="rect" id="node73" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2808,75,3024,104"/><area shape="rect" id="node75" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2835,127,2997,174"/><area shape="rect" id="node77" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2891,197,2941,227"/><area shape="rect" id="node79" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2847,250,2985,297"/><area shape="rect" id="node81" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2827,319,3005,366"/><area shape="rect" id="node83" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2835,389,2997,435"/><area shape="rect" id="node85" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2833,459,2999,488"/><area shape="rect" id="node87" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2847,511,2985,558"/><area shape="rect" id="node89" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2844,581,2988,627"/><area shape="rect" id="node108" href="../../d1/d42/a01800.html#a809a5b39c87ab02b0e3a438609e2bdfb" title="rocksdb::VersionSet\l::PickCompactionUniversal" alt="" coords="496,1533,677,1579"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4f278dfbc54cda6dccee7d56f54e78ac"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::MaxGrandParentOverlapBytes </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02119">2119</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d2/de3/a02637_source.html#l00343">rocksdb::Options::max_grandparent_overlap_factor</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02107">MaxFileSizeForLevel()</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02904">CompactRange()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02522">PickCompactionBySize()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l00611">rocksdb::Version::PickLevelForMemTableOutput()</a>.</p>
<div class="fragment"><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;                                                         {</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> result = <a class="code" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5">MaxFileSizeForLevel</a>(level);</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;  result *= <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#ae243afff75023d370c77ba832f96ad2a">max_grandparent_overlap_factor</a>;</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a4f278dfbc54cda6dccee7d56f54e78ac_cgraph.png" border="0" usemap="#d1/d42/a01800_a4f278dfbc54cda6dccee7d56f54e78ac_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a4f278dfbc54cda6dccee7d56f54e78ac_cgraph" id="d1/d42/a01800_a4f278dfbc54cda6dccee7d56f54e78ac_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5" title="rocksdb::VersionSet\l::MaxFileSizeForLevel" alt="" coords="261,5,413,51"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="463,5,601,51"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a4f278dfbc54cda6dccee7d56f54e78ac_icgraph.png" border="0" usemap="#d1/d42/a01800_a4f278dfbc54cda6dccee7d56f54e78ac_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a4f278dfbc54cda6dccee7d56f54e78ac_icgraph" id="d1/d42/a01800_a4f278dfbc54cda6dccee7d56f54e78ac_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#ace5e7f4084293eb426653ea279392111" title="rocksdb::VersionSet\l::CompactRange" alt="" coords="285,1338,424,1385"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="525,1429,664,1475"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a176e677ba6676e5160bbf1cd712d48e3" title="rocksdb::VersionSet\l::PickCompactionBySize" alt="" coords="271,1458,439,1505"/><area shape="rect" id="node10" href="../../d4/dd1/a01797.html#a8cd69a62e51d319948e7e85cdc5686c3" title="rocksdb::Version::PickLevel\lForMemTableOutput" alt="" coords="263,1527,447,1574"/><area shape="rect" id="node12" href="../../dd/df5/a00386.html#ac3d320a145d5d36cb2bbf9e57b39ae8a" title="rocksdb::DBImpl::WriteLevel0\lTable" alt="" coords="496,1527,693,1574"/><area shape="rect" id="node14" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="741,1527,931,1574"/><area shape="rect" id="node16" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1275,1475,1472,1522"/><area shape="rect" id="node102" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1275,1579,1472,1626"/><area shape="rect" id="node105" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="980,1484,1225,1513"/><area shape="rect" id="node18" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1520,1415,1717,1462"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1765,1377,2013,1407"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="2061,1419,2283,1466"/><area shape="rect" id="node25" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2331,1591,2528,1638"/><area shape="rect" id="node31" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2343,181,2516,211"/><area shape="rect" id="node45" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2332,1418,2527,1465"/><area shape="rect" id="node49" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2341,1488,2517,1517"/><area shape="rect" id="node53" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2363,864,2496,893"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2348,58,2511,105"/><area shape="rect" id="node27" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2579,1600,2789,1629"/><area shape="rect" id="node33" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2609,181,2759,211"/><area shape="rect" id="node43" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2581,128,2787,157"/><area shape="rect" id="node35" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2861,181,3027,211"/><area shape="rect" id="node37" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2893,235,2995,264"/><area shape="rect" id="node39" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2841,427,3047,456"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2889,128,2999,157"/><area shape="rect" id="node47" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2605,1493,2763,1523"/><area shape="rect" id="node51" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2629,1547,2739,1576"/><area shape="rect" id="node55" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2603,618,2765,665"/><area shape="rect" id="node57" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2613,687,2755,734"/><area shape="rect" id="node59" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2584,757,2784,787"/><area shape="rect" id="node61" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2588,811,2780,840"/><area shape="rect" id="node63" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2629,864,2739,893"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2595,917,2773,947"/><area shape="rect" id="node67" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2604,970,2764,1017"/><area shape="rect" id="node69" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2623,565,2745,595"/><area shape="rect" id="node72" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2616,1039,2752,1086"/><area shape="rect" id="node74" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2588,1109,2780,1155"/><area shape="rect" id="node76" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2588,1178,2780,1225"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2576,1248,2792,1277"/><area shape="rect" id="node80" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2603,1301,2765,1347"/><area shape="rect" id="node82" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2659,1371,2709,1400"/><area shape="rect" id="node84" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2615,1423,2753,1470"/><area shape="rect" id="node86" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2595,234,2773,281"/><area shape="rect" id="node88" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2603,303,2765,350"/><area shape="rect" id="node90" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2601,373,2767,403"/><area shape="rect" id="node92" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2615,426,2753,473"/><area shape="rect" id="node94" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2612,495,2756,542"/><area shape="rect" id="node98" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="2593,58,2775,105"/><area shape="rect" id="node100" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="2629,5,2739,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac412ddba42cd8fc7e7472004bdf5d351"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> rocksdb::VersionSet::MaxNextLevelOverlappingBytes </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02009">2009</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00646">rocksdb::Version::GetOverlappingInputs()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00026">rocksdb::FileMetaData::largest</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00025">rocksdb::FileMetaData::smallest</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l00031">rocksdb::TotalFileSize()</a>.</p>
<div class="fragment"><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                                                 {</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> result = 0;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;  std::vector&lt;FileMetaData*&gt; overlaps;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 1; level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>() - 1; level++) {</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level].size(); i++) {</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      <span class="keyword">const</span> FileMetaData* <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][i];</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060">GetOverlappingInputs</a>(level+1, &amp;f-&gt;smallest, &amp;f-&gt;largest,</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                                     &amp;overlaps);</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> sum = <a class="code" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e">TotalFileSize</a>(overlaps);</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;      <span class="keywordflow">if</span> (sum &gt; result) {</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        result = sum;</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;      }</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    }</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;  }</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ac412ddba42cd8fc7e7472004bdf5d351_cgraph.png" border="0" usemap="#d1/d42/a01800_ac412ddba42cd8fc7e7472004bdf5d351_cgraph" alt=""/></div>
<map name="d1/d42/a01800_ac412ddba42cd8fc7e7472004bdf5d351_cgraph" id="d1/d42/a01800_ac412ddba42cd8fc7e7472004bdf5d351_cgraph">
<area shape="rect" id="node3" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060" title="rocksdb::Version::GetOverlapping\lInputs" alt="" coords="272,256,491,303"/><area shape="rect" id="node31" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="312,325,451,372"/><area shape="rect" id="node33" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="305,395,457,425"/><area shape="rect" id="node5" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="1057,5,1201,52"/><area shape="rect" id="node7" href="../../d4/dd1/a01797.html#adadffeaebb14efe4d6af9c401e919e1e" title="rocksdb::Version::GetOverlapping\lInputsBinarySearch" alt="" coords="539,179,757,225"/><area shape="rect" id="node13" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="1024,283,1235,329"/><area shape="rect" id="node15" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="1059,179,1200,225"/><area shape="rect" id="node10" href="../../d4/dd1/a01797.html#a8861eeaa29b1b1dd83c413f2da2b8738" title="rocksdb::Version::Extend\lOverlappingInputs" alt="" coords="807,65,975,112"/><area shape="rect" id="node23" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="848,135,933,165"/><area shape="rect" id="node25" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="849,239,932,269"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ae015f9b23bbadef7eb4e3796c2d4fb46" title="rocksdb::ExtractUserKey" alt="" coords="1284,187,1452,217"/><area shape="rect" id="node19" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1501,161,1640,190"/><area shape="rect" id="node21" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1503,214,1639,243"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aacf23c27ccf421a224f961ad96dca7bc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::VersionSet::NeedsCompaction </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00338">338</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00186">rocksdb::Version::file_to_compact_</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00319">NeedsSizeCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                               {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">return</span> ((<a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a770555728cc6c48ab0de35a780788688">file_to_compact_</a> != <span class="keyword">nullptr</span>) ||</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <a class="code" href="../../d1/d42/a01800.html#a03e008d1840cd489452ec18094f96c69">NeedsSizeCompaction</a>());</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_aacf23c27ccf421a224f961ad96dca7bc_cgraph.png" border="0" usemap="#d1/d42/a01800_aacf23c27ccf421a224f961ad96dca7bc_cgraph" alt=""/></div>
<map name="d1/d42/a01800_aacf23c27ccf421a224f961ad96dca7bc_cgraph" id="d1/d42/a01800_aacf23c27ccf421a224f961ad96dca7bc_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a03e008d1840cd489452ec18094f96c69" title="rocksdb::VersionSet\l::NeedsSizeCompaction" alt="" coords="196,5,359,51"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="409,5,548,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a03e008d1840cd489452ec18094f96c69"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::VersionSet::NeedsSizeCompaction </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00319">319</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00194">rocksdb::Version::compaction_score_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00576">rocksdb::Options::compaction_style</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00057">rocksdb::kCompactionStyleUniversal</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d6a/a02613_source.html#l00338">NeedsCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                   {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">// In universal compaction case, this check doesn&#39;t really</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// check the compaction condition, but checks num of files threshold</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">// only. We are not going to miss any compaction opportunity</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="comment">// but it&#39;s likely that more compactions are scheduled but</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">// ending up with nothing to do. We can improve it later.</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment">// TODO: improve this function to be accurate for universal</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">//       compactions.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordtype">int</span> num_levels_to_check =</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        (<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> != <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a>) ?</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>() - 1 : 1;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num_levels_to_check; i++) {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a6ff4778880132e90e27ac58c39916567">compaction_score_</a>[i] &gt;= 1) {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a03e008d1840cd489452ec18094f96c69_cgraph.png" border="0" usemap="#d1/d42/a01800_a03e008d1840cd489452ec18094f96c69_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a03e008d1840cd489452ec18094f96c69_cgraph" id="d1/d42/a01800_a03e008d1840cd489452ec18094f96c69_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="220,5,359,51"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a03e008d1840cd489452ec18094f96c69_icgraph.png" border="0" usemap="#d1/d42/a01800_a03e008d1840cd489452ec18094f96c69_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a03e008d1840cd489452ec18094f96c69_icgraph" id="d1/d42/a01800_a03e008d1840cd489452ec18094f96c69_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#aacf23c27ccf421a224f961ad96dca7bc" title="rocksdb::VersionSet\l::NeedsCompaction" alt="" coords="220,5,359,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1a39a05ce05a65f4ccaabf59d18c0162"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::NewFileNumber </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00256">256</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00476">next_file_number_</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>.</p>
<div class="fragment"><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a>++; }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a1a39a05ce05a65f4ccaabf59d18c0162_icgraph.png" border="0" usemap="#d1/d42/a01800_a1a39a05ce05a65f4ccaabf59d18c0162_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a1a39a05ce05a65f4ccaabf59d18c0162_icgraph" id="d1/d42/a01800_a1a39a05ce05a65f4ccaabf59d18c0162_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="196,57,335,103"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2485,5,2664,35"/><area shape="rect" id="node9" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="385,799,583,846"/><area shape="rect" id="node106" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="640,57,813,103"/><area shape="rect" id="node7" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2825,5,2876,35"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="632,1475,821,1522"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1165,1497,1363,1543"/><area shape="rect" id="node100" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1165,1621,1363,1667"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="871,1509,1116,1539"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1411,1482,1608,1529"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1656,1499,1904,1528"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1952,1490,2173,1537"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2221,1663,2419,1710"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2233,1368,2407,1397"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2223,1490,2417,1537"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2232,1560,2408,1589"/><area shape="rect" id="node50" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2253,677,2387,707"/><area shape="rect" id="node94" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2239,1421,2401,1467"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2469,1661,2680,1691"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2500,1315,2649,1344"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2472,1368,2677,1397"/><area shape="rect" id="node32" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2768,1421,2933,1451"/><area shape="rect" id="node34" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2800,1315,2901,1344"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2748,1261,2953,1291"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2796,1368,2905,1397"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2496,1544,2653,1573"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2520,1597,2629,1627"/><area shape="rect" id="node52" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2493,301,2656,347"/><area shape="rect" id="node54" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2504,370,2645,417"/><area shape="rect" id="node56" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2475,440,2675,469"/><area shape="rect" id="node58" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2479,493,2671,523"/><area shape="rect" id="node60" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2520,547,2629,576"/><area shape="rect" id="node63" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2495,599,2655,646"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2513,1261,2636,1291"/><area shape="rect" id="node68" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2507,738,2643,785"/><area shape="rect" id="node70" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2479,807,2671,854"/><area shape="rect" id="node72" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2479,877,2671,923"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2467,947,2683,976"/><area shape="rect" id="node76" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2493,999,2656,1046"/><area shape="rect" id="node78" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2549,1069,2600,1099"/><area shape="rect" id="node80" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2505,1122,2644,1169"/><area shape="rect" id="node82" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2485,1191,2664,1238"/><area shape="rect" id="node84" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2493,669,2656,715"/><area shape="rect" id="node88" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2492,109,2657,139"/><area shape="rect" id="node90" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2505,162,2644,209"/><area shape="rect" id="node92" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2503,231,2647,278"/><area shape="rect" id="node86" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="2732,363,2969,410"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="2484,1421,2665,1467"/><area shape="rect" id="node98" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="2520,1491,2629,1520"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6ae62b8394f58801a6340323b2c37185"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rocksdb::VersionSet::NumberLevels </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00292">292</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00482">num_levels_</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l00254">rocksdb::Version::AddIterators()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01967">AddLiveFiles()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01992">AddLiveFilesCurrentVersion()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01934">ApproximateOffsetOf()</a>, <a class="el" href="../../d9/de7/a02572_source.html#l04863">rocksdb::BM_LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00930">rocksdb::VersionSet::Builder::Builder()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00964">rocksdb::VersionSet::Builder::CheckConsistency()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02904">CompactRange()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00859">rocksdb::Version::DebugString()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01674">Finalize()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00416">rocksdb::Version::Get()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02879">GetLiveFilesMetaData()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02862">GetMetadataForFile()</a>, <a class="el" href="../../d6/d0b/a02741_source.html#l01012">rocksdb::ReduceDBLevelsCommand::GetOldNumOfLevels()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01870">LevelDataSizeSummary()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01856">LevelSummary()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02099">MaxBytesForLevel()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02107">MaxFileSizeForLevel()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02009">MaxNextLevelOverlappingBytes()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00319">NeedsSizeCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02002">NumLevelBytes()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01850">NumLevelFiles()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02522">PickCompactionBySize()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02313">PickCompactionUniversalReadAmp()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02209">PickCompactionUniversalSizeAmp()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00611">rocksdb::Version::PickLevelForMemTableOutput()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>, <a class="el" href="../../dc/dd5/a02614_source.html#l00020">ReduceNumberOfLevels()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01082">rocksdb::VersionSet::Builder::SaveTo()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03079">rocksdb::Compaction::SetupBottomMostLevel()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02774">SetupOtherInputs()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02185">SizeBeingCompacted()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01776">UpdateFilesBySize()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01819">WriteSnapshot()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00942">rocksdb::VersionSet::Builder::~Builder()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l00039">rocksdb::Version::~Version()</a>.</p>
<div class="fragment"><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#a707d774d0f01630acd6caaf633514324">num_levels_</a>; }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a6ae62b8394f58801a6340323b2c37185_icgraph.png" border="0" usemap="#d1/d42/a01800_a6ae62b8394f58801a6340323b2c37185_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a6ae62b8394f58801a6340323b2c37185_icgraph" id="d1/d42/a01800_a6ae62b8394f58801a6340323b2c37185_icgraph">
<area shape="rect" id="node3" href="../../d4/dd1/a01797.html#a3a763078b635914957a9d00be6238853" title="rocksdb::Version::AddIterators" alt="" coords="205,5,403,35"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#ad966a25099780a5da3327ed06c81713e" title="rocksdb::VersionSet\l::AddLiveFiles" alt="" coords="235,58,373,105"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#aa5f832bd9d8a2cfda48e82bc4db8bd94" title="rocksdb::VersionSet\l::AddLiveFilesCurrentVersion" alt="" coords="208,127,400,174"/><area shape="rect" id="node9" href="../../d1/d42/a01800.html#aa0764ce8698d7d5b1ace2e0f6710c0f0" title="rocksdb::VersionSet\l::ApproximateOffsetOf" alt="" coords="228,197,380,243"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1015,435,1193,464"/><area shape="rect" id="node15" href="../../d0/d27/a00239.html#aa2ea220025d3626d915fe6902ad4a106" title="rocksdb::VersionSet\l::Builder::Builder" alt="" coords="235,1698,373,1745"/><area shape="rect" id="node17" href="../../d0/d27/a00239.html#a70c9fbc2ead82d8e2e4722161341eb49" title="rocksdb::VersionSet\l::Builder::CheckConsistency" alt="" coords="209,439,399,486"/><area shape="rect" id="node21" href="../../d1/d42/a01800.html#acf04defe0d794e6933785aad628ab9b6" title="rocksdb::VersionSet\l::Recover" alt="" coords="773,487,912,534"/><area shape="rect" id="node24" href="../../d0/d58/a01230.html#a769cf9f08028648f2cb824dbbf695de7" title="rocksdb::ReduceDBLevelsCommand\l::GetOldNumOfLevels" alt="" coords="985,487,1223,534"/><area shape="rect" id="node29" href="../../d1/d42/a01800.html#a6a345ce36535de042e2e0d254ff66a5a" title="rocksdb::VersionSet\l::DumpManifest" alt="" coords="773,601,912,647"/><area shape="rect" id="node33" href="../../d0/d27/a00239.html#a61a3b1cccd9c3d386297a9cf999781d6" title="rocksdb::VersionSet\l::Builder::SaveTo" alt="" coords="512,487,651,534"/><area shape="rect" id="node35" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="773,743,912,790"/><area shape="rect" id="node40" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="1017,853,1191,899"/><area shape="rect" id="node45" href="../../d1/d42/a01800.html#ace5e7f4084293eb426653ea279392111" title="rocksdb::VersionSet\l::CompactRange" alt="" coords="1035,1501,1173,1547"/><area shape="rect" id="node47" href="../../d4/dd1/a01797.html#a182d34a1f180b6f3e93b910df003257a" title="rocksdb::Version::DebugString" alt="" coords="481,557,681,587"/><area shape="rect" id="node51" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3" title="rocksdb::VersionSet\l::Finalize" alt="" coords="512,661,651,707"/><area shape="rect" id="node55" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="1035,1190,1173,1237"/><area shape="rect" id="node58" href="../../d4/dd1/a01797.html#ac25d8c130a1d695a0047111eb9195214" title="rocksdb::Version::Get" alt="" coords="229,1768,379,1797"/><area shape="rect" id="node66" href="../../d1/d42/a01800.html#a7916db473b10047e2acae9d12d1ff817" title="rocksdb::VersionSet\l::GetLiveFilesMetaData" alt="" coords="224,1821,384,1867"/><area shape="rect" id="node68" href="../../d1/d42/a01800.html#a4adc0625af13d9bbe2ed45960942e910" title="rocksdb::VersionSet\l::GetMetadataForFile" alt="" coords="232,1890,376,1937"/><area shape="rect" id="node71" href="../../d1/d42/a01800.html#a9ed02b6e79c2fde606142311ba7f3fd0" title="rocksdb::VersionSet\l::LevelDataSizeSummary" alt="" coords="496,2021,667,2067"/><area shape="rect" id="node73" href="../../d1/d42/a01800.html#a4d9d66f1d05b0e3351f1cca8b72552cb" title="rocksdb::VersionSet\l::LevelSummary" alt="" coords="235,2079,373,2126"/><area shape="rect" id="node76" href="../../d1/d42/a01800.html#a1639228385c42402a661292f6a27a818" title="rocksdb::VersionSet\l::MaxBytesForLevel" alt="" coords="235,661,373,707"/><area shape="rect" id="node79" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5" title="rocksdb::VersionSet\l::MaxFileSizeForLevel" alt="" coords="228,1422,380,1469"/><area shape="rect" id="node84" href="../../d1/d42/a01800.html#ae62effcc413a67f9941cfc18a5d3bd93" title="rocksdb::VersionSet\l::SetupOtherInputs" alt="" coords="773,1371,912,1418"/><area shape="rect" id="node92" href="../../d1/d42/a01800.html#a176e677ba6676e5160bbf1cd712d48e3" title="rocksdb::VersionSet\l::PickCompactionBySize" alt="" coords="759,1281,927,1327"/><area shape="rect" id="node95" href="../../d4/dd1/a01797.html#a8cd69a62e51d319948e7e85cdc5686c3" title="rocksdb::Version::PickLevel\lForMemTableOutput" alt="" coords="751,1681,935,1727"/><area shape="rect" id="node99" href="../../d1/d42/a01800.html#ab1dc555d20916566e713d4ec5a623160" title="rocksdb::VersionSet\l::PickCompactionUniversalReadAmp" alt="" coords="463,1621,700,1667"/><area shape="rect" id="node101" href="../../d1/d42/a01800.html#aa2aed822db8d2f7096ef3aa1773bb946" title="rocksdb::VersionSet\l::PickCompactionUniversalSizeAmp" alt="" coords="464,1690,699,1737"/><area shape="rect" id="node103" href="../../d1/d42/a01800.html#ac412ddba42cd8fc7e7472004bdf5d351" title="rocksdb::VersionSet\l::MaxNextLevelOverlappingBytes" alt="" coords="196,2149,412,2195"/><area shape="rect" id="node105" href="../../d1/d42/a01800.html#a03e008d1840cd489452ec18094f96c69" title="rocksdb::VersionSet\l::NeedsSizeCompaction" alt="" coords="223,2218,385,2265"/><area shape="rect" id="node107" href="../../d1/d42/a01800.html#ab0315528b5040a26724d06e9707692b4" title="rocksdb::VersionSet\l::NumLevelBytes" alt="" coords="235,1959,373,2006"/><area shape="rect" id="node110" href="../../d1/d42/a01800.html#a46a07e37f062ed0919878d92fb69a090" title="rocksdb::VersionSet\l::NumLevelFiles" alt="" coords="512,989,651,1035"/><area shape="rect" id="node112" href="../../d9/d5e/a00295.html#a92210e9ffc40a91ed85a1068e9033f0a" title="rocksdb::Compaction\l::SetupBottomMostLevel" alt="" coords="760,1159,925,1206"/><area shape="rect" id="node128" href="../../d1/d42/a01800.html#ac723248f990dd0f5de3eca23b292a501" title="rocksdb::VersionSet\l::SizeBeingCompacted" alt="" coords="504,730,659,777"/><area shape="rect" id="node134" href="../../d1/d42/a01800.html#a1161ffbcf7b18cde8bed5e361c7d3f0f" title="rocksdb::VersionSet\l::UpdateFilesBySize" alt="" coords="511,919,652,966"/><area shape="rect" id="node137" href="../../d1/d42/a01800.html#ab1e1ece4fbaa4098f0e08154f773cb61" title="rocksdb::VersionSet\l::WriteSnapshot" alt="" coords="512,799,651,846"/><area shape="rect" id="node140" href="../../d0/d27/a00239.html#a52e7547d321b9d9f9b9ed963146d67c3" title="rocksdb::VersionSet\l::Builder::~Builder" alt="" coords="235,2287,373,2334"/><area shape="rect" id="node142" href="../../d4/dd1/a01797.html#a0aab3f155faff82dd2e02aea4b2e7000" title="rocksdb::Version::\l~Version" alt="" coords="240,2357,368,2403"/><area shape="rect" id="node13" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1367,435,1417,464"/><area shape="rect" id="node19" href="../../d0/d27/a00239.html#a2ebf4c9e22b9adce7919b255dcb80393" title="rocksdb::VersionSet\l::Builder::Apply" alt="" coords="512,418,651,465"/><area shape="rect" id="node26" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="1273,547,1511,594"/><area shape="rect" id="node31" href="../../dd/d20/a00939.html#a0a4996198d709bec7b49eec50ba36567" title="rocksdb::ManifestDumpCommand\l::DoCommand" alt="" coords="993,607,1215,654"/><area shape="rect" id="node38" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="1005,743,1203,790"/><area shape="rect" id="node60" href="../../db/db9/a00387.html#aec7cba1ef92009fef81139c88020c9e1" title="rocksdb::DBImplReadOnly::Get" alt="" coords="479,1915,684,1944"/><area shape="rect" id="node62" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="495,1968,668,1997"/><area shape="rect" id="node64" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="493,1861,669,1891"/><area shape="rect" id="node82" href="../../d1/d42/a01800.html#a31739d9b6c47d04ec18b7e717796c4ed" title="rocksdb::VersionSet\l::ExpandedCompactionByteSize\lLimit" alt="" coords="476,1413,687,1477"/><area shape="rect" id="node88" href="../../d1/d42/a01800.html#a4f278dfbc54cda6dccee7d56f54e78ac" title="rocksdb::VersionSet\l::MaxGrandParentOverlapBytes" alt="" coords="479,1501,684,1547"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab0315528b5040a26724d06e9707692b4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> rocksdb::VersionSet::NumLevelBytes </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>)</td><td></td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02002">2002</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l00031">rocksdb::TotalFileSize()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01870">LevelDataSizeSummary()</a>.</p>
<div class="fragment"><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;                                                 {</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;  assert(level &gt;= 0);</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;  assert(level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>());</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  assert(<a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>);</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e">TotalFileSize</a>(<a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level]);</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ab0315528b5040a26724d06e9707692b4_cgraph.png" border="0" usemap="#d1/d42/a01800_ab0315528b5040a26724d06e9707692b4_cgraph" alt=""/></div>
<map name="d1/d42/a01800_ab0315528b5040a26724d06e9707692b4_cgraph" id="d1/d42/a01800_ab0315528b5040a26724d06e9707692b4_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="201,5,340,51"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="195,75,347,104"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ab0315528b5040a26724d06e9707692b4_icgraph.png" border="0" usemap="#d1/d42/a01800_ab0315528b5040a26724d06e9707692b4_icgraph" alt=""/></div>
<map name="d1/d42/a01800_ab0315528b5040a26724d06e9707692b4_icgraph" id="d1/d42/a01800_ab0315528b5040a26724d06e9707692b4_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a9ed02b6e79c2fde606142311ba7f3fd0" title="rocksdb::VersionSet\l::LevelDataSizeSummary" alt="" coords="195,5,365,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a46a07e37f062ed0919878d92fb69a090"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rocksdb::VersionSet::NumLevelFiles </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>)</td><td></td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01850">1850</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/d0b/a02741_source.html#l01012">rocksdb::ReduceDBLevelsCommand::GetOldNumOfLevels()</a>, <a class="el" href="../../dc/dd5/a02614_source.html#l00020">ReduceNumberOfLevels()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l03079">rocksdb::Compaction::SetupBottomMostLevel()</a>.</p>
<div class="fragment"><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                                             {</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  assert(level &gt;= 0);</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  assert(level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>());</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level].size();</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a46a07e37f062ed0919878d92fb69a090_cgraph.png" border="0" usemap="#d1/d42/a01800_a46a07e37f062ed0919878d92fb69a090_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a46a07e37f062ed0919878d92fb69a090_cgraph" id="d1/d42/a01800_a46a07e37f062ed0919878d92fb69a090_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="196,5,335,51"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a46a07e37f062ed0919878d92fb69a090_icgraph.png" border="0" usemap="#d1/d42/a01800_a46a07e37f062ed0919878d92fb69a090_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a46a07e37f062ed0919878d92fb69a090_icgraph" id="d1/d42/a01800_a46a07e37f062ed0919878d92fb69a090_icgraph">
<area shape="rect" id="node3" href="../../d0/d58/a01230.html#a769cf9f08028648f2cb824dbbf695de7" title="rocksdb::ReduceDBLevelsCommand\l::GetOldNumOfLevels" alt="" coords="196,5,433,51"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="228,74,401,121"/><area shape="rect" id="node10" href="../../d9/d5e/a00295.html#a92210e9ffc40a91ed85a1068e9033f0a" title="rocksdb::Compaction\l::SetupBottomMostLevel" alt="" coords="232,143,397,190"/><area shape="rect" id="node5" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="484,22,721,69"/><area shape="rect" id="node12" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="533,109,672,155"/><area shape="rect" id="node14" href="../../d1/d42/a01800.html#ace5e7f4084293eb426653ea279392111" title="rocksdb::VersionSet\l::CompactRange" alt="" coords="533,178,672,225"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a90a321a7d55d6a3cab7b1a63366b59f4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d1/d42/a01800.html">VersionSet</a> &amp;&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a62eb602d1ca2dc2a9f0a87dfe184fb2c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::VersionSet::ParentRangeInCompaction </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../de/de6/a00723.html">InternalKey</a> *&#160;</td>
          <td class="paramname"><em>smallest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/de6/a00723.html">InternalKey</a> *&#160;</td>
          <td class="paramname"><em>largest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02698">2698</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02708">FilesInCompaction()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l00646">rocksdb::Version::GetOverlappingInputs()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02727">ExpandWhileOverlapping()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l02522">PickCompactionBySize()</a>.</p>
<div class="fragment"><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;                                                            {</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;  std::vector&lt;FileMetaData*&gt; inputs;</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060">GetOverlappingInputs</a>(level+1, smallest, largest,</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;                                 &amp;inputs, *parent_index, parent_index);</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#a512e8e76628bdb9c867f6309d68fd412">FilesInCompaction</a>(inputs);</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a62eb602d1ca2dc2a9f0a87dfe184fb2c_cgraph.png" border="0" usemap="#d1/d42/a01800_a62eb602d1ca2dc2a9f0a87dfe184fb2c_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a62eb602d1ca2dc2a9f0a87dfe184fb2c_cgraph" id="d1/d42/a01800_a62eb602d1ca2dc2a9f0a87dfe184fb2c_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a512e8e76628bdb9c867f6309d68fd412" title="rocksdb::VersionSet\l::FilesInCompaction" alt="" coords="280,187,419,233"/><area shape="rect" id="node5" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060" title="rocksdb::Version::GetOverlapping\lInputs" alt="" coords="240,256,459,303"/><area shape="rect" id="node7" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="1025,5,1169,52"/><area shape="rect" id="node9" href="../../d4/dd1/a01797.html#adadffeaebb14efe4d6af9c401e919e1e" title="rocksdb::Version::GetOverlapping\lInputsBinarySearch" alt="" coords="507,179,725,225"/><area shape="rect" id="node15" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="992,283,1203,329"/><area shape="rect" id="node17" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="1027,179,1168,225"/><area shape="rect" id="node12" href="../../d4/dd1/a01797.html#a8861eeaa29b1b1dd83c413f2da2b8738" title="rocksdb::Version::Extend\lOverlappingInputs" alt="" coords="775,65,943,112"/><area shape="rect" id="node25" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="816,135,901,165"/><area shape="rect" id="node27" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="817,239,900,269"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#ae015f9b23bbadef7eb4e3796c2d4fb46" title="rocksdb::ExtractUserKey" alt="" coords="1252,187,1420,217"/><area shape="rect" id="node21" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1469,161,1608,190"/><area shape="rect" id="node23" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1471,214,1607,243"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a62eb602d1ca2dc2a9f0a87dfe184fb2c_icgraph.png" border="0" usemap="#d1/d42/a01800_a62eb602d1ca2dc2a9f0a87dfe184fb2c_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a62eb602d1ca2dc2a9f0a87dfe184fb2c_icgraph" id="d1/d42/a01800_a62eb602d1ca2dc2a9f0a87dfe184fb2c_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#aec0ea29ca7b511b74376486592307d70" title="rocksdb::VersionSet\l::ExpandWhileOverlapping" alt="" coords="240,9,416,55"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="465,74,604,121"/><area shape="rect" id="node10" href="../../d1/d42/a01800.html#a176e677ba6676e5160bbf1cd712d48e3" title="rocksdb::VersionSet\l::PickCompactionBySize" alt="" coords="244,129,412,175"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#ace5e7f4084293eb426653ea279392111" title="rocksdb::VersionSet\l::CompactRange" alt="" coords="465,5,604,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a18db5b74de66aa2038d11902bbd1f348"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> * rocksdb::VersionSet::PickCompaction </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02595">2595</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../de/d3b/a02610_source.html#l00027">rocksdb::FileMetaData::being_compacted</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00438">Compaction</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00195">rocksdb::Version::compaction_level_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00194">rocksdb::Version::compaction_score_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00576">rocksdb::Options::compaction_style</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00500">compactions_in_progress_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02727">ExpandWhileOverlapping()</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00186">rocksdb::Version::file_to_compact_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00187">rocksdb::Version::file_to_compact_level_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01674">Finalize()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00646">rocksdb::Version::GetOverlappingInputs()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02029">GetRange()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00611">rocksdb::Compaction::input_version_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00619">rocksdb::Compaction::inputs_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00057">rocksdb::kCompactionStyleUniversal</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00026">rocksdb::FileMetaData::largest</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03067">rocksdb::Compaction::MarkFilesBeingCompacted()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02107">MaxFileSizeForLevel()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02119">MaxGrandParentOverlapBytes()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00629">rocksdb::Compaction::parent_index_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02698">ParentRangeInCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02522">PickCompactionBySize()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02443">PickCompactionUniversal()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00591">rocksdb::Version::Ref()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03079">rocksdb::Compaction::SetupBottomMostLevel()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02774">SetupOtherInputs()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02185">SizeBeingCompacted()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00025">rocksdb::FileMetaData::smallest</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00159">rocksdb::Version::vset_</a>.</p>
<div class="fragment"><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;                                       {</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a>* c = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;  <span class="keywordtype">int</span> level = -1;</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;  <span class="comment">// Compute the compactions needed. It is better to do it here</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;  <span class="comment">// and also in LogAndApply(), otherwise the values could be stale.</span></div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;  std::vector&lt;uint64_t&gt; size_being_compacted(<a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>()-1);</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a493d21d96671526645310de1037118dd">vset_</a>-&gt;<a class="code" href="../../d1/d42/a01800.html#ac723248f990dd0f5de3eca23b292a501">SizeBeingCompacted</a>(size_being_compacted);</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3">Finalize</a>(<a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>, size_being_compacted);</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;  <span class="comment">// In universal style of compaction, compact L0 files back into L0.</span></div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> ==  <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a>) {</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;    <span class="keywordtype">int</span> level = 0;</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;    c = <a class="code" href="../../d1/d42/a01800.html#a809a5b39c87ab02b0e3a438609e2bdfb">PickCompactionUniversal</a>(level, <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a6ff4778880132e90e27ac58c39916567">compaction_score_</a>[level]);</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;    <span class="keywordflow">return</span> c;</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;  }</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;  <span class="comment">// We prefer compactions triggered by too much data in a level over</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;  <span class="comment">// the compactions triggered by seeks.</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;  <span class="comment">// Find the compactions by size on all levels.</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>()-1; i++) {</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;    assert(i == 0 || <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a6ff4778880132e90e27ac58c39916567">compaction_score_</a>[i] &lt;=</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;                     <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a6ff4778880132e90e27ac58c39916567">compaction_score_</a>[i-1]);</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;    level = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a59fbad3f8eccacd6d53dc2848160eae1">compaction_level_</a>[i];</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a6ff4778880132e90e27ac58c39916567">compaction_score_</a>[i] &gt;= 1)) {</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;      c = <a class="code" href="../../d1/d42/a01800.html#a176e677ba6676e5160bbf1cd712d48e3">PickCompactionBySize</a>(level, <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a6ff4778880132e90e27ac58c39916567">compaction_score_</a>[i]);</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#aec0ea29ca7b511b74376486592307d70">ExpandWhileOverlapping</a>(c);</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;      <span class="keywordflow">if</span> (c != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;      }</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    }</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;  }</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  <span class="comment">// Find compactions needed by seeks</span></div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;  FileMetaData* <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a770555728cc6c48ab0de35a780788688">file_to_compact_</a>;</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  <span class="keywordflow">if</span> (c == <span class="keyword">nullptr</span> &amp;&amp; f != <span class="keyword">nullptr</span> &amp;&amp; !f-&gt;being_compacted) {</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;    level = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#aecfbafaa8da6cebb57df402fed4bba77">file_to_compact_level_</a>;</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;    <span class="keywordtype">int</span> parent_index = -1;</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;    <span class="comment">// Only allow one level 0 compaction at a time.</span></div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;    <span class="comment">// Do not pick this file if its parents at level+1 are being compacted.</span></div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;    <span class="keywordflow">if</span> (level != 0 || <a class="code" href="../../d1/d42/a01800.html#a6c4a4e38b597d39024dd2192adceb3b3">compactions_in_progress_</a>[0].empty()) {</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="../../d1/d42/a01800.html#a62eb602d1ca2dc2a9f0a87dfe184fb2c">ParentRangeInCompaction</a>(&amp;f-&gt;smallest, &amp;f-&gt;largest, level,</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                                  &amp;parent_index)) {</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;        c = <span class="keyword">new</span> <a class="code" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a>(level, level+1, <a class="code" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5">MaxFileSizeForLevel</a>(level+1),</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                <a class="code" href="../../d1/d42/a01800.html#a4f278dfbc54cda6dccee7d56f54e78ac">MaxGrandParentOverlapBytes</a>(level), <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(), <span class="keyword">true</span>);</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;        c-&gt;inputs_[0].push_back(f);</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;        c-&gt;parent_index_ = parent_index;</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;        <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a770555728cc6c48ab0de35a780788688">file_to_compact_</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;        <a class="code" href="../../d1/d42/a01800.html#aec0ea29ca7b511b74376486592307d70">ExpandWhileOverlapping</a>(c);</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;      }</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;    }</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;  }</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;  <span class="keywordflow">if</span> (c == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;  }</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;  c-&gt;input_version_ = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>;</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;  c-&gt;input_version_-&gt;<a class="code" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2">Ref</a>();</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;  <span class="comment">// Two level 0 compaction won&#39;t run at the same time, so don&#39;t need to worry</span></div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;  <span class="comment">// about files on level 0 being compacted.</span></div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;  <span class="keywordflow">if</span> (level == 0) {</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    assert(<a class="code" href="../../d1/d42/a01800.html#a6c4a4e38b597d39024dd2192adceb3b3">compactions_in_progress_</a>[0].empty());</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;    InternalKey smallest, largest;</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588">GetRange</a>(c-&gt;inputs_[0], &amp;smallest, &amp;largest);</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;    <span class="comment">// Note that the next call will discard the file we placed in</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    <span class="comment">// c-&gt;inputs_[0] earlier and replace it with an overlapping set</span></div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;    <span class="comment">// which will include the picked file.</span></div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;    c-&gt;inputs_[0].clear();</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060">GetOverlappingInputs</a>(0, &amp;smallest, &amp;largest, &amp;c-&gt;inputs_[0]);</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    <span class="comment">// If we include more L0 files in the same compaction run it can</span></div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;    <span class="comment">// cause the &#39;smallest&#39; and &#39;largest&#39; key to get extended to a</span></div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;    <span class="comment">// larger range. So, re-invoke GetRange to get the new key range</span></div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588">GetRange</a>(c-&gt;inputs_[0], &amp;smallest, &amp;largest);</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#a62eb602d1ca2dc2a9f0a87dfe184fb2c">ParentRangeInCompaction</a>(&amp;smallest, &amp;largest,</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;                                level, &amp;c-&gt;parent_index_)) {</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;      <span class="keyword">delete</span> c;</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;    }</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;    assert(!c-&gt;inputs_[0].empty());</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;  }</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;  <span class="comment">// Setup &quot;level+1&quot; files (inputs_[1])</span></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#ae62effcc413a67f9941cfc18a5d3bd93">SetupOtherInputs</a>(c);</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;  <span class="comment">// mark all the files that are being compacted</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;  c-&gt;MarkFilesBeingCompacted(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;  <span class="comment">// Is this compaction creating a file at the bottommost level</span></div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;  c-&gt;SetupBottomMostLevel(<span class="keyword">false</span>);</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;  <span class="comment">// remember this currently undergoing compaction</span></div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a6c4a4e38b597d39024dd2192adceb3b3">compactions_in_progress_</a>[level].insert(c);</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;  <span class="keywordflow">return</span> c;</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a18db5b74de66aa2038d11902bbd1f348_cgraph.png" border="0" usemap="#d1/d42/a01800_a18db5b74de66aa2038d11902bbd1f348_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a18db5b74de66aa2038d11902bbd1f348_cgraph" id="d1/d42/a01800_a18db5b74de66aa2038d11902bbd1f348_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#aec0ea29ca7b511b74376486592307d70" title="rocksdb::VersionSet\l::ExpandWhileOverlapping" alt="" coords="200,177,376,224"/><area shape="rect" id="node7" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060" title="rocksdb::Version::GetOverlapping\lInputs" alt="" coords="717,157,936,204"/><area shape="rect" id="node35" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588" title="rocksdb::VersionSet\l::GetRange" alt="" coords="757,468,896,514"/><area shape="rect" id="node51" href="../../d1/d42/a01800.html#a62eb602d1ca2dc2a9f0a87dfe184fb2c" title="rocksdb::VersionSet\l::ParentRangeInCompaction" alt="" coords="456,92,643,138"/><area shape="rect" id="node55" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3" title="rocksdb::VersionSet\l::Finalize" alt="" coords="480,585,619,632"/><area shape="rect" id="node59" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="1024,1428,1163,1474"/><area shape="rect" id="node70" href="../../d9/d5e/a00295.html#a11fbf1653e0ebe7db8c6e709de649557" title="rocksdb::Compaction\l::MarkFilesBeingCompacted" alt="" coords="195,2018,381,2065"/><area shape="rect" id="node72" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5" title="rocksdb::VersionSet\l::MaxFileSizeForLevel" alt="" coords="751,1248,903,1294"/><area shape="rect" id="node75" href="../../d1/d42/a01800.html#a4f278dfbc54cda6dccee7d56f54e78ac" title="rocksdb::VersionSet\l::MaxGrandParentOverlapBytes" alt="" coords="447,806,652,853"/><area shape="rect" id="node80" href="../../d1/d42/a01800.html#a176e677ba6676e5160bbf1cd712d48e3" title="rocksdb::VersionSet\l::PickCompactionBySize" alt="" coords="204,721,372,768"/><area shape="rect" id="node87" href="../../d1/d42/a01800.html#a809a5b39c87ab02b0e3a438609e2bdfb" title="rocksdb::VersionSet\l::PickCompactionUniversal" alt="" coords="197,1898,379,1945"/><area shape="rect" id="node108" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="475,2098,624,2127"/><area shape="rect" id="node111" href="../../d9/d5e/a00295.html#a92210e9ffc40a91ed85a1068e9033f0a" title="rocksdb::Compaction\l::SetupBottomMostLevel" alt="" coords="205,1408,371,1454"/><area shape="rect" id="node118" href="../../d1/d42/a01800.html#ae62effcc413a67f9941cfc18a5d3bd93" title="rocksdb::VersionSet\l::SetupOtherInputs" alt="" coords="219,977,357,1024"/><area shape="rect" id="node145" href="../../d1/d42/a01800.html#ac723248f990dd0f5de3eca23b292a501" title="rocksdb::VersionSet\l::SizeBeingCompacted" alt="" coords="211,1598,365,1645"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a512e8e76628bdb9c867f6309d68fd412" title="rocksdb::VersionSet\l::FilesInCompaction" alt="" coords="757,88,896,134"/><area shape="rect" id="node49" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="476,1377,623,1424"/><area shape="rect" id="node9" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="1553,258,1697,305"/><area shape="rect" id="node11" href="../../d4/dd1/a01797.html#adadffeaebb14efe4d6af9c401e919e1e" title="rocksdb::Version::GetOverlapping\lInputsBinarySearch" alt="" coords="984,364,1203,410"/><area shape="rect" id="node17" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="1520,144,1731,190"/><area shape="rect" id="node19" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="1555,377,1696,424"/><area shape="rect" id="node14" href="../../d4/dd1/a01797.html#a8861eeaa29b1b1dd83c413f2da2b8738" title="rocksdb::Version::Extend\lOverlappingInputs" alt="" coords="1277,318,1445,365"/><area shape="rect" id="node27" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="1319,439,1404,468"/><area shape="rect" id="node29" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="1320,1300,1403,1330"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#ae015f9b23bbadef7eb4e3796c2d4fb46" title="rocksdb::ExtractUserKey" alt="" coords="1780,524,1948,554"/><area shape="rect" id="node23" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1997,524,2136,554"/><area shape="rect" id="node25" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1999,603,2135,632"/><area shape="rect" id="node37" href="../../de/de6/a00723.html#af2bf0f2689f28795fc9d0533b6f04acf" title="rocksdb::InternalKey\l::Clear" alt="" coords="1023,593,1164,640"/><area shape="rect" id="node39" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="1256,542,1467,589"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#aab29434ed2c251eae44fdb498e4d8dcc" title="rocksdb::BumpPerfCount" alt="" coords="1541,498,1709,527"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1543,551,1708,580"/><area shape="rect" id="node57" href="../../d1/d42/a01800.html#a1639228385c42402a661292f6a27a818" title="rocksdb::VersionSet\l::MaxBytesForLevel" alt="" coords="757,592,896,638"/><area shape="rect" id="node62" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="757,661,896,708"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="751,926,903,955"/><area shape="rect" id="node64" href="../../d0/dbf/a03363.html#a75c05654caed31bf91b09dbc14e681d1" title="beast::hash_metrics\l::detail::sqr" alt="" coords="1024,662,1163,709"/><area shape="rect" id="node89" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="779,1835,875,1864"/><area shape="rect" id="node91" href="../../d1/d42/a01800.html#ae6adf63444a6a5f7dc4ad0bd751a0c13" title="rocksdb::VersionSet\l::LevelFileSummary" alt="" coords="480,2028,619,2074"/><area shape="rect" id="node93" href="../../d1/d42/a01800.html#aa2aed822db8d2f7096ef3aa1773bb946" title="rocksdb::VersionSet\l::PickCompactionUniversalSizeAmp" alt="" coords="432,1788,667,1834"/><area shape="rect" id="node99" href="../../d1/d42/a01800.html#ab1dc555d20916566e713d4ec5a623160" title="rocksdb::VersionSet\l::PickCompactionUniversalReadAmp" alt="" coords="431,1958,668,2005"/><area shape="rect" id="node115" href="../../d1/d42/a01800.html#a46a07e37f062ed0919878d92fb69a090" title="rocksdb::VersionSet\l::NumLevelFiles" alt="" coords="757,1428,896,1474"/><area shape="rect" id="node123" href="../../d1/d42/a01800.html#a300d694d7eba66eb5bb129ddfea015fa" title="rocksdb::VersionSet\l::GetRange2" alt="" coords="480,465,619,512"/><area shape="rect" id="node127" href="../../d1/d42/a01800.html#a31739d9b6c47d04ec18b7e717796c4ed" title="rocksdb::VersionSet\l::ExpandedCompactionByteSize\lLimit" alt="" coords="444,1239,655,1303"/><area shape="rect" id="node131" href="../../d4/dd1/a01797.html#a8ba59d2bda530f588042dcbad00d3b9d" title="rocksdb::Version::HasOverlapping\lUserKey" alt="" coords="1251,97,1472,144"/><area shape="rect" id="node137" href="../../de/de6/a00723.html#a1f29087f48fd168fe431e4b884f5aed1" title="rocksdb::InternalKey\l::DebugString" alt="" coords="479,977,620,1024"/><area shape="rect" id="node139" href="../../de/de6/a00723.html#a6d86d2cfbd4205b41f29f84cdedf3c22" title="rocksdb::InternalKey\l::Encode" alt="" coords="479,1046,620,1093"/><area shape="rect" id="node141" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="468,1116,631,1146"/><area shape="rect" id="node143" href="../../d2/d86/a01798.html#ad1b747cb4b2572325d2622a9bcfb242d" title="rocksdb::VersionEdit\l::SetCompactPointer" alt="" coords="477,1169,621,1216"/><area shape="rect" id="node149" href="../../d9/d5e/a00295.html#ae0e14955026684df1c7e261dc31fcb70" title="rocksdb::Compaction\l::num_input_files" alt="" coords="476,1718,623,1765"/><area shape="rect" id="node151" href="../../d9/d5e/a00295.html#a31e5be150c385f6df320ee7f7daf7a9a" title="rocksdb::Compaction\l::input" alt="" coords="476,1649,623,1696"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a176e677ba6676e5160bbf1cd712d48e3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> * rocksdb::VersionSet::PickCompactionBySize </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>score</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02522">2522</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00628">rocksdb::Compaction::base_index_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00027">rocksdb::FileMetaData::being_compacted</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00438">Compaction</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00500">compactions_in_progress_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00024">rocksdb::FileMetaData::file_size</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00172">rocksdb::Version::files_by_size_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00619">rocksdb::Compaction::inputs_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00026">rocksdb::FileMetaData::largest</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02107">MaxFileSizeForLevel()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02119">MaxGrandParentOverlapBytes()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00176">rocksdb::Version::next_file_to_compact_by_size_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00183">rocksdb::Version::number_of_files_to_sort_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00629">rocksdb::Compaction::parent_index_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02698">ParentRangeInCompaction()</a>, <a class="el" href="../../d5/d1b/a01971_source.html#l00116">beast::hash_metrics::detail::score()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00630">rocksdb::Compaction::score_</a>, and <a class="el" href="../../de/d3b/a02610_source.html#l00025">rocksdb::FileMetaData::smallest</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;                                                                    {</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a>* c = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;  <span class="comment">// level 0 files are overlapping. So we cannot pick more</span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;  <span class="comment">// than one concurrent compactions at this level. This</span></div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;  <span class="comment">// could be made better by looking at key-ranges that are</span></div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;  <span class="comment">// being compacted at level 0.</span></div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;  <span class="keywordflow">if</span> (level == 0 &amp;&amp; <a class="code" href="../../d1/d42/a01800.html#a6c4a4e38b597d39024dd2192adceb3b3">compactions_in_progress_</a>[level].size() == 1) {</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;  }</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;  assert(level &gt;= 0);</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;  assert(level+1 &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>());</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  c = <span class="keyword">new</span> <a class="code" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a>(level, level+1, <a class="code" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5">MaxFileSizeForLevel</a>(level+1),</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a4f278dfbc54cda6dccee7d56f54e78ac">MaxGrandParentOverlapBytes</a>(level), <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>());</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  c-&gt;score_ = <a class="code" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527">score</a>;</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  <span class="comment">// Pick the largest file in this level that is not already</span></div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;  <span class="comment">// being compacted</span></div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  std::vector&lt;int&gt;&amp; file_size = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a83064706e81e2fd23744f97d3ddfaa7c">files_by_size_</a>[level];</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;  <span class="comment">// record the first file that is not yet compacted</span></div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;  <span class="keywordtype">int</span> nextIndex = -1;</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#ac54995430714197d2901217fa0d052df">next_file_to_compact_by_size_</a>[level];</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;       i &lt; file_size.size(); i++) {</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    <span class="keywordtype">int</span> index = file_size[i];</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    FileMetaData* <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][index];</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    <span class="comment">// check to verify files are arranged in descending size</span></div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;    assert((i == file_size.size() - 1) ||</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;           (i &gt;= <a class="code" href="../../d4/dd1/a01797.html#a4d4d981d0d40d7be0ef31dc604461a17">Version::number_of_files_to_sort_</a>-1) ||</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;          (f-&gt;file_size &gt;= <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][file_size[i+1]]-&gt;file_size));</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    <span class="comment">// do not pick a file to compact if it is being compacted</span></div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;    <span class="comment">// from n-1 level.</span></div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;    <span class="keywordflow">if</span> (f-&gt;being_compacted) {</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    }</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    <span class="comment">// remember the startIndex for the next call to PickCompaction</span></div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;    <span class="keywordflow">if</span> (nextIndex == -1) {</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;      nextIndex = i;</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;    }</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;    <span class="comment">//if (i &gt; Version::number_of_files_to_sort_) {</span></div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;    <span class="comment">//  Log(options_-&gt;info_log, &quot;XXX Looking at index %d&quot;, i);</span></div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;    <span class="comment">// Do not pick this file if its parents at level+1 are being compacted.</span></div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;    <span class="comment">// Maybe we can avoid redoing this work in SetupOtherInputs</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;    <span class="keywordtype">int</span> parent_index = -1;</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#a62eb602d1ca2dc2a9f0a87dfe184fb2c">ParentRangeInCompaction</a>(&amp;f-&gt;smallest, &amp;f-&gt;largest, level,</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;                                &amp;parent_index)) {</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    }</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;    c-&gt;inputs_[0].push_back(f);</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;    c-&gt;base_index_ = index;</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;    c-&gt;parent_index_ = parent_index;</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  }</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;  <span class="keywordflow">if</span> (c-&gt;inputs_[0].empty()) {</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    <span class="keyword">delete</span> c;</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;    c = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;  }</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;  <span class="comment">// store where to start the iteration in the next call to PickCompaction</span></div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#ac54995430714197d2901217fa0d052df">next_file_to_compact_by_size_</a>[level] = nextIndex;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;  <span class="keywordflow">return</span> c;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a176e677ba6676e5160bbf1cd712d48e3_cgraph.png" border="0" usemap="#d1/d42/a01800_a176e677ba6676e5160bbf1cd712d48e3_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a176e677ba6676e5160bbf1cd712d48e3_cgraph" id="d1/d42/a01800_a176e677ba6676e5160bbf1cd712d48e3_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5" title="rocksdb::VersionSet\l::MaxFileSizeForLevel" alt="" coords="511,33,663,80"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="784,36,923,82"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a4f278dfbc54cda6dccee7d56f54e78ac" title="rocksdb::VersionSet\l::MaxGrandParentOverlapBytes" alt="" coords="223,33,428,80"/><area shape="rect" id="node11" href="../../d1/d42/a01800.html#a62eb602d1ca2dc2a9f0a87dfe184fb2c" title="rocksdb::VersionSet\l::ParentRangeInCompaction" alt="" coords="232,153,419,200"/><area shape="rect" id="node43" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="256,257,395,304"/><area shape="rect" id="node13" href="../../d1/d42/a01800.html#a512e8e76628bdb9c867f6309d68fd412" title="rocksdb::VersionSet\l::FilesInCompaction" alt="" coords="517,222,656,269"/><area shape="rect" id="node15" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060" title="rocksdb::Version::GetOverlapping\lInputs" alt="" coords="477,153,696,200"/><area shape="rect" id="node17" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="1263,190,1407,237"/><area shape="rect" id="node19" href="../../d4/dd1/a01797.html#adadffeaebb14efe4d6af9c401e919e1e" title="rocksdb::Version::GetOverlapping\lInputsBinarySearch" alt="" coords="744,302,963,349"/><area shape="rect" id="node25" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="1229,477,1440,524"/><area shape="rect" id="node27" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="1264,260,1405,306"/><area shape="rect" id="node22" href="../../d4/dd1/a01797.html#a8861eeaa29b1b1dd83c413f2da2b8738" title="rocksdb::Version::Extend\lOverlappingInputs" alt="" coords="1012,417,1180,464"/><area shape="rect" id="node35" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="1053,311,1139,340"/><area shape="rect" id="node37" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="1055,364,1137,394"/><area shape="rect" id="node29" href="../../d4/d87/a03436.html#ae015f9b23bbadef7eb4e3796c2d4fb46" title="rocksdb::ExtractUserKey" alt="" coords="1489,268,1657,298"/><area shape="rect" id="node31" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1707,242,1845,271"/><area shape="rect" id="node33" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1708,295,1844,324"/><area shape="rect" id="node45" href="../../d0/dbf/a03363.html#a75c05654caed31bf91b09dbc14e681d1" title="beast::hash_metrics\l::detail::sqr" alt="" coords="517,292,656,338"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a176e677ba6676e5160bbf1cd712d48e3_icgraph.png" border="0" usemap="#d1/d42/a01800_a176e677ba6676e5160bbf1cd712d48e3_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a176e677ba6676e5160bbf1cd712d48e3_icgraph" id="d1/d42/a01800_a176e677ba6676e5160bbf1cd712d48e3_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="223,5,361,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a809a5b39c87ab02b0e3a438609e2bdfb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> * rocksdb::VersionSet::PickCompactionUniversal </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>score</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02443">2443</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d2/de3/a02637_source.html#l00579">rocksdb::Options::compaction_options_universal</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00500">compactions_in_progress_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00172">rocksdb::Version::files_by_size_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00029">rocksdb::FileMetaData::largest_seqno</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00272">rocksdb::Options::level0_file_num_compaction_trigger</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01885">LevelFileSummary()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00185">rocksdb::NUM_FILES_IN_SINGLE_COMPACTION</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02313">PickCompactionUniversalReadAmp()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02209">PickCompactionUniversalSizeAmp()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00591">rocksdb::Version::Ref()</a>, <a class="el" href="../../d2/d11/a02647_source.html#l00035">rocksdb::CompactionOptionsUniversal::size_ratio</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00028">rocksdb::FileMetaData::smallest_seqno</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00348">rocksdb::Options::statistics</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                                                                       {</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;  assert (level == 0);</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;  <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level].size() &lt;</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;      (<span class="keywordtype">unsigned</span> int)<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a61b4f31fe3214e38548552cac20bd3ae">level0_file_num_compaction_trigger</a>)) {</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Universal: nothing to do\n&quot;</span>);</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  }</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;  VersionSet::FileSummaryStorage tmp;</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Universal: candidate files(%lu): %s\n&quot;</span>,</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level].size(),</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#ae6adf63444a6a5f7dc4ad0bd751a0c13">LevelFileSummary</a>(&amp;tmp, 0));</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  <span class="comment">// Check for size amplification first.</span></div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a>* c = <a class="code" href="../../d1/d42/a01800.html#aa2aed822db8d2f7096ef3aa1773bb946">PickCompactionUniversalSizeAmp</a>(level, <a class="code" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527">score</a>);</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  <span class="keywordflow">if</span> (c == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;    <span class="comment">// Size amplification is within limits. Try reducing read</span></div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    <span class="comment">// amplification while maintaining file size ratios.</span></div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ratio = <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a2b4cedd34a649927cb4232c9f05cd5aa">compaction_options_universal</a>.<a class="code" href="../../d9/d0d/a00298.html#afe1e4100c1ce559c539b020ec7b46361">size_ratio</a>;</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;    c = <a class="code" href="../../d1/d42/a01800.html#ab1dc555d20916566e713d4ec5a623160">PickCompactionUniversalReadAmp</a>(level, <a class="code" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527">score</a>, ratio, UINT_MAX);</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="comment">// Size amplification and file size ratios are within configured limits.</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;    <span class="comment">// If max read amplification is exceeding configured limits, then force</span></div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;    <span class="comment">// compaction without looking at filesize ratios and try to reduce</span></div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    <span class="comment">// the number of files to fewer than level0_file_num_compaction_trigger.</span></div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;    <span class="keywordflow">if</span> (c == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_files = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level].size() -</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;                               <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a61b4f31fe3214e38548552cac20bd3ae">level0_file_num_compaction_trigger</a>;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;      c = <a class="code" href="../../d1/d42/a01800.html#ab1dc555d20916566e713d4ec5a623160">PickCompactionUniversalReadAmp</a>(level, <a class="code" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527">score</a>, UINT_MAX, num_files);</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;    }</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;  }</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;  <span class="keywordflow">if</span> (c == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;  }</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;  assert(c-&gt;inputs_[0].size() &gt; 1);</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;  <span class="comment">// validate that all the chosen files are non overlapping in time</span></div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;  FileMetaData* newerfile __attribute__((unused)) = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; c-&gt;inputs_[0].size(); i++) {</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;    FileMetaData* <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> = c-&gt;inputs_[0][i];</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;    assert (f-&gt;smallest_seqno &lt;= f-&gt;largest_seqno);</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;    assert(newerfile == <span class="keyword">nullptr</span> ||</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;           newerfile-&gt;smallest_seqno &gt; f-&gt;largest_seqno);</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    newerfile = <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a>;</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;  }</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;  <span class="comment">// The files are sorted from newest first to oldest last.</span></div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;  std::vector&lt;int&gt;&amp; file_by_time = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a83064706e81e2fd23744f97d3ddfaa7c">files_by_size_</a>[level];</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;  <span class="comment">// Is the earliest file part of this compaction?</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;  <span class="keywordtype">int</span> last_index = file_by_time[file_by_time.size()-1];</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;  FileMetaData* last_file = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][last_index];</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;  <span class="keywordflow">if</span> (c-&gt;inputs_[0][c-&gt;inputs_[0].size()-1] == last_file) {</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    c-&gt;bottommost_level_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;  }</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;  <span class="comment">// update statistics</span></div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>-&gt;measureTime(<a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aea6829dcb3cddc2e45f298f9c4f53b67e6">NUM_FILES_IN_SINGLE_COMPACTION</a>,</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;                                      c-&gt;inputs_[0].size());</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;  }</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  c-&gt;input_version_ = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>;</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;  c-&gt;input_version_-&gt;<a class="code" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2">Ref</a>();</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;  <span class="comment">// mark all the files that are being compacted</span></div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;  c-&gt;MarkFilesBeingCompacted(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;  <span class="comment">// remember this currently undergoing compaction</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a6c4a4e38b597d39024dd2192adceb3b3">compactions_in_progress_</a>[level].insert(c);</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;  <span class="comment">// Record whether this compaction includes all sst files.</span></div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;  <span class="comment">// For now, it is only relevant in universal compaction mode.</span></div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;  c-&gt;is_full_compaction_ = (c-&gt;inputs_[0].size() == <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[0].size());</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;  <span class="keywordflow">return</span> c;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a809a5b39c87ab02b0e3a438609e2bdfb_cgraph.png" border="0" usemap="#d1/d42/a01800_a809a5b39c87ab02b0e3a438609e2bdfb_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a809a5b39c87ab02b0e3a438609e2bdfb_cgraph" id="d1/d42/a01800_a809a5b39c87ab02b0e3a438609e2bdfb_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#ae6adf63444a6a5f7dc4ad0bd751a0c13" title="rocksdb::VersionSet\l::LevelFileSummary" alt="" coords="285,146,424,193"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="551,405,647,435"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#ab1dc555d20916566e713d4ec5a623160" title="rocksdb::VersionSet\l::PickCompactionUniversalReadAmp" alt="" coords="236,215,473,262"/><area shape="rect" id="node25" href="../../d1/d42/a01800.html#aa2aed822db8d2f7096ef3aa1773bb946" title="rocksdb::VersionSet\l::PickCompactionUniversalSizeAmp" alt="" coords="237,285,472,331"/><area shape="rect" id="node31" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="280,405,429,435"/><area shape="rect" id="node9" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="557,112,640,141"/><area shape="rect" id="node11" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="556,5,641,35"/><area shape="rect" id="node14" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="523,59,675,88"/><area shape="rect" id="node16" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5" title="rocksdb::VersionSet\l::MaxFileSizeForLevel" alt="" coords="523,285,675,331"/><area shape="rect" id="node18" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="724,285,863,331"/><area shape="rect" id="node21" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="529,215,668,262"/><area shape="rect" id="node23" href="../../d0/dbf/a03363.html#a75c05654caed31bf91b09dbc14e681d1" title="beast::hash_metrics\l::detail::sqr" alt="" coords="724,215,863,262"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a809a5b39c87ab02b0e3a438609e2bdfb_icgraph.png" border="0" usemap="#d1/d42/a01800_a809a5b39c87ab02b0e3a438609e2bdfb_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a809a5b39c87ab02b0e3a438609e2bdfb_icgraph" id="d1/d42/a01800_a809a5b39c87ab02b0e3a438609e2bdfb_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="236,5,375,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab1dc555d20916566e713d4ec5a623160"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> * rocksdb::VersionSet::PickCompactionUniversalReadAmp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>score</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>ratio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>num_files</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02313">2313</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../de/d3b/a02610_source.html#l00027">rocksdb::FileMetaData::being_compacted</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00438">Compaction</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00579">rocksdb::Options::compaction_options_universal</a>, <a class="el" href="../../d2/d11/a02647_source.html#l00070">rocksdb::CompactionOptionsUniversal::compression_size_percent</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00024">rocksdb::FileMetaData::file_size</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00172">rocksdb::Version::files_by_size_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00619">rocksdb::Compaction::inputs_</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d5/dd8/a03083_source.html#l00035">ripple::max()</a>, <a class="el" href="../../d2/d11/a02647_source.html#l00041">rocksdb::CompactionOptionsUniversal::max_merge_width</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02107">MaxFileSizeForLevel()</a>, <a class="el" href="../../d5/dd8/a03083_source.html#l00031">ripple::min()</a>, <a class="el" href="../../d2/d11/a02647_source.html#l00038">rocksdb::CompactionOptionsUniversal::min_merge_width</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00023">rocksdb::FileMetaData::number</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, <a class="el" href="../../d5/d1b/a01971_source.html#l00116">beast::hash_metrics::detail::score()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00630">rocksdb::Compaction::score_</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l00031">rocksdb::TotalFileSize()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02443">PickCompactionUniversal()</a>.</p>
<div class="fragment"><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;                                                 {</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> min_merge_width =</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a2b4cedd34a649927cb4232c9f05cd5aa">compaction_options_universal</a>.<a class="code" href="../../d9/d0d/a00298.html#a2e0a22409db14dedca88773e9c47e778">min_merge_width</a>;</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_merge_width =</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a2b4cedd34a649927cb4232c9f05cd5aa">compaction_options_universal</a>.<a class="code" href="../../d9/d0d/a00298.html#af30ea01da6c70b626b955f6df59f33a1">max_merge_width</a>;</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;  <span class="comment">// The files are sorted from newest first to oldest last.</span></div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;  std::vector&lt;int&gt;&amp; file_by_time = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a83064706e81e2fd23744f97d3ddfaa7c">files_by_size_</a>[level];</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;  FileMetaData* <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;  <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;  <span class="keywordtype">int</span> start_index = 0;</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> candidate_count;</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;  assert(file_by_time.size() == <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level].size());</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_files_to_compact = <a class="code" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff">std::min</a>(max_merge_width,</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;                                       max_number_of_files_to_compact);</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;  min_merge_width = <a class="code" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785">std::max</a>(min_merge_width, 2U);</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;  <span class="comment">// Considers a candidate file only if it is smaller than the</span></div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;  <span class="comment">// total size accumulated so far.</span></div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> loop = 0; loop &lt; file_by_time.size(); loop++) {</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    candidate_count = 0;</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    <span class="comment">// Skip files that are already being compacted</span></div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    <span class="keywordflow">for</span> (f = <span class="keyword">nullptr</span>; loop &lt; file_by_time.size(); loop++) {</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;      <span class="keywordtype">int</span> index = file_by_time[loop];</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      f = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][index];</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;      <span class="keywordflow">if</span> (!f-&gt;being_compacted) {</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;        candidate_count = 1;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;      }</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;          <span class="stringliteral">&quot;Universal: file %lu[%d] being compacted, skipping&quot;</span>,</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;          (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;number, loop);</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;      f = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    }</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    <span class="comment">// This file is not being compacted. Consider it as the</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    <span class="comment">// first candidate to be compacted.</span></div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> candidate_size =  f != <span class="keyword">nullptr</span>? f-&gt;file_size : 0;</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    <span class="keywordflow">if</span> (f != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Universal: Possible candidate file %lu[%d].&quot;</span>,</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;          (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;number, loop);</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    }</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    <span class="comment">// Check if the suceeding files need compaction.</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = loop+1;</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;         candidate_count &lt; max_files_to_compact &amp;&amp; i &lt; file_by_time.size();</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;         i++) {</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;      <span class="keywordtype">int</span> index = file_by_time[i];</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;      FileMetaData* f = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][index];</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;      <span class="keywordflow">if</span> (f-&gt;being_compacted) {</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;      }</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;      <span class="comment">// pick files if the total candidate file size (increased by the</span></div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;      <span class="comment">// specified ratio) is still larger than the next candidate file.</span></div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;      <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> sz = (candidate_size * (100L + ratio)) /100;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;      <span class="keywordflow">if</span> (sz &lt; f-&gt;file_size) {</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      }</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      candidate_count++;</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;      candidate_size += f-&gt;file_size;</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;    }</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    <span class="comment">// Found a series of consecutive files that need compaction.</span></div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    <span class="keywordflow">if</span> (candidate_count &gt;= (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)min_merge_width) {</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;      start_index = loop;</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;      done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = loop;</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;           i &lt; loop + candidate_count &amp;&amp; i &lt; file_by_time.size(); i++) {</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;       <span class="keywordtype">int</span> index = file_by_time[i];</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;       FileMetaData* f = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][index];</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;       <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;           <span class="stringliteral">&quot;Universal: Skipping file %lu[%d] with size %lu %d\n&quot;</span>,</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;           (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;number,</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;           i,</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;           (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;file_size,</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;           f-&gt;being_compacted);</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;      }</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;    }</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;  }</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  <span class="keywordflow">if</span> (!done || candidate_count &lt;= 1) {</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;  }</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> first_index_after = start_index + candidate_count;</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;  <span class="comment">// Compression is enabled if files compacted earlier already reached</span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;  <span class="comment">// size ratio of compression.</span></div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;  <span class="keywordtype">bool</span> enable_compression = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;  <span class="keywordtype">int</span> ratio_to_compress =</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a2b4cedd34a649927cb4232c9f05cd5aa">compaction_options_universal</a>.<a class="code" href="../../d9/d0d/a00298.html#afcd15128bac78da1023eff339c63d015">compression_size_percent</a>;</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  <span class="keywordflow">if</span> (ratio_to_compress &gt;= 0) {</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> total_size = <a class="code" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e">TotalFileSize</a>(<a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level]);</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> older_file_size = 0;</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = file_by_time.size() - 1; i &gt;= first_index_after;</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;        i--) {</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      older_file_size += <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][file_by_time[i]]-&gt;file_size;</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      <span class="keywordflow">if</span> (older_file_size * 100L &gt;= total_size * (<span class="keywordtype">long</span>) ratio_to_compress) {</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;        enable_compression = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;      }</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;    }</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;  }</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a>* c = <span class="keyword">new</span> <a class="code" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a>(level, level, <a class="code" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5">MaxFileSizeForLevel</a>(level),</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                                 LLONG_MAX, <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(), <span class="keyword">false</span>,</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                                 enable_compression);</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;  c-&gt;score_ = <a class="code" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527">score</a>;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = start_index; i &lt; first_index_after; i++) {</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;    <span class="keywordtype">int</span> index = file_by_time[i];</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;    FileMetaData* f = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][index];</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;    c-&gt;inputs_[0].push_back(f);</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Universal: Picking file %lu[%d] with size %lu\n&quot;</span>,</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;number,</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;        i,</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;file_size);</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;  }</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;  <span class="keywordflow">return</span> c;</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ab1dc555d20916566e713d4ec5a623160_cgraph.png" border="0" usemap="#d1/d42/a01800_ab1dc555d20916566e713d4ec5a623160_cgraph" alt=""/></div>
<map name="d1/d42/a01800_ab1dc555d20916566e713d4ec5a623160_cgraph" id="d1/d42/a01800_ab1dc555d20916566e713d4ec5a623160_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="321,5,417,35"/><area shape="rect" id="node5" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="327,59,412,88"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5" title="rocksdb::VersionSet\l::MaxFileSizeForLevel" alt="" coords="293,111,445,158"/><area shape="rect" id="node9" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="495,142,633,189"/><area shape="rect" id="node11" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="328,232,411,261"/><area shape="rect" id="node14" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="300,285,439,331"/><area shape="rect" id="node18" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="293,355,445,384"/><area shape="rect" id="node16" href="../../d0/dbf/a03363.html#a75c05654caed31bf91b09dbc14e681d1" title="beast::hash_metrics\l::detail::sqr" alt="" coords="495,285,633,331"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ab1dc555d20916566e713d4ec5a623160_icgraph.png" border="0" usemap="#d1/d42/a01800_ab1dc555d20916566e713d4ec5a623160_icgraph" alt=""/></div>
<map name="d1/d42/a01800_ab1dc555d20916566e713d4ec5a623160_icgraph" id="d1/d42/a01800_ab1dc555d20916566e713d4ec5a623160_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a809a5b39c87ab02b0e3a438609e2bdfb" title="rocksdb::VersionSet\l::PickCompactionUniversal" alt="" coords="293,5,475,51"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="524,5,663,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa2aed822db8d2f7096ef3aa1773bb946"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> * rocksdb::VersionSet::PickCompactionUniversalSizeAmp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>score</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02209">2209</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../de/d3b/a02610_source.html#l00027">rocksdb::FileMetaData::being_compacted</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00438">Compaction</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00579">rocksdb::Options::compaction_options_universal</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00024">rocksdb::FileMetaData::file_size</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00172">rocksdb::Version::files_by_size_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02107">MaxFileSizeForLevel()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00023">rocksdb::FileMetaData::number</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, and <a class="el" href="../../d5/d1b/a01971_source.html#l00116">beast::hash_metrics::detail::score()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02443">PickCompactionUniversal()</a>.</p>
<div class="fragment"><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                             {</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;  assert (level == 0);</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;  <span class="comment">// percentage flexibilty while reducing size amplification</span></div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> ratio = <a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a2b4cedd34a649927cb4232c9f05cd5aa">compaction_options_universal</a>.</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                     max_size_amplification_percent;</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;  <span class="comment">// The files are sorted from newest first to oldest last.</span></div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;  std::vector&lt;int&gt;&amp; file_by_time = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a83064706e81e2fd23744f97d3ddfaa7c">files_by_size_</a>[level];</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;  assert(file_by_time.size() == <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level].size());</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> candidate_count = 0;</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> candidate_size = 0;</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> start_index = 0;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;  FileMetaData* <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;  <span class="comment">// Skip files that are already being compacted</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> loop = 0; loop &lt; file_by_time.size() - 1; loop++) {</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    <span class="keywordtype">int</span> index = file_by_time[loop];</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    f = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][index];</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;    <span class="keywordflow">if</span> (!f-&gt;being_compacted) {</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;      start_index = loop;         <span class="comment">// Consider this as the first candidate.</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;    }</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Universal: skipping file %lu[%d] compacted %s&quot;</span>,</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;number,</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;        loop,</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;        <span class="stringliteral">&quot; cannot be a candidate to reduce size amp.\n&quot;</span>);</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    f = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;  }</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  <span class="keywordflow">if</span> (f == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;             <span class="comment">// no candidate files</span></div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;  }</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Universal: First candidate file %lu[%d] %s&quot;</span>,</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;      (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;number,</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;      start_index,</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;      <span class="stringliteral">&quot; to reduce size amp.\n&quot;</span>);</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  <span class="comment">// keep adding up all the remaining files</span></div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> loop = start_index; loop &lt; file_by_time.size() - 1;</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;       loop++) {</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    <span class="keywordtype">int</span> index = file_by_time[loop];</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    f = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][index];</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    <span class="keywordflow">if</span> (f-&gt;being_compacted) {</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;          <span class="stringliteral">&quot;Universal: Possible candidate file %lu[%d] %s.&quot;</span>,</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;          (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;number,</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;          loop,</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;          <span class="stringliteral">&quot; is already being compacted. No size amp reduction possible.\n&quot;</span>);</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    }</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    candidate_size += f-&gt;file_size;</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;    candidate_count++;</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;  }</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;  <span class="keywordflow">if</span> (candidate_count == 0) {</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  }</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;  <span class="comment">// size of earliest file</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;  <span class="keywordtype">int</span> index = file_by_time[file_by_time.size() - 1];</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> earliest_file_size = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][index]-&gt;file_size;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;  <span class="comment">// size amplification = percentage of additional size</span></div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;  <span class="keywordflow">if</span> (candidate_size * 100 &lt; ratio * earliest_file_size) {</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        <span class="stringliteral">&quot;Universal: size amp not needed. newer-files-total-size %lu &quot;</span></div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        <span class="stringliteral">&quot;earliest-file-size %lu&quot;</span>,</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)candidate_size,</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)earliest_file_size);</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        <span class="stringliteral">&quot;Universal: size amp needed. newer-files-total-size %lu &quot;</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;        <span class="stringliteral">&quot;earliest-file-size %lu&quot;</span>,</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)candidate_size,</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)earliest_file_size);</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;  }</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;  assert(start_index &gt;= 0 &amp;&amp; start_index &lt; file_by_time.size() - 1);</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;  <span class="comment">// create a compaction request</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;  <span class="comment">// We always compact all the files, so always compress.</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a>* c = <span class="keyword">new</span> <a class="code" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a>(level, level, <a class="code" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5">MaxFileSizeForLevel</a>(level),</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;                                 LLONG_MAX, <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(), <span class="keyword">false</span>,</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;                                 <span class="keyword">true</span>);</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;  c-&gt;score_ = <a class="code" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527">score</a>;</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> loop = start_index; loop &lt; file_by_time.size(); loop++) {</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    <span class="keywordtype">int</span> index = file_by_time[loop];</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;    f = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][index];</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    c-&gt;inputs_[0].push_back(f);</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;        <span class="stringliteral">&quot;Universal: size amp picking file %lu[%d] with size %lu&quot;</span>,</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;number,</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;        index,</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)f-&gt;file_size);</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;  }</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;  <span class="keywordflow">return</span> c;</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_aa2aed822db8d2f7096ef3aa1773bb946_cgraph.png" border="0" usemap="#d1/d42/a01800_aa2aed822db8d2f7096ef3aa1773bb946_cgraph" alt=""/></div>
<map name="d1/d42/a01800_aa2aed822db8d2f7096ef3aa1773bb946_cgraph" id="d1/d42/a01800_aa2aed822db8d2f7096ef3aa1773bb946_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="316,5,412,35"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5" title="rocksdb::VersionSet\l::MaxFileSizeForLevel" alt="" coords="288,58,440,105"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="489,83,628,130"/><area shape="rect" id="node10" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="295,178,433,225"/><area shape="rect" id="node12" href="../../d0/dbf/a03363.html#a75c05654caed31bf91b09dbc14e681d1" title="beast::hash_metrics\l::detail::sqr" alt="" coords="489,178,628,225"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_aa2aed822db8d2f7096ef3aa1773bb946_icgraph.png" border="0" usemap="#d1/d42/a01800_aa2aed822db8d2f7096ef3aa1773bb946_icgraph" alt=""/></div>
<map name="d1/d42/a01800_aa2aed822db8d2f7096ef3aa1773bb946_icgraph" id="d1/d42/a01800_aa2aed822db8d2f7096ef3aa1773bb946_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a809a5b39c87ab02b0e3a438609e2bdfb" title="rocksdb::VersionSet\l::PickCompactionUniversal" alt="" coords="288,5,469,51"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="519,5,657,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9fd748ec8ea9e958a86f194171482773"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::PrevLogNumber </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00290">290</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00480">prev_log_number_</a>.</p>
<div class="fragment"><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="../../d1/d42/a01800.html#a7fb8190a6ca751167dc288649b8849c3">prev_log_number_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acf04defe0d794e6933785aad628ab9b6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::VersionSet::Recover </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01400">1400</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d6/dfc/a02612_source.html#l01193">AppendVersion()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01033">rocksdb::VersionSet::Builder::Apply()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00112">rocksdb::VersionEdit::comparator_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00042">rocksdb::Status::Corruption()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00250">current()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00503">current_version_number_</a>, <a class="el" href="../../da/d03/a02577_source.html#l00086">rocksdb::CurrentFileName()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00472">dbname_</a>, <a class="el" href="../../df/d40/a02609_source.html#l00122">rocksdb::VersionEdit::DecodeFrom()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00471">env_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01674">Finalize()</a>, <a class="el" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d">rocksdb::Env::GetFileSize()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00117">rocksdb::VersionEdit::has_comparator_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00121">rocksdb::VersionEdit::has_last_sequence_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00118">rocksdb::VersionEdit::has_log_number_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00120">rocksdb::VersionEdit::has_next_file_number_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00119">rocksdb::VersionEdit::has_prev_log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00475">icmp_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00048">rocksdb::Status::InvalidArgument()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00116">rocksdb::VersionEdit::last_sequence_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00478">last_sequence_</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00113">rocksdb::VersionEdit::log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00479">log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00477">manifest_file_number_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01668">MarkFileNumberUsed()</a>, <a class="el" href="../../d0/d61/a00302.html#a3ef0d8f8f4fe04540c00cd4a9c9d5e84">rocksdb::Comparator::Name()</a>, <a class="el" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3">rocksdb::Env::NewSequentialFile()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00115">rocksdb::VersionEdit::next_file_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00476">next_file_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00200">rocksdb::Version::offset_manifest_file_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00114">rocksdb::VersionEdit::prev_log_number_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00480">prev_log_number_</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00092">rocksdb::ReadFileToString()</a>, <a class="el" href="../../d6/dae/a02581_source.html#l00064">rocksdb::log::Reader::ReadRecord()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01082">rocksdb::VersionSet::Builder::SaveTo()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02185">SizeBeingCompacted()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00515">storage_options_</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00107">rocksdb::InternalKeyComparator::user_comparator()</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00441">Version</a>.</p>

<p>Referenced by <a class="el" href="../../d9/de7/a02572_source.html#l04863">rocksdb::BM_LogAndApply()</a>, <a class="el" href="../../d6/d0b/a02741_source.html#l01036">rocksdb::ReduceDBLevelsCommand::DoCommand()</a>, and <a class="el" href="../../d6/d0b/a02741_source.html#l01012">rocksdb::ReduceDBLevelsCommand::GetOldNumOfLevels()</a>.</p>
<div class="fragment"><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;                           {</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="keyword">struct </span>LogReporter : <span class="keyword">public</span> log::Reader::Reporter {</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a>* status;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> Corruption(<span class="keywordtype">size_t</span> bytes, <span class="keyword">const</span> <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a>&amp; s) {</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      <span class="keywordflow">if</span> (this-&gt;status-&gt;ok()) *this-&gt;status = s;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    }</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  };</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  <span class="comment">// Read &quot;CURRENT&quot; file, which contains a pointer to the current manifest file</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  std::string <a class="code" href="../../d1/d42/a01800.html#ae52f5390be942a7fc5b906074a33805b">current</a>;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../d4/d87/a03436.html#a3eae53c8ac4efe43228cf64d7aafed37">ReadFileToString</a>(<a class="code" href="../../d1/d42/a01800.html#ae22040b4a38e203468c16912223420de">env_</a>, <a class="code" href="../../d4/d87/a03436.html#a112e8c44dec6475699006a7f68830b1a">CurrentFileName</a>(<a class="code" href="../../d1/d42/a01800.html#a46b2347fce13fe13dff6c57867a64d37">dbname_</a>), &amp;current);</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  }</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  <span class="keywordflow">if</span> (current.empty() || current[current.size()-1] != <span class="charliteral">&#39;\n&#39;</span>) {</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d">Status::Corruption</a>(<span class="stringliteral">&quot;CURRENT file does not end with newline&quot;</span>);</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  }</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  current.resize(current.size() - 1);</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Recovering from manifest file:%s\n&quot;</span>,</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;      current.c_str());</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  std::string dscname = <a class="code" href="../../d1/d42/a01800.html#a46b2347fce13fe13dff6c57867a64d37">dbname_</a> + <span class="stringliteral">&quot;/&quot;</span> + <a class="code" href="../../d1/d42/a01800.html#ae52f5390be942a7fc5b906074a33805b">current</a>;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  unique_ptr&lt;SequentialFile&gt; file;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  s = <a class="code" href="../../d1/d42/a01800.html#ae22040b4a38e203468c16912223420de">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3">NewSequentialFile</a>(dscname, &amp;file, <a class="code" href="../../d1/d42/a01800.html#aa455bb240de0e461dbab37045dcc3e1c">storage_options_</a>);</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  }</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> manifest_file_size;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  s = <a class="code" href="../../d1/d42/a01800.html#ae22040b4a38e203468c16912223420de">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d">GetFileSize</a>(dscname, &amp;manifest_file_size);</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  }</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  <span class="keywordtype">bool</span> have_log_number = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <span class="keywordtype">bool</span> have_prev_log_number = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  <span class="keywordtype">bool</span> have_next_file = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  <span class="keywordtype">bool</span> have_last_sequence = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> next_file = 0;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> last_sequence = 0;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> log_number = 0;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> prev_log_number = 0;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  Builder builder(<span class="keyword">this</span>, <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>);</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    LogReporter reporter;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    reporter.status = &amp;s;</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    log::Reader reader(std::move(file), &amp;reporter, <span class="keyword">true</span><span class="comment">/*checksum*/</span>,</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                       0<span class="comment">/*initial_offset*/</span>);</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    Slice record;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    std::string scratch;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="keywordflow">while</span> (reader.ReadRecord(&amp;record, &amp;scratch) &amp;&amp; s.ok()) {</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      VersionEdit edit(<a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>());</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      s = edit.DecodeFrom(record);</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        <span class="keywordflow">if</span> (edit.has_comparator_ &amp;&amp;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;            edit.comparator_ != <a class="code" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a>.<a class="code" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a">user_comparator</a>()-&gt;<a class="code" href="../../d0/d61/a00302.html#a3ef0d8f8f4fe04540c00cd4a9c9d5e84">Name</a>()) {</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;          s = <a class="code" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba">Status::InvalidArgument</a>(<a class="code" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a>.<a class="code" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a">user_comparator</a>()-&gt;<a class="code" href="../../d0/d61/a00302.html#a3ef0d8f8f4fe04540c00cd4a9c9d5e84">Name</a>(),</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                                      <span class="stringliteral">&quot;does not match existing comparator &quot;</span> +</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                                      edit.comparator_);</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        }</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      }</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        builder.Apply(&amp;edit);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      }</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="keywordflow">if</span> (edit.has_log_number_) {</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        log_number = edit.log_number_;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        have_log_number = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      }</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      <span class="keywordflow">if</span> (edit.has_prev_log_number_) {</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        prev_log_number = edit.prev_log_number_;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        have_prev_log_number = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      }</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <span class="keywordflow">if</span> (edit.has_next_file_number_) {</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        next_file = edit.next_file_number_;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        have_next_file = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      }</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="keywordflow">if</span> (edit.has_last_sequence_) {</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        last_sequence = edit.last_sequence_;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        have_last_sequence = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      }</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    }</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;  }</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  file.reset();</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordflow">if</span> (!have_next_file) {</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      s = <a class="code" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d">Status::Corruption</a>(<span class="stringliteral">&quot;no meta-nextfile entry in descriptor&quot;</span>);</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!have_log_number) {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;      s = <a class="code" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d">Status::Corruption</a>(<span class="stringliteral">&quot;no meta-lognumber entry in descriptor&quot;</span>);</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!have_last_sequence) {</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      s = <a class="code" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d">Status::Corruption</a>(<span class="stringliteral">&quot;no last-sequence-number entry in descriptor&quot;</span>);</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    }</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">if</span> (!have_prev_log_number) {</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;      prev_log_number = 0;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    }</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a5e1d11c285967cb347b090f67e5b34dd">MarkFileNumberUsed</a>(prev_log_number);</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a5e1d11c285967cb347b090f67e5b34dd">MarkFileNumberUsed</a>(log_number);</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  }</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#ace162f32d4abb584945d3a55a389b0a3">Version</a>* v = <span class="keyword">new</span> <a class="code" href="../../d1/d42/a01800.html#ace162f32d4abb584945d3a55a389b0a3">Version</a>(<span class="keyword">this</span>, <a class="code" href="../../d1/d42/a01800.html#a33937b18365def065cbb16d930d47c81">current_version_number_</a>++);</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    builder.SaveTo(v);</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <span class="comment">// Install recovered version</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    std::vector&lt;uint64_t&gt; size_being_compacted(<a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>()-1);</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#ac723248f990dd0f5de3eca23b292a501">SizeBeingCompacted</a>(size_being_compacted);</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3">Finalize</a>(v, size_being_compacted);</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    v-&gt;offset_manifest_file_ = manifest_file_size;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#aa5b2b44d11b6085ed5deeb7a562d30a7">AppendVersion</a>(v);</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a> = next_file;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a> = next_file + 1;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#ac9813d4953bf5d62a1bbd8f94ede1a15">last_sequence_</a> = last_sequence;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a8efe3b4907507a75117c3148fe888f9e">log_number_</a> = log_number;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#a7fb8190a6ca751167dc288649b8849c3">prev_log_number_</a> = prev_log_number;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Recovered from manifest file:%s succeeded,&quot;</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        <span class="stringliteral">&quot;manifest_file_number is %lu, next_file_number is %lu, &quot;</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        <span class="stringliteral">&quot;last_sequence is %lu, log_number is %lu,&quot;</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <span class="stringliteral">&quot;prev_log_number is %lu\n&quot;</span>,</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        current.c_str(),</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        (<span class="keywordtype">unsigned</span> long)<a class="code" href="../../d1/d42/a01800.html#ab02f581e1b243a5d4e421a85ecc36f76">manifest_file_number_</a>,</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a>,</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        (<span class="keywordtype">unsigned</span> long)<a class="code" href="../../d1/d42/a01800.html#ac9813d4953bf5d62a1bbd8f94ede1a15">last_sequence_</a>,</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="../../d1/d42/a01800.html#a8efe3b4907507a75117c3148fe888f9e">log_number_</a>,</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        (<span class="keywordtype">unsigned</span> long)<a class="code" href="../../d1/d42/a01800.html#a7fb8190a6ca751167dc288649b8849c3">prev_log_number_</a>);</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  }</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_acf04defe0d794e6933785aad628ab9b6_cgraph.png" border="0" usemap="#d1/d42/a01800_acf04defe0d794e6933785aad628ab9b6_cgraph" alt=""/></div>
<map name="d1/d42/a01800_acf04defe0d794e6933785aad628ab9b6_cgraph" id="d1/d42/a01800_acf04defe0d794e6933785aad628ab9b6_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#aa5b2b44d11b6085ed5deeb7a562d30a7" title="rocksdb::VersionSet\l::AppendVersion" alt="" coords="231,50,369,97"/><area shape="rect" id="node9" href="../../d0/d27/a00239.html#a2ebf4c9e22b9adce7919b255dcb80393" title="rocksdb::VersionSet\l::Builder::Apply" alt="" coords="231,199,369,246"/><area shape="rect" id="node13" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="753,407,892,454"/><area shape="rect" id="node25" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="977,2077,1159,2107"/><area shape="rect" id="node29" href="../../d1/d42/a01800.html#ae52f5390be942a7fc5b906074a33805b" title="rocksdb::VersionSet\l::current" alt="" coords="231,1942,369,1989"/><area shape="rect" id="node31" href="../../d4/d87/a03436.html#a112e8c44dec6475699006a7f68830b1a" title="rocksdb::CurrentFileName" alt="" coords="213,2012,387,2041"/><area shape="rect" id="node33" href="../../d2/d86/a01798.html#aa96a614beb016ddb66fa3fd0b2cc8a3f" title="rocksdb::VersionEdit\l::DecodeFrom" alt="" coords="229,1771,371,1818"/><area shape="rect" id="node58" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3" title="rocksdb::VersionSet\l::Finalize" alt="" coords="231,551,369,598"/><area shape="rect" id="node68" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d" title="rocksdb::Env::GetFileSize" alt="" coords="213,2065,387,2095"/><area shape="rect" id="node70" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba" title="rocksdb::Status::Invalid\lArgument" alt="" coords="988,2139,1148,2186"/><area shape="rect" id="node73" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="252,2119,348,2148"/><area shape="rect" id="node75" href="../../d1/d42/a01800.html#a5e1d11c285967cb347b090f67e5b34dd" title="rocksdb::VersionSet\l::MarkFileNumberUsed" alt="" coords="221,2171,379,2218"/><area shape="rect" id="node77" href="../../d0/d61/a00302.html#a3ef0d8f8f4fe04540c00cd4a9c9d5e84" title="rocksdb::Comparator\l::Name" alt="" coords="228,2241,372,2287"/><area shape="rect" id="node79" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="453,941,669,971"/><area shape="rect" id="node82" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="755,1389,891,1419"/><area shape="rect" id="node84" href="../../d4/d87/a03436.html#a3eae53c8ac4efe43228cf64d7aafed37" title="rocksdb::ReadFileToString" alt="" coords="212,1164,388,1193"/><area shape="rect" id="node93" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="229,1386,371,1433"/><area shape="rect" id="node112" href="../../d0/d27/a00239.html#a61a3b1cccd9c3d386297a9cf999781d6" title="rocksdb::VersionSet\l::Builder::SaveTo" alt="" coords="231,294,369,341"/><area shape="rect" id="node119" href="../../d1/d42/a01800.html#ac723248f990dd0f5de3eca23b292a501" title="rocksdb::VersionSet\l::SizeBeingCompacted" alt="" coords="223,802,377,849"/><area shape="rect" id="node128" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="195,2310,405,2357"/><area shape="rect" id="node5" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="487,5,636,35"/><area shape="rect" id="node7" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="481,59,641,88"/><area shape="rect" id="node11" href="../../d0/d27/a00239.html#a70c9fbc2ead82d8e2e4722161341eb49" title="rocksdb::VersionSet\l::Builder::CheckConsistency" alt="" coords="467,199,656,246"/><area shape="rect" id="node23" href="../../d0/d27/a00239.html#aa80eab37c10d6aecd296315cd0e210de" title="rocksdb::VersionSet\l::Builder::CheckConsistency\lForDeletes" alt="" coords="467,112,656,176"/><area shape="rect" id="node15" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="717,314,928,361"/><area shape="rect" id="node21" href="../../de/de6/a00723.html#a1f29087f48fd168fe431e4b884f5aed1" title="rocksdb::InternalKey\l::DebugString" alt="" coords="752,199,893,246"/><area shape="rect" id="node17" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="999,1193,1137,1223"/><area shape="rect" id="node19" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1000,1419,1136,1448"/><area shape="rect" id="node27" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1208,2113,1368,2143"/><area shape="rect" id="node35" href="../../d2/d86/a01798.html#a9a7a27d2f256bfadb0b538c97c5524a1" title="rocksdb::VersionEdit\l::Clear" alt="" coords="491,1885,632,1931"/><area shape="rect" id="node38" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="487,1608,636,1637"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#a030ed538894432d224c6b2646fdde92e" title="rocksdb::GetInternalKey" alt="" coords="480,2005,643,2035"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#adeae0144b8eaea4c370172d4f6edaf48" title="rocksdb::GetLengthPrefixed\lSlice" alt="" coords="731,1966,915,2013"/><area shape="rect" id="node45" href="../../d2/d86/a01798.html#a734cb8f3cec65c72f32045b3449a6708" title="rocksdb::VersionEdit\l::GetLevel" alt="" coords="491,1711,632,1758"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#ad2427e2124d28ef6468f035303fcb22d" title="rocksdb::GetVarint32" alt="" coords="751,1627,895,1656"/><area shape="rect" id="node52" href="../../d4/d87/a03436.html#abef3500551ebbb64ab50e4abde1ab3b9" title="rocksdb::GetVarint64" alt="" coords="751,1680,895,1709"/><area shape="rect" id="node56" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="480,1832,643,1861"/><area shape="rect" id="node60" href="../../d1/d42/a01800.html#a1639228385c42402a661292f6a27a818" title="rocksdb::VersionSet\l::MaxBytesForLevel" alt="" coords="492,613,631,659"/><area shape="rect" id="node64" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="492,490,631,537"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="485,560,637,589"/><area shape="rect" id="node90" href="../../d3/da4/a01343.html#a73ad8155e9996d5430081aaac7eb0d00" title="rocksdb::SequentialFile\l::Read" alt="" coords="483,1045,640,1091"/><area shape="rect" id="node95" href="../../d5/d54/a01213.html#acb5bb46275c505b8eab7bceac8affd36" title="rocksdb::log::Reader\l::SkipToInitialBlock" alt="" coords="491,1386,632,1433"/><area shape="rect" id="node98" href="../../de/daf/a01417.html#a8f740f146e792dc89409f8402a61ad04" title="rocksdb::Slice::clear" alt="" coords="752,1219,893,1248"/><area shape="rect" id="node101" href="../../d5/d54/a01213.html#a57eb93a86418bd4a2b32ee163aecea5d" title="rocksdb::log::Reader\l::ReadPhysicalRecord" alt="" coords="485,1266,637,1313"/><area shape="rect" id="node106" href="../../d5/d54/a01213.html#a7db406791cb13477c816733858ea1e51" title="rocksdb::log::Reader\l::ReportCorruption" alt="" coords="752,1557,893,1603"/><area shape="rect" id="node116" href="../../d0/d27/a00239.html#a39f8d86429df9529e2d5e8dd2c6bc14f" title="rocksdb::VersionSet\l::Builder::MaybeAddFile" alt="" coords="481,269,641,315"/><area shape="rect" id="node122" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="488,802,635,849"/><area shape="rect" id="node124" href="../../d9/d5e/a00295.html#ae0e14955026684df1c7e261dc31fcb70" title="rocksdb::Compaction\l::num_input_files" alt="" coords="488,733,635,779"/><area shape="rect" id="node126" href="../../d9/d5e/a00295.html#a31e5be150c385f6df320ee7f7daf7a9a" title="rocksdb::Compaction\l::input" alt="" coords="488,871,635,918"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_acf04defe0d794e6933785aad628ab9b6_icgraph.png" border="0" usemap="#d1/d42/a01800_acf04defe0d794e6933785aad628ab9b6_icgraph" alt=""/></div>
<map name="d1/d42/a01800_acf04defe0d794e6933785aad628ab9b6_icgraph" id="d1/d42/a01800_acf04defe0d794e6933785aad628ab9b6_icgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="225,5,404,35"/><area shape="rect" id="node7" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="484,83,721,130"/><area shape="rect" id="node9" href="../../d0/d58/a01230.html#a769cf9f08028648f2cb824dbbf695de7" title="rocksdb::ReduceDBLevelsCommand\l::GetOldNumOfLevels" alt="" coords="196,109,433,155"/><area shape="rect" id="node5" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="577,5,628,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a788a71e004c7a132a2fea2a82eedccd6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::VersionSet::ReduceNumberOfLevels </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>new_levels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/a00998.html">port::Mutex</a> *&#160;</td>
          <td class="paramname"><em>mu</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/dd5/a02614_source.html#l00020">20</a> of file <a class="el" href="../../dc/dd5/a02614_source.html">version_set_reduce_num_levels.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00491">compact_pointer_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01173">Init()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00048">rocksdb::Status::InvalidArgument()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00497">level_max_bytes_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00494">max_file_size_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00482">num_levels_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01850">NumLevelFiles()</a>, and <a class="el" href="../../d5/d96/a02642_source.html#l00036">rocksdb::Status::OK()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/d0b/a02741_source.html#l01036">rocksdb::ReduceDBLevelsCommand::DoCommand()</a>.</p>
<div class="fragment"><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                                                                     {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <span class="keywordflow">if</span>(new_levels &lt;= 1) {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba">Status::InvalidArgument</a>(</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        <span class="stringliteral">&quot;Number of levels needs to be bigger than 1&quot;</span>);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  }</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#ace162f32d4abb584945d3a55a389b0a3">Version</a>* current_version = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordtype">int</span> current_levels = <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>();</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordflow">if</span> (current_levels &lt;= new_levels) {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00">Status::OK</a>();</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  }</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="comment">// Make sure there are file only on one level from</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="comment">// (new_levels-1) to (current_levels-1)</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordtype">int</span> first_nonempty_level = -1;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordtype">int</span> first_nonempty_level_filenum = 0;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = new_levels - 1; i &lt; current_levels; i++) {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordtype">int</span> file_num = <a class="code" href="../../d1/d42/a01800.html#a46a07e37f062ed0919878d92fb69a090">NumLevelFiles</a>(i);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">if</span> (file_num != 0) {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      <span class="keywordflow">if</span> (first_nonempty_level &lt; 0) {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        first_nonempty_level = i;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        first_nonempty_level_filenum = file_num;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordtype">char</span> msg[255];</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        sprintf(msg, <span class="stringliteral">&quot;Found at least two levels containing files: &quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;            <span class="stringliteral">&quot;[%d:%d],[%d:%d].\n&quot;</span>,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            first_nonempty_level, first_nonempty_level_filenum, i, file_num);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba">Status::InvalidArgument</a>(msg);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    }</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  }</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> st;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  std::vector&lt;FileMetaData*&gt;*  old_files_list = current_version-&gt;files_;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  std::vector&lt;FileMetaData*&gt;* new_files_list =</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="keyword">new</span> std::vector&lt;FileMetaData*&gt;[new_levels];</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; new_levels - 1; i++) {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    new_files_list[i] = old_files_list[i];</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordflow">if</span> (first_nonempty_level &gt; 0) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    new_files_list[new_levels - 1] = old_files_list[first_nonempty_level];</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keyword">delete</span>[] current_version-&gt;files_;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  current_version-&gt;files_ = new_files_list;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keyword">delete</span>[] <a class="code" href="../../d1/d42/a01800.html#a73592373481ef75a5aa62e5c51c398c7">compact_pointer_</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keyword">delete</span>[] <a class="code" href="../../d1/d42/a01800.html#a118a633a8d1ff038ab5506ad9044d086">max_file_size_</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keyword">delete</span>[] <a class="code" href="../../d1/d42/a01800.html#a8e79f8d904167a1092d337c82093a629">level_max_bytes_</a>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a707d774d0f01630acd6caaf633514324">num_levels_</a> = new_levels;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a73592373481ef75a5aa62e5c51c398c7">compact_pointer_</a> = <span class="keyword">new</span> std::string[new_levels];</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#add78f5ab4cff29b479bed39a64406732">Init</a>(new_levels);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  VersionEdit ve(new_levels);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  st = <a class="code" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50">LogAndApply</a>(&amp;ve , <a class="code" href="../../db/d44/a02564.html#a900dad9ea326bf70a183d88a8ab50a13">mu</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordflow">return</span> st;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a788a71e004c7a132a2fea2a82eedccd6_cgraph.png" border="0" usemap="#d1/d42/a01800_a788a71e004c7a132a2fea2a82eedccd6_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a788a71e004c7a132a2fea2a82eedccd6_cgraph" id="d1/d42/a01800_a788a71e004c7a132a2fea2a82eedccd6_cgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#add78f5ab4cff29b479bed39a64406732" title="rocksdb::VersionSet\l::Init" alt="" coords="237,5,376,51"/><area shape="rect" id="node5" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba" title="rocksdb::Status::Invalid\lArgument" alt="" coords="227,143,387,190"/><area shape="rect" id="node9" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="237,1026,376,1073"/><area shape="rect" id="node27" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="1188,1522,1327,1569"/><area shape="rect" id="node77" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="465,211,607,240"/><area shape="rect" id="node121" href="../../d1/d42/a01800.html#a46a07e37f062ed0919878d92fb69a090" title="rocksdb::VersionSet\l::NumLevelFiles" alt="" coords="237,74,376,121"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="713,175,873,204"/><area shape="rect" id="node11" href="../../d1/d42/a01800.html#aa5b2b44d11b6085ed5deeb7a562d30a7" title="rocksdb::VersionSet\l::AppendVersion" alt="" coords="467,1234,605,1281"/><area shape="rect" id="node17" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="723,1194,864,1241"/><area shape="rect" id="node19" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="711,416,876,445"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#addb687ba13b100fdc18a512b23ba195b" title="rocksdb::DescriptorFileName" alt="" coords="697,699,889,728"/><area shape="rect" id="node23" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3" title="rocksdb::VersionSet\l::Finalize" alt="" coords="724,1862,863,1909"/><area shape="rect" id="node34" href="../../d4/dd1/a01797.html#aeb022110f00e15d30e0600d5252e0392" title="rocksdb::Version::GetVersion\lNumber" alt="" coords="440,957,632,1003"/><area shape="rect" id="node36" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="465,1165,607,1211"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="745,805,841,835"/><area shape="rect" id="node42" href="../../d1/d42/a01800.html#abfc3ec9be932533630087e672fce75b3" title="rocksdb::VersionSet\l::LogAndApplyHelper" alt="" coords="464,1477,608,1523"/><area shape="rect" id="node54" href="../../d2/d86/a01798.html#a5eca07307a1eb4123a2b4d3370495d02" title="rocksdb::VersionEdit\l::SetNextFile" alt="" coords="723,1541,864,1587"/><area shape="rect" id="node58" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="472,1304,600,1333"/><area shape="rect" id="node60" href="../../d1/d42/a01800.html#af55acbe3f8a2077614c6d8374eb24c04" title="rocksdb::VersionSet\l::ManifestContains" alt="" coords="467,767,605,814"/><area shape="rect" id="node66" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="725,752,861,781"/><area shape="rect" id="node70" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="708,981,879,1011"/><area shape="rect" id="node72" href="../../d1/d42/a01800.html#a1a39a05ce05a65f4ccaabf59d18c0162" title="rocksdb::VersionSet\l::NewFileNumber" alt="" coords="467,1407,605,1454"/><area shape="rect" id="node74" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="435,1763,637,1792"/><area shape="rect" id="node81" href="../../d0/d27/a00239.html#a61a3b1cccd9c3d386297a9cf999781d6" title="rocksdb::VersionSet\l::Builder::SaveTo" alt="" coords="724,1711,863,1758"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a387951cc646ab45c3ef918e66797e0d6" title="rocksdb::SetCurrentFile" alt="" coords="456,563,616,592"/><area shape="rect" id="node101" href="../../d0/d39/a00314.html#a84d028d8d526b7ce592433ba836a1853" title="rocksdb::port::CondVar\l::Signal" alt="" coords="457,1026,615,1073"/><area shape="rect" id="node104" href="../../d1/d42/a01800.html#ac723248f990dd0f5de3eca23b292a501" title="rocksdb::VersionSet\l::SizeBeingCompacted" alt="" coords="967,566,1121,613"/><area shape="rect" id="node108" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="465,1095,607,1142"/><area shape="rect" id="node111" href="../../d1/d42/a01800.html#a1161ffbcf7b18cde8bed5e361c7d3f0f" title="rocksdb::VersionSet\l::UpdateFilesBySize" alt="" coords="973,1139,1115,1186"/><area shape="rect" id="node114" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="457,887,615,934"/><area shape="rect" id="node117" href="../../d1/d42/a01800.html#ab1e1ece4fbaa4098f0e08154f773cb61" title="rocksdb::VersionSet\l::WriteSnapshot" alt="" coords="975,1491,1113,1538"/><area shape="rect" id="node13" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="719,1141,868,1171"/><area shape="rect" id="node15" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="713,1088,873,1117"/><area shape="rect" id="node25" href="../../d1/d42/a01800.html#a1639228385c42402a661292f6a27a818" title="rocksdb::VersionSet\l::MaxBytesForLevel" alt="" coords="975,1923,1113,1970"/><area shape="rect" id="node30" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="975,1801,1113,1847"/><area shape="rect" id="node32" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="968,1871,1120,1900"/><area shape="rect" id="node38" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="707,1035,880,1064"/><area shape="rect" id="node44" href="../../d0/d27/a00239.html#a2ebf4c9e22b9adce7919b255dcb80393" title="rocksdb::VersionSet\l::Builder::Apply" alt="" coords="724,1471,863,1518"/><area shape="rect" id="node50" href="../../d2/d86/a01798.html#a576049674a35517dc121fe6e1838b550" title="rocksdb::VersionEdit\l::SetLastSequence" alt="" coords="723,1402,864,1449"/><area shape="rect" id="node52" href="../../d2/d86/a01798.html#a8d557cf30bde88010eff4307cc3d385f" title="rocksdb::VersionEdit\l::SetLogNumber" alt="" coords="723,1263,864,1310"/><area shape="rect" id="node56" href="../../d2/d86/a01798.html#ab2a5ed0c015e8ccecf147de0bf2a6d12" title="rocksdb::VersionEdit\l::SetPrevLogNumber" alt="" coords="721,1333,865,1379"/><area shape="rect" id="node46" href="../../d0/d27/a00239.html#a70c9fbc2ead82d8e2e4722161341eb49" title="rocksdb::VersionSet\l::Builder::CheckConsistency" alt="" coords="949,1611,1139,1658"/><area shape="rect" id="node64" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="685,928,901,957"/><area shape="rect" id="node68" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="723,858,864,905"/><area shape="rect" id="node85" href="../../d0/d27/a00239.html#a39f8d86429df9529e2d5e8dd2c6bc14f" title="rocksdb::VersionSet\l::Builder::MaybeAddFile" alt="" coords="964,1681,1124,1727"/><area shape="rect" id="node89" href="../../d4/d87/a03436.html#a112e8c44dec6475699006a7f68830b1a" title="rocksdb::CurrentFileName" alt="" coords="707,645,880,675"/><area shape="rect" id="node94" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="716,469,871,515"/><area shape="rect" id="node96" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="705,539,881,568"/><area shape="rect" id="node98" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="705,592,881,621"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a788a71e004c7a132a2fea2a82eedccd6_icgraph.png" border="0" usemap="#d1/d42/a01800_a788a71e004c7a132a2fea2a82eedccd6_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a788a71e004c7a132a2fea2a82eedccd6_icgraph" id="d1/d42/a01800_a788a71e004c7a132a2fea2a82eedccd6_icgraph">
<area shape="rect" id="node3" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="228,5,465,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1fc1a928a1fe6381f942be6588ea697b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::ReleaseCompactionFiles </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td>
          <td class="paramname"><em>status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02175">2175</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00500">compactions_in_progress_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00547">rocksdb::Compaction::level()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03067">rocksdb::Compaction::MarkFilesBeingCompacted()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l03110">rocksdb::Compaction::ResetNextCompactionIndex()</a>.</p>
<div class="fragment"><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;                                                                    {</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;  c-&gt;MarkFilesBeingCompacted(<span class="keyword">false</span>);</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a6c4a4e38b597d39024dd2192adceb3b3">compactions_in_progress_</a>[c-&gt;level()].erase(c);</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;  <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    c-&gt;ResetNextCompactionIndex();</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;  }</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a1fc1a928a1fe6381f942be6588ea697b_cgraph.png" border="0" usemap="#d1/d42/a01800_a1fc1a928a1fe6381f942be6588ea697b_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a1fc1a928a1fe6381f942be6588ea697b_cgraph" id="d1/d42/a01800_a1fc1a928a1fe6381f942be6588ea697b_cgraph">
<area shape="rect" id="node3" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="253,5,400,51"/><area shape="rect" id="node5" href="../../d9/d5e/a00295.html#a11fbf1653e0ebe7db8c6e709de649557" title="rocksdb::Compaction\l::MarkFilesBeingCompacted" alt="" coords="233,74,420,121"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="259,144,395,173"/><area shape="rect" id="node9" href="../../d9/d5e/a00295.html#af67d7d2ac0a2a9b7908e23033b705575" title="rocksdb::Compaction\l::ResetNextCompactionIndex" alt="" coords="229,197,424,243"/><area shape="rect" id="node11" href="../../d4/dd1/a01797.html#a941d36dbc0c16a543c2f61fb25d61574" title="rocksdb::Version::ResetNext\lCompactionIndex" alt="" coords="473,197,663,243"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aea18ea584f40b5752beb02354969c8d8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::ReuseFileNumber </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td>
          <td class="paramname"><em>file_number</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00261">261</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00476">next_file_number_</a>.</p>
<div class="fragment"><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                                             {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a> == file_number + 1) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a3729aabcbf981b8262e9987d61429244">next_file_number_</a> = file_number;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac223fcd2a8723749b17ab7360828112d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::SetLastSequence </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td>
          <td class="paramname"><em>s</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00277">277</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00478">last_sequence_</a>.</p>
<div class="fragment"><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                   {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    assert(s &gt;= <a class="code" href="../../d1/d42/a01800.html#ac9813d4953bf5d62a1bbd8f94ede1a15">last_sequence_</a>);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#ac9813d4953bf5d62a1bbd8f94ede1a15">last_sequence_</a> = s;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae62effcc413a67f9941cfc18a5d3bd93"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::SetupOtherInputs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *&#160;</td>
          <td class="paramname"><em>c</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02774">2774</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00628">rocksdb::Compaction::base_index_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00491">compact_pointer_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d2/ddf/a02573_source.html#l00040">rocksdb::InternalKey::DebugString()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00612">rocksdb::Compaction::edit_</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00136">rocksdb::InternalKey::Encode()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02113">ExpandedCompactionByteSizeLimit()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02708">FilesInCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00646">rocksdb::Version::GetOverlappingInputs()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02029">GetRange()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02054">GetRange2()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00623">rocksdb::Compaction::grandparents_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00816">rocksdb::Version::HasOverlappingUserKey()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00619">rocksdb::Compaction::inputs_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00547">rocksdb::Compaction::level()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00629">rocksdb::Compaction::parent_index_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00065">rocksdb::VersionEdit::SetCompactPointer()</a>, <a class="el" href="../../dd/d75/a02639_source.html#l00072">rocksdb::Slice::ToString()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l00031">rocksdb::TotalFileSize()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02904">CompactRange()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;                                               {</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;  <span class="comment">// If inputs are empty, then there is nothing to expand.</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;  <span class="keywordflow">if</span> (c-&gt;inputs_[0].empty()) {</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  }</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> level = c-&gt;level();</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;  InternalKey smallest, largest;</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;  <span class="comment">// Get the range one last time.</span></div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588">GetRange</a>(c-&gt;inputs_[0], &amp;smallest, &amp;largest);</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;  <span class="comment">// Populate the set of next-level files (inputs_[1]) to include in compaction</span></div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060">GetOverlappingInputs</a>(level+1, &amp;smallest, &amp;largest, &amp;c-&gt;inputs_[1],</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;                                 c-&gt;parent_index_, &amp;c-&gt;parent_index_);</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;  <span class="comment">// Get entire range covered by compaction</span></div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;  InternalKey all_start, all_limit;</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a300d694d7eba66eb5bb129ddfea015fa">GetRange2</a>(c-&gt;inputs_[0], c-&gt;inputs_[1], &amp;all_start, &amp;all_limit);</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;  <span class="comment">// See if we can further grow the number of inputs in &quot;level&quot; without</span></div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;  <span class="comment">// changing the number of &quot;level+1&quot; files we pick up. We also choose NOT</span></div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;  <span class="comment">// to expand if this would cause &quot;level&quot; to include some entries for some</span></div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;  <span class="comment">// user key, while excluding other entries for the same user key. This</span></div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;  <span class="comment">// can happen when one user key spans multiple files.</span></div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;  <span class="keywordflow">if</span> (!c-&gt;inputs_[1].empty()) {</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;    std::vector&lt;FileMetaData*&gt; expanded0;</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060">GetOverlappingInputs</a>(level, &amp;all_start, &amp;all_limit, &amp;expanded0,</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;                                   c-&gt;base_index_, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> inputs0_size = <a class="code" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e">TotalFileSize</a>(c-&gt;inputs_[0]);</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> inputs1_size = <a class="code" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e">TotalFileSize</a>(c-&gt;inputs_[1]);</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> expanded0_size = <a class="code" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e">TotalFileSize</a>(expanded0);</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> limit = <a class="code" href="../../d1/d42/a01800.html#a31739d9b6c47d04ec18b7e717796c4ed">ExpandedCompactionByteSizeLimit</a>(level);</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    <span class="keywordflow">if</span> (expanded0.size() &gt; c-&gt;inputs_[0].size() &amp;&amp;</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;        inputs1_size + expanded0_size &lt; limit &amp;&amp;</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;        !<a class="code" href="../../d1/d42/a01800.html#a512e8e76628bdb9c867f6309d68fd412">FilesInCompaction</a>(expanded0) &amp;&amp;</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;        !<a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a8ba59d2bda530f588042dcbad00d3b9d">HasOverlappingUserKey</a>(&amp;expanded0, level)) {</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;      InternalKey new_start, new_limit;</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588">GetRange</a>(expanded0, &amp;new_start, &amp;new_limit);</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;      std::vector&lt;FileMetaData*&gt; expanded1;</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060">GetOverlappingInputs</a>(level+1, &amp;new_start, &amp;new_limit,</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                                     &amp;expanded1, c-&gt;parent_index_,</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;                                     &amp;c-&gt;parent_index_);</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;      <span class="keywordflow">if</span> (expanded1.size() == c-&gt;inputs_[1].size() &amp;&amp;</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;          !<a class="code" href="../../d1/d42/a01800.html#a512e8e76628bdb9c867f6309d68fd412">FilesInCompaction</a>(expanded1)) {</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;            <span class="stringliteral">&quot;Expanding@%lu %lu+%lu (%lu+%lu bytes) to %lu+%lu (%lu+%lu bytes)&quot;</span></div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;            <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)level,</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(c-&gt;inputs_[0].size()),</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(c-&gt;inputs_[1].size()),</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)inputs0_size,</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;            (<span class="keywordtype">unsigned</span> long)inputs1_size,</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(expanded0.size()),</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(expanded1.size()),</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)expanded0_size,</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;            (<span class="keywordtype">unsigned</span> long)inputs1_size);</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;        smallest = new_start;</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;        largest = new_limit;</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;        c-&gt;inputs_[0] = expanded0;</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;        c-&gt;inputs_[1] = expanded1;</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;        <a class="code" href="../../d1/d42/a01800.html#a300d694d7eba66eb5bb129ddfea015fa">GetRange2</a>(c-&gt;inputs_[0], c-&gt;inputs_[1], &amp;all_start, &amp;all_limit);</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;      }</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    }</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;  }</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;  <span class="comment">// Compute the set of grandparent files that overlap this compaction</span></div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;  <span class="comment">// (parent == level+1; grandparent == level+2)</span></div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;  <span class="keywordflow">if</span> (level + 2 &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>()) {</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060">GetOverlappingInputs</a>(level + 2, &amp;all_start, &amp;all_limit,</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;                                   &amp;c-&gt;grandparents_);</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;  }</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">false</span>) {</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Compacting %d &#39;%s&#39; .. &#39;%s&#39;&quot;</span>,</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;        level,</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;        smallest.DebugString().c_str(),</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;        largest.DebugString().c_str());</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;  }</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;  <span class="comment">// Update the place where we will do the next compaction for this level.</span></div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;  <span class="comment">// We update this immediately instead of waiting for the VersionEdit</span></div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;  <span class="comment">// to be applied so that if the compaction fails, we will try a different</span></div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;  <span class="comment">// key range next time.</span></div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;  <a class="code" href="../../d1/d42/a01800.html#a73592373481ef75a5aa62e5c51c398c7">compact_pointer_</a>[level] = largest.Encode().ToString();</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;  c-&gt;edit_-&gt;SetCompactPointer(level, largest);</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ae62effcc413a67f9941cfc18a5d3bd93_cgraph.png" border="0" usemap="#d1/d42/a01800_ae62effcc413a67f9941cfc18a5d3bd93_cgraph" alt=""/></div>
<map name="d1/d42/a01800_ae62effcc413a67f9941cfc18a5d3bd93_cgraph" id="d1/d42/a01800_ae62effcc413a67f9941cfc18a5d3bd93_cgraph">
<area shape="rect" id="node3" href="../../de/de6/a00723.html#a1f29087f48fd168fe431e4b884f5aed1" title="rocksdb::InternalKey\l::DebugString" alt="" coords="503,132,644,178"/><area shape="rect" id="node7" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="1013,51,1176,80"/><area shape="rect" id="node24" href="../../de/de6/a00723.html#a6d86d2cfbd4205b41f29f84cdedf3c22" title="rocksdb::InternalKey\l::Encode" alt="" coords="765,518,907,565"/><area shape="rect" id="node26" href="../../d1/d42/a01800.html#a31739d9b6c47d04ec18b7e717796c4ed" title="rocksdb::VersionSet\l::ExpandedCompactionByteSize\lLimit" alt="" coords="200,252,411,316"/><area shape="rect" id="node30" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="767,253,905,300"/><area shape="rect" id="node32" href="../../d1/d42/a01800.html#a512e8e76628bdb9c867f6309d68fd412" title="rocksdb::VersionSet\l::FilesInCompaction" alt="" coords="236,390,375,437"/><area shape="rect" id="node34" href="../../d4/dd1/a01797.html#ac453d54c8c52b533043787960fe5e060" title="rocksdb::Version::GetOverlapping\lInputs" alt="" coords="196,649,415,696"/><area shape="rect" id="node60" href="../../d1/d42/a01800.html#a49822736d0cb083b87cca21346af7588" title="rocksdb::VersionSet\l::GetRange" alt="" coords="504,454,643,501"/><area shape="rect" id="node73" href="../../d1/d42/a01800.html#a300d694d7eba66eb5bb129ddfea015fa" title="rocksdb::VersionSet\l::GetRange2" alt="" coords="236,460,375,506"/><area shape="rect" id="node76" href="../../d4/dd1/a01797.html#a8ba59d2bda530f588042dcbad00d3b9d" title="rocksdb::Version::HasOverlapping\lUserKey" alt="" coords="195,580,416,626"/><area shape="rect" id="node83" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="232,718,379,765"/><area shape="rect" id="node85" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="257,788,353,818"/><area shape="rect" id="node88" href="../../d2/d86/a01798.html#ad1b747cb4b2572325d2622a9bcfb242d" title="rocksdb::VersionEdit\l::SetCompactPointer" alt="" coords="233,841,377,888"/><area shape="rect" id="node91" href="../../d4/d87/a03436.html#a79ca3fdf63c8d546b2365f8fee94734e" title="rocksdb::TotalFileSize" alt="" coords="229,911,381,940"/><area shape="rect" id="node5" href="../../d6/d80/a01076.html#a36870425cc00e160004d62bd6118a24d" title="rocksdb::ParsedInternalKey\l::DebugString" alt="" coords="745,72,927,118"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a4bf89f1a48c96450ef0d88b5c9f0a1ec" title="rocksdb::EscapeString" alt="" coords="759,142,913,171"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2" title="rocksdb::ParseInternalKey" alt="" coords="748,196,924,226"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#abd1b2064e9379d3df8f49bcdd26d7de0" title="rocksdb::AppendEscapedStringTo" alt="" coords="1249,138,1468,167"/><area shape="rect" id="node13" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1519,267,1655,296"/><area shape="rect" id="node17" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1517,396,1656,426"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1012,292,1177,322"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="1276,292,1441,322"/><area shape="rect" id="node28" href="../../d1/d42/a01800.html#a51725970659718a612480286843b0ad5" title="rocksdb::VersionSet\l::MaxFileSizeForLevel" alt="" coords="497,260,649,306"/><area shape="rect" id="node36" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="1023,629,1167,676"/><area shape="rect" id="node38" href="../../d4/dd1/a01797.html#adadffeaebb14efe4d6af9c401e919e1e" title="rocksdb::Version::GetOverlapping\lInputsBinarySearch" alt="" coords="464,833,683,880"/><area shape="rect" id="node44" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="989,1033,1200,1080"/><area shape="rect" id="node46" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="1024,740,1165,786"/><area shape="rect" id="node41" href="../../d4/dd1/a01797.html#a8861eeaa29b1b1dd83c413f2da2b8738" title="rocksdb::Version::Extend\lOverlappingInputs" alt="" coords="752,948,920,994"/><area shape="rect" id="node52" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="793,842,879,871"/><area shape="rect" id="node54" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="795,895,877,924"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#ae015f9b23bbadef7eb4e3796c2d4fb46" title="rocksdb::ExtractUserKey" alt="" coords="1275,396,1443,426"/><area shape="rect" id="node62" href="../../de/de6/a00723.html#af2bf0f2689f28795fc9d0533b6f04acf" title="rocksdb::InternalKey\l::Clear" alt="" coords="765,449,907,496"/><area shape="rect" id="node64" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="731,380,941,426"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#aab29434ed2c251eae44fdb498e4d8dcc" title="rocksdb::BumpPerfCount" alt="" coords="1011,447,1179,476"/><area shape="rect" id="node79" href="../../d4/d87/a03436.html#a382fc0a9bad90fe4253c354dd309f083" title="rocksdb::FindFile" alt="" coords="512,532,635,562"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ae62effcc413a67f9941cfc18a5d3bd93_icgraph.png" border="0" usemap="#d1/d42/a01800_ae62effcc413a67f9941cfc18a5d3bd93_icgraph" alt=""/></div>
<map name="d1/d42/a01800_ae62effcc413a67f9941cfc18a5d3bd93_icgraph" id="d1/d42/a01800_ae62effcc413a67f9941cfc18a5d3bd93_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#ace5e7f4084293eb426653ea279392111" title="rocksdb::VersionSet\l::CompactRange" alt="" coords="196,5,335,51"/><area shape="rect" id="node5" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="196,74,335,121"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac723248f990dd0f5de3eca23b292a501"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::SizeBeingCompacted </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>sizes</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02185">2185</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00500">compactions_in_progress_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00024">rocksdb::FileMetaData::file_size</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00560">rocksdb::Compaction::input()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00547">rocksdb::Compaction::level()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00557">rocksdb::Compaction::num_input_files()</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>.</p>
<div class="fragment"><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;                                                              {</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>()-1; level++) {</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> total = 0;</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;    <span class="keywordflow">for</span> (std::set&lt;Compaction*&gt;::iterator it =</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;         <a class="code" href="../../d1/d42/a01800.html#a6c4a4e38b597d39024dd2192adceb3b3">compactions_in_progress_</a>[level].begin();</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;         it != <a class="code" href="../../d1/d42/a01800.html#a6c4a4e38b597d39024dd2192adceb3b3">compactions_in_progress_</a>[level].end();</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;         ++it) {</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      <a class="code" href="../../d1/d42/a01800.html#a9372e882b35d27c78356228e4b758917">Compaction</a>* c = (*it);</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      assert(c-&gt;level() == level);</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; c-&gt;num_input_files(0); i++) {</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        total += c-&gt;input(0,i)-&gt;file_size;</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;      }</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    }</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    sizes[level] = total;</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;  }</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ac723248f990dd0f5de3eca23b292a501_cgraph.png" border="0" usemap="#d1/d42/a01800_ac723248f990dd0f5de3eca23b292a501_cgraph" alt=""/></div>
<map name="d1/d42/a01800_ac723248f990dd0f5de3eca23b292a501_cgraph" id="d1/d42/a01800_ac723248f990dd0f5de3eca23b292a501_cgraph">
<area shape="rect" id="node3" href="../../d9/d5e/a00295.html#a31e5be150c385f6df320ee7f7daf7a9a" title="rocksdb::Compaction\l::input" alt="" coords="211,5,357,51"/><area shape="rect" id="node5" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="211,74,357,121"/><area shape="rect" id="node7" href="../../d9/d5e/a00295.html#ae0e14955026684df1c7e261dc31fcb70" title="rocksdb::Compaction\l::num_input_files" alt="" coords="211,143,357,190"/><area shape="rect" id="node9" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="215,213,353,259"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ac723248f990dd0f5de3eca23b292a501_icgraph.png" border="0" usemap="#d1/d42/a01800_ac723248f990dd0f5de3eca23b292a501_icgraph" alt=""/></div>
<map name="d1/d42/a01800_ac723248f990dd0f5de3eca23b292a501_icgraph" id="d1/d42/a01800_ac723248f990dd0f5de3eca23b292a501_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a6a345ce36535de042e2e0d254ff66a5a" title="rocksdb::VersionSet\l::DumpManifest" alt="" coords="212,1431,351,1478"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="212,1561,351,1607"/><area shape="rect" id="node102" href="../../d1/d42/a01800.html#a18db5b74de66aa2038d11902bbd1f348" title="rocksdb::VersionSet\l::PickCompaction" alt="" coords="212,1710,351,1757"/><area shape="rect" id="node104" href="../../d1/d42/a01800.html#acf04defe0d794e6933785aad628ab9b6" title="rocksdb::VersionSet\l::Recover" alt="" coords="2288,1650,2427,1697"/><area shape="rect" id="node5" href="../../dd/d20/a00939.html#a0a4996198d709bec7b49eec50ba36567" title="rocksdb::ManifestDumpCommand\l::DoCommand" alt="" coords="400,1401,621,1447"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2535,1547,2713,1576"/><area shape="rect" id="node13" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="412,1470,609,1517"/><area shape="rect" id="node99" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="677,1590,851,1637"/><area shape="rect" id="node11" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2887,1547,2937,1576"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="669,987,859,1034"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1203,909,1400,955"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1203,1013,1400,1059"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="908,969,1153,999"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1448,909,1645,955"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1693,923,1941,952"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1989,823,2211,870"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2259,1013,2456,1059"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2271,59,2444,88"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2260,249,2455,295"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2269,595,2445,624"/><area shape="rect" id="node46" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2291,856,2424,885"/><area shape="rect" id="node89" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2276,717,2439,763"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2519,1493,2729,1523"/><area shape="rect" id="node34" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2549,59,2699,88"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2521,5,2727,35"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2545,112,2703,141"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2569,165,2679,195"/><area shape="rect" id="node48" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2543,549,2705,595"/><area shape="rect" id="node50" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2553,618,2695,665"/><area shape="rect" id="node52" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2524,688,2724,717"/><area shape="rect" id="node54" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2528,741,2720,771"/><area shape="rect" id="node56" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2569,795,2679,824"/><area shape="rect" id="node59" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2544,847,2704,894"/><area shape="rect" id="node61" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2563,917,2685,947"/><area shape="rect" id="node63" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2556,970,2692,1017"/><area shape="rect" id="node65" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2528,1039,2720,1086"/><area shape="rect" id="node67" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2528,1109,2720,1155"/><area shape="rect" id="node69" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2516,1179,2732,1208"/><area shape="rect" id="node71" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2543,1231,2705,1278"/><area shape="rect" id="node73" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2599,1301,2649,1331"/><area shape="rect" id="node75" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2555,1354,2693,1401"/><area shape="rect" id="node77" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2535,287,2713,334"/><area shape="rect" id="node79" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2543,1423,2705,1470"/><area shape="rect" id="node83" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2541,357,2707,387"/><area shape="rect" id="node85" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2555,410,2693,457"/><area shape="rect" id="node87" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2552,479,2696,526"/><area shape="rect" id="node81" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="2793,1625,3031,1671"/><area shape="rect" id="node91" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="2533,218,2715,265"/><area shape="rect" id="node108" href="../../d0/d58/a01230.html#a769cf9f08028648f2cb824dbbf695de7" title="rocksdb::ReduceDBLevelsCommand\l::GetOldNumOfLevels" alt="" coords="2505,1650,2743,1697"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1161ffbcf7b18cde8bed5e361c7d3f0f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::VersionSet::UpdateFilesBySize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/dd1/a01797.html">Version</a> *&#160;</td>
          <td class="paramname"><em>v</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01776">1776</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../d2/de3/a02637_source.html#l00576">rocksdb::Options::compaction_style</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01765">rocksdb::compareSeqnoDescending()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01759">rocksdb::compareSizeDescending()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00172">rocksdb::Version::files_by_size_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00057">rocksdb::kCompactionStyleUniversal</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00176">rocksdb::Version::next_file_to_compact_by_size_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00183">rocksdb::Version::number_of_files_to_sort_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>.</p>
<div class="fragment"><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;                                             {</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;  <span class="comment">// No need to sort the highest level because it is never compacted.</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <span class="keywordtype">int</span> max_level = (<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> == <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a>) ?</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;                  <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>() : <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>() - 1;</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; max_level; level++) {</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="keyword">const</span> std::vector&lt;FileMetaData*&gt;&amp; files = v-&gt;files_[level];</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    std::vector&lt;int&gt;&amp; files_by_size = v-&gt;files_by_size_[level];</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    assert(files_by_size.size() == 0);</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="comment">// populate a temp vector for sorting based on size</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    std::vector&lt;Fsize&gt; temp(files.size());</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; files.size(); i++) {</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;      temp[i].index = i;</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;      temp[i].file = files[i];</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    }</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <span class="comment">// sort the top number_of_files_to_sort_ based on file size</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> == <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a>) {</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;      <span class="keywordtype">int</span> num = temp.size();</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      std::partial_sort(temp.begin(),  temp.begin() + num,</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                        temp.end(), <a class="code" href="../../d4/d87/a03436.html#a97c47fe7cbf010994c2307a711b9390c">compareSeqnoDescending</a>);</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      <span class="keywordtype">int</span> num = <a class="code" href="../../d4/dd1/a01797.html#a4d4d981d0d40d7be0ef31dc604461a17">Version::number_of_files_to_sort_</a>;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;      <span class="keywordflow">if</span> (num &gt; (<span class="keywordtype">int</span>)temp.size()) {</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        num = temp.size();</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      }</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      std::partial_sort(temp.begin(),  temp.begin() + num,</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;                        temp.end(), <a class="code" href="../../d4/d87/a03436.html#a85ba2149b92b235f96db65279922b7a2">compareSizeDescending</a>);</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    }</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    assert(temp.size() == files.size());</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <span class="comment">// initialize files_by_size_</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; temp.size(); i++) {</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;      files_by_size.push_back(temp[i].index);</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    }</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    v-&gt;next_file_to_compact_by_size_[level] = 0;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    assert(v-&gt;files_[level].size() == v-&gt;files_by_size_[level].size());</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;  }</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a1161ffbcf7b18cde8bed5e361c7d3f0f_cgraph.png" border="0" usemap="#d1/d42/a01800_a1161ffbcf7b18cde8bed5e361c7d3f0f_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a1161ffbcf7b18cde8bed5e361c7d3f0f_cgraph" id="d1/d42/a01800_a1161ffbcf7b18cde8bed5e361c7d3f0f_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a97c47fe7cbf010994c2307a711b9390c" title="rocksdb::compareSeqnoDescending" alt="" coords="197,5,429,35"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a85ba2149b92b235f96db65279922b7a2" title="rocksdb::compareSizeDescending" alt="" coords="203,59,424,88"/><area shape="rect" id="node7" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="244,111,383,158"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a1161ffbcf7b18cde8bed5e361c7d3f0f_icgraph.png" border="0" usemap="#d1/d42/a01800_a1161ffbcf7b18cde8bed5e361c7d3f0f_icgraph" alt=""/></div>
<map name="d1/d42/a01800_a1161ffbcf7b18cde8bed5e361c7d3f0f_icgraph" id="d1/d42/a01800_a1161ffbcf7b18cde8bed5e361c7d3f0f_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="199,57,337,103"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2488,5,2667,35"/><area shape="rect" id="node9" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="388,799,585,846"/><area shape="rect" id="node106" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="643,57,816,103"/><area shape="rect" id="node7" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2828,5,2879,35"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="635,1475,824,1522"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1168,1497,1365,1543"/><area shape="rect" id="node100" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1168,1621,1365,1667"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="873,1509,1119,1539"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1413,1482,1611,1529"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1659,1499,1907,1528"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1955,1490,2176,1537"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2224,1663,2421,1710"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2236,1368,2409,1397"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2225,1490,2420,1537"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2235,1560,2411,1589"/><area shape="rect" id="node50" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2256,677,2389,707"/><area shape="rect" id="node94" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2241,1421,2404,1467"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2472,1661,2683,1691"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2503,1315,2652,1344"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2475,1368,2680,1397"/><area shape="rect" id="node32" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2771,1421,2936,1451"/><area shape="rect" id="node34" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2803,1315,2904,1344"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2751,1261,2956,1291"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2799,1368,2908,1397"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2499,1544,2656,1573"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2523,1597,2632,1627"/><area shape="rect" id="node52" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2496,301,2659,347"/><area shape="rect" id="node54" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2507,370,2648,417"/><area shape="rect" id="node56" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2477,440,2677,469"/><area shape="rect" id="node58" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2481,493,2673,523"/><area shape="rect" id="node60" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2523,547,2632,576"/><area shape="rect" id="node63" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2497,599,2657,646"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2516,1261,2639,1291"/><area shape="rect" id="node68" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2509,738,2645,785"/><area shape="rect" id="node70" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2481,807,2673,854"/><area shape="rect" id="node72" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2481,877,2673,923"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2469,947,2685,976"/><area shape="rect" id="node76" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2496,999,2659,1046"/><area shape="rect" id="node78" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2552,1069,2603,1099"/><area shape="rect" id="node80" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2508,1122,2647,1169"/><area shape="rect" id="node82" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2488,1191,2667,1238"/><area shape="rect" id="node84" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2496,669,2659,715"/><area shape="rect" id="node88" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2495,109,2660,139"/><area shape="rect" id="node90" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2508,162,2647,209"/><area shape="rect" id="node92" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2505,231,2649,278"/><area shape="rect" id="node86" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="2735,363,2972,410"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="2487,1421,2668,1467"/><area shape="rect" id="node98" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="2523,1491,2632,1520"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a70c2cca8ce9d7c0e133e96f952111d40"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::VersionSet::VerifyCompactionFileConsistency </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d5e/a00295.html">Compaction</a> *&#160;</td>
          <td class="paramname"><em>c</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l02127">2127</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00560">rocksdb::Compaction::input()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00611">rocksdb::Compaction::input_version_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00547">rocksdb::Compaction::level()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00557">rocksdb::Compaction::num_input_files()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00023">rocksdb::FileMetaData::number</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00473">options_</a>.</p>
<div class="fragment"><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                                                              {</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> (c-&gt;input_version_ != <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>) {</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../d1/d42/a01800.html#aea259a26e9ad3d2ca39ea1a5f4858878">options_</a>-&gt;<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;VerifyCompactionFileConsistency version mismatch&quot;</span>);</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;  }</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;  <span class="comment">// verify files in level</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;  <span class="keywordtype">int</span> level = c-&gt;level();</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; c-&gt;num_input_files(0); i++) {</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> number = c-&gt;input(0,i)-&gt;number;</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    <span class="comment">// look for this file in the current version</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;    <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level].size(); j++) {</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;      FileMetaData* <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][j];</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      <span class="keywordflow">if</span> (f-&gt;number == number) {</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;        found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;      }</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;    }</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    <span class="keywordflow">if</span> (!found) {</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// input files non existant in current version</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;    }</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;  }</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  <span class="comment">// verify level+1 files</span></div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;  level++;</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; c-&gt;num_input_files(1); i++) {</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> number = c-&gt;input(1,i)-&gt;number;</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;    <span class="comment">// look for this file in the current version</span></div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;    <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level].size(); j++) {</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      FileMetaData* f = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level][j];</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;      <span class="keywordflow">if</span> (f-&gt;number == number) {</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;        found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;      }</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    }</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    <span class="keywordflow">if</span> (!found) {</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// input files non existant in current version</span></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    }</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;  }</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;     <span class="comment">// everything good</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_a70c2cca8ce9d7c0e133e96f952111d40_cgraph.png" border="0" usemap="#d1/d42/a01800_a70c2cca8ce9d7c0e133e96f952111d40_cgraph" alt=""/></div>
<map name="d1/d42/a01800_a70c2cca8ce9d7c0e133e96f952111d40_cgraph" id="d1/d42/a01800_a70c2cca8ce9d7c0e133e96f952111d40_cgraph">
<area shape="rect" id="node3" href="../../d9/d5e/a00295.html#a31e5be150c385f6df320ee7f7daf7a9a" title="rocksdb::Compaction\l::input" alt="" coords="283,5,429,51"/><area shape="rect" id="node5" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="283,74,429,121"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="308,144,404,173"/><area shape="rect" id="node9" href="../../d9/d5e/a00295.html#ae0e14955026684df1c7e261dc31fcb70" title="rocksdb::Compaction\l::num_input_files" alt="" coords="283,197,429,243"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab1e1ece4fbaa4098f0e08154f773cb61"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::VersionSet::WriteSnapshot </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../da/d18/a01850.html">log::Writer</a> *&#160;</td>
          <td class="paramname"><em>log</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d6/dfc/a02612_source.html#l01819">1819</a> of file <a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a>.</p>

<p>References <a class="el" href="../../de/d3b/a02610_source.html#l00072">rocksdb::VersionEdit::AddFile()</a>, <a class="el" href="../../dc/d28/a02584_source.html#l00032">rocksdb::log::Writer::AddRecord()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00491">compact_pointer_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00487">current_</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00135">rocksdb::InternalKey::DecodeFrom()</a>, <a class="el" href="../../df/d40/a02609_source.html#l00049">rocksdb::VersionEdit::EncodeTo()</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00024">rocksdb::FileMetaData::file_size</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00166">rocksdb::Version::files_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00475">icmp_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00026">rocksdb::FileMetaData::largest</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00029">rocksdb::FileMetaData::largest_seqno</a>, <a class="el" href="../../d0/d61/a00302.html#a3ef0d8f8f4fe04540c00cd4a9c9d5e84">rocksdb::Comparator::Name()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00023">rocksdb::FileMetaData::number</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00065">rocksdb::VersionEdit::SetCompactPointer()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00045">rocksdb::VersionEdit::SetComparatorName()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00025">rocksdb::FileMetaData::smallest</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00028">rocksdb::FileMetaData::smallest_seqno</a>, and <a class="el" href="../../dc/db2/a02574_source.html#l00107">rocksdb::InternalKeyComparator::user_comparator()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>.</p>
<div class="fragment"><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                                               {</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;  <span class="comment">// TODO: Break up into multiple records to reduce memory usage on recovery?</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  <span class="comment">// Save metadata</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  VersionEdit edit(<a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>());</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  edit.SetComparatorName(<a class="code" href="../../d1/d42/a01800.html#aa9f3871481ba903b57737941a72115c7">icmp_</a>.<a class="code" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a">user_comparator</a>()-&gt;<a class="code" href="../../d0/d61/a00302.html#a3ef0d8f8f4fe04540c00cd4a9c9d5e84">Name</a>());</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  <span class="comment">// Save compaction pointers</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(); level++) {</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d42/a01800.html#a73592373481ef75a5aa62e5c51c398c7">compact_pointer_</a>[level].empty()) {</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;      InternalKey key;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;      key.DecodeFrom(<a class="code" href="../../d1/d42/a01800.html#a73592373481ef75a5aa62e5c51c398c7">compact_pointer_</a>[level]);</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;      edit.SetCompactPointer(level, key);</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    }</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  }</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  <span class="comment">// Save files</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; <a class="code" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185">NumberLevels</a>(); level++) {</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    <span class="keyword">const</span> std::vector&lt;FileMetaData*&gt;&amp; files = <a class="code" href="../../d1/d42/a01800.html#af2f098a7fdc59cda85bda47538bf6b30">current_</a>-&gt;<a class="code" href="../../d4/dd1/a01797.html#a35f53fab270908bca7d895f54c85bfe9">files_</a>[level];</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; files.size(); i++) {</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;      <span class="keyword">const</span> FileMetaData* <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> = files[i];</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;      edit.AddFile(level, f-&gt;number, f-&gt;file_size, f-&gt;smallest, f-&gt;largest,</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                   f-&gt;smallest_seqno, f-&gt;largest_seqno);</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    }</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;  }</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  std::string record;</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  edit.EncodeTo(&amp;record);</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;  <span class="keywordflow">return</span> log-&gt;AddRecord(record);</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ab1e1ece4fbaa4098f0e08154f773cb61_cgraph.png" border="0" usemap="#d1/d42/a01800_ab1e1ece4fbaa4098f0e08154f773cb61_cgraph" alt=""/></div>
<map name="d1/d42/a01800_ab1e1ece4fbaa4098f0e08154f773cb61_cgraph" id="d1/d42/a01800_ab1e1ece4fbaa4098f0e08154f773cb61_cgraph">
<area shape="rect" id="node3" href="../../d2/d86/a01798.html#a62a14d8606dbc1d557b6e3bb55c617dd" title="rocksdb::VersionEdit\l::AddFile" alt="" coords="229,250,371,297"/><area shape="rect" id="node5" href="../../da/d18/a01850.html#a38f817406010aa11b3e9ece52425cae2" title="rocksdb::log::Writer\l::AddRecord" alt="" coords="477,213,613,259"/><area shape="rect" id="node42" href="../../de/de6/a00723.html#a87df954d098adf219ebd79ae6f5b75f3" title="rocksdb::InternalKey\l::DecodeFrom" alt="" coords="475,282,616,329"/><area shape="rect" id="node46" href="../../d2/d86/a01798.html#a6b9fe2d268b89b432b49827445798943" title="rocksdb::VersionEdit\l::EncodeTo" alt="" coords="229,421,371,467"/><area shape="rect" id="node65" href="../../d0/d61/a00302.html#a3ef0d8f8f4fe04540c00cd4a9c9d5e84" title="rocksdb::Comparator\l::Name" alt="" coords="228,490,372,537"/><area shape="rect" id="node67" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="231,559,369,606"/><area shape="rect" id="node69" href="../../d2/d86/a01798.html#ad1b747cb4b2572325d2622a9bcfb242d" title="rocksdb::VersionEdit\l::SetCompactPointer" alt="" coords="228,629,372,675"/><area shape="rect" id="node71" href="../../d2/d86/a01798.html#a314e38c243876ccf58dac6c3b18180e6" title="rocksdb::VersionEdit\l::SetComparatorName" alt="" coords="224,698,376,745"/><area shape="rect" id="node75" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="195,767,405,814"/><area shape="rect" id="node7" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="700,340,839,369"/><area shape="rect" id="node9" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="701,287,837,316"/><area shape="rect" id="node11" href="../../da/d18/a01850.html#aa1a71db57537317c5621593b04750216" title="rocksdb::log::Writer\l::EmitPhysicalRecord" alt="" coords="695,158,844,205"/><area shape="rect" id="node39" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="917,227,1053,256"/><area shape="rect" id="node13" href="../../d7/db0/a03467.html#aba0a720f8204028aa9b0f78f969d5f97" title="rocksdb::crc32c::Extend" alt="" coords="904,67,1067,96"/><area shape="rect" id="node35" href="../../d7/db0/a03467.html#a878557cbe7e1259455691fa1eb7b2743" title="rocksdb::crc32c::Mask" alt="" coords="908,120,1063,149"/><area shape="rect" id="node37" href="../../d4/d87/a03436.html#aabc7ce45ae48e15b24a6756f9b4fd694" title="rocksdb::EncodeFixed32" alt="" coords="903,173,1068,203"/><area shape="rect" id="node15" href="../../d7/db0/a03467.html#a174fe9c8cf3cb558b7accfdc10c6c04c" title="rocksdb::crc32c::CRC32" alt="" coords="1119,67,1284,96"/><area shape="rect" id="node17" href="../../d7/db0/a03467.html#aeb8537c518a4a8ac7e1d8f8ac1c6bb63" title="rocksdb::crc32c::Choose\l_CRC32" alt="" coords="1333,58,1501,105"/><area shape="rect" id="node19" href="../../d7/db0/a03467.html#a6abc7c8ed18979f0e12fcfb6460f9285" title="rocksdb::crc32c::isSSE42" alt="" coords="1551,5,1724,35"/><area shape="rect" id="node21" href="../../d7/db0/a03467.html#ab6bf1f9041f7859fe1aae6312f650115" title="rocksdb::crc32c::Fast\l_CRC32" alt="" coords="1563,58,1712,105"/><area shape="rect" id="node29" href="../../d7/db0/a03467.html#aabbb4470a0a8566fff676e40a5c3a491" title="rocksdb::crc32c::Slow\l_CRC32" alt="" coords="1773,118,1925,165"/><area shape="rect" id="node23" href="../../d7/db0/a03467.html#aa5eeccea7be6cc99acab7223cc1c7baf" title="rocksdb::crc32c::LE\l_LOAD64" alt="" coords="1780,49,1919,95"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1975,60,2140,89"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="2191,92,2356,121"/><area shape="rect" id="node31" href="../../d7/db0/a03467.html#a72b216c9d4dfeeaea89e2410eec06ff9" title="rocksdb::crc32c::LE\l_LOAD32" alt="" coords="1988,114,2127,161"/><area shape="rect" id="node48" href="../../de/de6/a00723.html#a6d86d2cfbd4205b41f29f84cdedf3c22" title="rocksdb::InternalKey\l::Encode" alt="" coords="475,421,616,467"/><area shape="rect" id="node50" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e" title="beast.util.Iter.first" alt="" coords="484,491,607,520"/><area shape="rect" id="node52" href="../../d4/d87/a03436.html#af1cdcde94bcaeced42cd5925a5827232" title="rocksdb::PutLengthPrefixed\lSlice" alt="" coords="455,351,636,398"/><area shape="rect" id="node55" href="../../d4/d87/a03436.html#afe24fa7da1cd551af92134aa66f96183" title="rocksdb::PutVarint32" alt="" coords="697,465,841,495"/><area shape="rect" id="node61" href="../../d4/d87/a03436.html#aa7b83a93a0d06b7c3324f7ef95051c21" title="rocksdb::PutVarint64" alt="" coords="473,595,617,624"/><area shape="rect" id="node57" href="../../d4/d87/a03436.html#a94c48680211f25845f5c35acd4b54ebb" title="rocksdb::EncodeVarint32" alt="" coords="901,465,1069,495"/><area shape="rect" id="node63" href="../../d4/d87/a03436.html#a04ab81feb839c834d2bf339b687491e0" title="rocksdb::EncodeVarint64" alt="" coords="685,595,853,624"/><area shape="rect" id="node73" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="464,707,627,736"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d42/a01800_ab1e1ece4fbaa4098f0e08154f773cb61_icgraph.png" border="0" usemap="#d1/d42/a01800_ab1e1ece4fbaa4098f0e08154f773cb61_icgraph" alt=""/></div>
<map name="d1/d42/a01800_ab1e1ece4fbaa4098f0e08154f773cb61_icgraph" id="d1/d42/a01800_ab1e1ece4fbaa4098f0e08154f773cb61_icgraph">
<area shape="rect" id="node3" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="196,57,335,103"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2485,5,2664,35"/><area shape="rect" id="node9" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="385,799,583,846"/><area shape="rect" id="node106" href="../../d1/d42/a01800.html#a788a71e004c7a132a2fea2a82eedccd6" title="rocksdb::VersionSet\l::ReduceNumberOfLevels" alt="" coords="640,57,813,103"/><area shape="rect" id="node7" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2825,5,2876,35"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="632,1475,821,1522"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1165,1497,1363,1543"/><area shape="rect" id="node100" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1165,1621,1363,1667"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="871,1509,1116,1539"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1411,1482,1608,1529"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1656,1499,1904,1528"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1952,1490,2173,1537"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2221,1663,2419,1710"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2233,1368,2407,1397"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2223,1490,2417,1537"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2232,1560,2408,1589"/><area shape="rect" id="node50" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2253,677,2387,707"/><area shape="rect" id="node94" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2239,1421,2401,1467"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2469,1661,2680,1691"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2500,1315,2649,1344"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2472,1368,2677,1397"/><area shape="rect" id="node32" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2768,1421,2933,1451"/><area shape="rect" id="node34" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2800,1315,2901,1344"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2748,1261,2953,1291"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2796,1368,2905,1397"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2496,1544,2653,1573"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2520,1597,2629,1627"/><area shape="rect" id="node52" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2493,301,2656,347"/><area shape="rect" id="node54" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2504,370,2645,417"/><area shape="rect" id="node56" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2475,440,2675,469"/><area shape="rect" id="node58" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2479,493,2671,523"/><area shape="rect" id="node60" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2520,547,2629,576"/><area shape="rect" id="node63" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2495,599,2655,646"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2513,1261,2636,1291"/><area shape="rect" id="node68" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2507,738,2643,785"/><area shape="rect" id="node70" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2479,807,2671,854"/><area shape="rect" id="node72" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2479,877,2671,923"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2467,947,2683,976"/><area shape="rect" id="node76" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2493,999,2656,1046"/><area shape="rect" id="node78" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2549,1069,2600,1099"/><area shape="rect" id="node80" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2505,1122,2644,1169"/><area shape="rect" id="node82" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2485,1191,2664,1238"/><area shape="rect" id="node84" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2493,669,2656,715"/><area shape="rect" id="node88" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2492,109,2657,139"/><area shape="rect" id="node90" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2505,162,2644,209"/><area shape="rect" id="node92" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2503,231,2647,278"/><area shape="rect" id="node86" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="2732,363,2969,410"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="2484,1421,2665,1467"/><area shape="rect" id="node98" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="2520,1491,2629,1520"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Friends And Related Function Documentation</h2>
<a class="anchor" id="a9372e882b35d27c78356228e4b758917"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="../../d9/d5e/a00295.html">Compaction</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00438">438</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02904">CompactRange()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02522">PickCompactionBySize()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02313">PickCompactionUniversalReadAmp()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l02209">PickCompactionUniversalSizeAmp()</a>.</p>

</div>
</div>
<a class="anchor" id="ace162f32d4abb584945d3a55a389b0a3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="../../d4/dd1/a01797.html">Version</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00441">441</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01133">VersionSet()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a73592373481ef75a5aa62e5c51c398c7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string* rocksdb::VersionSet::compact_pointer_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00491">491</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01033">rocksdb::VersionSet::Builder::Apply()</a>, <a class="el" href="../../dc/dd5/a02614_source.html#l00020">ReduceNumberOfLevels()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02774">SetupOtherInputs()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01133">VersionSet()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01819">WriteSnapshot()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01161">~VersionSet()</a>.</p>

</div>
</div>
<a class="anchor" id="a6c4a4e38b597d39024dd2192adceb3b3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::set&lt;<a class="el" href="../../d9/d5e/a00295.html">Compaction</a>*&gt; &gt; rocksdb::VersionSet::compactions_in_progress_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00500">500</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02522">PickCompactionBySize()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02443">PickCompactionUniversal()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02175">ReleaseCompactionFiles()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l02185">SizeBeingCompacted()</a>.</p>

</div>
</div>
<a class="anchor" id="af2f098a7fdc59cda85bda47538bf6b30"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/dd1/a01797.html">Version</a>* rocksdb::VersionSet::current_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00487">487</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01992">AddLiveFilesCurrentVersion()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01193">AppendVersion()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02904">CompactRange()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00250">current()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02727">ExpandWhileOverlapping()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02879">GetLiveFilesMetaData()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02862">GetMetadataForFile()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01885">LevelFileSummary()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01856">LevelSummary()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00386">ManifestFileSize()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00344">MaxCompactionScore()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00349">MaxCompactionScoreLevel()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02009">MaxNextLevelOverlappingBytes()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00338">NeedsCompaction()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00319">NeedsSizeCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02002">NumLevelBytes()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01850">NumLevelFiles()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02698">ParentRangeInCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02522">PickCompactionBySize()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02443">PickCompactionUniversal()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02313">PickCompactionUniversalReadAmp()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02209">PickCompactionUniversalSizeAmp()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>, <a class="el" href="../../dc/dd5/a02614_source.html#l00020">ReduceNumberOfLevels()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02774">SetupOtherInputs()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02127">VerifyCompactionFileConsistency()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01819">WriteSnapshot()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01161">~VersionSet()</a>.</p>

</div>
</div>
<a class="anchor" id="a33937b18365def065cbb16d930d47c81"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::current_version_number_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00503">503</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01133">VersionSet()</a>.</p>

</div>
</div>
<a class="anchor" id="a46b2347fce13fe13dff6c57867a64d37"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const std::string rocksdb::VersionSet::dbname_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00472">472</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01907">ManifestContains()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>.</p>

</div>
</div>
<a class="anchor" id="ac6a954cbe510f1e5f1f6049b933b88a3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unique_ptr&lt;<a class="el" href="../../da/d18/a01850.html">log::Writer</a>&gt; rocksdb::VersionSet::descriptor_log_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00485">485</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>.</p>

</div>
</div>
<a class="anchor" id="aed497293c513f1060753fdb66493da3d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/dd1/a01797.html">Version</a> rocksdb::VersionSet::dummy_versions_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00486">486</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01967">AddLiveFiles()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01193">AppendVersion()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00595">rocksdb::Version::Unref()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01161">~VersionSet()</a>.</p>

</div>
</div>
<a class="anchor" id="ae22040b4a38e203468c16912223420de"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/db1/a00460.html">Env</a>* const rocksdb::VersionSet::env_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00471">471</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01907">ManifestContains()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>.</p>

</div>
</div>
<a class="anchor" id="aa9f3871481ba903b57737941a72115c7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../d0/d72/a00724.html">InternalKeyComparator</a> rocksdb::VersionSet::icmp_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00475">475</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01934">ApproximateOffsetOf()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00930">rocksdb::VersionSet::Builder::Builder()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00964">rocksdb::VersionSet::Builder::CheckConsistency()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00755">rocksdb::Version::ExtendOverlappingInputs()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00416">rocksdb::Version::Get()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00646">rocksdb::Version::GetOverlappingInputs()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00704">rocksdb::Version::GetOverlappingInputsBinarySearch()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02029">GetRange()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00816">rocksdb::Version::HasOverlappingUserKey()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03015">rocksdb::Compaction::IsBaseLevelForKey()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02063">MakeInputIterator()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01117">rocksdb::VersionSet::Builder::MaybeAddFile()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00237">rocksdb::Version::NewConcatenatingIterator()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00604">rocksdb::Version::OverlapInLevel()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01082">rocksdb::VersionSet::Builder::SaveTo()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03040">rocksdb::Compaction::ShouldStopBefore()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01819">WriteSnapshot()</a>.</p>

</div>
</div>
<a class="anchor" id="a12b0bca04f0781f79326d4de43cff810"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::last_observed_manifest_size_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00510">510</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>.</p>

</div>
</div>
<a class="anchor" id="ac9813d4953bf5d62a1bbd8f94ede1a15"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::last_sequence_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00478">478</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00274">LastSequence()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01379">LogAndApplyHelper()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00277">SetLastSequence()</a>.</p>

</div>
</div>
<a class="anchor" id="a8e79f8d904167a1092d337c82093a629"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>* rocksdb::VersionSet::level_max_bytes_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00497">497</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01173">Init()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02099">MaxBytesForLevel()</a>, <a class="el" href="../../dc/dd5/a02614_source.html#l00020">ReduceNumberOfLevels()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01161">~VersionSet()</a>.</p>

</div>
</div>
<a class="anchor" id="a8efe3b4907507a75117c3148fe888f9e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::log_number_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00479">479</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01379">LogAndApplyHelper()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00286">LogNumber()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>.</p>

</div>
</div>
<a class="anchor" id="ab02f581e1b243a5d4e421a85ecc36f76"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::manifest_file_number_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00477">477</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01907">ManifestContains()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00253">ManifestFileNumber()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>.</p>

</div>
</div>
<a class="anchor" id="a5c2f30ab49313fa28edcca51fb13acd0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::deque&lt;<a class="el" href="../../d7/db6/a00940.html">ManifestWriter</a>*&gt; rocksdb::VersionSet::manifest_writers_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00506">506</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>.</p>

</div>
</div>
<a class="anchor" id="a118a633a8d1ff038ab5506ad9044d086"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>* rocksdb::VersionSet::max_file_size_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00494">494</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01173">Init()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02107">MaxFileSizeForLevel()</a>, <a class="el" href="../../dc/dd5/a02614_source.html#l00020">ReduceNumberOfLevels()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01161">~VersionSet()</a>.</p>

</div>
</div>
<a class="anchor" id="a3729aabcbf981b8262e9987d61429244"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::next_file_number_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00476">476</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01379">LogAndApplyHelper()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01668">MarkFileNumberUsed()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00256">NewFileNumber()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>, and <a class="el" href="../../db/d6a/a02613_source.html#l00261">ReuseFileNumber()</a>.</p>

</div>
</div>
<a class="anchor" id="a707d774d0f01630acd6caaf633514324"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rocksdb::VersionSet::num_levels_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00482">482</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d6a/a02613_source.html#l00292">NumberLevels()</a>, and <a class="el" href="../../dc/dd5/a02614_source.html#l00020">ReduceNumberOfLevels()</a>.</p>

</div>
</div>
<a class="anchor" id="abae36f2c040724d34e2ef7c4a4ae2013"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="../../d0/ddb/a00542.html">FileMetaData</a>*&gt; rocksdb::VersionSet::obsolete_files_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00512">512</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02897">GetObsoleteFiles()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00039">rocksdb::Version::~Version()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01161">~VersionSet()</a>.</p>

</div>
</div>
<a class="anchor" id="aea259a26e9ad3d2ca39ea1a5f4858878"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../dd/d57/a01054.html">Options</a>* const rocksdb::VersionSet::options_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00473">473</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02904">CompactRange()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02113">ExpandedCompactionByteSizeLimit()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01674">Finalize()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00416">rocksdb::Version::Get()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01173">Init()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03015">rocksdb::Compaction::IsBaseLevelForKey()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02063">MakeInputIterator()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01907">ManifestContains()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02119">MaxGrandParentOverlapBytes()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00319">NeedsSizeCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02595">PickCompaction()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02443">PickCompactionUniversal()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02313">PickCompactionUniversalReadAmp()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02209">PickCompactionUniversalSizeAmp()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00611">rocksdb::Version::PickLevelForMemTableOutput()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03079">rocksdb::Compaction::SetupBottomMostLevel()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02774">SetupOtherInputs()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01776">UpdateFilesBySize()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02127">VerifyCompactionFileConsistency()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01133">VersionSet()</a>.</p>

</div>
</div>
<a class="anchor" id="a7fb8190a6ca751167dc288649b8849c3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::VersionSet::prev_log_number_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00480">480</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01379">LogAndApplyHelper()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00290">PrevLogNumber()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>.</p>

</div>
</div>
<a class="anchor" id="aa455bb240de0e461dbab37045dcc3e1c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../d5/d5f/a00461.html">EnvOptions</a>&amp; rocksdb::VersionSet::storage_options_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00515">515</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l01934">ApproximateOffsetOf()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01539">DumpManifest()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01211">LogAndApply()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02063">MakeInputIterator()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01907">ManifestContains()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l01400">Recover()</a>.</p>

</div>
</div>
<a class="anchor" id="ab1fa9d94ea404bcb28cb8ceff339d769"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../d5/d5f/a00461.html">EnvOptions</a> rocksdb::VersionSet::storage_options_compactions_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00519">519</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l02063">MakeInputIterator()</a>.</p>

</div>
</div>
<a class="anchor" id="acbe852ae17cbb6c37d4b9dfbe9f44bb2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/df9/a01624.html">TableCache</a>* const rocksdb::VersionSet::table_cache_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d6a/a02613_source.html#l00474">474</a> of file <a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02612_source.html#l00254">rocksdb::Version::AddIterators()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l01934">ApproximateOffsetOf()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00416">rocksdb::Version::Get()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l02063">MakeInputIterator()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00237">rocksdb::Version::NewConcatenatingIterator()</a>, and <a class="el" href="../../d6/dfc/a02612_source.html#l00213">rocksdb::Version::PrefixMayMatch()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>rippled/src/ripple/rocksdb/rocksdb/db/<a class="el" href="../../db/d6a/a02613_source.html">version_set.h</a></li>
<li>rippled/src/ripple/rocksdb/rocksdb/db/<a class="el" href="../../d6/dfc/a02612_source.html">version_set.cc</a></li>
<li>rippled/src/ripple/rocksdb/rocksdb/db/<a class="el" href="../../dc/dd5/a02614_source.html">version_set_reduce_num_levels.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d4/d87/a03436.html">rocksdb</a></li><li class="navelem"><a class="el" href="../../d1/d42/a01800.html">VersionSet</a></li>
    <li class="footer">Generated on Fri May 2 2014 05:29:22 for rippled by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
