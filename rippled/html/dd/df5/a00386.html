<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>rippled: rocksdb::DBImpl Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">rippled
   &#160;<span id="projectnumber">0.24.0-rc1</span>
   </div>
   <div id="projectbrief">Reference implementation of the Ripple Protocol</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="../../classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="../../inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dd/df5/a00386.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="../../de/d75/a08490.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">rocksdb::DBImpl Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for rocksdb::DBImpl:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/d5b/a08491.png" border="0" usemap="#rocksdb_1_1_d_b_impl_inherit__map" alt="Inheritance graph"/></div>
<map name="rocksdb_1_1_d_b_impl_inherit__map" id="rocksdb_1_1_d_b_impl_inherit__map">
<area shape="rect" id="node5" href="../../db/db9/a00387.html" title="rocksdb::DBImplReadOnly" alt="" coords="5,160,184,189"/><area shape="rect" id="node2" href="../../d8/ddd/a00380.html" title="rocksdb::DB" alt="" coords="48,5,141,35"/></map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for rocksdb::DBImpl:</div>
<div class="dyncontent">
<div class="center"><img src="../../d8/dc4/a08492.png" border="0" usemap="#rocksdb_1_1_d_b_impl_coll__map" alt="Collaboration graph"/></div>
<map name="rocksdb_1_1_d_b_impl_coll__map" id="rocksdb_1_1_d_b_impl_coll__map">
<area shape="rect" id="node2" href="../../d8/ddd/a00380.html" title="rocksdb::DB" alt="" coords="1507,235,1600,264"/><area shape="rect" id="node6" href="../../db/da2/a00300.html" title="rocksdb::DBImpl::Compaction\lStats" alt="" coords="959,95,1156,142"/><area shape="rect" id="node8" href="../../d0/db9/a01552.html" title="rocksdb::Status" alt="" coords="643,992,757,1021"/><area shape="rect" id="node70" href="../../db/dd4/a01849.html" title="rocksdb::DBImpl::Writer" alt="" coords="976,983,1139,1012"/><area shape="rect" id="node10" href="../../df/d12/a00942.html" title="rocksdb::DBImpl::ManualCompaction" alt="" coords="1181,1300,1421,1329"/><area shape="rect" id="node12" href="../../de/de6/a00723.html" title="rocksdb::InternalKey" alt="" coords="629,1328,771,1357"/><area shape="rect" id="node14" title="STL class. " alt="" coords="245,1119,325,1148"/><area shape="rect" id="node26" href="../../de/df9/a01624.html" title="rocksdb::TableCache" alt="" coords="984,488,1131,517"/><area shape="rect" id="node31" href="../../dd/d57/a01054.html" title="rocksdb::Options" alt="" coords="640,488,760,517"/><area shape="rect" id="node73" href="../../d2/dbd/a01844.html" title="rocksdb::WriteBatch" alt="" coords="629,939,771,968"/><area shape="rect" id="node103" href="../../d2/d86/a01798.html" title="rocksdb::VersionEdit" alt="" coords="629,1045,771,1075"/><area shape="rect" id="node110" href="../../d0/d72/a00724.html" title="rocksdb::InternalKeyComparator" alt="" coords="595,885,805,915"/><area shape="rect" id="node16" title="STL class. " alt="" coords="7,1110,132,1157"/><area shape="rect" id="node18" href="../../d5/d5f/a00461.html" title="rocksdb::EnvOptions" alt="" coords="628,349,772,379"/><area shape="rect" id="node29" href="../../db/db1/a00460.html" title="rocksdb::Env" alt="" coords="236,5,335,35"/><area shape="rect" id="node43" href="../../dd/de9/a00552.html" title="rocksdb::FilterPolicy" alt="" coords="215,809,356,839"/><area shape="rect" id="node86" href="../../db/d7c/a00722.html" title="rocksdb::InternalFilterPolicy" alt="" coords="608,767,792,796"/><area shape="rect" id="node45" href="../../d9/d0d/a00298.html" title="rocksdb::CompactionOptions\lUniversal" alt="" coords="191,285,380,331"/><area shape="rect" id="node47" href="../../d1/d67/a00310.html" title="rocksdb::CompressionOptions" alt="" coords="187,355,384,384"/><area shape="rect" id="node53" href="../../d0/d7d/a01419.html" title="rocksdb::SliceTransform" alt="" coords="204,461,367,491"/><area shape="rect" id="node55" href="../../db/d7b/a00296.html" title="rocksdb::CompactionFilter" alt="" coords="199,515,372,544"/><area shape="rect" id="node57" href="../../d0/d61/a00302.html" title="rocksdb::Comparator" alt="" coords="213,891,357,920"/><area shape="rect" id="node62" href="../../dc/de6/a01426.html" title="rocksdb::SnapshotList" alt="" coords="1477,1739,1629,1768"/><area shape="rect" id="node64" href="../../db/df2/a01425.html" title="rocksdb::SnapshotImpl" alt="" coords="1849,1763,2004,1792"/><area shape="rect" id="node76" href="../../d0/d39/a00314.html" title="rocksdb::port::CondVar" alt="" coords="621,1099,779,1128"/><area shape="rect" id="node78" href="../../d9/d9a/a00998.html" title="rocksdb::port::Mutex" alt="" coords="215,1372,356,1401"/><area shape="rect" id="node80" href="../../d5/df4/a01551.html" title="rocksdb::DBImpl::StatsSnapshot" alt="" coords="1447,1471,1660,1500"/><area shape="rect" id="node84" href="../../d8/daf/a01550.html" title="rocksdb::StatsLogger" alt="" coords="984,35,1131,64"/><area shape="rect" id="node91" href="../../dd/d72/a00541.html" title="rocksdb::FileLock" alt="" coords="1491,1575,1616,1604"/><area shape="rect" id="node99" href="../../d3/dcd/a00965.html" title="rocksdb::MemTable" alt="" coords="989,1169,1125,1199"/><area shape="rect" id="node106" href="../../d7/d70/a00106.html" title="rocksdb::ArenaImpl" alt="" coords="633,1221,767,1251"/><area shape="rect" id="node108" href="../../de/d76/a00134.html" title="rocksdb::port::AtomicPointer" alt="" coords="964,911,1151,940"/><area shape="rect" id="node115" href="../../d7/dd4/a00968.html" title="rocksdb::MemTableList" alt="" coords="1475,943,1632,972"/></map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d95/a00299.html">CompactionState</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/da2/a00300.html">CompactionStats</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/dea/a00408.html">DeletionState</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d12/a00942.html">ManualCompaction</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/df4/a01551.html">StatsSnapshot</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/dd4/a01849.html">Writer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a23ac2b183dd4ff1459cfa34bd17b065e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a23ac2b183dd4ff1459cfa34bd17b065e">DBImpl</a> (const <a class="el" href="../../dd/d57/a01054.html">Options</a> &amp;options, const std::string &amp;<a class="el" href="../../d1/d03/a02560.html#a75d845559336df6843f3b599960f89d2">dbname</a>)</td></tr>
<tr class="separator:a23ac2b183dd4ff1459cfa34bd17b065e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bdda420ec5d44390a04215d8b1cbffd"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a9bdda420ec5d44390a04215d8b1cbffd">~DBImpl</a> ()</td></tr>
<tr class="separator:a9bdda420ec5d44390a04215d8b1cbffd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3f878f99daf7f0c7cc8146423027b17"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ae3f878f99daf7f0c7cc8146423027b17">Put</a> (const <a class="el" href="../../da/d4b/a01848.html">WriteOptions</a> &amp;, const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;key, const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;<a class="el" href="../../d5/d95/a02720.html#a0f61d63b009d0880a89c843bd50d8d76">value</a>)</td></tr>
<tr class="separator:ae3f878f99daf7f0c7cc8146423027b17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b355ac2e2039e00d858b96905d79d71"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a4b355ac2e2039e00d858b96905d79d71">Merge</a> (const <a class="el" href="../../da/d4b/a01848.html">WriteOptions</a> &amp;, const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;key, const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;<a class="el" href="../../d5/d95/a02720.html#a0f61d63b009d0880a89c843bd50d8d76">value</a>)</td></tr>
<tr class="separator:a4b355ac2e2039e00d858b96905d79d71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d5efdb5c1e9ec19aebcb0d76208ffe5"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a5d5efdb5c1e9ec19aebcb0d76208ffe5">Delete</a> (const <a class="el" href="../../da/d4b/a01848.html">WriteOptions</a> &amp;, const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;key)</td></tr>
<tr class="separator:a5d5efdb5c1e9ec19aebcb0d76208ffe5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a036d197e1bf77abea19c23696305cf34"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34">Write</a> (const <a class="el" href="../../da/d4b/a01848.html">WriteOptions</a> &amp;options, <a class="el" href="../../d2/dbd/a01844.html">WriteBatch</a> *updates)</td></tr>
<tr class="separator:a036d197e1bf77abea19c23696305cf34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa86e47e55cc16361ca8bfb166c659f9a"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a">Get</a> (const <a class="el" href="../../da/d3f/a01215.html">ReadOptions</a> &amp;options, const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;key, std::string *<a class="el" href="../../d5/d95/a02720.html#a0f61d63b009d0880a89c843bd50d8d76">value</a>)</td></tr>
<tr class="separator:aa86e47e55cc16361ca8bfb166c659f9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19d8fbac12db943503c6a28d35c44e44"><td class="memItemLeft" align="right" valign="top">virtual std::vector&lt; <a class="el" href="../../d0/db9/a01552.html">Status</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44">MultiGet</a> (const <a class="el" href="../../da/d3f/a01215.html">ReadOptions</a> &amp;options, const std::vector&lt; <a class="el" href="../../de/daf/a01417.html">Slice</a> &gt; &amp;keys, std::vector&lt; std::string &gt; *values)</td></tr>
<tr class="separator:a19d8fbac12db943503c6a28d35c44e44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15fbc3b2d454e4ace04cf01a4ed30124"><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124">KeyMayExist</a> (const <a class="el" href="../../da/d3f/a01215.html">ReadOptions</a> &amp;options, const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;key, std::string *<a class="el" href="../../d5/d95/a02720.html#a0f61d63b009d0880a89c843bd50d8d76">value</a>, bool *<a class="el" href="../../d6/dfc/a02612.html#a087d12026d35e2170481e0128071e9e0">value_found</a>=nullptr)</td></tr>
<tr class="separator:a15fbc3b2d454e4ace04cf01a4ed30124"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abca482230e9c3c9bab5276e8b932dae5"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d2/d02/a00777.html">Iterator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#abca482230e9c3c9bab5276e8b932dae5">NewIterator</a> (const <a class="el" href="../../da/d3f/a01215.html">ReadOptions</a> &amp;)</td></tr>
<tr class="separator:abca482230e9c3c9bab5276e8b932dae5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb3d7b24abbe10776fe76de685853433"><td class="memItemLeft" align="right" valign="top">virtual const <a class="el" href="../../d5/da5/a01424.html">Snapshot</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#afb3d7b24abbe10776fe76de685853433">GetSnapshot</a> ()</td></tr>
<tr class="separator:afb3d7b24abbe10776fe76de685853433"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e23ff6c3d681856e78c3d28514c5319"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a3e23ff6c3d681856e78c3d28514c5319">ReleaseSnapshot</a> (const <a class="el" href="../../d5/da5/a01424.html">Snapshot</a> *snapshot)</td></tr>
<tr class="separator:a3e23ff6c3d681856e78c3d28514c5319"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae57d4ca72d8c220fe8a384531433e585"><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ae57d4ca72d8c220fe8a384531433e585">GetProperty</a> (const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;property, std::string *<a class="el" href="../../d5/d95/a02720.html#a0f61d63b009d0880a89c843bd50d8d76">value</a>)</td></tr>
<tr class="separator:ae57d4ca72d8c220fe8a384531433e585"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab18101544e1b3b97a4789c160f2bc727"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ab18101544e1b3b97a4789c160f2bc727">GetApproximateSizes</a> (const <a class="el" href="../../dc/dee/a01166.html">Range</a> *range, int n, <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> *sizes)</td></tr>
<tr class="separator:ab18101544e1b3b97a4789c160f2bc727"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafef42f7b99bd9afdd50369bc5d37476"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476">CompactRange</a> (const <a class="el" href="../../de/daf/a01417.html">Slice</a> *begin, const <a class="el" href="../../de/daf/a01417.html">Slice</a> *end, bool reduce_level=false, int target_level=-1)</td></tr>
<tr class="separator:aafef42f7b99bd9afdd50369bc5d37476"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaecfe0733c5634343143bf3e9f705880"><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880">NumberLevels</a> ()</td></tr>
<tr class="separator:aaecfe0733c5634343143bf3e9f705880"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cf2899c898a18ab3f2f2414fc94872e"><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a9cf2899c898a18ab3f2f2414fc94872e">MaxMemCompactionLevel</a> ()</td></tr>
<tr class="separator:a9cf2899c898a18ab3f2f2414fc94872e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28a74ad04d23968571f1da281e4a6fa7"><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a28a74ad04d23968571f1da281e4a6fa7">Level0StopWriteTrigger</a> ()</td></tr>
<tr class="separator:a28a74ad04d23968571f1da281e4a6fa7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf39022d45b559b69933cfe719571c10"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aaf39022d45b559b69933cfe719571c10">Flush</a> (const <a class="el" href="../../d8/dd2/a00565.html">FlushOptions</a> &amp;options)</td></tr>
<tr class="separator:aaf39022d45b559b69933cfe719571c10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52e50f163faaf106e39a7b004a457ec4"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a52e50f163faaf106e39a7b004a457ec4">DisableFileDeletions</a> ()</td></tr>
<tr class="separator:a52e50f163faaf106e39a7b004a457ec4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f6c0d55ec4f04c4b5f736f59fa51d4d"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a2f6c0d55ec4f04c4b5f736f59fa51d4d">EnableFileDeletions</a> ()</td></tr>
<tr class="separator:a2f6c0d55ec4f04c4b5f736f59fa51d4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa4a148182ce98c83d363817e938ddd5"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aaa4a148182ce98c83d363817e938ddd5">GetLiveFiles</a> (std::vector&lt; std::string &gt; &amp;, <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> *manifest_file_size, bool flush_memtable=true)</td></tr>
<tr class="separator:aaa4a148182ce98c83d363817e938ddd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa24437e34cff2bc2607adf5a382efe80"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aa24437e34cff2bc2607adf5a382efe80">GetSortedWalFiles</a> (<a class="el" href="../../d4/d87/a03436.html#aaaf0d0ee1eb6c730ee241e600b26f980">VectorLogPtr</a> &amp;files)</td></tr>
<tr class="separator:aa24437e34cff2bc2607adf5a382efe80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af639734e3275f01b80d8ef8702450dfe"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#af639734e3275f01b80d8ef8702450dfe">GetLatestSequenceNumber</a> () const </td></tr>
<tr class="separator:af639734e3275f01b80d8ef8702450dfe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefb7a749f364c505a5a6b06d977cbc71"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aefb7a749f364c505a5a6b06d977cbc71">GetUpdatesSince</a> (<a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> seq_number, unique_ptr&lt; <a class="el" href="../../db/dbe/a01706.html">TransactionLogIterator</a> &gt; *iter)</td></tr>
<tr class="separator:aefb7a749f364c505a5a6b06d977cbc71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a993778aa65fb4553d1c10eb4604bb0fb"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb">DeleteFile</a> (std::string <a class="el" href="../../dc/d40/a02767.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr class="separator:a993778aa65fb4553d1c10eb4604bb0fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2042e7d897313b6299bbab78267fdd09"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a2042e7d897313b6299bbab78267fdd09">GetLiveFilesMetaData</a> (std::vector&lt; <a class="el" href="../../d2/dab/a00886.html">LiveFileMetaData</a> &gt; *metadata)</td></tr>
<tr class="separator:a2042e7d897313b6299bbab78267fdd09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae97e90f1166836da10d3f5d48be25f1e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e">TEST_CompactRange</a> (int level, const <a class="el" href="../../de/daf/a01417.html">Slice</a> *begin, const <a class="el" href="../../de/daf/a01417.html">Slice</a> *end)</td></tr>
<tr class="separator:ae97e90f1166836da10d3f5d48be25f1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a789ea69cfa7ee4fccf934757a4641228"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a789ea69cfa7ee4fccf934757a4641228">TEST_FlushMemTable</a> ()</td></tr>
<tr class="separator:a789ea69cfa7ee4fccf934757a4641228"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a686cee90690cb59d1342551db012df"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a1a686cee90690cb59d1342551db012df">TEST_WaitForFlushMemTable</a> ()</td></tr>
<tr class="separator:a1a686cee90690cb59d1342551db012df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7fa2399305a1c85baebcd08845421b3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ae7fa2399305a1c85baebcd08845421b3">TEST_WaitForCompact</a> ()</td></tr>
<tr class="separator:ae7fa2399305a1c85baebcd08845421b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9769b218862adb599d44cd43b19cd3f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/d02/a00777.html">Iterator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ae9769b218862adb599d44cd43b19cd3f">TEST_NewInternalIterator</a> ()</td></tr>
<tr class="separator:ae9769b218862adb599d44cd43b19cd3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d0bad830232c95a0ed926443e52d213"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a3d0bad830232c95a0ed926443e52d213">TEST_MaxNextLevelOverlappingBytes</a> ()</td></tr>
<tr class="separator:a3d0bad830232c95a0ed926443e52d213"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2870077d89d80a121ad4c84797d5994"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ac2870077d89d80a121ad4c84797d5994">TEST_Destroy_DBImpl</a> ()</td></tr>
<tr class="separator:ac2870077d89d80a121ad4c84797d5994"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4c810b1b069d14c725b0a153669eb46"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ae4c810b1b069d14c725b0a153669eb46">TEST_Current_Manifest_FileNo</a> ()</td></tr>
<tr class="separator:ae4c810b1b069d14c725b0a153669eb46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad62af2cf23b7a2da72715051e719e5f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ad62af2cf23b7a2da72715051e719e5f1">TEST_PurgeObsoleteteWAL</a> ()</td></tr>
<tr class="separator:ad62af2cf23b7a2da72715051e719e5f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d23756d9a9255dbdd0dec5ccf760315"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a0d23756d9a9255dbdd0dec5ccf760315">TEST_GetLevel0TotalSize</a> ()</td></tr>
<tr class="separator:a0d23756d9a9255dbdd0dec5ccf760315"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38ba419b53ed952418f318f46eeba2d0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a38ba419b53ed952418f318f46eeba2d0">TEST_SetDefaultTimeToCheck</a> (<a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> default_interval_to_delete_obsolete_WAL)</td></tr>
<tr class="separator:a38ba419b53ed952418f318f46eeba2d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3683f24e767a6e83d03acab509c64ba8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8">FindObsoleteFiles</a> (<a class="el" href="../../dd/dea/a00408.html">DeletionState</a> &amp;deletion_state, bool force, bool no_full_scan=false)</td></tr>
<tr class="separator:a3683f24e767a6e83d03acab509c64ba8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b3b0cce1e70a97d4d797ba7d5511dd5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5">PurgeObsoleteFiles</a> (<a class="el" href="../../dd/dea/a00408.html">DeletionState</a> &amp;deletion_state)</td></tr>
<tr class="separator:a9b3b0cce1e70a97d4d797ba7d5511dd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_a00380"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_a00380')"><img src="../../closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="../../d8/ddd/a00380.html">rocksdb::DB</a></td></tr>
<tr class="memitem:ae00d7f1a6ddc817c21c6b26b7326e461 inherit pub_methods_a00380"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/ddd/a00380.html#ae00d7f1a6ddc817c21c6b26b7326e461">DB</a> ()</td></tr>
<tr class="separator:ae00d7f1a6ddc817c21c6b26b7326e461 inherit pub_methods_a00380"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a081608a8ec479f77a2f3c9875bb55add inherit pub_methods_a00380"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/ddd/a00380.html#a081608a8ec479f77a2f3c9875bb55add">~DB</a> ()</td></tr>
<tr class="separator:a081608a8ec479f77a2f3c9875bb55add inherit pub_methods_a00380"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:aa6cba6e97343be3409f1ccaabfaa00c0"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../d0/d61/a00302.html">Comparator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0">user_comparator</a> () const </td></tr>
<tr class="separator:aa6cba6e97343be3409f1ccaabfaa00c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e2e51b73e463650be75ab726c67c3b4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/dcd/a00965.html">MemTable</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a2e2e51b73e463650be75ab726c67c3b4">GetMemTable</a> ()</td></tr>
<tr class="separator:a2e2e51b73e463650be75ab726c67c3b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b410d980071bc0ca4fd10b0156c2442"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/d02/a00777.html">Iterator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a4b410d980071bc0ca4fd10b0156c2442">NewInternalIterator</a> (const <a class="el" href="../../da/d3f/a01215.html">ReadOptions</a> &amp;, <a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> *latest_snapshot)</td></tr>
<tr class="separator:a4b410d980071bc0ca4fd10b0156c2442"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a421429fed52c239fa98fd79a7c0d0a1e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/db1/a00460.html">Env</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a></td></tr>
<tr class="separator:a421429fed52c239fa98fd79a7c0d0a1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aa55902220295b54840086d16d3db4b"><td class="memItemLeft" align="right" valign="top">const std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a></td></tr>
<tr class="separator:a6aa55902220295b54840086d16d3db4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75a26fad56e9d17743842ef2573eb6ef"><td class="memItemLeft" align="right" valign="top">unique_ptr&lt; <a class="el" href="../../d1/d42/a01800.html">VersionSet</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a></td></tr>
<tr class="separator:a75a26fad56e9d17743842ef2573eb6ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa92d556db5d7f5bc58f2531cd124729d"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../d0/d72/a00724.html">InternalKeyComparator</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aa92d556db5d7f5bc58f2531cd124729d">internal_comparator_</a></td></tr>
<tr class="separator:aa92d556db5d7f5bc58f2531cd124729d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d41b9e4cd6689ab16cc69a26a98c3bb"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../dd/d57/a01054.html">Options</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a></td></tr>
<tr class="separator:a0d41b9e4cd6689ab16cc69a26a98c3bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:adca3cc37d179c0402363d4cae6529d72"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#adca3cc37d179c0402363d4cae6529d72">NewDB</a> ()</td></tr>
<tr class="separator:adca3cc37d179c0402363d4cae6529d72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe079cf353957e6c79ed794cbc0bb9fc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#afe079cf353957e6c79ed794cbc0bb9fc">Recover</a> (<a class="el" href="../../d2/d86/a01798.html">VersionEdit</a> *edit, <a class="el" href="../../d3/dcd/a00965.html">MemTable</a> *external_table=nullptr, bool error_if_log_file_exist=false)</td></tr>
<tr class="separator:afe079cf353957e6c79ed794cbc0bb9fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a933c2a47a906fd7bcfdc3bfe77c9ea6e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a933c2a47a906fd7bcfdc3bfe77c9ea6e">MaybeIgnoreError</a> (<a class="el" href="../../d0/db9/a01552.html">Status</a> *s) const </td></tr>
<tr class="separator:a933c2a47a906fd7bcfdc3bfe77c9ea6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acef475ae9fa32c7caf0ba839f056d89c"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#acef475ae9fa32c7caf0ba839f056d89c">CreateArchivalDirectory</a> ()</td></tr>
<tr class="separator:acef475ae9fa32c7caf0ba839f056d89c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4406b5ed5487f7562bd0fe1696c6092f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a4406b5ed5487f7562bd0fe1696c6092f">DeleteObsoleteFiles</a> ()</td></tr>
<tr class="separator:a4406b5ed5487f7562bd0fe1696c6092f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f1443d5437c4f0e98d7b0eb2839ef2e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e">FlushMemTableToOutputFile</a> (bool *madeProgress, <a class="el" href="../../dd/dea/a00408.html">DeletionState</a> &amp;deletion_state)</td></tr>
<tr class="separator:a3f1443d5437c4f0e98d7b0eb2839ef2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb8cf2e0f98f8368db32bea16bcf3cb7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#adb8cf2e0f98f8368db32bea16bcf3cb7">RecoverLogFile</a> (<a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> log_number, <a class="el" href="../../d2/d86/a01798.html">VersionEdit</a> *edit, <a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> *<a class="el" href="../../de/d94/a02597.html#a52c1b794512261f530db50c720acb0c4">max_sequence</a>, <a class="el" href="../../d3/dcd/a00965.html">MemTable</a> *external_table)</td></tr>
<tr class="separator:adb8cf2e0f98f8368db32bea16bcf3cb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9408ef3bd3f2ad6fb684bc688737c70b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a9408ef3bd3f2ad6fb684bc688737c70b">WriteLevel0TableForRecovery</a> (<a class="el" href="../../d3/dcd/a00965.html">MemTable</a> *<a class="el" href="../../db/d44/a02564.html#a0d98018e8146e811f356fa860a9839a0">mem</a>, <a class="el" href="../../d2/d86/a01798.html">VersionEdit</a> *edit)</td></tr>
<tr class="separator:a9408ef3bd3f2ad6fb684bc688737c70b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3d320a145d5d36cb2bbf9e57b39ae8a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ac3d320a145d5d36cb2bbf9e57b39ae8a">WriteLevel0Table</a> (std::vector&lt; <a class="el" href="../../d3/dcd/a00965.html">MemTable</a> * &gt; &amp;mems, <a class="el" href="../../d2/d86/a01798.html">VersionEdit</a> *edit, <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> *filenumber)</td></tr>
<tr class="separator:ac3d320a145d5d36cb2bbf9e57b39ae8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bd51a8c14d950ad017734df3a7b851c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a4bd51a8c14d950ad017734df3a7b851c">SlowdownAmount</a> (int n, int top, int bottom)</td></tr>
<tr class="separator:a4bd51a8c14d950ad017734df3a7b851c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa86eaccec6e3d9e5146c13ca31b2918f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f">MakeRoomForWrite</a> (bool force)</td></tr>
<tr class="separator:aa86eaccec6e3d9e5146c13ca31b2918f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbfdfdd72e490648da9f229fdcd06337"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/dbd/a01844.html">WriteBatch</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#acbfdfdd72e490648da9f229fdcd06337">BuildBatchGroup</a> (<a class="el" href="../../db/dd4/a01849.html">Writer</a> **last_writer)</td></tr>
<tr class="separator:acbfdfdd72e490648da9f229fdcd06337"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad14868938ccf999100f441fcd9aa7c28"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28">FlushMemTable</a> (const <a class="el" href="../../d8/dd2/a00565.html">FlushOptions</a> &amp;options)</td></tr>
<tr class="separator:ad14868938ccf999100f441fcd9aa7c28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1db8d713be426c044273b2fa01c75c08"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a1db8d713be426c044273b2fa01c75c08">WaitForFlushMemTable</a> ()</td></tr>
<tr class="separator:a1db8d713be426c044273b2fa01c75c08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ab5900a7770dcb2a687bfd41269f2df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df">MaybeScheduleLogDBDeployStats</a> ()</td></tr>
<tr class="separator:a4ab5900a7770dcb2a687bfd41269f2df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ce77d938c703a205124f8ef0cd6156c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a5ce77d938c703a205124f8ef0cd6156c">LogDBDeployStats</a> ()</td></tr>
<tr class="separator:a5ce77d938c703a205124f8ef0cd6156c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f3ccd58266e8fd7a1b513ebef01928a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a">MaybeScheduleFlushOrCompaction</a> ()</td></tr>
<tr class="separator:a6f3ccd58266e8fd7a1b513ebef01928a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af25ba1d8b183fb12968ebb12ae28de91"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91">BackgroundCallCompaction</a> ()</td></tr>
<tr class="separator:af25ba1d8b183fb12968ebb12ae28de91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af70abfde15bcbcb869e36a51460def59"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59">BackgroundCallFlush</a> ()</td></tr>
<tr class="separator:af70abfde15bcbcb869e36a51460def59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c7b18fec45d2a89a72902476d846566"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566">BackgroundCompaction</a> (bool *madeProgress, <a class="el" href="../../dd/dea/a00408.html">DeletionState</a> &amp;deletion_state)</td></tr>
<tr class="separator:a5c7b18fec45d2a89a72902476d846566"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a497121b80918b7283fae65d8bfe01fc4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4">BackgroundFlush</a> (bool *madeProgress, <a class="el" href="../../dd/dea/a00408.html">DeletionState</a> &amp;deletion_state)</td></tr>
<tr class="separator:a497121b80918b7283fae65d8bfe01fc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d04c5afc2255f2160046afed2398cbd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a0d04c5afc2255f2160046afed2398cbd">CleanupCompaction</a> (<a class="el" href="../../df/d95/a00299.html">CompactionState</a> *compact, <a class="el" href="../../d0/db9/a01552.html">Status</a> status)</td></tr>
<tr class="separator:a0d04c5afc2255f2160046afed2398cbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a118052cb7b51c90604865d226452918b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b">DoCompactionWork</a> (<a class="el" href="../../df/d95/a00299.html">CompactionState</a> *compact, <a class="el" href="../../dd/dea/a00408.html">DeletionState</a> &amp;deletion_state)</td></tr>
<tr class="separator:a118052cb7b51c90604865d226452918b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9b32f2f68613634aaf0252e1fb143d2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#af9b32f2f68613634aaf0252e1fb143d2">OpenCompactionOutputFile</a> (<a class="el" href="../../df/d95/a00299.html">CompactionState</a> *compact)</td></tr>
<tr class="separator:af9b32f2f68613634aaf0252e1fb143d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab378543940b68e279594acd5af9ef594"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ab378543940b68e279594acd5af9ef594">FinishCompactionOutputFile</a> (<a class="el" href="../../df/d95/a00299.html">CompactionState</a> *compact, <a class="el" href="../../d2/d02/a00777.html">Iterator</a> *input)</td></tr>
<tr class="separator:ab378543940b68e279594acd5af9ef594"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adffcba2faee783d86cfa72adbdcb10f0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#adffcba2faee783d86cfa72adbdcb10f0">InstallCompactionResults</a> (<a class="el" href="../../df/d95/a00299.html">CompactionState</a> *compact)</td></tr>
<tr class="separator:adffcba2faee783d86cfa72adbdcb10f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4a580611125396a6e0072010fced806"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aa4a580611125396a6e0072010fced806">AllocateCompactionOutputFileNumbers</a> (<a class="el" href="../../df/d95/a00299.html">CompactionState</a> *compact)</td></tr>
<tr class="separator:aa4a580611125396a6e0072010fced806"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1a3a12c1f9b394536a0375966d4c65f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ab1a3a12c1f9b394536a0375966d4c65f">ReleaseCompactionUnusedFileNumbers</a> (<a class="el" href="../../df/d95/a00299.html">CompactionState</a> *compact)</td></tr>
<tr class="separator:ab1a3a12c1f9b394536a0375966d4c65f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c148333899c4965e7f0c90bce0abd46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46">PurgeObsoleteWALFiles</a> ()</td></tr>
<tr class="separator:a7c148333899c4965e7f0c90bce0abd46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a663aa80742985c3054c1962a94be6267"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267">AppendSortedWalsOfType</a> (const std::string &amp;path, <a class="el" href="../../d4/d87/a03436.html#aaaf0d0ee1eb6c730ee241e600b26f980">VectorLogPtr</a> &amp;log_files, <a class="el" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073d">WalFileType</a> type)</td></tr>
<tr class="separator:a663aa80742985c3054c1962a94be6267"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb375cca04c4521fd39126db3ffcf9e9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#acb375cca04c4521fd39126db3ffcf9e9">RetainProbableWalFiles</a> (<a class="el" href="../../d4/d87/a03436.html#aaaf0d0ee1eb6c730ee241e600b26f980">VectorLogPtr</a> &amp;all_logs, const <a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> target)</td></tr>
<tr class="separator:acb375cca04c4521fd39126db3ffcf9e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26b3cfbce68c226c861cfacd4a111fe1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a26b3cfbce68c226c861cfacd4a111fe1">CheckWalFileExistsAndEmpty</a> (const <a class="el" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073d">WalFileType</a> type, const <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> number)</td></tr>
<tr class="separator:a26b3cfbce68c226c861cfacd4a111fe1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58d2431c9ec2de7473a8bc2f171c04b8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a58d2431c9ec2de7473a8bc2f171c04b8">ReadFirstRecord</a> (const <a class="el" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073d">WalFileType</a> type, const <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> number, <a class="el" href="../../d2/dbd/a01844.html">WriteBatch</a> *const result)</td></tr>
<tr class="separator:a58d2431c9ec2de7473a8bc2f171c04b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a0816871126bc130e6e4f3ad8f81da8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8">ReadFirstLine</a> (const std::string &amp;fname, <a class="el" href="../../d2/dbd/a01844.html">WriteBatch</a> *const batch)</td></tr>
<tr class="separator:a8a0816871126bc130e6e4f3ad8f81da8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa52b644196bb47c051055a7a9a827fcd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aa52b644196bb47c051055a7a9a827fcd">PrintStatistics</a> ()</td></tr>
<tr class="separator:aa52b644196bb47c051055a7a9a827fcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ca9562b2a7a0a8e0645db22648a2ac5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a9ca9562b2a7a0a8e0645db22648a2ac5">MaybeDumpStats</a> ()</td></tr>
<tr class="separator:a9ca9562b2a7a0a8e0645db22648a2ac5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7c2980d0da47c4557512b51231ca07c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ab7c2980d0da47c4557512b51231ca07c">FindMinimumEmptyLevelFitting</a> (int level)</td></tr>
<tr class="separator:ab7c2980d0da47c4557512b51231ca07c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a889fc527654cd063029f570c18173834"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a889fc527654cd063029f570c18173834">ReFitLevel</a> (int level, int target_level=-1)</td></tr>
<tr class="separator:a889fc527654cd063029f570c18173834"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af426d859acf9ebfa5cc1e5d2c394ac91"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#af426d859acf9ebfa5cc1e5d2c394ac91">DBImpl</a> (const <a class="el" href="../../dd/df5/a00386.html">DBImpl</a> &amp;)</td></tr>
<tr class="separator:af426d859acf9ebfa5cc1e5d2c394ac91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7de98af70f00c70c1b81bedd7fc02716"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a7de98af70f00c70c1b81bedd7fc02716">operator=</a> (const <a class="el" href="../../dd/df5/a00386.html">DBImpl</a> &amp;)</td></tr>
<tr class="separator:a7de98af70f00c70c1b81bedd7fc02716"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24b1211b5a5fbfccfe0818c32753ff5f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a24b1211b5a5fbfccfe0818c32753ff5f">DelayLoggingAndReset</a> ()</td></tr>
<tr class="separator:a24b1211b5a5fbfccfe0818c32753ff5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb1d7919e60faa30ad63a70ce932e109"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aeb1d7919e60faa30ad63a70ce932e109">findEarliestVisibleSnapshot</a> (<a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> in, std::vector&lt; <a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> &gt; &amp;snapshots, <a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> *prev_snapshot)</td></tr>
<tr class="separator:aeb1d7919e60faa30ad63a70ce932e109"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcef1eaa87f194ee6689e465e15801ed"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed">GetImpl</a> (const <a class="el" href="../../da/d3f/a01215.html">ReadOptions</a> &amp;options, const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;key, std::string *<a class="el" href="../../d5/d95/a02720.html#a0f61d63b009d0880a89c843bd50d8d76">value</a>, bool *<a class="el" href="../../d6/dfc/a02612.html#a087d12026d35e2170481e0128071e9e0">value_found</a>=nullptr)</td></tr>
<tr class="separator:afcef1eaa87f194ee6689e465e15801ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:a3b86ec3494acbb6dbb8f2fdace967183"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a3b86ec3494acbb6dbb8f2fdace967183">BGLogDBDeployStats</a> (void *<a class="el" href="../../db/d44/a02564.html#a22e641d23ca36f47aa7b2b551bec1dc6">db</a>)</td></tr>
<tr class="separator:a3b86ec3494acbb6dbb8f2fdace967183"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f92fd02fffbe404bbdffc1bd24195d7"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7">BGWorkCompaction</a> (void *<a class="el" href="../../db/d44/a02564.html#a22e641d23ca36f47aa7b2b551bec1dc6">db</a>)</td></tr>
<tr class="separator:a0f92fd02fffbe404bbdffc1bd24195d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f35702e61b4f7ec3eb12e91432dca47"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47">BGWorkFlush</a> (void *<a class="el" href="../../db/d44/a02564.html#a22e641d23ca36f47aa7b2b551bec1dc6">db</a>)</td></tr>
<tr class="separator:a7f35702e61b4f7ec3eb12e91432dca47"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:af40cab146546ef65dfc86414e3f3ec1e"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../db/d7c/a00722.html">InternalFilterPolicy</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#af40cab146546ef65dfc86414e3f3ec1e">internal_filter_policy_</a></td></tr>
<tr class="separator:af40cab146546ef65dfc86414e3f3ec1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77159fede5375d22613591e9b724e3eb"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a77159fede5375d22613591e9b724e3eb">owns_info_log_</a></td></tr>
<tr class="separator:a77159fede5375d22613591e9b724e3eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b44e75ddaf3ea3befcd06b23ca9abb6"><td class="memItemLeft" align="right" valign="top">unique_ptr&lt; <a class="el" href="../../de/df9/a01624.html">TableCache</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a1b44e75ddaf3ea3befcd06b23ca9abb6">table_cache_</a></td></tr>
<tr class="separator:a1b44e75ddaf3ea3befcd06b23ca9abb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a178d9c0a3dc95d6e5e1a0485bdeb8bc9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d72/a00541.html">FileLock</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a178d9c0a3dc95d6e5e1a0485bdeb8bc9">db_lock_</a></td></tr>
<tr class="separator:a178d9c0a3dc95d6e5e1a0485bdeb8bc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cb19b8bd2dd10018827bfdc4094505e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d9a/a00998.html">port::Mutex</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a></td></tr>
<tr class="separator:a4cb19b8bd2dd10018827bfdc4094505e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa30ff424691deb3432441334d3adb3cf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/d76/a00134.html">port::AtomicPointer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aa30ff424691deb3432441334d3adb3cf">shutting_down_</a></td></tr>
<tr class="separator:aa30ff424691deb3432441334d3adb3cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f7627f46f001610ad9241e9741cd00a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d39/a00314.html">port::CondVar</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a></td></tr>
<tr class="separator:a4f7627f46f001610ad9241e9741cd00a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6372d47ec4455946aa5754c002a4fbf0"><td class="memItemLeft" align="right" valign="top">std::shared_ptr<br class="typebreak"/>
&lt; <a class="el" href="../../d0/daf/a00970.html">MemTableRepFactory</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a6372d47ec4455946aa5754c002a4fbf0">mem_rep_factory_</a></td></tr>
<tr class="separator:a6372d47ec4455946aa5754c002a4fbf0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa363f82be90e7c8172d31ba1209e6574"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/dcd/a00965.html">MemTable</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a></td></tr>
<tr class="separator:aa363f82be90e7c8172d31ba1209e6574"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57a62c80616f5fa0f568a36367c85466"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d7/dd4/a00968.html">MemTableList</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a></td></tr>
<tr class="separator:a57a62c80616f5fa0f568a36367c85466"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39586d8f5ff2cd8c0d99d96763b8ccc6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a39586d8f5ff2cd8c0d99d96763b8ccc6">logfile_number_</a></td></tr>
<tr class="separator:a39586d8f5ff2cd8c0d99d96763b8ccc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0801eebdc654c9987f70ba512e9c45f4"><td class="memItemLeft" align="right" valign="top">unique_ptr&lt; <a class="el" href="../../da/d18/a01850.html">log::Writer</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a0801eebdc654c9987f70ba512e9c45f4">log_</a></td></tr>
<tr class="separator:a0801eebdc654c9987f70ba512e9c45f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a851172acb183ae096ea0a767407d421c"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a851172acb183ae096ea0a767407d421c">host_name_</a></td></tr>
<tr class="separator:a851172acb183ae096ea0a767407d421c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d3abc2f19390f60d4a922b98dd23450"><td class="memItemLeft" align="right" valign="top">std::deque&lt; <a class="el" href="../../db/dd4/a01849.html">Writer</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a2d3abc2f19390f60d4a922b98dd23450">writers_</a></td></tr>
<tr class="separator:a2d3abc2f19390f60d4a922b98dd23450"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adac005f654a15bf772dbd40a06ea2762"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/dbd/a01844.html">WriteBatch</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#adac005f654a15bf772dbd40a06ea2762">tmp_batch_</a></td></tr>
<tr class="separator:adac005f654a15bf772dbd40a06ea2762"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bf69eb135ada49bd652b4421ccc14af"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dc/de6/a01426.html">SnapshotList</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a6bf69eb135ada49bd652b4421ccc14af">snapshots_</a></td></tr>
<tr class="separator:a6bf69eb135ada49bd652b4421ccc14af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a62212922480c1ca92b25a555b3410e"><td class="memItemLeft" align="right" valign="top">std::set&lt; <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a1a62212922480c1ca92b25a555b3410e">pending_outputs_</a></td></tr>
<tr class="separator:a1a62212922480c1ca92b25a555b3410e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ab341ae7c6562bb9b1864963181c48a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a></td></tr>
<tr class="separator:a9ab341ae7c6562bb9b1864963181c48a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca89b02f26787b31bba9a8690b4be42d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aca89b02f26787b31bba9a8690b4be42d">bg_flush_scheduled_</a></td></tr>
<tr class="separator:aca89b02f26787b31bba9a8690b4be42d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab308f5a73496bf663add416d38b1eb3b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ab308f5a73496bf663add416d38b1eb3b">bg_logstats_scheduled_</a></td></tr>
<tr class="separator:ab308f5a73496bf663add416d38b1eb3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8d415c46a300bbfcaaa95e812a51179"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/d12/a00942.html">ManualCompaction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ab8d415c46a300bbfcaaa95e812a51179">manual_compaction_</a></td></tr>
<tr class="separator:ab8d415c46a300bbfcaaa95e812a51179"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79aec493ad501d3e044e08f610591926"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a79aec493ad501d3e044e08f610591926">bg_error_</a></td></tr>
<tr class="separator:a79aec493ad501d3e044e08f610591926"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8170a5a4d3a3f498851720b843b48f9f"><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; <a class="el" href="../../d8/daf/a01550.html">StatsLogger</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a8170a5a4d3a3f498851720b843b48f9f">logger_</a></td></tr>
<tr class="separator:a8170a5a4d3a3f498851720b843b48f9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44c1ebfd047bdb17d99296bb152bac93"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> volatile&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a44c1ebfd047bdb17d99296bb152bac93">last_log_ts</a></td></tr>
<tr class="separator:a44c1ebfd047bdb17d99296bb152bac93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3573b1eae3665c2cc757b8c396622b17"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a3573b1eae3665c2cc757b8c396622b17">disable_delete_obsolete_files_</a></td></tr>
<tr class="separator:a3573b1eae3665c2cc757b8c396622b17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c7bbb1d0ce162afbd075c1dcd4fa74f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a1c7bbb1d0ce162afbd075c1dcd4fa74f">delete_obsolete_files_last_run_</a></td></tr>
<tr class="separator:a1c7bbb1d0ce162afbd075c1dcd4fa74f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa753be868ff8a4028802e24903106836"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aa753be868ff8a4028802e24903106836">purge_wal_files_last_run_</a></td></tr>
<tr class="separator:aa753be868ff8a4028802e24903106836"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07c615f6afce7171a2d78fe7d9813f31"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a07c615f6afce7171a2d78fe7d9813f31">last_stats_dump_time_microsec_</a></td></tr>
<tr class="separator:a07c615f6afce7171a2d78fe7d9813f31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac49af7a9a13d9dc7a31f0d406e44f257"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ac49af7a9a13d9dc7a31f0d406e44f257">default_interval_to_delete_obsolete_WAL_</a></td></tr>
<tr class="separator:ac49af7a9a13d9dc7a31f0d406e44f257"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b4aea06a6f9f09239f48143743bbdd8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a9b4aea06a6f9f09239f48143743bbdd8">stall_level0_slowdown_</a></td></tr>
<tr class="separator:a9b4aea06a6f9f09239f48143743bbdd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a3ca004233cdbcb55f6f30069dbfcf9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a8a3ca004233cdbcb55f6f30069dbfcf9">stall_memtable_compaction_</a></td></tr>
<tr class="separator:a8a3ca004233cdbcb55f6f30069dbfcf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a182e2795f3be1489a771f3ddedce61b5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a182e2795f3be1489a771f3ddedce61b5">stall_level0_num_files_</a></td></tr>
<tr class="separator:a182e2795f3be1489a771f3ddedce61b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad16938a69629762e5dc6be3578fba857"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ad16938a69629762e5dc6be3578fba857">stall_leveln_slowdown_</a></td></tr>
<tr class="separator:ad16938a69629762e5dc6be3578fba857"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bb02fe37022bebc791fedd92c78ed9b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a1bb02fe37022bebc791fedd92c78ed9b">stall_level0_slowdown_count_</a></td></tr>
<tr class="separator:a1bb02fe37022bebc791fedd92c78ed9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44d8fc4443a936952c054b78675d5f1a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a44d8fc4443a936952c054b78675d5f1a">stall_memtable_compaction_count_</a></td></tr>
<tr class="separator:a44d8fc4443a936952c054b78675d5f1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50104c0514607e212a634b2992deee15"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a50104c0514607e212a634b2992deee15">stall_level0_num_files_count_</a></td></tr>
<tr class="separator:a50104c0514607e212a634b2992deee15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35f210903f860d88d3ec82ae93e043c3"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a35f210903f860d88d3ec82ae93e043c3">stall_leveln_slowdown_count_</a></td></tr>
<tr class="separator:a35f210903f860d88d3ec82ae93e043c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25b665f7651c915e7f8f0404dd9dc0d4"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a25b665f7651c915e7f8f0404dd9dc0d4">started_at_</a></td></tr>
<tr class="separator:a25b665f7651c915e7f8f0404dd9dc0d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a917f2b90eead9ad2465a74dc1d9f52d6"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a917f2b90eead9ad2465a74dc1d9f52d6">flush_on_destroy_</a></td></tr>
<tr class="separator:a917f2b90eead9ad2465a74dc1d9f52d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13c28a94505e5bd8600e110755429192"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="../../db/da2/a00300.html">CompactionStats</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a></td></tr>
<tr class="separator:a13c28a94505e5bd8600e110755429192"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef63a9eac507c09f6105dfc1ca85a25d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d5/df4/a01551.html">StatsSnapshot</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#aef63a9eac507c09f6105dfc1ca85a25d">last_stats_</a></td></tr>
<tr class="separator:aef63a9eac507c09f6105dfc1ca85a25d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac70f13459b5221663e10f148dc876f42"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ac70f13459b5221663e10f148dc876f42">db_absolute_path_</a></td></tr>
<tr class="separator:ac70f13459b5221663e10f148dc876f42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ac5de89c53f110bb27112295ea2314d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a7ac5de89c53f110bb27112295ea2314d">delayed_writes_</a></td></tr>
<tr class="separator:a7ac5de89c53f110bb27112295ea2314d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab30f83ba6f1f9323bbe1c12ba03840e8"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../d5/d5f/a00461.html">EnvOptions</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a></td></tr>
<tr class="separator:ab30f83ba6f1f9323bbe1c12ba03840e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64f1e254c5aaa8e73231273933cdeef6"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#a64f1e254c5aaa8e73231273933cdeef6">bg_work_gate_closed_</a></td></tr>
<tr class="separator:a64f1e254c5aaa8e73231273933cdeef6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9cf2e8b889d360238e31db0232d1595"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#af9cf2e8b889d360238e31db0232d1595">refitting_level_</a></td></tr>
<tr class="separator:af9cf2e8b889d360238e31db0232d1595"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:ab82cb85ced089ba044749b72f13054f3"><td class="memItemLeft" align="right" valign="top">static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ab82cb85ced089ba044749b72f13054f3">KEEP_LOG_FILE_NUM</a> = 1000</td></tr>
<tr class="separator:ab82cb85ced089ba044749b72f13054f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:ad22eb7a23cbf34de526efa966c578d4a"><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/df5/a00386.html#ad22eb7a23cbf34de526efa966c578d4a">DB</a></td></tr>
<tr class="separator:ad22eb7a23cbf34de526efa966c578d4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pub_static_methods_a00380"><td colspan="2" onclick="javascript:toggleInherit('pub_static_methods_a00380')"><img src="../../closed.png" alt="-"/>&#160;Static Public Member Functions inherited from <a class="el" href="../../d8/ddd/a00380.html">rocksdb::DB</a></td></tr>
<tr class="memitem:a898ece06bdc8a5ec59e5996a01f2650d inherit pub_static_methods_a00380"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d">Open</a> (const <a class="el" href="../../dd/d57/a01054.html">Options</a> &amp;options, const std::string &amp;<a class="el" href="../../dc/d40/a02767.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="el" href="../../d8/ddd/a00380.html">DB</a> **dbptr)</td></tr>
<tr class="separator:a898ece06bdc8a5ec59e5996a01f2650d inherit pub_static_methods_a00380"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c34ae639e95ce237f939d185a09c04b inherit pub_static_methods_a00380"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/ddd/a00380.html#a2c34ae639e95ce237f939d185a09c04b">OpenForReadOnly</a> (const <a class="el" href="../../dd/d57/a01054.html">Options</a> &amp;options, const std::string &amp;<a class="el" href="../../dc/d40/a02767.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="el" href="../../d8/ddd/a00380.html">DB</a> **dbptr, bool error_if_log_file_exist=false)</td></tr>
<tr class="separator:a2c34ae639e95ce237f939d185a09c04b inherit pub_static_methods_a00380"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00034">34</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a23ac2b183dd4ff1459cfa34bd17b065e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rocksdb::DBImpl::DBImpl </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../dd/d57/a01054.html">Options</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>dbname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00226">226</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00445">db_absolute_path_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00176">dbname_</a>, <a class="el" href="../../df/d23/a02751_source.html#l00113">rocksdb::Options::Dump()</a>, <a class="el" href="../../d4/d87/a03436.html#a819fdb510440c431da3c97a742f19914">rocksdb::dumpLeveldbBuildVersion()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/db1/a00460.html#a85e9d22dff053a1ada591614b4ae2994">rocksdb::Env::GetAbsolutePath()</a>, <a class="el" href="../../db/db1/a00460.html#a6ee02c3a73c1a5f17a8bf197ffb1a0dd">rocksdb::Env::GetHostName()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00316">host_name_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00178">internal_comparator_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00353">last_log_ts</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00174">rocksdb::Options::max_open_files</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00311">mem_</a>, <a class="el" href="../../d8/d24/a02001_source.html#l00405">name</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00268">rocksdb::Options::num_levels</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00043">rocksdb::MemTable::Ref()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00375">stall_leveln_slowdown_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00379">stall_leveln_slowdown_count_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00451">storage_options_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00301">table_cache_</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    : <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>(options.env),</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>(<a class="code" href="../../d1/d03/a02560.html#a75d845559336df6843f3b599960f89d2">dbname</a>),</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#aa92d556db5d7f5bc58f2531cd124729d">internal_comparator_</a>(options.comparator),</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>(<a class="code" href="../../d4/d87/a03436.html#abff772f829522cce816cd5540350b445">SanitizeOptions</a>(</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;          <a class="code" href="../../d1/d03/a02560.html#a75d845559336df6843f3b599960f89d2">dbname</a>, &amp;<a class="code" href="../../dd/df5/a00386.html#aa92d556db5d7f5bc58f2531cd124729d">internal_comparator_</a>, &amp;<a class="code" href="../../dd/df5/a00386.html#af40cab146546ef65dfc86414e3f3ec1e">internal_filter_policy_</a>, options)),</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#af40cab146546ef65dfc86414e3f3ec1e">internal_filter_policy_</a>(options.filter_policy),</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a77159fede5375d22613591e9b724e3eb">owns_info_log_</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a> != options.info_log),</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a178d9c0a3dc95d6e5e1a0485bdeb8bc9">db_lock_</a>(<span class="keyword">nullptr</span>),</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>(options.use_adaptive_mutex),</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#aa30ff424691deb3432441334d3adb3cf">shutting_down_</a>(<span class="keyword">nullptr</span>),</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>),</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a6372d47ec4455946aa5754c002a4fbf0">mem_rep_factory_</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a7287ce08385860bc847200b2c692b69d">memtable_factory</a>),</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>(<span class="keyword">new</span> MemTable(<a class="code" href="../../dd/df5/a00386.html#aa92d556db5d7f5bc58f2531cd124729d">internal_comparator_</a>, <a class="code" href="../../dd/df5/a00386.html#a6372d47ec4455946aa5754c002a4fbf0">mem_rep_factory_</a>,</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880">NumberLevels</a>(), <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>)),</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a39586d8f5ff2cd8c0d99d96763b8ccc6">logfile_number_</a>(0),</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#adac005f654a15bf772dbd40a06ea2762">tmp_batch_</a>(),</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a>(0),</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#aca89b02f26787b31bba9a8690b4be42d">bg_flush_scheduled_</a>(0),</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#ab308f5a73496bf663add416d38b1eb3b">bg_logstats_scheduled_</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#ab8d415c46a300bbfcaaa95e812a51179">manual_compaction_</a>(<span class="keyword">nullptr</span>),</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a8170a5a4d3a3f498851720b843b48f9f">logger_</a>(<span class="keyword">nullptr</span>),</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a3573b1eae3665c2cc757b8c396622b17">disable_delete_obsolete_files_</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a1c7bbb1d0ce162afbd075c1dcd4fa74f">delete_obsolete_files_last_run_</a>(options.env-&gt;NowMicros()),</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#aa753be868ff8a4028802e24903106836">purge_wal_files_last_run_</a>(0),</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a07c615f6afce7171a2d78fe7d9813f31">last_stats_dump_time_microsec_</a>(0),</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#ac49af7a9a13d9dc7a31f0d406e44f257">default_interval_to_delete_obsolete_WAL_</a>(600),</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a9b4aea06a6f9f09239f48143743bbdd8">stall_level0_slowdown_</a>(0),</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a8a3ca004233cdbcb55f6f30069dbfcf9">stall_memtable_compaction_</a>(0),</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a182e2795f3be1489a771f3ddedce61b5">stall_level0_num_files_</a>(0),</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a1bb02fe37022bebc791fedd92c78ed9b">stall_level0_slowdown_count_</a>(0),</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a44d8fc4443a936952c054b78675d5f1a">stall_memtable_compaction_count_</a>(0),</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a50104c0514607e212a634b2992deee15">stall_level0_num_files_count_</a>(0),</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a25b665f7651c915e7f8f0404dd9dc0d4">started_at_</a>(options.env-&gt;NowMicros()),</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a917f2b90eead9ad2465a74dc1d9f52d6">flush_on_destroy_</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>(options.num_levels),</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a7ac5de89c53f110bb27112295ea2314d">delayed_writes_</a>(0),</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>(options),</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a64f1e254c5aaa8e73231273933cdeef6">bg_work_gate_closed_</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#af9cf2e8b889d360238e31db0232d1595">refitting_level_</a>(<span class="keyword">false</span>) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>-&gt;<a class="code" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5">Ref</a>();</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a85e9d22dff053a1ada591614b4ae2994">GetAbsolutePath</a>(<a class="code" href="../../d1/d03/a02560.html#a75d845559336df6843f3b599960f89d2">dbname</a>, &amp;<a class="code" href="../../dd/df5/a00386.html#ac70f13459b5221663e10f148dc876f42">db_absolute_path_</a>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#ad16938a69629762e5dc6be3578fba857">stall_leveln_slowdown_</a>.resize(options.num_levels);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a35f210903f860d88d3ec82ae93e043c3">stall_leveln_slowdown_count_</a>.resize(options.num_levels);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; options.num_levels; ++i) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#ad16938a69629762e5dc6be3578fba857">stall_leveln_slowdown_</a>[i] = 0;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a35f210903f860d88d3ec82ae93e043c3">stall_leveln_slowdown_count_</a>[i] = 0;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="comment">// Reserve ten files or so for other uses and give the rest to TableCache.</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> table_cache_size = <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a1b67162c6c31c5ba5d3729514b47b678">max_open_files</a> - 10;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a1b44e75ddaf3ea3befcd06b23ca9abb6">table_cache_</a>.reset(<span class="keyword">new</span> TableCache(<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>, &amp;<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>,</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                    <a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>, table_cache_size));</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>.reset(<span class="keyword">new</span> VersionSet(<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>, &amp;<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>, <a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>,</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                 <a class="code" href="../../dd/df5/a00386.html#a1b44e75ddaf3ea3befcd06b23ca9abb6">table_cache_</a>.get(), &amp;<a class="code" href="../../dd/df5/a00386.html#aa92d556db5d7f5bc58f2531cd124729d">internal_comparator_</a>));</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="preprocessor">#ifdef ROCKSDB_LDB_BUILD_VERSION</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor"></span>  <a class="code" href="../../d4/d87/a03436.html#a819fdb510440c431da3c97a742f19914">dumpLeveldbBuildVersion</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>.get());</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#aa4c75549c37b3e7c4baedb8c718444e1">Dump</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>.get());</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="../../d8/d24/a02001.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>[100];</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> st = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a6ee02c3a73c1a5f17a8bf197ffb1a0dd">GetHostName</a>(name, 100L);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordflow">if</span> (st.ok()) {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a851172acb183ae096ea0a767407d421c">host_name_</a> = <a class="code" href="../../d8/d24/a02001.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Can&#39;t get hostname, use localhost as host name.&quot;</span>);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a851172acb183ae096ea0a767407d421c">host_name_</a> = <span class="stringliteral">&quot;localhost&quot;</span>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a44c1ebfd047bdb17d99296bb152bac93">last_log_ts</a> = 0;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a23ac2b183dd4ff1459cfa34bd17b065e_cgraph.png" border="0" usemap="#dd/df5/a00386_a23ac2b183dd4ff1459cfa34bd17b065e_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a23ac2b183dd4ff1459cfa34bd17b065e_cgraph" id="dd/df5/a00386_a23ac2b183dd4ff1459cfa34bd17b065e_cgraph">
<area shape="rect" id="node3" href="../../dd/d57/a01054.html#aa4c75549c37b3e7c4baedb8c718444e1" title="rocksdb::Options::Dump" alt="" coords="249,101,412,131"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="523,5,619,35"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#a819fdb510440c431da3c97a742f19914" title="rocksdb::dumpLeveldbBuild\lVersion" alt="" coords="240,154,421,201"/><area shape="rect" id="node17" href="../../db/db1/a00460.html#a85e9d22dff053a1ada591614b4ae2994" title="rocksdb::Env::GetAbsolutePath" alt="" coords="228,224,433,253"/><area shape="rect" id="node19" href="../../db/db1/a00460.html#a6ee02c3a73c1a5f17a8bf197ffb1a0dd" title="rocksdb::Env::GetHostName" alt="" coords="236,277,425,307"/><area shape="rect" id="node22" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="267,331,395,360"/><area shape="rect" id="node24" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="263,384,399,413"/><area shape="rect" id="node26" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="248,437,413,467"/><area shape="rect" id="node7" href="../../d0/d61/a00302.html#a3ef0d8f8f4fe04540c00cd4a9c9d5e84" title="rocksdb::Comparator\l::Name" alt="" coords="499,58,643,105"/><area shape="rect" id="node9" href="../../db/d7b/a00296.html#ad1494025487cde909a53510b94456d56" title="rocksdb::CompactionFilter\l::Name" alt="" coords="484,127,657,174"/><area shape="rect" id="node11" href="../../dd/de9/a00552.html#a51521763e767376e3325e5565a6f7bf6" title="rocksdb::FilterPolicy\l::Name" alt="" coords="500,197,641,243"/><area shape="rect" id="node13" href="../../d0/d7d/a01419.html#a608eaf184ca43376fe39aaad58c5d90c" title="rocksdb::SliceTransform\l::Name" alt="" coords="489,266,652,313"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9bdda420ec5d44390a04215d8b1cbffd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rocksdb::DBImpl::~DBImpl </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00305">305</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00329">bg_compaction_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00309">bg_cv_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00332">bg_flush_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00335">bg_logstats_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00304">db_lock_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00384">flush_on_destroy_</a>, <a class="el" href="../../db/d44/a02564_source.html#l01554">FlushMemTable()</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00110">rocksdb::MemTable::GetFirstSequenceNumber()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00312">imm_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00311">mem_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../de/d76/a00134.html#a30ba8a8f96b44b0802aee9bc9c16c58a">rocksdb::port::AtomicPointer::Release_Store()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00308">shutting_down_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, <a class="el" href="../../db/db1/a00460.html#a802631b298800f1ee47b75f3d8c9594d">rocksdb::Env::UnlockFile()</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00046">rocksdb::MemTable::Unref()</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00032">rocksdb::MemTableList::UnrefAll()</a>, and <a class="el" href="../../de/d7b/a02660_source.html#l00059">rocksdb::port::CondVar::Wait()</a>.</p>
<div class="fragment"><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="comment">// Wait for background work to finish</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a917f2b90eead9ad2465a74dc1d9f52d6">flush_on_destroy_</a> &amp;&amp; <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>-&gt;<a class="code" href="../../d3/dcd/a00965.html#aac4669a721ac40316118f847a3659b45">GetFirstSequenceNumber</a>() != 0) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28">FlushMemTable</a>(FlushOptions());</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#aa30ff424691deb3432441334d3adb3cf">shutting_down_</a>.<a class="code" href="../../de/d76/a00134.html#a30ba8a8f96b44b0802aee9bc9c16c58a">Release_Store</a>(<span class="keyword">this</span>);  <span class="comment">// Any non-nullptr value is ok</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> ||</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;         <a class="code" href="../../dd/df5/a00386.html#aca89b02f26787b31bba9a8690b4be42d">bg_flush_scheduled_</a> ||</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;         <a class="code" href="../../dd/df5/a00386.html#ab308f5a73496bf663add416d38b1eb3b">bg_logstats_scheduled_</a>) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36">Wait</a>();</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a178d9c0a3dc95d6e5e1a0485bdeb8bc9">db_lock_</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a802631b298800f1ee47b75f3d8c9594d">UnlockFile</a>(<a class="code" href="../../dd/df5/a00386.html#a178d9c0a3dc95d6e5e1a0485bdeb8bc9">db_lock_</a>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a> != <span class="keyword">nullptr</span>) <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>-&gt;<a class="code" href="../../d3/dcd/a00965.html#a35a338dd8c1096c850b1bdd3969aeee4">Unref</a>();</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#a2422dd76d6ba8c9b961eb4666ab8695f">UnrefAll</a>();</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a9bdda420ec5d44390a04215d8b1cbffd_cgraph.png" border="0" usemap="#dd/df5/a00386_a9bdda420ec5d44390a04215d8b1cbffd_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a9bdda420ec5d44390a04215d8b1cbffd_cgraph" id="dd/df5/a00386_a9bdda420ec5d44390a04215d8b1cbffd_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="235,203,424,250"/><area shape="rect" id="node7" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="964,127,1121,174"/><area shape="rect" id="node19" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="972,317,1113,363"/><area shape="rect" id="node30" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="972,58,1113,105"/><area shape="rect" id="node53" href="../../de/d76/a00134.html#a30ba8a8f96b44b0802aee9bc9c16c58a" title="rocksdb::port::AtomicPointer\l::Release_Store" alt="" coords="1212,1530,1399,1577"/><area shape="rect" id="node95" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="713,1735,841,1764"/><area shape="rect" id="node109" href="../../d3/dcd/a00965.html#aac4669a721ac40316118f847a3659b45" title="rocksdb::MemTable::\lGetFirstSequenceNumber" alt="" coords="243,1837,416,1883"/><area shape="rect" id="node115" href="../../db/db1/a00460.html#a802631b298800f1ee47b75f3d8c9594d" title="rocksdb::Env::UnlockFile" alt="" coords="245,1907,413,1936"/><area shape="rect" id="node117" href="../../d3/dcd/a00965.html#a35a338dd8c1096c850b1bdd3969aeee4" title="rocksdb::MemTable::\lUnref" alt="" coords="257,1959,401,2006"/><area shape="rect" id="node119" href="../../d7/dd4/a00968.html#a2422dd76d6ba8c9b961eb4666ab8695f" title="rocksdb::MemTableList\l::UnrefAll" alt="" coords="251,2029,408,2075"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="473,691,631,720"/><area shape="rect" id="node17" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="975,5,1111,35"/><area shape="rect" id="node104" href="../../dd/df5/a00386.html#a1db8d713be426c044273b2fa01c75c08" title="rocksdb::DBImpl::WaitFor\lFlushMemTable" alt="" coords="691,203,864,250"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="680,794,875,841"/><area shape="rect" id="node28" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="972,1485,1113,1515"/><area shape="rect" id="node67" href="../../dd/df5/a00386.html#acbfdfdd72e490648da9f229fdcd06337" title="rocksdb::DBImpl::BuildBatch\lGroup" alt="" coords="683,1614,872,1661"/><area shape="rect" id="node71" href="../../da/d8c/a01845.html#a04c6bd515d35bda6ffa8ae21ab1e1478" title="rocksdb::WriteBatchInternal\l::ByteSize" alt="" coords="951,1591,1135,1638"/><area shape="rect" id="node73" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="951,1783,1135,1830"/><area shape="rect" id="node78" href="../../da/d8c/a01845.html#a2c7f53a4c8d710fdbf229c917506f7ab" title="rocksdb::WriteBatchInternal\l::SetSequence" alt="" coords="685,914,869,961"/><area shape="rect" id="node85" href="../../d4/d87/a03436.html#a48457fd59325e708afa7fff617f87e05" title="rocksdb::StartPerfTimer" alt="" coords="697,1035,857,1064"/><area shape="rect" id="node87" href="../../da/d8c/a01845.html#af28dbb69a970e8ab218402339f0bb7ee" title="rocksdb::WriteBatchInternal\l::Contents" alt="" coords="685,1087,869,1134"/><area shape="rect" id="node89" href="../../d4/d87/a03436.html#af0bd42ecfc79c4765b60919d28702a29" title="rocksdb::BumpPerfTime" alt="" coords="696,397,859,427"/><area shape="rect" id="node91" href="../../da/d8c/a01845.html#aa10e1abb5f141e75e184bf456a5d65a6" title="rocksdb::WriteBatchInternal\l::InsertInto" alt="" coords="685,450,869,497"/><area shape="rect" id="node93" href="../../d4/d87/a03436.html#a9231fa7580b3932152d6f3bd39907320" title="rocksdb::SetTickerCount" alt="" coords="695,520,860,549"/><area shape="rect" id="node98" href="../../d2/dbd/a01844.html#a73502c77c1ebdf40417a34eb385e117e" title="rocksdb::WriteBatch\l::Clear" alt="" coords="707,623,848,670"/><area shape="rect" id="node100" href="../../d0/d39/a00314.html#a84d028d8d526b7ce592433ba836a1853" title="rocksdb::port::CondVar\l::Signal" alt="" coords="699,323,856,370"/><area shape="rect" id="node9" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1219,201,1392,231"/><area shape="rect" id="node13" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1235,1255,1376,1302"/><area shape="rect" id="node15" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="973,1031,1112,1078"/><area shape="rect" id="node22" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="923,1101,1163,1131"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#a4bd51a8c14d950ad017734df3a7b851c" title="rocksdb::DBImpl::Slowdown\lAmount" alt="" coords="949,1154,1136,1201"/><area shape="rect" id="node26" href="../../d8/d6c/a01563.html#a2265fb9a74a457ec56cc61f60ea5353e" title="rocksdb::StopWatch\l::ElapsedMicros" alt="" coords="972,1223,1113,1270"/><area shape="rect" id="node33" href="../../d3/dcd/a00965.html#a3232b72cba2586f3d6dbd08d8b4be86d" title="rocksdb::MemTable::\lApproximateMemoryUsage" alt="" coords="953,1293,1132,1339"/><area shape="rect" id="node35" href="../../dd/df5/a00386.html#a24b1211b5a5fbfccfe0818c32753ff5f" title="rocksdb::DBImpl::DelayLogging\lAndReset" alt="" coords="940,666,1145,713"/><area shape="rect" id="node37" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1257,645,1353,675"/><area shape="rect" id="node39" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="964,197,1121,243"/><area shape="rect" id="node43" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="1000,387,1085,416"/><area shape="rect" id="node45" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="941,440,1144,469"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="967,493,1119,523"/><area shape="rect" id="node49" href="../../d3/dcd/a00965.html#a08633ea1ccd8277c4bad90686e12e59d" title="rocksdb::MemTable::\lSetNextLogNumber" alt="" coords="971,546,1115,593"/><area shape="rect" id="node51" href="../../d7/dd4/a00968.html#a889613116ef509399ebb13a714e236d6" title="rocksdb::MemTableList::Add" alt="" coords="948,1432,1137,1461"/><area shape="rect" id="node55" href="../../d7/dd4/a00968.html#acd9439e034e085a62a05850d9ba39c7a" title="rocksdb::MemTableList\l::FlushRequested" alt="" coords="964,735,1121,782"/><area shape="rect" id="node57" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="937,805,1148,835"/><area shape="rect" id="node59" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="960,859,1125,888"/><area shape="rect" id="node61" href="../../d3/dcd/a00965.html#a81f80d2b6674d454e4b65f238281d716" title="rocksdb::MemTable::\lSetLogNumber" alt="" coords="971,911,1115,958"/><area shape="rect" id="node63" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="932,1362,1153,1409"/><area shape="rect" id="node69" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e" title="beast.util.Iter.first" alt="" coords="981,1661,1104,1691"/><area shape="rect" id="node75" href="../../da/d8c/a01845.html#a3e28aed1201077095cf66c5e242d1630" title="rocksdb::WriteBatchInternal\l::Append" alt="" coords="951,1714,1135,1761"/><area shape="rect" id="node80" href="../../d4/d87/a03436.html#a0a6b5f485f1b3d6f33ead2fc4d7c891c" title="rocksdb::EncodeFixed64" alt="" coords="960,1539,1125,1568"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af426d859acf9ebfa5cc1e5d2c394ac91"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rocksdb::DBImpl::DBImpl </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../dd/df5/a00386.html">DBImpl</a> &amp;&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="aa4a580611125396a6e0072010fced806"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::AllocateCompactionOutputFileNumbers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d95/a00299.html">CompactionState</a> *&#160;</td>
          <td class="paramname"><em>compact</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01887">1887</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l00091">rocksdb::DBImpl::CompactionState::allocated_file_numbers</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00095">rocksdb::DBImpl::CompactionState::builder</a>, <a class="el" href="../../db/d44/a02564_source.html#l00075">rocksdb::DBImpl::CompactionState::compaction</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00557">rocksdb::Compaction::num_input_files()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00326">pending_outputs_</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>.</p>
<div class="fragment"><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                                                                         {</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;  assert(compact != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;  assert(compact-&gt;builder == <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;  <span class="keywordtype">int</span> filesNeeded = compact-&gt;compaction-&gt;num_input_files(1);</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; filesNeeded; i++) {</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> file_number = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NewFileNumber();</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a1a62212922480c1ca92b25a555b3410e">pending_outputs_</a>.insert(file_number);</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    compact-&gt;allocated_file_numbers.push_back(file_number);</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  }</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aa4a580611125396a6e0072010fced806_cgraph.png" border="0" usemap="#dd/df5/a00386_aa4a580611125396a6e0072010fced806_cgraph" alt=""/></div>
<map name="dd/df5/a00386_aa4a580611125396a6e0072010fced806_cgraph" id="dd/df5/a00386_aa4a580611125396a6e0072010fced806_cgraph">
<area shape="rect" id="node3" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="261,5,403,51"/><area shape="rect" id="node5" href="../../d9/d5e/a00295.html#ae0e14955026684df1c7e261dc31fcb70" title="rocksdb::Compaction\l::num_input_files" alt="" coords="259,74,405,121"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aa4a580611125396a6e0072010fced806_icgraph.png" border="0" usemap="#dd/df5/a00386_aa4a580611125396a6e0072010fced806_icgraph" alt=""/></div>
<map name="dd/df5/a00386_aa4a580611125396a6e0072010fced806_icgraph" id="dd/df5/a00386_aa4a580611125396a6e0072010fced806_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="260,289,505,319"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="555,281,752,327"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="800,250,997,297"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1045,267,1293,296"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1341,258,1563,305"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1628,77,1791,123"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1611,146,1808,193"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1623,267,1796,296"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1621,1105,1797,1135"/><area shape="rect" id="node50" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1612,1465,1807,1511"/><area shape="rect" id="node58" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1643,899,1776,928"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1909,93,2019,123"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1873,23,2055,70"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="2169,59,2279,88"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="2145,5,2303,35"/><area shape="rect" id="node25" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1859,155,2069,184"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1889,261,2039,291"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1861,208,2067,237"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2169,288,2279,317"/><area shape="rect" id="node36" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2173,341,2275,371"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2121,533,2327,563"/><area shape="rect" id="node40" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2141,235,2307,264"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="2169,181,2279,211"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1909,1573,2019,1603"/><area shape="rect" id="node52" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1885,1627,2043,1656"/><area shape="rect" id="node54" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="2169,1657,2279,1687"/><area shape="rect" id="node56" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="2129,1587,2319,1634"/><area shape="rect" id="node60" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1883,751,2045,798"/><area shape="rect" id="node64" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1893,821,2035,867"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1864,960,2064,989"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1868,1013,2060,1043"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1909,1067,2019,1096"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1875,1120,2053,1149"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1884,1173,2044,1219"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1903,699,2025,728"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1896,1242,2032,1289"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1868,1311,2060,1358"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1868,1381,2060,1427"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1856,1451,2072,1480"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1883,1503,2045,1550"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1939,315,1989,344"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1895,367,2033,414"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1875,437,2053,483"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1883,506,2045,553"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1881,576,2047,605"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1895,629,2033,675"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1892,890,2036,937"/><area shape="rect" id="node62" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2143,751,2305,798"/><area shape="rect" id="node66" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2137,829,2311,859"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a663aa80742985c3054c1962a94be6267"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::AppendSortedWalsOfType </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/d87/a03436.html#aaaf0d0ee1eb6c730ee241e600b26f980">VectorLogPtr</a> &amp;&#160;</td>
          <td class="paramname"><em>log_files</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073d">WalFileType</a>&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01442">1442</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l01353">CheckWalFileExistsAndEmpty()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6">rocksdb::Env::GetChildren()</a>, <a class="el" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d">rocksdb::Env::GetFileSize()</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00025">rocksdb::kLogFile</a>, <a class="el" href="../../da/d03/a02577_source.html#l00060">rocksdb::LogFileName()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../da/d03/a02577_source.html#l00144">rocksdb::ParseFileName()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01363">ReadFirstRecord()</a>, and <a class="el" href="../../d6/dca/a02616_source.html#l00134">rocksdb::WriteBatchInternal::Sequence()</a>.</p>

<p>Referenced by <a class="el" href="../../dd/db2/a02563_source.html#l00083">GetSortedWalFiles()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00650">PurgeObsoleteWALFiles()</a>.</p>
<div class="fragment"><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;                                                   {</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  std::vector&lt;std::string&gt; all_files;</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> status = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6">GetChildren</a>(<a class="code" href="../../d0/d58/a03393.html#a26624e6ddbf7cb60b7e1115042b559eb">path</a>, &amp;all_files);</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  }</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  log_files.reserve(log_files.size() + all_files.size());</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  VectorLogPtr::iterator pos_start;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="keywordflow">if</span> (!log_files.empty()) {</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    pos_start = log_files.end() - 1;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    pos_start = log_files.begin();</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  }</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> : all_files) {</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> number;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68">FileType</a> type;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc">ParseFileName</a>(<a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a>, &amp;number, &amp;type) &amp;&amp; type == <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a68c3486771836efd9dd6d409e9cf28c4">kLogFile</a>){</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      WriteBatch batch;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../dd/df5/a00386.html#a58d2431c9ec2de7473a8bc2f171c04b8">ReadFirstRecord</a>(log_type, number, &amp;batch);</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a26b3cfbce68c226c861cfacd4a111fe1">CheckWalFileExistsAndEmpty</a>(log_type, number)) {</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        }</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;        <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      }</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> size_bytes;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d">GetFileSize</a>(<a class="code" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477">LogFileName</a>(<a class="code" href="../../d0/d58/a03393.html#a26624e6ddbf7cb60b7e1115042b559eb">path</a>, number), &amp;size_bytes);</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      }</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      log_files.push_back(std::move(unique_ptr&lt;LogFile&gt;(<span class="keyword">new</span> LogFileImpl(</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        number, log_type, <a class="code" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44">WriteBatchInternal::Sequence</a>(&amp;batch), size_bytes))));</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    }</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  }</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  CompareLogByPointer compare_log_files;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  std::sort(pos_start, log_files.end(), compare_log_files);</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a663aa80742985c3054c1962a94be6267_cgraph.png" border="0" usemap="#dd/df5/a00386_a663aa80742985c3054c1962a94be6267_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a663aa80742985c3054c1962a94be6267_cgraph" id="dd/df5/a00386_a663aa80742985c3054c1962a94be6267_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a26b3cfbce68c226c861cfacd4a111fe1" title="rocksdb::DBImpl::CheckWal\lFileExistsAndEmpty" alt="" coords="264,283,453,330"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="531,352,683,381"/><area shape="rect" id="node12" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d" title="rocksdb::Env::GetFileSize" alt="" coords="520,195,693,224"/><area shape="rect" id="node14" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1317,383,1453,412"/><area shape="rect" id="node16" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="271,695,447,724"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="785,144,951,173"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#a58d2431c9ec2de7473a8bc2f171c04b8" title="rocksdb::DBImpl::ReadFirst\lRecord" alt="" coords="267,625,451,671"/><area shape="rect" id="node133" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="1987,138,2171,185"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="505,299,708,328"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="787,299,949,328"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="1024,147,1251,176"/><area shape="rect" id="node25" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="1311,85,1460,115"/><area shape="rect" id="node27" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="1308,181,1463,227"/><area shape="rect" id="node29" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1787,485,1923,515"/><area shape="rect" id="node34" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="1049,93,1225,123"/><area shape="rect" id="node39" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8" title="rocksdb::DBImpl::ReadFirstLine" alt="" coords="503,803,711,832"/><area shape="rect" id="node114" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="787,1173,949,1203"/><area shape="rect" id="node121" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="797,1227,939,1256"/><area shape="rect" id="node128" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8" title="rocksdb::Status::NotSupported" alt="" coords="1520,1279,1723,1308"/><area shape="rect" id="node131" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736" title="beast::IP::to_string" alt="" coords="540,856,673,885"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1089,965,1185,995"/><area shape="rect" id="node43" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1052,1021,1223,1051"/><area shape="rect" id="node47" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="760,691,976,720"/><area shape="rect" id="node50" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="797,794,939,841"/><area shape="rect" id="node72" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="1531,1124,1712,1153"/><area shape="rect" id="node109" href="../../d6/d66/a00916.html#ac156dfd78ec3a8dd539224668defc12d" title="rocksdb::LogReporter\l::Corruption" alt="" coords="795,953,941,999"/><area shape="rect" id="node117" href="../../da/d8c/a01845.html#a49f498cf63e9c738c4d598398a6f8c9e" title="rocksdb::WriteBatchInternal\l::SetContents" alt="" coords="1045,623,1229,670"/><area shape="rect" id="node45" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1311,1073,1460,1103"/><area shape="rect" id="node52" href="../../d5/d54/a01213.html#acb5bb46275c505b8eab7bceac8affd36" title="rocksdb::log::Reader\l::SkipToInitialBlock" alt="" coords="1067,554,1208,601"/><area shape="rect" id="node60" href="../../de/daf/a01417.html#a8f740f146e792dc89409f8402a61ad04" title="rocksdb::Slice::clear" alt="" coords="1315,951,1456,980"/><area shape="rect" id="node63" href="../../d5/d54/a01213.html#a57eb93a86418bd4a2b32ee163aecea5d" title="rocksdb::log::Reader\l::ReadPhysicalRecord" alt="" coords="1061,794,1213,841"/><area shape="rect" id="node69" href="../../d5/d54/a01213.html#a7db406791cb13477c816733858ea1e51" title="rocksdb::log::Reader\l::ReportCorruption" alt="" coords="1315,1003,1456,1050"/><area shape="rect" id="node76" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1316,639,1455,668"/><area shape="rect" id="node55" href="../../d5/d54/a01213.html#a49fd67047e3128cc471e7c31c5db6f9c" title="rocksdb::log::Reader\l::ReportDrop" alt="" coords="1551,795,1692,842"/><area shape="rect" id="node58" href="../../d7/d04/a01246.html#a3489a71709b9f8a459daf7761fc8658e" title="rocksdb::log::Reader\l::Reporter::Corruption" alt="" coords="1781,795,1928,842"/><area shape="rect" id="node78" href="../../d7/db0/a03467.html#a8c50508656b8faef53619a2d4097eaf0" title="rocksdb::crc32c::Unmask" alt="" coords="1300,847,1471,876"/><area shape="rect" id="node80" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="2860,743,3025,772"/><area shape="rect" id="node82" href="../../d7/db0/a03467.html#a90a67ab6517f594a989c6cb4f3ff67f9" title="rocksdb::crc32c::Value" alt="" coords="1308,743,1463,772"/><area shape="rect" id="node74" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1775,1201,1935,1231"/><area shape="rect" id="node84" href="../../d7/db0/a03467.html#aba0a720f8204028aa9b0f78f969d5f97" title="rocksdb::crc32c::Extend" alt="" coords="1540,743,1703,772"/><area shape="rect" id="node86" href="../../d7/db0/a03467.html#a174fe9c8cf3cb558b7accfdc10c6c04c" title="rocksdb::crc32c::CRC32" alt="" coords="1772,743,1937,772"/><area shape="rect" id="node88" href="../../d7/db0/a03467.html#aeb8537c518a4a8ac7e1d8f8ac1c6bb63" title="rocksdb::crc32c::Choose\l_CRC32" alt="" coords="1995,734,2163,781"/><area shape="rect" id="node90" href="../../d7/db0/a03467.html#a6abc7c8ed18979f0e12fcfb6460f9285" title="rocksdb::crc32c::isSSE42" alt="" coords="2220,795,2393,824"/><area shape="rect" id="node92" href="../../d7/db0/a03467.html#ab6bf1f9041f7859fe1aae6312f650115" title="rocksdb::crc32c::Fast\l_CRC32" alt="" coords="2232,674,2381,721"/><area shape="rect" id="node99" href="../../d7/db0/a03467.html#aabbb4470a0a8566fff676e40a5c3a491" title="rocksdb::crc32c::Slow\l_CRC32" alt="" coords="2443,734,2595,781"/><area shape="rect" id="node94" href="../../d7/db0/a03467.html#aa5eeccea7be6cc99acab7223cc1c7baf" title="rocksdb::crc32c::LE\l_LOAD64" alt="" coords="2449,665,2588,711"/><area shape="rect" id="node96" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="2644,673,2809,703"/><area shape="rect" id="node101" href="../../d7/db0/a03467.html#a72b216c9d4dfeeaea89e2410eec06ff9" title="rocksdb::crc32c::LE\l_LOAD32" alt="" coords="2657,734,2796,781"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a663aa80742985c3054c1962a94be6267_icgraph.png" border="0" usemap="#dd/df5/a00386_a663aa80742985c3054c1962a94be6267_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a663aa80742985c3054c1962a94be6267_icgraph" id="dd/df5/a00386_a663aa80742985c3054c1962a94be6267_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#aa24437e34cff2bc2607adf5a382efe80" title="rocksdb::DBImpl::GetSorted\lWalFiles" alt="" coords="279,966,465,1013"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="265,1095,479,1142"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#aefb7a749f364c505a5a6b06d977cbc71" title="rocksdb::DBImpl::GetUpdates\lSince" alt="" coords="537,889,735,935"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="581,975,691,1004"/><area shape="rect" id="node7" href="../../db/d95/a00391.html#aa7a0e63b4ab38f47f7e65f92961c6625" title="rocksdb::DBTest::OpenTransaction\lLogIter" alt="" coords="793,867,1020,914"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="529,1061,743,1107"/><area shape="rect" id="node104" href="../../dd/df5/a00386.html#ad62af2cf23b7a2da72715051e719e5f1" title="rocksdb::DBImpl::TEST\l_PurgeObsoleteteWAL" alt="" coords="555,1130,717,1177"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a2f6c0d55ec4f04c4b5f736f59fa51d4d" title="rocksdb::DBImpl::EnableFile\lDeletions" alt="" coords="812,937,1001,983"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a4406b5ed5487f7562bd0fe1696c6092f" title="rocksdb::DBImpl::DeleteObsolete\lFiles" alt="" coords="1329,875,1548,922"/><area shape="rect" id="node85" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="808,1061,1005,1107"/><area shape="rect" id="node92" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1597,1151,1795,1198"/><area shape="rect" id="node99" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="813,1212,1000,1241"/><area shape="rect" id="node19" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1629,673,1763,703"/><area shape="rect" id="node21" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1885,9,2048,55"/><area shape="rect" id="node25" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1896,86,2037,133"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1867,160,2067,189"/><area shape="rect" id="node31" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1871,213,2063,243"/><area shape="rect" id="node39" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1912,267,2021,296"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1877,320,2056,349"/><area shape="rect" id="node45" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1887,373,2047,419"/><area shape="rect" id="node49" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1905,443,2028,472"/><area shape="rect" id="node57" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1899,495,2035,542"/><area shape="rect" id="node59" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1871,565,2063,611"/><area shape="rect" id="node61" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1871,634,2063,681"/><area shape="rect" id="node67" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1859,704,2075,733"/><area shape="rect" id="node69" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1885,757,2048,803"/><area shape="rect" id="node71" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1941,827,1992,856"/><area shape="rect" id="node73" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1897,879,2036,926"/><area shape="rect" id="node75" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1877,949,2056,995"/><area shape="rect" id="node77" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1885,1018,2048,1065"/><area shape="rect" id="node79" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1884,1088,2049,1117"/><area shape="rect" id="node81" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1897,1141,2036,1187"/><area shape="rect" id="node83" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1895,1210,2039,1257"/><area shape="rect" id="node23" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2171,5,2333,51"/><area shape="rect" id="node27" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2165,75,2339,104"/><area shape="rect" id="node33" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="2139,127,2365,174"/><area shape="rect" id="node35" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="2165,197,2339,227"/><area shape="rect" id="node37" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="2165,250,2339,297"/><area shape="rect" id="node43" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2227,320,2277,349"/><area shape="rect" id="node47" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="2172,373,2332,419"/><area shape="rect" id="node51" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2149,443,2355,472"/><area shape="rect" id="node53" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="2151,495,2353,542"/><area shape="rect" id="node55" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="2197,565,2307,595"/><area shape="rect" id="node63" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="2156,626,2348,673"/><area shape="rect" id="node65" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="2156,695,2348,742"/><area shape="rect" id="node87" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1069,1057,1280,1087"/><area shape="rect" id="node89" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1328,1091,1549,1138"/><area shape="rect" id="node94" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1843,1280,2091,1309"/><area shape="rect" id="node102" href="../../d4/d87/a03436.html#ad19b60849d205b89e09ff716b7714f69" title="rocksdb::TEST" alt="" coords="1120,1212,1229,1241"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af25ba1d8b183fb12968ebb12ae28de91"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::BackgroundCallCompaction </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01694">1694</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">rocksdb::port::AtomicPointer::Acquire_Load()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00329">bg_compaction_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00309">bg_cv_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00129">rocksdb::DBImpl::DeletionState::HaveSomethingToDelete()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00418">MaybeDumpStats()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00022">MaybeScheduleLogDBDeployStats()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00511">PurgeObsoleteFiles()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00308">shutting_down_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00067">rocksdb::port::CondVar::SignalAll()</a>, <a class="el" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b">rocksdb::Env::SleepForMicroseconds()</a>, <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>, and <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01631">BGWorkCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                                      {</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keywordtype">bool</span> madeProgress = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  DeletionState deletion_state;</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a9ca9562b2a7a0a8e0645db22648a2ac5">MaybeDumpStats</a>();</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  <span class="comment">// Log(options_.info_log, &quot;XXX BG Thread %llx process new work item&quot;, pthread_self());</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  assert(<a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a>);</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s;</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#aa30ff424691deb3432441334d3adb3cf">shutting_down_</a>.<a class="code" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">Acquire_Load</a>()) {</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    s = <a class="code" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566">BackgroundCompaction</a>(&amp;madeProgress, deletion_state);</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      <span class="comment">// Wait a little bit before retrying background compaction in</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;      <span class="comment">// case this is an environmental problem and we do not want to</span></div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;      <span class="comment">// chew up resources for failed compactions for the duration of</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;      <span class="comment">// the problem.</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1">SignalAll</a>();  <span class="comment">// In case a waiter can proceed despite the error</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Waiting after background compaction error: %s&quot;</span>,</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;          s.ToString().c_str());</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b">SleepForMicroseconds</a>(1000000);</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    }</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;  }</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  <span class="comment">// If !s.ok(), this means that Compaction failed. In that case, we want</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="comment">// to delete all obsolete files we might have created and we force</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;  <span class="comment">// FindObsoleteFiles(). This is because deletion_state does not catch</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  <span class="comment">// all created files if compaction failed.</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8">FindObsoleteFiles</a>(deletion_state, !s.ok());</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  <span class="comment">// delete unnecessary files if any, this is done outside the mutex</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  <span class="keywordflow">if</span> (deletion_state.HaveSomethingToDelete()) {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5">PurgeObsoleteFiles</a>(deletion_state);</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  }</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a>--;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df">MaybeScheduleLogDBDeployStats</a>();</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  <span class="comment">// Previous compaction may have produced too many files in a level,</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  <span class="comment">// So reschedule another compaction if we made progress in the</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;  <span class="comment">// last compaction.</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  <span class="keywordflow">if</span> (madeProgress) {</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a">MaybeScheduleFlushOrCompaction</a>();</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  }</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1">SignalAll</a>();</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_af25ba1d8b183fb12968ebb12ae28de91_cgraph.png" border="0" usemap="#dd/df5/a00386_af25ba1d8b183fb12968ebb12ae28de91_cgraph" alt=""/></div>
<map name="dd/df5/a00386_af25ba1d8b183fb12968ebb12ae28de91_cgraph" id="dd/df5/a00386_af25ba1d8b183fb12968ebb12ae28de91_cgraph">
<area shape="rect" id="node3" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="1421,109,1608,155"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="272,1083,469,1130"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1467,2291,1563,2320"/><area shape="rect" id="node38" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="1444,1726,1585,1773"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="1451,3081,1579,3111"/><area shape="rect" id="node44" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="1444,1795,1585,1842"/><area shape="rect" id="node47" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1429,2613,1600,2643"/><area shape="rect" id="node51" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1447,1336,1583,1365"/><area shape="rect" id="node61" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df" title="rocksdb::DBImpl::MaybeSchedule\lLogDBDeployStats" alt="" coords="1117,349,1339,395"/><area shape="rect" id="node75" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="835,382,1056,429"/><area shape="rect" id="node97" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1" title="rocksdb::port::CondVar\l::SignalAll" alt="" coords="867,1961,1024,2007"/><area shape="rect" id="node108" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="1125,1666,1331,1713"/><area shape="rect" id="node112" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="1412,1581,1617,1627"/><area shape="rect" id="node120" href="../../dd/df5/a00386.html#a9ca9562b2a7a0a8e0645db22648a2ac5" title="rocksdb::DBImpl::MaybeDump\lStats" alt="" coords="844,2222,1047,2269"/><area shape="rect" id="node134" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="839,2761,1052,2807"/><area shape="rect" id="node162" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="251,3259,491,3288"/><area shape="rect" id="node7" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1444,798,1585,845"/><area shape="rect" id="node9" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="1149,573,1307,619"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="851,1053,1040,1099"/><area shape="rect" id="node72" href="../../de/de6/a00723.html#a1f29087f48fd168fe431e4b884f5aed1" title="rocksdb::InternalKey\l::DebugString" alt="" coords="592,1113,733,1159"/><area shape="rect" id="node86" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="540,1565,785,1595"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a0d04c5afc2255f2160046afed2398cbd" title="rocksdb::DBImpl::Cleanup\lCompaction" alt="" coords="1140,693,1316,739"/><area shape="rect" id="node11" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc" title="rocksdb::port::AtomicPointer\l::NoBarrier_Load" alt="" coords="1421,603,1608,650"/><area shape="rect" id="node18" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="1436,2017,1593,2063"/><area shape="rect" id="node22" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="1433,868,1596,897"/><area shape="rect" id="node24" href="../../d7/dd4/a00968.html#ab919b8b2b4a57174e618272f0f6dd7a2" title="rocksdb::MemTableList\l::PickMemtablesToFlush" alt="" coords="1145,983,1311,1030"/><area shape="rect" id="node26" href="../../d3/dcd/a00965.html#a1345f2a7f5bbb0416dfb6290ab6eea0b" title="rocksdb::MemTable::\lGetEdits" alt="" coords="1156,1053,1300,1099"/><area shape="rect" id="node28" href="../../d2/d86/a01798.html#ab2a5ed0c015e8ccecf147de0bf2a6d12" title="rocksdb::VersionEdit\l::SetPrevLogNumber" alt="" coords="1156,1122,1300,1169"/><area shape="rect" id="node30" href="../../d2/d86/a01798.html#a8d557cf30bde88010eff4307cc3d385f" title="rocksdb::VersionEdit\l::SetLogNumber" alt="" coords="1157,1191,1299,1238"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#ac3d320a145d5d36cb2bbf9e57b39ae8a" title="rocksdb::DBImpl::WriteLevel0\lTable" alt="" coords="1129,1786,1327,1833"/><area shape="rect" id="node55" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="1129,914,1327,961"/><area shape="rect" id="node35" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="1428,1956,1601,1985"/><area shape="rect" id="node40" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1679,1804,1852,1833"/><area shape="rect" id="node49" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1691,2613,1840,2643"/><area shape="rect" id="node64" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="1415,499,1615,528"/><area shape="rect" id="node67" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="1435,224,1595,253"/><area shape="rect" id="node69" href="../../dd/df5/a00386.html#a3b86ec3494acbb6dbb8f2fdace967183" title="rocksdb::DBImpl::BGLogDBDeploy\lStats" alt="" coords="1401,349,1628,395"/><area shape="rect" id="node81" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1123,245,1333,275"/><area shape="rect" id="node83" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1104,469,1352,499"/><area shape="rect" id="node114" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="1427,2095,1603,2124"/><area shape="rect" id="node123" href="../../dd/df5/a00386.html#ae57d4ca72d8c220fe8a384531433e585" title="rocksdb::DBImpl::GetProperty" alt="" coords="1129,2059,1327,2088"/><area shape="rect" id="node128" href="../../dd/df5/a00386.html#aa52b644196bb47c051055a7a9a827fcd" title="rocksdb::DBImpl::PrintStatistics" alt="" coords="1123,2264,1333,2293"/><area shape="rect" id="node136" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="1147,2848,1309,2877"/><area shape="rect" id="node138" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1152,2901,1304,2931"/><area shape="rect" id="node140" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="1432,2771,1597,2800"/><area shape="rect" id="node143" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="1140,2691,1316,2720"/><area shape="rect" id="node145" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="1127,2795,1329,2824"/><area shape="rect" id="node149" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="1432,2979,1597,3008"/><area shape="rect" id="node151" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="1121,2469,1335,2515"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_af25ba1d8b183fb12968ebb12ae28de91_icgraph.png" border="0" usemap="#dd/df5/a00386_af25ba1d8b183fb12968ebb12ae28de91_icgraph" alt=""/></div>
<map name="dd/df5/a00386_af25ba1d8b183fb12968ebb12ae28de91_icgraph" id="dd/df5/a00386_af25ba1d8b183fb12968ebb12ae28de91_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="251,296,499,325"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="547,287,768,334"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="833,158,996,205"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="816,227,1013,274"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="816,969,1013,1015"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="828,348,1001,377"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="827,19,1003,48"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="817,77,1012,123"/><area shape="rect" id="node54" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="848,916,981,945"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1115,119,1224,148"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1079,171,1260,218"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1384,129,1493,159"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1360,183,1517,212"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1064,241,1275,271"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1095,295,1244,324"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1067,348,1272,377"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="1384,240,1493,269"/><area shape="rect" id="node32" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="1388,293,1489,323"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1336,400,1541,429"/><area shape="rect" id="node36" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="1356,347,1521,376"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="1384,453,1493,483"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1115,12,1224,41"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1091,65,1248,95"/><area shape="rect" id="node50" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="1384,5,1493,35"/><area shape="rect" id="node52" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="1344,58,1533,105"/><area shape="rect" id="node56" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1088,1169,1251,1215"/><area shape="rect" id="node60" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1099,1238,1240,1285"/><area shape="rect" id="node64" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1069,1308,1269,1337"/><area shape="rect" id="node66" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1073,1361,1265,1391"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1115,1484,1224,1513"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1080,1537,1259,1567"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1089,1590,1249,1637"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1108,401,1231,431"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1101,454,1237,501"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1073,523,1265,570"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1073,593,1265,639"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1061,663,1277,692"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1088,715,1251,762"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1144,785,1195,815"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1100,838,1239,885"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1080,907,1259,954"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1088,977,1251,1023"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1087,1047,1252,1076"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1100,1099,1239,1146"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1097,1414,1241,1461"/><area shape="rect" id="node58" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1357,1169,1520,1215"/><area shape="rect" id="node62" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1352,1247,1525,1276"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1325,1383,1552,1430"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="1352,1331,1525,1360"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af70abfde15bcbcb869e36a51460def59"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::BackgroundCallFlush </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01648">1648</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">rocksdb::port::AtomicPointer::Acquire_Load()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01635">BackgroundFlush()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00309">bg_cv_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00332">bg_flush_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00129">rocksdb::DBImpl::DeletionState::HaveSomethingToDelete()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00511">PurgeObsoleteFiles()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00308">shutting_down_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00067">rocksdb::port::CondVar::SignalAll()</a>, <a class="el" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b">rocksdb::Env::SleepForMicroseconds()</a>, <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>, and <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01627">BGWorkFlush()</a>.</p>
<div class="fragment"><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                                 {</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  <span class="keywordtype">bool</span> madeProgress = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  DeletionState deletion_state;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;  assert(<a class="code" href="../../dd/df5/a00386.html#aca89b02f26787b31bba9a8690b4be42d">bg_flush_scheduled_</a>);</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#aa30ff424691deb3432441334d3adb3cf">shutting_down_</a>.<a class="code" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">Acquire_Load</a>()) {</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    s = <a class="code" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4">BackgroundFlush</a>(&amp;madeProgress, deletion_state);</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;      <span class="comment">// Wait a little bit before retrying background compaction in</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;      <span class="comment">// case this is an environmental problem and we do not want to</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      <span class="comment">// chew up resources for failed compactions for the duration of</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      <span class="comment">// the problem.</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1">SignalAll</a>();  <span class="comment">// In case a waiter can proceed despite the error</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Waiting after background flush error: %s&quot;</span>,</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;          s.ToString().c_str());</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b">SleepForMicroseconds</a>(1000000);</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    }</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  }</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  <span class="comment">// If !s.ok(), this means that Flush failed. In that case, we want</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  <span class="comment">// to delete all obsolete files and we force FindObsoleteFiles()</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8">FindObsoleteFiles</a>(deletion_state, !s.ok());</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  <span class="comment">// delete unnecessary files if any, this is done outside the mutex</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  <span class="keywordflow">if</span> (deletion_state.HaveSomethingToDelete()) {</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5">PurgeObsoleteFiles</a>(deletion_state);</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  }</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#aca89b02f26787b31bba9a8690b4be42d">bg_flush_scheduled_</a>--;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;  <span class="keywordflow">if</span> (madeProgress) {</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a">MaybeScheduleFlushOrCompaction</a>();</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;  }</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1">SignalAll</a>();</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_af70abfde15bcbcb869e36a51460def59_cgraph.png" border="0" usemap="#dd/df5/a00386_af70abfde15bcbcb869e36a51460def59_cgraph" alt=""/></div>
<map name="dd/df5/a00386_af70abfde15bcbcb869e36a51460def59_cgraph" id="dd/df5/a00386_af70abfde15bcbcb869e36a51460def59_cgraph">
<area shape="rect" id="node3" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="1364,1318,1551,1365"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="545,589,743,636"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1645,904,1781,934"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1665,551,1761,580"/><area shape="rect" id="node39" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="1387,1129,1528,1176"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="1393,1819,1521,1848"/><area shape="rect" id="node45" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="1387,1198,1528,1245"/><area shape="rect" id="node48" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1628,1982,1799,2011"/><area shape="rect" id="node69" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="1079,1154,1284,1201"/><area shape="rect" id="node73" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="1355,1698,1560,1745"/><area shape="rect" id="node81" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="251,1432,472,1478"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="1075,2074,1288,2121"/><area shape="rect" id="node147" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1" title="rocksdb::port::CondVar\l::SignalAll" alt="" coords="1103,1546,1260,1593"/><area shape="rect" id="node150" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="1061,1920,1301,1950"/><area shape="rect" id="node9" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="1103,933,1260,980"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="820,589,1009,636"/><area shape="rect" id="node11" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc" title="rocksdb::port::AtomicPointer\l::NoBarrier_Load" alt="" coords="1364,1060,1551,1106"/><area shape="rect" id="node17" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1387,785,1528,832"/><area shape="rect" id="node19" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="1103,485,1260,532"/><area shape="rect" id="node23" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="1376,352,1539,382"/><area shape="rect" id="node25" href="../../d7/dd4/a00968.html#ab919b8b2b4a57174e618272f0f6dd7a2" title="rocksdb::MemTableList\l::PickMemtablesToFlush" alt="" coords="1099,554,1264,601"/><area shape="rect" id="node27" href="../../d3/dcd/a00965.html#a1345f2a7f5bbb0416dfb6290ab6eea0b" title="rocksdb::MemTable::\lGetEdits" alt="" coords="1109,624,1253,670"/><area shape="rect" id="node29" href="../../d2/d86/a01798.html#ab2a5ed0c015e8ccecf147de0bf2a6d12" title="rocksdb::VersionEdit\l::SetPrevLogNumber" alt="" coords="1109,693,1253,740"/><area shape="rect" id="node31" href="../../d2/d86/a01798.html#a8d557cf30bde88010eff4307cc3d385f" title="rocksdb::VersionEdit\l::SetLogNumber" alt="" coords="1111,365,1252,412"/><area shape="rect" id="node33" href="../../dd/df5/a00386.html#ac3d320a145d5d36cb2bbf9e57b39ae8a" title="rocksdb::DBImpl::WriteLevel0\lTable" alt="" coords="1083,813,1280,860"/><area shape="rect" id="node55" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="1083,245,1280,292"/><area shape="rect" id="node61" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df" title="rocksdb::DBImpl::MaybeSchedule\lLogDBDeployStats" alt="" coords="1071,1477,1292,1524"/><area shape="rect" id="node36" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="1371,1007,1544,1036"/><area shape="rect" id="node41" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1627,1207,1800,1236"/><area shape="rect" id="node50" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1900,1982,2049,2011"/><area shape="rect" id="node64" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="1613,1710,1813,1739"/><area shape="rect" id="node67" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="1377,1646,1537,1675"/><area shape="rect" id="node75" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="1625,1352,1801,1382"/><area shape="rect" id="node87" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="539,1868,749,1898"/><area shape="rect" id="node90" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="520,1484,768,1514"/><area shape="rect" id="node92" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="816,1546,1013,1593"/><area shape="rect" id="node105" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="1376,2406,1539,2435"/><area shape="rect" id="node109" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1381,2248,1533,2278"/><area shape="rect" id="node112" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="1631,2140,1796,2170"/><area shape="rect" id="node128" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="1369,2043,1545,2072"/><area shape="rect" id="node130" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="1356,2352,1559,2382"/><area shape="rect" id="node135" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="1631,2195,1796,2224"/><area shape="rect" id="node137" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="1351,1973,1564,2020"/><area shape="rect" id="node107" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1632,2352,1795,2382"/><area shape="rect" id="node114" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="1861,2192,2088,2222"/><area shape="rect" id="node116" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="2140,2223,2289,2252"/><area shape="rect" id="node118" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="2137,2132,2292,2178"/><area shape="rect" id="node120" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="2343,2088,2479,2118"/><area shape="rect" id="node125" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="1887,2088,2063,2118"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_af70abfde15bcbcb869e36a51460def59_icgraph.png" border="0" usemap="#dd/df5/a00386_af70abfde15bcbcb869e36a51460def59_icgraph" alt=""/></div>
<map name="dd/df5/a00386_af70abfde15bcbcb869e36a51460def59_icgraph" id="dd/df5/a00386_af70abfde15bcbcb869e36a51460def59_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="251,212,461,241"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="509,230,731,277"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="796,23,959,70"/><area shape="rect" id="node18" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1033,143,1231,190"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="779,143,976,190"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="791,264,964,293"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="789,1149,965,1179"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="780,1517,975,1563"/><area shape="rect" id="node54" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="811,939,944,968"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1077,5,1187,35"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1041,58,1223,105"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1357,29,1467,59"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1333,83,1491,112"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1288,153,1536,183"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1057,264,1207,293"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1029,317,1235,347"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="1357,209,1467,239"/><area shape="rect" id="node32" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="1361,263,1463,292"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1309,369,1515,399"/><area shape="rect" id="node36" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="1329,316,1495,345"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="1357,423,1467,452"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1077,1629,1187,1659"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1053,1683,1211,1712"/><area shape="rect" id="node50" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="1357,1652,1467,1681"/><area shape="rect" id="node52" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="1317,1705,1507,1751"/><area shape="rect" id="node56" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1051,685,1213,731"/><area shape="rect" id="node60" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1061,807,1203,854"/><area shape="rect" id="node64" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1032,755,1232,784"/><area shape="rect" id="node66" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1036,877,1228,907"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1077,1000,1187,1029"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1043,1053,1221,1083"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1052,1106,1212,1153"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1071,371,1193,400"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1064,1175,1200,1222"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1036,1245,1228,1291"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1036,1314,1228,1361"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1024,1384,1240,1413"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1051,1437,1213,1483"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1107,1507,1157,1536"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1063,1559,1201,1606"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1043,423,1221,470"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1051,493,1213,539"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1049,563,1215,592"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1063,615,1201,662"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1060,930,1204,977"/><area shape="rect" id="node58" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1331,685,1493,731"/><area shape="rect" id="node62" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1325,816,1499,845"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1299,926,1525,973"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="1325,873,1499,903"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5c7b18fec45d2a89a72902476d846566"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::BackgroundCompaction </td>
          <td>(</td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>madeProgress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/dea/a00408.html">DeletionState</a> &amp;&#160;</td>
          <td class="paramname"><em>deletion_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01747">1747</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">rocksdb::port::AtomicPointer::Acquire_Load()</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00342">rocksdb::DBImpl::ManualCompaction::begin</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00329">bg_compaction_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00349">bg_error_</a>, <a class="el" href="../../db/d44/a02564_source.html#l01862">CleanupCompaction()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00576">rocksdb::Options::compaction_style</a>, <a class="el" href="../../d2/ddf/a02573_source.html#l00040">rocksdb::InternalKey::DebugString()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00495">rocksdb::Options::disable_auto_compactions</a>, <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00340">rocksdb::DBImpl::ManualCompaction::done</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00343">rocksdb::DBImpl::ManualCompaction::end</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../db/d44/a02564_source.html#l01113">FlushMemTableToOutputFile()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00312">imm_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00341">rocksdb::DBImpl::ManualCompaction::in_progress</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00046">rocksdb::MemTableList::IsFlushPending()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00057">rocksdb::kCompactionStyleUniversal</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00339">rocksdb::DBImpl::ManualCompaction::level</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00346">manual_compaction_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00401">rocksdb::Options::max_background_compactions</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00167">rocksdb::Options::min_write_buffer_number_to_merge</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00125">rocksdb::Options::paranoid_checks</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00308">shutting_down_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00344">rocksdb::DBImpl::ManualCompaction::tmp_storage</a>, <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;                                 {</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  *madeProgress = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  <span class="comment">// TODO: remove memtable flush from formal compaction</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36">IsFlushPending</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a115f9538bf76bb2a2929567292510d98">min_write_buffer_number_to_merge</a>)) {</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        <span class="stringliteral">&quot;BackgroundCompaction doing FlushMemTableToOutputFile, compaction slots &quot;</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        <span class="stringliteral">&quot;available %d&quot;</span>,</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acfc44c7252fbd8c8d98c42903014dbbc">max_background_compactions</a> - <a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a>);</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> stat = <a class="code" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e">FlushMemTableToOutputFile</a>(madeProgress, deletion_state);</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="keywordflow">if</span> (!stat.ok()) {</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      <span class="keywordflow">return</span> stat;</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    }</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  }</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  unique_ptr&lt;Compaction&gt; c;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <span class="keywordtype">bool</span> is_manual = (<a class="code" href="../../dd/df5/a00386.html#ab8d415c46a300bbfcaaa95e812a51179">manual_compaction_</a> != <span class="keyword">nullptr</span>) &amp;&amp;</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;                   (<a class="code" href="../../dd/df5/a00386.html#ab8d415c46a300bbfcaaa95e812a51179">manual_compaction_</a>-&gt;<a class="code" href="../../df/d12/a00942.html#a64ccb95bc4ef7341c6d4b5e2bc03c350">in_progress</a> == <span class="keyword">false</span>);</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;  InternalKey manual_end;</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  <span class="keywordflow">if</span> (is_manual) {</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    ManualCompaction* m = <a class="code" href="../../dd/df5/a00386.html#ab8d415c46a300bbfcaaa95e812a51179">manual_compaction_</a>;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    assert(!m-&gt;in_progress);</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    m-&gt;in_progress = <span class="keyword">true</span>; <span class="comment">// another thread cannot pick up the same work</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    c.reset(<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;CompactRange(m-&gt;level, m-&gt;begin, m-&gt;end));</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    <span class="keywordflow">if</span> (c) {</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;      manual_end = c-&gt;input(0, c-&gt;num_input_files(0) - 1)-&gt;largest;</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;      m-&gt;done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    }</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        <span class="stringliteral">&quot;Manual compaction at level-%d from %s .. %s; will stop at %s\n&quot;</span>,</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        m-&gt;level,</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        (m-&gt;begin ? m-&gt;begin-&gt;DebugString().c_str() : <span class="stringliteral">&quot;(begin)&quot;</span>),</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        (m-&gt;end ? m-&gt;end-&gt;DebugString().c_str() : <span class="stringliteral">&quot;(end)&quot;</span>),</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        (m-&gt;done ? <span class="stringliteral">&quot;(end)&quot;</span> : manual_end.DebugString().c_str()));</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a1ccc803f6d2597d8a2ec56ba894baf9c">disable_auto_compactions</a>) {</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    c.reset(<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;PickCompaction());</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  }</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> status;</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <span class="keywordflow">if</span> (!c) {</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="comment">// Nothing to do</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Compaction nothing to do&quot;</span>);</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!is_manual &amp;&amp; c-&gt;IsTrivialMove()) {</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    <span class="comment">// Move file to next level</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    assert(c-&gt;num_input_files(0) == 1);</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    FileMetaData* <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> = c-&gt;input(0, 0);</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    c-&gt;edit()-&gt;DeleteFile(c-&gt;level(), f-&gt;number);</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    c-&gt;edit()-&gt;AddFile(c-&gt;level() + 1, f-&gt;number, f-&gt;file_size,</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;                       f-&gt;smallest, f-&gt;largest,</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                       f-&gt;smallest_seqno, f-&gt;largest_seqno);</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    status = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LogAndApply(c-&gt;edit(), &amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    VersionSet::LevelSummaryStorage tmp;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Moved #%lld to level-%d %lld bytes %s: %s\n&quot;</span>,</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        static_cast&lt;unsigned long long&gt;(f-&gt;number),</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;        c-&gt;level() + 1,</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(f-&gt;file_size),</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        status.ToString().c_str(),</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LevelSummary(&amp;tmp));</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;ReleaseCompactionFiles(c.get(), status);</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    *madeProgress = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a">MaybeScheduleFlushOrCompaction</a>(); <span class="comment">// do more compaction work in parallel.</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    CompactionState* compact = <span class="keyword">new</span> CompactionState(c.get());</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    status = <a class="code" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b">DoCompactionWork</a>(compact, deletion_state);</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a0d04c5afc2255f2160046afed2398cbd">CleanupCompaction</a>(compact, status);</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;ReleaseCompactionFiles(c.get(), status);</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    c-&gt;ReleaseInputs();</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    *madeProgress = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  }</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  c.reset();</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="keywordflow">if</span> (status.ok()) {</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <span class="comment">// Done</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#aa30ff424691deb3432441334d3adb3cf">shutting_down_</a>.<a class="code" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">Acquire_Load</a>()) {</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <span class="comment">// Ignore compaction errors found during shutting down</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        <span class="stringliteral">&quot;Compaction error: %s&quot;</span>, status.ToString().c_str());</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a3caefadde126ce359200ea7742e3dba7">paranoid_checks</a> &amp;&amp; <a class="code" href="../../dd/df5/a00386.html#a79aec493ad501d3e044e08f610591926">bg_error_</a>.<a class="code" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425">ok</a>()) {</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a79aec493ad501d3e044e08f610591926">bg_error_</a> = status;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    }</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  }</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  <span class="keywordflow">if</span> (is_manual) {</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    ManualCompaction* m = <a class="code" href="../../dd/df5/a00386.html#ab8d415c46a300bbfcaaa95e812a51179">manual_compaction_</a>;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      m-&gt;<a class="code" href="../../df/d12/a00942.html#ac2647745adf9e3e7b5b4db87c232da8a">done</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    }</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    <span class="comment">// For universal compaction:</span></div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    <span class="comment">//   Because universal compaction always happens at level 0, so one</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <span class="comment">//   compaction will pick up all overlapped files. No files will be</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    <span class="comment">//   filtered out due to size limit and left for a successive compaction.</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    <span class="comment">//   So we can safely conclude the current compaction.</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    <span class="comment">//   Also note that, if we don&#39;t stop here, then the current compaction</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <span class="comment">//   writes a new file back to level 0, which will be used in successive</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;    <span class="comment">//   compaction. Hence the manual compaction will never finish.</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> == <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a>) {</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;      m-&gt;done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    }</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    <span class="keywordflow">if</span> (!m-&gt;done) {</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;      <span class="comment">// We only compacted part of the requested range.  Update *m</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;      <span class="comment">// to the range that is left to be compacted.</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      m-&gt;tmp_storage = manual_end;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;      m-&gt;begin = &amp;m-&gt;tmp_storage;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    }</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    m-&gt;in_progress = <span class="keyword">false</span>; <span class="comment">// not being processed anymore</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#ab8d415c46a300bbfcaaa95e812a51179">manual_compaction_</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  }</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;  <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a5c7b18fec45d2a89a72902476d846566_cgraph.png" border="0" usemap="#dd/df5/a00386_a5c7b18fec45d2a89a72902476d846566_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a5c7b18fec45d2a89a72902476d846566_cgraph" id="dd/df5/a00386_a5c7b18fec45d2a89a72902476d846566_cgraph">
<area shape="rect" id="node3" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="836,64,1023,111"/><area shape="rect" id="node5" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="859,320,1000,367"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a0d04c5afc2255f2160046afed2398cbd" title="rocksdb::DBImpl::Cleanup\lCompaction" alt="" coords="576,315,752,362"/><area shape="rect" id="node10" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="861,814,997,844"/><area shape="rect" id="node12" href="../../de/de6/a00723.html#a1f29087f48fd168fe431e4b884f5aed1" title="rocksdb::InternalKey\l::DebugString" alt="" coords="304,2788,445,2835"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="252,1588,497,1617"/><area shape="rect" id="node28" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="881,1458,977,1488"/><area shape="rect" id="node61" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="851,251,1008,298"/><area shape="rect" id="node64" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="569,435,759,482"/><area shape="rect" id="node126" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="579,2820,749,2849"/><area shape="rect" id="node131" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="553,94,775,140"/><area shape="rect" id="node14" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2" title="rocksdb::ParseInternalKey" alt="" coords="576,2716,752,2745"/><area shape="rect" id="node20" href="../../d6/d80/a01076.html#a36870425cc00e160004d62bd6118a24d" title="rocksdb::ParsedInternalKey\l::DebugString" alt="" coords="573,2872,755,2919"/><area shape="rect" id="node24" href="../../d4/d87/a03436.html#a4bf89f1a48c96450ef0d88b5c9f0a1ec" title="rocksdb::EscapeString" alt="" coords="587,2942,741,2972"/><area shape="rect" id="node16" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="860,2173,999,2202"/><area shape="rect" id="node18" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="861,2245,997,2274"/><area shape="rect" id="node22" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="848,2824,1011,2853"/><area shape="rect" id="node30" href="../../d9/d5e/a00295.html#ae0e14955026684df1c7e261dc31fcb70" title="rocksdb::Compaction\l::num_input_files" alt="" coords="856,1240,1003,1287"/><area shape="rect" id="node32" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="591,2315,737,2362"/><area shape="rect" id="node34" href="../../d9/d5e/a00295.html#ab758c022170f7bb2421feae0d2f9de90" title="rocksdb::Compaction\l::score" alt="" coords="591,2384,737,2431"/><area shape="rect" id="node36" href="../../d9/d5e/a00295.html#a689b7c58190c1fee9c0fd22e7ff79ea3" title="rocksdb::Compaction\l::Summary" alt="" coords="591,2454,737,2500"/><area shape="rect" id="node38" href="../../dc/de6/a01426.html#ab55f97d15a5529dec33ece4781c23955" title="rocksdb::SnapshotList\l::getAll" alt="" coords="588,2523,740,2570"/><area shape="rect" id="node40" href="../../d9/d5e/a00295.html#a1db1e317f2592dea3a1f3e1ddb56197d" title="rocksdb::Compaction\l::BottomMostLevel" alt="" coords="591,2592,737,2639"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#aa4a580611125396a6e0072010fced806" title="rocksdb::DBImpl::Allocate\lCompactionOutputFileNumbers" alt="" coords="561,1115,767,1162"/><area shape="rect" id="node46" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="859,1822,1000,1868"/><area shape="rect" id="node48" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="577,2662,751,2692"/><area shape="rect" id="node50" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0" title="rocksdb::DBImpl::user\l_comparator" alt="" coords="588,555,740,602"/><area shape="rect" id="node52" href="../../df/d95/a00299.html#ad2f52f4205cf56125d0e9d1c4929727d" title="rocksdb::DBImpl::Compaction\lState::GetFilterContext" alt="" coords="565,624,763,671"/><area shape="rect" id="node55" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc" title="rocksdb::port::AtomicPointer\l::NoBarrier_Load" alt="" coords="1079,1006,1265,1052"/><area shape="rect" id="node57" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="865,1897,993,1926"/><area shape="rect" id="node59" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="859,1959,1000,2006"/><area shape="rect" id="node69" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="848,1164,1011,1193"/><area shape="rect" id="node73" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1" title="rocksdb::port::CondVar\l::SignalAll" alt="" coords="585,694,743,740"/><area shape="rect" id="node75" href="../../d9/d5e/a00295.html#a405df211f8acdf4a025b6667245985ec" title="rocksdb::Compaction\l::ShouldStopBefore" alt="" coords="591,763,737,810"/><area shape="rect" id="node77" href="../../dd/df5/a00386.html#ab378543940b68e279594acd5af9ef594" title="rocksdb::DBImpl::FinishCompaction\lOutputFile" alt="" coords="548,1510,780,1556"/><area shape="rect" id="node79" href="../../df/d95/a00299.html#a67556dd7e1a4157598db71a86165dd40" title="rocksdb::DBImpl::Compaction\lState::current_output" alt="" coords="831,1604,1028,1651"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#aa87722c52593b34fb815ca86eede3494" title="rocksdb::UpdateInternalKey" alt="" coords="572,833,756,862"/><area shape="rect" id="node89" href="../../de/daf/a01417.html#a8f740f146e792dc89409f8402a61ad04" title="rocksdb::Slice::clear" alt="" coords="593,886,735,916"/><area shape="rect" id="node91" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="593,940,735,969"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#aeb1d7919e60faa30ad63a70ce932e109" title="rocksdb::DBImpl::findEarliest\lVisibleSnapshot" alt="" coords="568,1579,760,1626"/><area shape="rect" id="node96" href="../../d9/d5e/a00295.html#a53e0c2555b1e84479ba222ad0631d747" title="rocksdb::Compaction\l::IsBaseLevelForKey" alt="" coords="591,992,737,1039"/><area shape="rect" id="node99" href="../../dd/df5/a00386.html#af9b32f2f68613634aaf0252e1fb143d2" title="rocksdb::DBImpl::OpenCompaction\lOutputFile" alt="" coords="549,1920,779,1967"/><area shape="rect" id="node104" href="../../d9/d5e/a00295.html#abfdd0bc6e7a457377c45f15c89be37e7" title="rocksdb::Compaction\l::output_level" alt="" coords="856,2030,1003,2076"/><area shape="rect" id="node107" href="../../d4/d87/a03436.html#a79e23f5792d55281c43f7a8ea8588fea" title="rocksdb::GetInternalKeySeqno" alt="" coords="564,2142,764,2172"/><area shape="rect" id="node112" href="../../de/de6/a00723.html#a87df954d098adf219ebd79ae6f5b75f3" title="rocksdb::InternalKey\l::DecodeFrom" alt="" coords="593,2195,735,2242"/><area shape="rect" id="node116" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="623,1062,705,1092"/><area shape="rect" id="node118" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="621,1236,707,1265"/><area shape="rect" id="node120" href="../../d9/d5e/a00295.html#a37f93f7e5f747a03eb37894c1e950e84" title="rocksdb::Compaction\l::MaxOutputFileSize" alt="" coords="591,1339,737,1386"/><area shape="rect" id="node123" href="../../d9/d5e/a00295.html#a31e5be150c385f6df320ee7f7daf7a9a" title="rocksdb::Compaction\l::input" alt="" coords="591,1648,737,1695"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a5c7b18fec45d2a89a72902476d846566_icgraph.png" border="0" usemap="#dd/df5/a00386_a5c7b18fec45d2a89a72902476d846566_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a5c7b18fec45d2a89a72902476d846566_icgraph" id="dd/df5/a00386_a5c7b18fec45d2a89a72902476d846566_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="251,250,448,297"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="496,267,744,296"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="792,258,1013,305"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1079,77,1241,123"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1061,146,1259,193"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1073,267,1247,296"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1072,1099,1248,1128"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1063,1462,1257,1509"/><area shape="rect" id="node54" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1093,891,1227,920"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1360,93,1469,123"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1324,23,1505,70"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1629,59,1739,88"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1605,5,1763,35"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1309,155,1520,184"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1340,261,1489,291"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1312,208,1517,237"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="1629,235,1739,264"/><area shape="rect" id="node32" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="1633,288,1735,317"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1581,533,1787,563"/><area shape="rect" id="node36" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="1601,341,1767,371"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="1629,181,1739,211"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1360,1573,1469,1603"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1336,1627,1493,1656"/><area shape="rect" id="node50" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="1629,1657,1739,1687"/><area shape="rect" id="node52" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="1589,1587,1779,1634"/><area shape="rect" id="node56" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1333,751,1496,798"/><area shape="rect" id="node60" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1344,821,1485,867"/><area shape="rect" id="node64" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1315,891,1515,920"/><area shape="rect" id="node66" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1319,944,1511,973"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1360,1067,1469,1096"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1325,1120,1504,1149"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1335,1173,1495,1219"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1353,699,1476,728"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1347,1242,1483,1289"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1319,1311,1511,1358"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1319,1381,1511,1427"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1307,1451,1523,1480"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1333,1503,1496,1550"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1389,315,1440,344"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1345,367,1484,414"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1325,437,1504,483"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1333,506,1496,553"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1332,576,1497,605"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1345,629,1484,675"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1343,997,1487,1043"/><area shape="rect" id="node58" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1603,751,1765,798"/><area shape="rect" id="node62" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1597,829,1771,859"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1571,909,1797,955"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="1597,979,1771,1008"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a497121b80918b7283fae65d8bfe01fc4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::BackgroundFlush </td>
          <td>(</td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>madeProgress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/dea/a00408.html">DeletionState</a> &amp;&#160;</td>
          <td class="paramname"><em>deletion_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01635">1635</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00332">bg_flush_scheduled_</a>, <a class="el" href="../../db/d44/a02564_source.html#l01113">FlushMemTableToOutputFile()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00312">imm_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00046">rocksdb::MemTableList::IsFlushPending()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00413">rocksdb::Options::max_background_flushes</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00167">rocksdb::Options::min_write_buffer_number_to_merge</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01648">BackgroundCallFlush()</a>.</p>
<div class="fragment"><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                                                              {</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> stat;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;  <span class="keywordflow">while</span> (stat.ok() &amp;&amp;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;         <a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36">IsFlushPending</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a115f9538bf76bb2a2929567292510d98">min_write_buffer_number_to_merge</a>)) {</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        <span class="stringliteral">&quot;BackgroundCallFlush doing FlushMemTableToOutputFile, flush slots available %d&quot;</span>,</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#ad717a693361008e48cdc0ce1fb72df84">max_background_flushes</a> - <a class="code" href="../../dd/df5/a00386.html#aca89b02f26787b31bba9a8690b4be42d">bg_flush_scheduled_</a>);</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    stat = <a class="code" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e">FlushMemTableToOutputFile</a>(madeProgress, deletion_state);</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;  }</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;  <span class="keywordflow">return</span> stat;</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a497121b80918b7283fae65d8bfe01fc4_cgraph.png" border="0" usemap="#dd/df5/a00386_a497121b80918b7283fae65d8bfe01fc4_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a497121b80918b7283fae65d8bfe01fc4_cgraph" id="dd/df5/a00386_a497121b80918b7283fae65d8bfe01fc4_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="251,1091,440,1138"/><area shape="rect" id="node9" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="520,1870,677,1916"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1079,200,1175,229"/><area shape="rect" id="node69" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1059,1352,1195,1381"/><area shape="rect" id="node5" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1056,516,1197,563"/><area shape="rect" id="node7" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="520,1454,677,1500"/><area shape="rect" id="node15" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="791,97,953,126"/><area shape="rect" id="node19" href="../../d7/dd4/a00968.html#ab919b8b2b4a57174e618272f0f6dd7a2" title="rocksdb::MemTableList\l::PickMemtablesToFlush" alt="" coords="516,743,681,790"/><area shape="rect" id="node23" href="../../d3/dcd/a00965.html#a1345f2a7f5bbb0416dfb6290ab6eea0b" title="rocksdb::MemTable::\lGetEdits" alt="" coords="527,200,671,247"/><area shape="rect" id="node25" href="../../d2/d86/a01798.html#ab2a5ed0c015e8ccecf147de0bf2a6d12" title="rocksdb::VersionEdit\l::SetPrevLogNumber" alt="" coords="527,270,671,316"/><area shape="rect" id="node27" href="../../d2/d86/a01798.html#a8d557cf30bde88010eff4307cc3d385f" title="rocksdb::VersionEdit\l::SetLogNumber" alt="" coords="528,1160,669,1207"/><area shape="rect" id="node29" href="../../dd/df5/a00386.html#ac3d320a145d5d36cb2bbf9e57b39ae8a" title="rocksdb::DBImpl::WriteLevel0\lTable" alt="" coords="500,1091,697,1138"/><area shape="rect" id="node90" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="779,1800,965,1847"/><area shape="rect" id="node92" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="500,431,697,478"/><area shape="rect" id="node113" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df" title="rocksdb::DBImpl::MaybeSchedule\lLogDBDeployStats" alt="" coords="488,1800,709,1847"/><area shape="rect" id="node11" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc" title="rocksdb::port::AtomicPointer\l::NoBarrier_Load" alt="" coords="779,2046,965,2092"/><area shape="rect" id="node17" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1047,97,1207,126"/><area shape="rect" id="node21" href="../../de/d76/a00134.html#a30ba8a8f96b44b0802aee9bc9c16c58a" title="rocksdb::port::AtomicPointer\l::Release_Store" alt="" coords="779,491,965,538"/><area shape="rect" id="node32" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="785,1246,959,1276"/><area shape="rect" id="node35" href="../../d4/d87/a03436.html#a678cf0fa28a2449c444344ea1feef654" title="rocksdb::NewMergingIterator" alt="" coords="777,1678,967,1708"/><area shape="rect" id="node39" href="../../dc/de6/a01426.html#aab9c275d08ac06c7ca97116328298b9c" title="rocksdb::SnapshotList\l::GetNewest" alt="" coords="796,1731,948,1778"/><area shape="rect" id="node46" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="797,1350,947,1380"/><area shape="rect" id="node48" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="1056,667,1197,714"/><area shape="rect" id="node52" href="../../d4/d87/a03436.html#a54b259d9ef3d218359bf85355d87aa8e" title="rocksdb::BuildTable" alt="" coords="804,1625,940,1654"/><area shape="rect" id="node71" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0" title="rocksdb::DBImpl::user\l_comparator" alt="" coords="796,1403,948,1450"/><area shape="rect" id="node73" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="1063,817,1191,846"/><area shape="rect" id="node75" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="1056,736,1197,783"/><area shape="rect" id="node78" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="792,934,952,964"/><area shape="rect" id="node80" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1041,1033,1212,1062"/><area shape="rect" id="node83" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="801,987,943,1034"/><area shape="rect" id="node85" href="../../d4/dd1/a01797.html#a8cd69a62e51d319948e7e85cdc5686c3" title="rocksdb::Version::PickLevel\lForMemTableOutput" alt="" coords="780,1056,964,1103"/><area shape="rect" id="node87" href="../../d2/d86/a01798.html#a62a14d8606dbc1d557b6e3bb55c617dd" title="rocksdb::VersionEdit\l::AddFile" alt="" coords="801,1126,943,1172"/><area shape="rect" id="node37" href="../../d4/d87/a03436.html#abf92c452806fb54068f27e6034878f16" title="rocksdb::NewEmptyIterator" alt="" coords="1036,1786,1217,1816"/><area shape="rect" id="node41" href="../../dc/de6/a01426.html#acc40bb270942cc53168b9c718288b283" title="rocksdb::SnapshotList\l::empty" alt="" coords="1279,1859,1431,1906"/><area shape="rect" id="node43" href="../../dc/de6/a01426.html#afa2592669bdf476838c672623a519728" title="rocksdb::SnapshotList\l::newest" alt="" coords="1051,1890,1203,1936"/><area shape="rect" id="node50" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1268,710,1441,740"/><area shape="rect" id="node54" href="../../d2/dcc/a01623.html#ad007bf262f2bd82e6a88d994c0d94e95" title="rocksdb::TableBuilder\l::Abandon" alt="" coords="1053,1524,1200,1571"/><area shape="rect" id="node56" href="../../d2/dcc/a01623.html#a771e9853403a3ee66a66929e75d63f81" title="rocksdb::TableBuilder::Add" alt="" coords="1037,1594,1216,1624"/><area shape="rect" id="node58" href="../../d9/d75/a01843.html#ade502f1bafbb7db1b916d28ca16cc752" title="rocksdb::WritableFile\l::Close" alt="" coords="1055,1647,1199,1694"/><area shape="rect" id="node60" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="1055,1716,1199,1763"/><area shape="rect" id="node62" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1285,1434,1424,1464"/><area shape="rect" id="node64" href="../../de/de6/a00723.html#a87df954d098adf219ebd79ae6f5b75f3" title="rocksdb::InternalKey\l::DecodeFrom" alt="" coords="1056,1455,1197,1502"/><area shape="rect" id="node67" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="1044,1096,1209,1125"/><area shape="rect" id="node98" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="803,763,941,810"/><area shape="rect" id="node108" href="../../d3/dcd/a00965.html#a35a338dd8c1096c850b1bdd3969aeee4" title="rocksdb::MemTable::\lUnref" alt="" coords="800,371,944,418"/><area shape="rect" id="node110" href="../../d2/d86/a01798.html#a9a7a27d2f256bfadb0b538c97c5524a1" title="rocksdb::VersionEdit\l::Clear" alt="" coords="801,302,943,348"/><area shape="rect" id="node116" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="772,1940,972,1969"/><area shape="rect" id="node119" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="792,1993,952,2022"/><area shape="rect" id="node121" href="../../dd/df5/a00386.html#a3b86ec3494acbb6dbb8f2fdace967183" title="rocksdb::DBImpl::BGLogDBDeploy\lStats" alt="" coords="759,1870,985,1916"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a497121b80918b7283fae65d8bfe01fc4_icgraph.png" border="0" usemap="#dd/df5/a00386_a497121b80918b7283fae65d8bfe01fc4_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a497121b80918b7283fae65d8bfe01fc4_icgraph" id="dd/df5/a00386_a497121b80918b7283fae65d8bfe01fc4_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="251,230,448,277"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="496,212,707,241"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="755,230,976,277"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1041,23,1204,70"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1279,143,1476,190"/><area shape="rect" id="node25" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1024,143,1221,190"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1036,264,1209,293"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1035,1149,1211,1179"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1025,1517,1220,1563"/><area shape="rect" id="node56" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1056,939,1189,968"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1323,5,1432,35"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1287,58,1468,105"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1603,83,1712,112"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1579,29,1736,59"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1533,153,1781,183"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1303,264,1452,293"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1275,317,1480,347"/><area shape="rect" id="node32" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="1603,209,1712,239"/><area shape="rect" id="node34" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="1607,263,1708,292"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1555,369,1760,399"/><area shape="rect" id="node38" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="1575,316,1740,345"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="1603,423,1712,452"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1323,1629,1432,1659"/><area shape="rect" id="node50" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1299,1683,1456,1712"/><area shape="rect" id="node52" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="1603,1713,1712,1743"/><area shape="rect" id="node54" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="1563,1643,1752,1690"/><area shape="rect" id="node58" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1296,685,1459,731"/><area shape="rect" id="node62" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1307,807,1448,854"/><area shape="rect" id="node66" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1277,755,1477,784"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1281,877,1473,907"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1323,1000,1432,1029"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1288,1053,1467,1083"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1297,1106,1457,1153"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1316,371,1439,400"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1309,1175,1445,1222"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1281,1245,1473,1291"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1281,1314,1473,1361"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1269,1384,1485,1413"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1296,1437,1459,1483"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1352,1507,1403,1536"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1308,1559,1447,1606"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1288,423,1467,470"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1296,493,1459,539"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1295,563,1460,592"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1308,615,1447,662"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1305,930,1449,977"/><area shape="rect" id="node60" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1576,685,1739,731"/><area shape="rect" id="node64" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1571,816,1744,845"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1544,869,1771,915"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3b86ec3494acbb6dbb8f2fdace967183"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::BGLogDBDeployStats </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>db</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/d12/a02571_source.html#l00047">47</a> of file <a class="el" href="../../d7/d12/a02571_source.html">db_stats_logger.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l02479">db</a>, and <a class="el" href="../../d7/d12/a02571_source.html#l00052">LogDBDeployStats()</a>.</p>

<p>Referenced by <a class="el" href="../../d7/d12/a02571_source.html#l00022">MaybeScheduleLogDBDeployStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                        {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a23ac2b183dd4ff1459cfa34bd17b065e">DBImpl</a>* db_inst = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="../../dd/df5/a00386.html#a23ac2b183dd4ff1459cfa34bd17b065e">DBImpl</a>*<span class="keyword">&gt;</span>(<a class="code" href="../../db/d44/a02564.html#a22e641d23ca36f47aa7b2b551bec1dc6">db</a>);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  db_inst-&gt;LogDBDeployStats();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a3b86ec3494acbb6dbb8f2fdace967183_cgraph.png" border="0" usemap="#dd/df5/a00386_a3b86ec3494acbb6dbb8f2fdace967183_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a3b86ec3494acbb6dbb8f2fdace967183_cgraph" id="dd/df5/a00386_a3b86ec3494acbb6dbb8f2fdace967183_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a5ce77d938c703a205124f8ef0cd6156c" title="rocksdb::DBImpl::LogDBDeploy\lStats" alt="" coords="284,143,492,190"/><area shape="rect" id="node5" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="571,5,712,51"/><area shape="rect" id="node9" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="548,74,735,121"/><area shape="rect" id="node11" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1" title="rocksdb::port::CondVar\l::SignalAll" alt="" coords="563,143,720,190"/><area shape="rect" id="node14" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="571,213,712,259"/><area shape="rect" id="node17" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="541,283,741,312"/><area shape="rect" id="node7" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="791,152,964,181"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a3b86ec3494acbb6dbb8f2fdace967183_icgraph.png" border="0" usemap="#dd/df5/a00386_a3b86ec3494acbb6dbb8f2fdace967183_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a3b86ec3494acbb6dbb8f2fdace967183_icgraph" id="dd/df5/a00386_a3b86ec3494acbb6dbb8f2fdace967183_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df" title="rocksdb::DBImpl::MaybeSchedule\lLogDBDeployStats" alt="" coords="283,639,504,686"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="552,558,741,605"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1331,613,1528,659"/><area shape="rect" id="node22" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2173,661,2307,691"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1085,485,1283,531"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1085,566,1283,613"/><area shape="rect" id="node102" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="791,596,1036,625"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2141,555,2339,602"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1576,647,1824,676"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1872,586,2093,633"/><area shape="rect" id="node24" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2413,22,2576,69"/><area shape="rect" id="node28" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2424,126,2565,173"/><area shape="rect" id="node32" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2395,213,2595,243"/><area shape="rect" id="node34" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2399,267,2591,296"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2440,320,2549,349"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2405,373,2584,403"/><area shape="rect" id="node48" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2415,426,2575,473"/><area shape="rect" id="node52" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2433,496,2556,525"/><area shape="rect" id="node60" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2427,549,2563,595"/><area shape="rect" id="node62" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2399,618,2591,665"/><area shape="rect" id="node64" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2399,687,2591,734"/><area shape="rect" id="node70" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2387,757,2603,787"/><area shape="rect" id="node74" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2413,810,2576,857"/><area shape="rect" id="node80" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2469,880,2520,909"/><area shape="rect" id="node82" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2425,933,2564,979"/><area shape="rect" id="node88" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2405,1002,2584,1049"/><area shape="rect" id="node90" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2413,1071,2576,1118"/><area shape="rect" id="node96" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2412,1141,2577,1171"/><area shape="rect" id="node98" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2425,1194,2564,1241"/><area shape="rect" id="node100" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2423,1263,2567,1310"/><area shape="rect" id="node26" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2689,5,2852,51"/><area shape="rect" id="node30" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2684,75,2857,104"/><area shape="rect" id="node36" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="2657,197,2884,243"/><area shape="rect" id="node38" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="2684,267,2857,296"/><area shape="rect" id="node40" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="2684,127,2857,174"/><area shape="rect" id="node46" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2745,320,2796,349"/><area shape="rect" id="node50" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="2691,373,2851,419"/><area shape="rect" id="node54" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2668,496,2873,525"/><area shape="rect" id="node56" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="2669,549,2872,595"/><area shape="rect" id="node58" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="2716,443,2825,472"/><area shape="rect" id="node66" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="2675,687,2867,734"/><area shape="rect" id="node68" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="2675,618,2867,665"/><area shape="rect" id="node72" href="../../db/d84/a02686.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2745,757,2796,787"/><area shape="rect" id="node76" href="../../da/dee/a00383.html#a8cdb390521098e2a5f737561e9eb1134" title="rocksdb::DBConstructor\l::DBConstructor" alt="" coords="2689,879,2852,926"/><area shape="rect" id="node78" href="../../da/dee/a00383.html#ae9772754567f1b3c0ca7d5285a56ac6d" title="rocksdb::DBConstructor\l::FinishImpl" alt="" coords="2689,810,2852,857"/><area shape="rect" id="node84" href="../../d3/daa/a01577.html#af7e726bf27e216787e7c331834ec6075" title="rocksdb::StressTest::Run" alt="" coords="2685,1019,2856,1048"/><area shape="rect" id="node86" href="../../d3/daa/a01577.html#aeac9f55bde5a11da0fcc2c88465de0c6" title="rocksdb::StressTest\l::Reopen" alt="" coords="2701,949,2840,995"/><area shape="rect" id="node92" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="2652,1129,2889,1175"/><area shape="rect" id="node94" href="../../de/d9d/a00813.html#ab355fd20f7ef62b0cb2e673a6a2d9bec" title="rocksdb::LDBCommand::Run" alt="" coords="2673,1076,2868,1105"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0f92fd02fffbe404bbdffc1bd24195d7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::BGWorkCompaction </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>db</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01631">1631</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02479">db</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                                      {</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="../../dd/df5/a00386.html#a23ac2b183dd4ff1459cfa34bd17b065e">DBImpl</a>*<span class="keyword">&gt;</span>(<a class="code" href="../../db/d44/a02564.html#a22e641d23ca36f47aa7b2b551bec1dc6">db</a>)-&gt;<a class="code" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91">BackgroundCallCompaction</a>();</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a0f92fd02fffbe404bbdffc1bd24195d7_cgraph.png" border="0" usemap="#dd/df5/a00386_a0f92fd02fffbe404bbdffc1bd24195d7_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a0f92fd02fffbe404bbdffc1bd24195d7_cgraph" id="dd/df5/a00386_a0f92fd02fffbe404bbdffc1bd24195d7_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="301,1120,499,1167"/><area shape="rect" id="node5" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="1691,410,1877,456"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="568,1120,765,1167"/><area shape="rect" id="node15" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1716,1498,1852,1528"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1463,1756,1559,1785"/><area shape="rect" id="node41" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="1171,322,1312,368"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="1177,1781,1305,1810"/><area shape="rect" id="node50" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="1171,132,1312,179"/><area shape="rect" id="node62" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df" title="rocksdb::DBImpl::MaybeSchedule\lLogDBDeployStats" alt="" coords="1400,612,1621,659"/><area shape="rect" id="node72" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1" title="rocksdb::port::CondVar\l::SignalAll" alt="" coords="1163,202,1320,248"/><area shape="rect" id="node77" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1425,2414,1596,2444"/><area shape="rect" id="node84" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1131,63,1352,110"/><area shape="rect" id="node95" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="856,2030,1061,2076"/><area shape="rect" id="node99" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="1139,2090,1344,2136"/><area shape="rect" id="node107" href="../../dd/df5/a00386.html#a9ca9562b2a7a0a8e0645db22648a2ac5" title="rocksdb::DBImpl::MaybeDump\lStats" alt="" coords="565,1864,768,1911"/><area shape="rect" id="node120" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="852,2342,1065,2388"/><area shape="rect" id="node148" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="547,218,787,248"/><area shape="rect" id="node10" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1440,1120,1581,1167"/><area shape="rect" id="node12" href="../../dd/df5/a00386.html#a0d04c5afc2255f2160046afed2398cbd" title="rocksdb::DBImpl::Cleanup\lCompaction" alt="" coords="1153,1458,1329,1504"/><area shape="rect" id="node17" href="../../de/de6/a00723.html#a1f29087f48fd168fe431e4b884f5aed1" title="rocksdb::InternalKey\l::DebugString" alt="" coords="888,1294,1029,1340"/><area shape="rect" id="node25" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="836,861,1081,890"/><area shape="rect" id="node53" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="1432,442,1589,488"/><area shape="rect" id="node55" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="1147,594,1336,640"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2" title="rocksdb::ParseInternalKey" alt="" coords="1153,1282,1329,1312"/><area shape="rect" id="node21" href="../../d6/d80/a01076.html#a36870425cc00e160004d62bd6118a24d" title="rocksdb::ParsedInternalKey\l::DebugString" alt="" coords="1151,1335,1332,1382"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#a4bf89f1a48c96450ef0d88b5c9f0a1ec" title="rocksdb::EscapeString" alt="" coords="1164,1405,1319,1434"/><area shape="rect" id="node29" href="../../d9/d5e/a00295.html#ae0e14955026684df1c7e261dc31fcb70" title="rocksdb::Compaction\l::num_input_files" alt="" coords="1168,714,1315,760"/><area shape="rect" id="node31" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="1168,783,1315,830"/><area shape="rect" id="node33" href="../../d9/d5e/a00295.html#ab758c022170f7bb2421feae0d2f9de90" title="rocksdb::Compaction\l::score" alt="" coords="1168,852,1315,899"/><area shape="rect" id="node35" href="../../d9/d5e/a00295.html#a689b7c58190c1fee9c0fd22e7ff79ea3" title="rocksdb::Compaction\l::Summary" alt="" coords="1168,922,1315,968"/><area shape="rect" id="node37" href="../../dc/de6/a01426.html#ab55f97d15a5529dec33ece4781c23955" title="rocksdb::SnapshotList\l::getAll" alt="" coords="1165,991,1317,1038"/><area shape="rect" id="node39" href="../../d9/d5e/a00295.html#a1db1e317f2592dea3a1f3e1ddb56197d" title="rocksdb::Compaction\l::BottomMostLevel" alt="" coords="1168,1060,1315,1107"/><area shape="rect" id="node45" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="1155,1936,1328,1965"/><area shape="rect" id="node43" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1424,224,1597,253"/><area shape="rect" id="node65" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="1684,1049,1884,1078"/><area shape="rect" id="node68" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="1704,506,1864,536"/><area shape="rect" id="node70" href="../../dd/df5/a00386.html#a3b86ec3494acbb6dbb8f2fdace967183" title="rocksdb::DBImpl::BGLogDBDeploy\lStats" alt="" coords="1671,612,1897,659"/><area shape="rect" id="node79" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1709,2414,1859,2444"/><area shape="rect" id="node90" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1405,120,1616,149"/><area shape="rect" id="node101" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="1423,2097,1599,2126"/><area shape="rect" id="node110" href="../../dd/df5/a00386.html#ae57d4ca72d8c220fe8a384531433e585" title="rocksdb::DBImpl::GetProperty" alt="" coords="860,1977,1057,2006"/><area shape="rect" id="node114" href="../../dd/df5/a00386.html#aa52b644196bb47c051055a7a9a827fcd" title="rocksdb::DBImpl::PrintStatistics" alt="" coords="853,1873,1064,1902"/><area shape="rect" id="node122" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="1160,2381,1323,2410"/><area shape="rect" id="node124" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1165,2434,1317,2464"/><area shape="rect" id="node126" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="1428,2260,1593,2289"/><area shape="rect" id="node129" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="1153,2488,1329,2517"/><area shape="rect" id="node131" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="1140,2541,1343,2570"/><area shape="rect" id="node135" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="1428,2581,1593,2610"/><area shape="rect" id="node137" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="1135,2311,1348,2358"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a0f92fd02fffbe404bbdffc1bd24195d7_icgraph.png" border="0" usemap="#dd/df5/a00386_a0f92fd02fffbe404bbdffc1bd24195d7_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a0f92fd02fffbe404bbdffc1bd24195d7_icgraph" id="dd/df5/a00386_a0f92fd02fffbe404bbdffc1bd24195d7_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="301,278,523,325"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="588,58,751,105"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="571,127,768,174"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="825,366,1023,413"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="571,367,768,414"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="583,488,756,517"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="581,5,757,35"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="572,247,767,294"/><area shape="rect" id="node54" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="603,1127,736,1156"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="869,128,979,157"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="833,58,1015,105"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1139,40,1248,69"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1115,93,1272,123"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="819,188,1029,217"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="849,436,999,465"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="821,489,1027,519"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="1139,472,1248,501"/><area shape="rect" id="node32" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="1143,365,1244,395"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1091,525,1296,555"/><area shape="rect" id="node36" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="1111,419,1276,448"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="1139,579,1248,608"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="869,5,979,35"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="845,256,1003,285"/><area shape="rect" id="node50" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="1139,225,1248,255"/><area shape="rect" id="node52" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="1099,278,1288,325"/><area shape="rect" id="node56" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="843,1433,1005,1479"/><area shape="rect" id="node60" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="853,1502,995,1549"/><area shape="rect" id="node64" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="824,1572,1024,1601"/><area shape="rect" id="node66" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="828,1625,1020,1655"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="869,1748,979,1777"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="835,543,1013,572"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="844,595,1004,642"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="863,1380,985,1409"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="856,665,992,711"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="828,734,1020,781"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="828,803,1020,850"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="816,873,1032,903"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="843,926,1005,973"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="899,996,949,1025"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="855,1049,993,1095"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="835,1118,1013,1165"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="843,1187,1005,1234"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="841,1257,1007,1287"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="855,1310,993,1357"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="852,1678,996,1725"/><area shape="rect" id="node58" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1112,1433,1275,1479"/><area shape="rect" id="node62" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1107,1511,1280,1540"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1080,1647,1307,1694"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="1107,1595,1280,1624"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7f35702e61b4f7ec3eb12e91432dca47"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::BGWorkFlush </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>db</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01627">1627</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l01648">BackgroundCallFlush()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02479">db</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                                 {</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="../../dd/df5/a00386.html#a23ac2b183dd4ff1459cfa34bd17b065e">DBImpl</a>*<span class="keyword">&gt;</span>(<a class="code" href="../../db/d44/a02564.html#a22e641d23ca36f47aa7b2b551bec1dc6">db</a>)-&gt;<a class="code" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59">BackgroundCallFlush</a>();</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a7f35702e61b4f7ec3eb12e91432dca47_cgraph.png" border="0" usemap="#dd/df5/a00386_a7f35702e61b4f7ec3eb12e91432dca47_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a7f35702e61b4f7ec3eb12e91432dca47_cgraph" id="dd/df5/a00386_a7f35702e61b4f7ec3eb12e91432dca47_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="264,1741,461,1787"/><area shape="rect" id="node5" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="1623,418,1809,465"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="804,817,1001,863"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1924,637,2020,667"/><area shape="rect" id="node37" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="1645,1675,1787,1722"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="1652,1796,1780,1825"/><area shape="rect" id="node43" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="1645,1606,1787,1653"/><area shape="rect" id="node46" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1887,2067,2057,2096"/><area shape="rect" id="node50" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1904,1229,2040,1259"/><area shape="rect" id="node71" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="1337,1357,1543,1403"/><area shape="rect" id="node75" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="1613,1537,1819,1583"/><area shape="rect" id="node83" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="509,821,731,867"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="1333,2111,1547,2158"/><area shape="rect" id="node147" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1" title="rocksdb::port::CondVar\l::SignalAll" alt="" coords="1361,1954,1519,2001"/><area shape="rect" id="node150" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="1320,1749,1560,1779"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="1079,817,1268,863"/><area shape="rect" id="node15" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="1361,194,1519,241"/><area shape="rect" id="node11" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1645,1059,1787,1106"/><area shape="rect" id="node13" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="1361,757,1519,803"/><area shape="rect" id="node21" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="1635,688,1797,717"/><area shape="rect" id="node23" href="../../d7/dd4/a00968.html#ab919b8b2b4a57174e618272f0f6dd7a2" title="rocksdb::MemTableList\l::PickMemtablesToFlush" alt="" coords="1357,826,1523,873"/><area shape="rect" id="node25" href="../../d3/dcd/a00965.html#a1345f2a7f5bbb0416dfb6290ab6eea0b" title="rocksdb::MemTable::\lGetEdits" alt="" coords="1368,895,1512,942"/><area shape="rect" id="node27" href="../../d2/d86/a01798.html#ab2a5ed0c015e8ccecf147de0bf2a6d12" title="rocksdb::VersionEdit\l::SetPrevLogNumber" alt="" coords="1368,965,1512,1011"/><area shape="rect" id="node29" href="../../d2/d86/a01798.html#a8d557cf30bde88010eff4307cc3d385f" title="rocksdb::VersionEdit\l::SetLogNumber" alt="" coords="1369,1034,1511,1081"/><area shape="rect" id="node31" href="../../dd/df5/a00386.html#ac3d320a145d5d36cb2bbf9e57b39ae8a" title="rocksdb::DBImpl::WriteLevel0\lTable" alt="" coords="1341,1426,1539,1473"/><area shape="rect" id="node54" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="1341,637,1539,683"/><area shape="rect" id="node60" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df" title="rocksdb::DBImpl::MaybeSchedule\lLogDBDeployStats" alt="" coords="1329,466,1551,513"/><area shape="rect" id="node17" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc" title="rocksdb::port::AtomicPointer\l::NoBarrier_Load" alt="" coords="1623,194,1809,241"/><area shape="rect" id="node34" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="1629,1383,1803,1412"/><area shape="rect" id="node39" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1885,1684,2059,1713"/><area shape="rect" id="node48" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="2159,2065,2308,2095"/><area shape="rect" id="node63" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="1872,1456,2072,1485"/><area shape="rect" id="node66" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="1636,365,1796,395"/><area shape="rect" id="node77" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="1884,1848,2060,1877"/><area shape="rect" id="node90" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="779,1428,1027,1457"/><area shape="rect" id="node92" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1075,1486,1272,1533"/><area shape="rect" id="node105" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="1635,2484,1797,2513"/><area shape="rect" id="node109" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1640,2327,1792,2356"/><area shape="rect" id="node112" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="1889,2221,2055,2251"/><area shape="rect" id="node128" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="1628,2172,1804,2201"/><area shape="rect" id="node130" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="1615,2380,1817,2409"/><area shape="rect" id="node135" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="1889,2275,2055,2304"/><area shape="rect" id="node137" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="1609,1950,1823,1997"/><area shape="rect" id="node107" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1891,2380,2053,2409"/><area shape="rect" id="node114" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="2120,2169,2347,2199"/><area shape="rect" id="node116" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="2399,2252,2548,2281"/><area shape="rect" id="node118" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="2396,2161,2551,2207"/><area shape="rect" id="node120" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="2601,2248,2737,2277"/><area shape="rect" id="node125" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="2145,2223,2321,2252"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a7f35702e61b4f7ec3eb12e91432dca47_icgraph.png" border="0" usemap="#dd/df5/a00386_a7f35702e61b4f7ec3eb12e91432dca47_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a7f35702e61b4f7ec3eb12e91432dca47_icgraph" id="dd/df5/a00386_a7f35702e61b4f7ec3eb12e91432dca47_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="264,234,485,281"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="551,143,713,190"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="533,5,731,51"/><area shape="rect" id="node18" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="788,263,985,310"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="533,263,731,310"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="545,384,719,413"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="544,1435,720,1464"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="535,74,729,121"/><area shape="rect" id="node54" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="565,1067,699,1096"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="832,209,941,239"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="796,139,977,186"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1112,148,1221,177"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1088,201,1245,231"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1043,287,1291,316"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="812,437,961,467"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="784,384,989,413"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="1112,529,1221,559"/><area shape="rect" id="node32" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="1116,423,1217,452"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1064,736,1269,765"/><area shape="rect" id="node36" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="1084,476,1249,505"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="1112,369,1221,399"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="832,1749,941,1779"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="808,83,965,112"/><area shape="rect" id="node50" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="1112,23,1221,52"/><area shape="rect" id="node52" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="1072,75,1261,122"/><area shape="rect" id="node56" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="805,927,968,974"/><area shape="rect" id="node60" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="816,997,957,1043"/><area shape="rect" id="node64" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="787,1067,987,1096"/><area shape="rect" id="node66" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="791,1120,983,1149"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="832,1243,941,1272"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="797,1296,976,1325"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="807,1349,967,1395"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="825,875,948,904"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="819,1418,955,1465"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="791,1487,983,1534"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="791,1557,983,1603"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="779,1627,995,1656"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="805,1679,968,1726"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="861,491,912,520"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="817,543,956,590"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="797,613,976,659"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="805,682,968,729"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="804,752,969,781"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="817,805,956,851"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="815,1173,959,1219"/><area shape="rect" id="node58" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1085,927,1248,974"/><area shape="rect" id="node62" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1080,1005,1253,1035"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1053,1142,1280,1189"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="1080,1089,1253,1119"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acbfdfdd72e490648da9f229fdcd06337"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d2/dbd/a01844.html">WriteBatch</a> * rocksdb::DBImpl::BuildBatchGroup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/dd4/a01849.html">Writer</a> **&#160;</td>
          <td class="paramname"><em>last_writer</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02866">2866</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d6/dca/a02616_source.html#l00241">rocksdb::WriteBatchInternal::Append()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00065">rocksdb::DBImpl::Writer::batch</a>, <a class="el" href="../../d0/dce/a02617_source.html#l00041">rocksdb::WriteBatchInternal::ByteSize()</a>, <a class="el" href="../../d6/dca/a02616_source.html#l00126">rocksdb::WriteBatchInternal::Count()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00067">rocksdb::DBImpl::Writer::disableWAL</a>, <a class="el" href="../../d0/d40/a02374_source.html#l00003">beast.util.Iter::first()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00066">rocksdb::DBImpl::Writer::sync</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00320">tmp_batch_</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00319">writers_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>.</p>
<div class="fragment"><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;                                                        {</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;  assert(!<a class="code" href="../../dd/df5/a00386.html#a2d3abc2f19390f60d4a922b98dd23450">writers_</a>.empty());</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;  Writer* <a class="code" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e">first</a> = <a class="code" href="../../dd/df5/a00386.html#a2d3abc2f19390f60d4a922b98dd23450">writers_</a>.front();</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;  WriteBatch* result = first-&gt;batch;</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;  assert(result != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;  <span class="keywordtype">size_t</span> size = <a class="code" href="../../da/d8c/a01845.html#a04c6bd515d35bda6ffa8ae21ab1e1478">WriteBatchInternal::ByteSize</a>(first-&gt;batch);</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;  <span class="comment">// Allow the group to grow up to a maximum size, but if the</span></div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;  <span class="comment">// original write is small, limit the growth so we do not slow</span></div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;  <span class="comment">// down the small write too much.</span></div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;  <span class="keywordtype">size_t</span> max_size = 1 &lt;&lt; 20;</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;  <span class="keywordflow">if</span> (size &lt;= (128&lt;&lt;10)) {</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;    max_size = size + (128&lt;&lt;10);</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;  }</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;  *last_writer = <a class="code" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e">first</a>;</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;  std::deque&lt;Writer*&gt;::iterator iter = <a class="code" href="../../dd/df5/a00386.html#a2d3abc2f19390f60d4a922b98dd23450">writers_</a>.begin();</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;  ++iter;  <span class="comment">// Advance past &quot;first&quot;</span></div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;  <span class="keywordflow">for</span> (; iter != <a class="code" href="../../dd/df5/a00386.html#a2d3abc2f19390f60d4a922b98dd23450">writers_</a>.end(); ++iter) {</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;    Writer* w = *iter;</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;    <span class="keywordflow">if</span> (w-&gt;sync &amp;&amp; !first-&gt;sync) {</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;      <span class="comment">// Do not include a sync write into a batch handled by a non-sync write.</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;    }</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;    <span class="keywordflow">if</span> (!w-&gt;disableWAL &amp;&amp; first-&gt;disableWAL) {</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;      <span class="comment">// Do not include a write that needs WAL into a batch that has</span></div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;      <span class="comment">// WAL disabled.</span></div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;    }</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    <span class="keywordflow">if</span> (w-&gt;batch != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      size += <a class="code" href="../../da/d8c/a01845.html#a04c6bd515d35bda6ffa8ae21ab1e1478">WriteBatchInternal::ByteSize</a>(w-&gt;batch);</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;      <span class="keywordflow">if</span> (size &gt; max_size) {</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;        <span class="comment">// Do not make batch too big</span></div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;      }</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;      <span class="comment">// Append to *reuslt</span></div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;      <span class="keywordflow">if</span> (result == first-&gt;batch) {</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;        <span class="comment">// Switch to temporary batch instead of disturbing caller&#39;s batch</span></div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;        result = &amp;<a class="code" href="../../dd/df5/a00386.html#adac005f654a15bf772dbd40a06ea2762">tmp_batch_</a>;</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;        assert(<a class="code" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478">WriteBatchInternal::Count</a>(result) == 0);</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;        <a class="code" href="../../da/d8c/a01845.html#a3e28aed1201077095cf66c5e242d1630">WriteBatchInternal::Append</a>(result, first-&gt;batch);</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;      }</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;      <a class="code" href="../../da/d8c/a01845.html#a3e28aed1201077095cf66c5e242d1630">WriteBatchInternal::Append</a>(result, w-&gt;batch);</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;    }</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;    *last_writer = w;</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;  }</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;  <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_acbfdfdd72e490648da9f229fdcd06337_cgraph.png" border="0" usemap="#dd/df5/a00386_acbfdfdd72e490648da9f229fdcd06337_cgraph" alt=""/></div>
<map name="dd/df5/a00386_acbfdfdd72e490648da9f229fdcd06337_cgraph" id="dd/df5/a00386_acbfdfdd72e490648da9f229fdcd06337_cgraph">
<area shape="rect" id="node3" href="../../da/d8c/a01845.html#a3e28aed1201077095cf66c5e242d1630" title="rocksdb::WriteBatchInternal\l::Append" alt="" coords="245,5,429,51"/><area shape="rect" id="node7" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="667,35,851,82"/><area shape="rect" id="node11" href="../../da/d8c/a01845.html#a04c6bd515d35bda6ffa8ae21ab1e1478" title="rocksdb::WriteBatchInternal\l::ByteSize" alt="" coords="245,125,429,171"/><area shape="rect" id="node14" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e" title="beast.util.Iter.first" alt="" coords="276,195,399,224"/><area shape="rect" id="node5" href="../../d2/dbd/a01844.html#aab1bed53a5b803c151374a4a0788257a" title="rocksdb::WriteBatch\l::Count" alt="" coords="477,5,619,51"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="900,44,1065,73"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_acbfdfdd72e490648da9f229fdcd06337_icgraph.png" border="0" usemap="#dd/df5/a00386_acbfdfdd72e490648da9f229fdcd06337_icgraph" alt=""/></div>
<map name="dd/df5/a00386_acbfdfdd72e490648da9f229fdcd06337_icgraph" id="dd/df5/a00386_acbfdfdd72e490648da9f229fdcd06337_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="247,44,404,73"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="493,13,603,43"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="453,66,643,113"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a9bdda420ec5d44390a04215d8b1cbffd" title="rocksdb::DBImpl::~DBImpl" alt="" coords="692,21,871,51"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#aaf39022d45b559b69933cfe719571c10" title="rocksdb::DBImpl::Flush" alt="" coords="701,75,861,104"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a789ea69cfa7ee4fccf934757a4641228" title="rocksdb::DBImpl::TEST\l_FlushMemTable" alt="" coords="700,241,863,287"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#aaa4a148182ce98c83d363817e938ddd5" title="rocksdb::DBImpl::GetLive\lFiles" alt="" coords="933,5,1107,51"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="965,75,1075,104"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="965,128,1075,157"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="929,181,1111,227"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1181,245,1339,275"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#a09218d973702b7be115bc4a65c0d97b9" title="rocksdb::DBTest::MakeTables" alt="" coords="920,301,1120,331"/><area shape="rect" id="node34" href="../../de/de8/a00405.html#a49dbce26ebba1e0ac3f38a3af92b9757" title="rocksdb::DeleteFileTest\l::CreateTwoLevels" alt="" coords="940,354,1100,401"/><area shape="rect" id="node36" href="../../d0/d88/a01231.html#a07eb4424cb2bef23ca200a806de76d9b" title="rocksdb::ReduceLevelTest\l::CompactMemTable" alt="" coords="931,423,1109,470"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1205,189,1315,219"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="1401,245,1511,275"/><area shape="rect" id="node31" href="../../db/d95/a00391.html#af32d610cb80f870ed942c9ec7a053675" title="rocksdb::DBTest::FillLevels" alt="" coords="1168,301,1352,331"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a26b3cfbce68c226c861cfacd4a111fe1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::DBImpl::CheckWalFileExistsAndEmpty </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073d">WalFileType</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td>
          <td class="paramname"><em>number</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01353">1353</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../da/d03/a02577_source.html#l00068">rocksdb::ArchivedLogFileName()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d">rocksdb::Env::GetFileSize()</a>, <a class="el" href="../../d2/d80/a02645_source.html#l00030">rocksdb::kAliveLogFile</a>, <a class="el" href="../../da/d03/a02577_source.html#l00060">rocksdb::LogFileName()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00384">rocksdb::Options::wal_dir</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01442">AppendSortedWalsOfType()</a>.</p>
<div class="fragment"><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                                                               {</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  <span class="keyword">const</span> std::string fname = (type == <a class="code" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073da874001c1dff78414c7b1d24534730a22">kAliveLogFile</a>) ?</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477">LogFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>, number) :</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6">ArchivedLogFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>, number);</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> file_size;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d">GetFileSize</a>(fname, &amp;file_size);</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  <span class="keywordflow">return</span> (s.ok() &amp;&amp; (file_size == 0));</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a26b3cfbce68c226c861cfacd4a111fe1_cgraph.png" border="0" usemap="#dd/df5/a00386_a26b3cfbce68c226c861cfacd4a111fe1_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a26b3cfbce68c226c861cfacd4a111fe1_cgraph" id="dd/df5/a00386_a26b3cfbce68c226c861cfacd4a111fe1_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="244,5,447,35"/><area shape="rect" id="node7" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d" title="rocksdb::Env::GetFileSize" alt="" coords="259,59,432,88"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="269,112,421,141"/><area shape="rect" id="node12" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="277,165,413,195"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="497,59,660,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a26b3cfbce68c226c861cfacd4a111fe1_icgraph.png" border="0" usemap="#dd/df5/a00386_a26b3cfbce68c226c861cfacd4a111fe1_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a26b3cfbce68c226c861cfacd4a111fe1_icgraph" id="dd/df5/a00386_a26b3cfbce68c226c861cfacd4a111fe1_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267" title="rocksdb::DBImpl::AppendSorted\lWalsOfType" alt="" coords="243,1014,453,1061"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#aa24437e34cff2bc2607adf5a382efe80" title="rocksdb::DBImpl::GetSorted\lWalFiles" alt="" coords="516,966,703,1013"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="503,1095,716,1142"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#aefb7a749f364c505a5a6b06d977cbc71" title="rocksdb::DBImpl::GetUpdates\lSince" alt="" coords="775,889,972,935"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="819,975,928,1004"/><area shape="rect" id="node9" href="../../db/d95/a00391.html#aa7a0e63b4ab38f47f7e65f92961c6625" title="rocksdb::DBTest::OpenTransaction\lLogIter" alt="" coords="1031,867,1257,914"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="767,1061,980,1107"/><area shape="rect" id="node104" href="../../dd/df5/a00386.html#ad62af2cf23b7a2da72715051e719e5f1" title="rocksdb::DBImpl::TEST\l_PurgeObsoleteteWAL" alt="" coords="792,1130,955,1177"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a2f6c0d55ec4f04c4b5f736f59fa51d4d" title="rocksdb::DBImpl::EnableFile\lDeletions" alt="" coords="1049,937,1239,983"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#a4406b5ed5487f7562bd0fe1696c6092f" title="rocksdb::DBImpl::DeleteObsolete\lFiles" alt="" coords="1567,875,1785,922"/><area shape="rect" id="node85" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1045,1061,1243,1107"/><area shape="rect" id="node92" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1835,1151,2032,1198"/><area shape="rect" id="node99" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="1051,1212,1237,1241"/><area shape="rect" id="node21" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1867,673,2000,703"/><area shape="rect" id="node23" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2123,9,2285,55"/><area shape="rect" id="node27" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2133,86,2275,133"/><area shape="rect" id="node31" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2104,160,2304,189"/><area shape="rect" id="node33" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2108,213,2300,243"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2149,267,2259,296"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2115,320,2293,349"/><area shape="rect" id="node47" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2124,373,2284,419"/><area shape="rect" id="node51" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2143,443,2265,472"/><area shape="rect" id="node59" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2136,495,2272,542"/><area shape="rect" id="node61" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2108,565,2300,611"/><area shape="rect" id="node63" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2108,634,2300,681"/><area shape="rect" id="node67" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2096,704,2312,733"/><area shape="rect" id="node69" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2123,757,2285,803"/><area shape="rect" id="node71" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2179,827,2229,856"/><area shape="rect" id="node73" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2135,879,2273,926"/><area shape="rect" id="node75" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2115,949,2293,995"/><area shape="rect" id="node77" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2123,1018,2285,1065"/><area shape="rect" id="node79" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2121,1088,2287,1117"/><area shape="rect" id="node81" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2135,1141,2273,1187"/><area shape="rect" id="node83" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2132,1210,2276,1257"/><area shape="rect" id="node25" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2408,5,2571,51"/><area shape="rect" id="node29" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2403,75,2576,104"/><area shape="rect" id="node35" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="2376,127,2603,174"/><area shape="rect" id="node37" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="2403,197,2576,227"/><area shape="rect" id="node39" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="2403,250,2576,297"/><area shape="rect" id="node45" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2464,320,2515,349"/><area shape="rect" id="node49" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="2409,373,2569,419"/><area shape="rect" id="node53" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2387,443,2592,472"/><area shape="rect" id="node55" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="2388,495,2591,542"/><area shape="rect" id="node57" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="2435,565,2544,595"/><area shape="rect" id="node65" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="2393,634,2585,681"/><area shape="rect" id="node87" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1307,1057,1517,1087"/><area shape="rect" id="node89" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1565,1091,1787,1138"/><area shape="rect" id="node94" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="2080,1280,2328,1309"/><area shape="rect" id="node102" href="../../d4/d87/a03436.html#ad19b60849d205b89e09ff716b7714f69" title="rocksdb::TEST" alt="" coords="1357,1212,1467,1241"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0d04c5afc2255f2160046afed2398cbd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::CleanupCompaction </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d95/a00299.html">CompactionState</a> *&#160;</td>
          <td class="paramname"><em>compact</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/db9/a01552.html">Status</a>&#160;</td>
          <td class="paramname"><em>status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01862">1862</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00095">rocksdb::DBImpl::CompactionState::builder</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00085">rocksdb::DBImpl::CompactionState::Output::number</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00094">rocksdb::DBImpl::CompactionState::outfile</a>, <a class="el" href="../../db/d44/a02564_source.html#l00090">rocksdb::DBImpl::CompactionState::outputs</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00326">pending_outputs_</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00301">table_cache_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                                                                      {</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;  <span class="keywordflow">if</span> (compact-&gt;builder != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="comment">// May happen if we get a shutdown call in the middle of compaction</span></div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    compact-&gt;builder-&gt;Abandon();</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    compact-&gt;builder.reset();</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    assert(compact-&gt;outfile == <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;  }</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; compact-&gt;outputs.size(); i++) {</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="keyword">const</span> CompactionState::Output&amp; out = compact-&gt;outputs[i];</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a1a62212922480c1ca92b25a555b3410e">pending_outputs_</a>.erase(out.number);</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="comment">// If this file was inserted into the table cache then remove</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="comment">// them here because this compaction was not committed.</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a1b44e75ddaf3ea3befcd06b23ca9abb6">table_cache_</a>-&gt;Evict(out.number);</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    }</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;  }</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;  <span class="keyword">delete</span> compact;</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a0d04c5afc2255f2160046afed2398cbd_cgraph.png" border="0" usemap="#dd/df5/a00386_a0d04c5afc2255f2160046afed2398cbd_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a0d04c5afc2255f2160046afed2398cbd_cgraph" id="dd/df5/a00386_a0d04c5afc2255f2160046afed2398cbd_cgraph">
<area shape="rect" id="node3" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="231,5,372,51"/><area shape="rect" id="node5" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="233,75,369,104"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a0d04c5afc2255f2160046afed2398cbd_icgraph.png" border="0" usemap="#dd/df5/a00386_a0d04c5afc2255f2160046afed2398cbd_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a0d04c5afc2255f2160046afed2398cbd_icgraph" id="dd/df5/a00386_a0d04c5afc2255f2160046afed2398cbd_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="229,281,427,327"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="475,250,672,297"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="720,267,968,296"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1016,258,1237,305"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1303,77,1465,123"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1285,146,1483,193"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1297,267,1471,296"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1296,1099,1472,1128"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1287,1462,1481,1509"/><area shape="rect" id="node56" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1317,891,1451,920"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1584,93,1693,123"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1548,23,1729,70"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1853,5,1963,35"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1829,59,1987,88"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1533,155,1744,184"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1564,261,1713,291"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1536,208,1741,237"/><area shape="rect" id="node32" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="1853,341,1963,371"/><area shape="rect" id="node34" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="1857,235,1959,264"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1805,533,2011,563"/><area shape="rect" id="node38" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="1825,288,1991,317"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="1853,181,1963,211"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1584,1573,1693,1603"/><area shape="rect" id="node50" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1560,1627,1717,1656"/><area shape="rect" id="node52" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="1853,1596,1963,1625"/><area shape="rect" id="node54" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="1813,1649,2003,1695"/><area shape="rect" id="node58" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1557,751,1720,798"/><area shape="rect" id="node62" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1568,821,1709,867"/><area shape="rect" id="node66" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1539,891,1739,920"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1543,944,1735,973"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1584,1067,1693,1096"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1549,1120,1728,1149"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1559,1173,1719,1219"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1577,699,1700,728"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1571,1242,1707,1289"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1543,1311,1735,1358"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1543,1381,1735,1427"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1531,1451,1747,1480"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1557,1503,1720,1550"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1613,315,1664,344"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1569,367,1708,414"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1549,437,1728,483"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1557,506,1720,553"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1556,576,1721,605"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1569,629,1708,675"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1567,997,1711,1043"/><area shape="rect" id="node60" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1827,751,1989,798"/><area shape="rect" id="node64" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1821,829,1995,859"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1795,935,2021,982"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aafef42f7b99bd9afdd50369bc5d37476"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::CompactRange </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> *&#160;</td>
          <td class="paramname"><em>begin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> *&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>reduce_level</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>target_level</em> = <code>-1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a14cd393c252a82be295526b3142c7860">rocksdb::DB</a>.</p>

<p>Reimplemented in <a class="el" href="../../db/db9/a00387.html#a99d57b28b801f9d05d3972c9add45570">rocksdb::DBImplReadOnly</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01184">1184</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../dc/d40/a02767_source.html#l00022">base</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../db/d44/a02564_source.html#l01279">NumberLevels()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00604">rocksdb::Version::OverlapInLevel()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01223">ReFitLevel()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01485">TEST_CompactRange()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01577">TEST_FlushMemTable()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../d9/de7/a02572_source.html#l04720">rocksdb::PrefixScanInit()</a>, and <a class="el" href="../../d9/de7/a02572_source.html#l03329">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                                                               {</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <span class="keywordtype">int</span> max_level_with_files = 1;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  {</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    Version* <a class="code" href="../../dc/d40/a02767.html#a70ff0f6c026c3dd1ef6aaf504e7fddc3">base</a> = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current();</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 1; level &lt; <a class="code" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880">NumberLevels</a>(); level++) {</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <span class="keywordflow">if</span> (base-&gt;OverlapInLevel(level, begin, end)) {</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        max_level_with_files = level;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    }</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  }</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a789ea69cfa7ee4fccf934757a4641228">TEST_FlushMemTable</a>(); <span class="comment">// TODO(sanjay): Skip if memtable does not overlap</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; max_level_with_files; level++) {</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e">TEST_CompactRange</a>(level, begin, end);</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  }</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <span class="keywordflow">if</span> (reduce_level) {</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a889fc527654cd063029f570c18173834">ReFitLevel</a>(max_level_with_files, target_level);</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  }</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aafef42f7b99bd9afdd50369bc5d37476_cgraph.png" border="0" usemap="#dd/df5/a00386_aafef42f7b99bd9afdd50369bc5d37476_cgraph" alt=""/></div>
<map name="dd/df5/a00386_aafef42f7b99bd9afdd50369bc5d37476_cgraph" id="dd/df5/a00386_aafef42f7b99bd9afdd50369bc5d37476_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="2036,445,2164,475"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="1200,387,1411,416"/><area shape="rect" id="node7" href="../../d4/dd1/a01797.html#a7b284e57a9d16bddbbc8e22f6ab97e83" title="rocksdb::Version::Overlap\lInLevel" alt="" coords="235,194,408,241"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#a889fc527654cd063029f570c18173834" title="rocksdb::DBImpl::ReFitLevel" alt="" coords="955,439,1144,468"/><area shape="rect" id="node43" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="968,559,1131,606"/><area shape="rect" id="node85" href="../../dd/df5/a00386.html#a789ea69cfa7ee4fccf934757a4641228" title="rocksdb::DBImpl::TEST\l_FlushMemTable" alt="" coords="240,959,403,1006"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a2a9d42dd05ca280f3b0e1cc47c72516b" title="rocksdb::SomeFileOverlaps\lRange" alt="" coords="460,146,641,193"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a23d744801b349e2baff0d72d664ee469" title="rocksdb::AfterFile" alt="" coords="736,128,861,157"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a7002d01d934ec06e30ddaacd72991114" title="rocksdb::BeforeFile" alt="" coords="732,5,865,35"/><area shape="rect" id="node23" href="../../de/de6/a00723.html#a6d86d2cfbd4205b41f29f84cdedf3c22" title="rocksdb::InternalKey\l::Encode" alt="" coords="979,198,1120,245"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#a382fc0a9bad90fe4253c354dd309f083" title="rocksdb::FindFile" alt="" coords="737,181,860,211"/><area shape="rect" id="node28" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="693,58,904,105"/><area shape="rect" id="node13" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="977,111,1121,158"/><area shape="rect" id="node15" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="979,19,1120,66"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ae015f9b23bbadef7eb4e3796c2d4fb46" title="rocksdb::ExtractUserKey" alt="" coords="1221,28,1389,57"/><area shape="rect" id="node33" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="2052,609,2148,639"/><area shape="rect" id="node35" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="1227,1189,1384,1235"/><area shape="rect" id="node39" href="../../dd/df5/a00386.html#ab7c2980d0da47c4557512b51231ca07c" title="rocksdb::DBImpl::FindMinimum\lEmptyLevelFitting" alt="" coords="1203,541,1408,587"/><area shape="rect" id="node37" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="2244,1168,2417,1197"/><area shape="rect" id="node41" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1517,541,1659,587"/><area shape="rect" id="node47" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1195,795,1416,842"/><area shape="rect" id="node50" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="2007,878,2193,925"/><area shape="rect" id="node52" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="1509,765,1667,811"/><area shape="rect" id="node56" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="1508,661,1668,691"/><area shape="rect" id="node58" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1483,989,1693,1019"/><area shape="rect" id="node74" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1464,835,1712,864"/><area shape="rect" id="node54" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc" title="rocksdb::port::AtomicPointer\l::NoBarrier_Load" alt="" coords="1765,765,1952,811"/><area shape="rect" id="node60" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1760,959,1957,1006"/><area shape="rect" id="node63" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="2029,1033,2171,1079"/><area shape="rect" id="node69" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="2032,1369,2168,1399"/><area shape="rect" id="node71" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="2029,1129,2171,1175"/><area shape="rect" id="node76" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1760,878,1957,925"/><area shape="rect" id="node87" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="456,1218,645,1265"/><area shape="rect" id="node89" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="720,1181,877,1211"/><area shape="rect" id="node137" href="../../dd/df5/a00386.html#a1db8d713be426c044273b2fa01c75c08" title="rocksdb::DBImpl::WaitFor\lFlushMemTable" alt="" coords="963,1353,1136,1399"/><area shape="rect" id="node92" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="952,1173,1147,1219"/><area shape="rect" id="node97" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="1235,1309,1376,1339"/><area shape="rect" id="node107" href="../../dd/df5/a00386.html#acbfdfdd72e490648da9f229fdcd06337" title="rocksdb::DBImpl::BuildBatch\lGroup" alt="" coords="955,1598,1144,1645"/><area shape="rect" id="node109" href="../../da/d8c/a01845.html#a04c6bd515d35bda6ffa8ae21ab1e1478" title="rocksdb::WriteBatchInternal\l::ByteSize" alt="" coords="1213,1653,1397,1699"/><area shape="rect" id="node111" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="1213,1583,1397,1630"/><area shape="rect" id="node114" href="../../da/d8c/a01845.html#a2c7f53a4c8d710fdbf229c917506f7ab" title="rocksdb::WriteBatchInternal\l::SetSequence" alt="" coords="957,685,1141,731"/><area shape="rect" id="node119" href="../../d4/d87/a03436.html#a48457fd59325e708afa7fff617f87e05" title="rocksdb::StartPerfTimer" alt="" coords="969,755,1129,784"/><area shape="rect" id="node121" href="../../da/d8c/a01845.html#af28dbb69a970e8ab218402339f0bb7ee" title="rocksdb::WriteBatchInternal\l::Contents" alt="" coords="957,807,1141,854"/><area shape="rect" id="node123" href="../../d4/d87/a03436.html#af0bd42ecfc79c4765b60919d28702a29" title="rocksdb::BumpPerfTime" alt="" coords="968,877,1131,907"/><area shape="rect" id="node125" href="../../da/d8c/a01845.html#aa10e1abb5f141e75e184bf456a5d65a6" title="rocksdb::WriteBatchInternal\l::InsertInto" alt="" coords="957,930,1141,977"/><area shape="rect" id="node127" href="../../d4/d87/a03436.html#a9231fa7580b3932152d6f3bd39907320" title="rocksdb::SetTickerCount" alt="" coords="967,1000,1132,1029"/><area shape="rect" id="node131" href="../../d2/dbd/a01844.html#a73502c77c1ebdf40417a34eb385e117e" title="rocksdb::WriteBatch\l::Clear" alt="" coords="979,1103,1120,1150"/><area shape="rect" id="node133" href="../../d0/d39/a00314.html#a84d028d8d526b7ce592433ba836a1853" title="rocksdb::port::CondVar\l::Signal" alt="" coords="1780,1823,1937,1870"/><area shape="rect" id="node100" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="1227,1362,1384,1409"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aafef42f7b99bd9afdd50369bc5d37476_icgraph.png" border="0" usemap="#dd/df5/a00386_aafef42f7b99bd9afdd50369bc5d37476_icgraph" alt=""/></div>
<map name="dd/df5/a00386_aafef42f7b99bd9afdd50369bc5d37476_icgraph" id="dd/df5/a00386_aafef42f7b99bd9afdd50369bc5d37476_icgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="236,5,393,35"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="260,59,369,88"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="444,5,553,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acef475ae9fa32c7caf0ba839f056d89c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::CreateArchivalDirectory </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00401">401</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../da/d03/a02577_source.html#l00065">rocksdb::ArchivalDirectory()</a>, <a class="el" href="../../db/db1/a00460.html#a52a10880d70d77d1dcad9f2fb20ce171">rocksdb::Env::CreateDirIfMissing()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00036">rocksdb::Status::OK()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00384">rocksdb::Options::wal_dir</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00510">rocksdb::Options::WAL_size_limit_MB</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00509">rocksdb::Options::WAL_ttl_seconds</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>.</p>
<div class="fragment"><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                                             {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#aa73f5eb95eebb5c22c118839c49e9d6e">WAL_ttl_seconds</a> &gt; 0 || <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#abfb13cb9e2920fa97f1de810cf3910a2">WAL_size_limit_MB</a> &gt; 0) {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    std::string archivalPath = <a class="code" href="../../d4/d87/a03436.html#a546d3e2e5c3b4aa8ee9828c7b519d501">ArchivalDirectory</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a52a10880d70d77d1dcad9f2fb20ce171">CreateDirIfMissing</a>(archivalPath);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00">Status::OK</a>();</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_acef475ae9fa32c7caf0ba839f056d89c_cgraph.png" border="0" usemap="#dd/df5/a00386_acef475ae9fa32c7caf0ba839f056d89c_cgraph" alt=""/></div>
<map name="dd/df5/a00386_acef475ae9fa32c7caf0ba839f056d89c_cgraph" id="dd/df5/a00386_acef475ae9fa32c7caf0ba839f056d89c_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a546d3e2e5c3b4aa8ee9828c7b519d501" title="rocksdb::ArchivalDirectory" alt="" coords="269,5,445,35"/><area shape="rect" id="node5" href="../../db/db1/a00460.html#a52a10880d70d77d1dcad9f2fb20ce171" title="rocksdb::Env::CreateDirIf\lMissing" alt="" coords="272,58,443,105"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="287,128,428,157"/><area shape="rect" id="node9" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="493,128,653,157"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_acef475ae9fa32c7caf0ba839f056d89c_icgraph.png" border="0" usemap="#dd/df5/a00386_acef475ae9fa32c7caf0ba839f056d89c_icgraph" alt=""/></div>
<map name="dd/df5/a00386_acef475ae9fa32c7caf0ba839f056d89c_icgraph" id="dd/df5/a00386_acef475ae9fa32c7caf0ba839f056d89c_icgraph">
<area shape="rect" id="node3" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="271,645,404,675"/><area shape="rect" id="node5" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="480,21,643,67"/><area shape="rect" id="node11" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="491,121,632,167"/><area shape="rect" id="node17" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="461,205,661,235"/><area shape="rect" id="node19" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="465,259,657,288"/><area shape="rect" id="node31" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="507,323,616,352"/><area shape="rect" id="node33" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="472,376,651,405"/><area shape="rect" id="node37" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="481,429,641,475"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="500,499,623,528"/><area shape="rect" id="node53" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="493,602,629,649"/><area shape="rect" id="node55" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="465,671,657,718"/><area shape="rect" id="node57" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="465,741,657,787"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="453,811,669,840"/><area shape="rect" id="node69" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="480,863,643,910"/><area shape="rect" id="node75" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="536,933,587,963"/><area shape="rect" id="node77" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="492,986,631,1033"/><area shape="rect" id="node85" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="472,1055,651,1102"/><area shape="rect" id="node87" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="480,1125,643,1171"/><area shape="rect" id="node95" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="755,619,920,648"/><area shape="rect" id="node98" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="492,1194,631,1241"/><area shape="rect" id="node100" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="489,1263,633,1310"/><area shape="rect" id="node7" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="756,5,919,51"/><area shape="rect" id="node9" href="../../d9/d48/a00345.html#a08cff08de4bf7d2a6f51cb498a406f0f" title="rocksdb::CorruptionTest\l::CorruptionTest" alt="" coords="1033,5,1196,51"/><area shape="rect" id="node13" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="751,75,924,104"/><area shape="rect" id="node15" href="../../d9/d66/a02562.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1089,75,1140,104"/><area shape="rect" id="node21" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="724,127,951,174"/><area shape="rect" id="node23" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="751,197,924,227"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="751,250,924,297"/><area shape="rect" id="node25" href="../../db/d95/a00391.html#a509351e18607a06285412f6654253643" title="rocksdb::DBTest::DBTest" alt="" coords="1028,197,1201,227"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#a3761d111551d33530517a39f38f908d1" title="rocksdb::DBTest::ChangeOptions" alt="" coords="1005,259,1224,288"/><area shape="rect" id="node35" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="812,320,863,349"/><area shape="rect" id="node39" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="757,373,917,419"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="735,443,940,472"/><area shape="rect" id="node47" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="736,495,939,542"/><area shape="rect" id="node51" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="783,565,892,595"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#a28f3fa7104cc330d8f573f98682e000b" title="rocksdb::TEST" alt="" coords="1060,443,1169,472"/><area shape="rect" id="node49" href="../../dc/d6a/a02779.html#a1fa3253ca11014c1b01923a1674ff19c" title="main" alt="" coords="1089,561,1140,591"/><area shape="rect" id="node59" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="741,671,933,718"/><area shape="rect" id="node63" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="741,741,933,787"/><area shape="rect" id="node61" href="../../d0/dc7/a01402.html#aa4769c7f42641f11d37d9d1a0b381bef" title="rocksdb::SimpleTableDBTest\l::SimpleTableDBTest" alt="" coords="1019,671,1211,718"/><area shape="rect" id="node67" href="../../db/d84/a02686.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="812,811,863,840"/><area shape="rect" id="node71" href="../../da/dee/a00383.html#a8cdb390521098e2a5f737561e9eb1134" title="rocksdb::DBConstructor\l::DBConstructor" alt="" coords="756,863,919,910"/><area shape="rect" id="node73" href="../../da/dee/a00383.html#ae9772754567f1b3c0ca7d5285a56ac6d" title="rocksdb::DBConstructor\l::FinishImpl" alt="" coords="756,933,919,979"/><area shape="rect" id="node79" href="../../d3/daa/a01577.html#af7e726bf27e216787e7c331834ec6075" title="rocksdb::StressTest::Run" alt="" coords="752,1003,923,1032"/><area shape="rect" id="node83" href="../../d3/daa/a01577.html#aeac9f55bde5a11da0fcc2c88465de0c6" title="rocksdb::StressTest\l::Reopen" alt="" coords="768,1055,907,1102"/><area shape="rect" id="node81" href="../../d6/d50/a02694.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1089,1003,1140,1032"/><area shape="rect" id="node89" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="719,1125,956,1171"/><area shape="rect" id="node91" href="../../de/d9d/a00813.html#ab355fd20f7ef62b0cb2e673a6a2d9bec" title="rocksdb::LDBCommand::Run" alt="" coords="740,1195,935,1224"/><area shape="rect" id="node93" href="../../d0/d88/a01231.html#a66bef6f11f9e11d7ac84410cb5b8bf4a" title="rocksdb::ReduceLevelTest\l::ReduceLevels" alt="" coords="1025,1186,1204,1233"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a24b1211b5a5fbfccfe0818c32753ff5f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::DelayLoggingAndReset </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l03348">3348</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00448">delayed_writes_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>.</p>
<div class="fragment"><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;                                         {</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a7ac5de89c53f110bb27112295ea2314d">delayed_writes_</a> &gt; 0) {</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;delayed %d write...\n&quot;</span>, <a class="code" href="../../dd/df5/a00386.html#a7ac5de89c53f110bb27112295ea2314d">delayed_writes_</a> );</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a7ac5de89c53f110bb27112295ea2314d">delayed_writes_</a> = 0;</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;  }</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a24b1211b5a5fbfccfe0818c32753ff5f_cgraph.png" border="0" usemap="#dd/df5/a00386_a24b1211b5a5fbfccfe0818c32753ff5f_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a24b1211b5a5fbfccfe0818c32753ff5f_cgraph" id="dd/df5/a00386_a24b1211b5a5fbfccfe0818c32753ff5f_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="263,13,359,43"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a24b1211b5a5fbfccfe0818c32753ff5f_icgraph.png" border="0" usemap="#dd/df5/a00386_a24b1211b5a5fbfccfe0818c32753ff5f_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a24b1211b5a5fbfccfe0818c32753ff5f_icgraph" id="dd/df5/a00386_a24b1211b5a5fbfccfe0818c32753ff5f_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="261,35,456,82"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="505,44,663,73"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="752,13,861,43"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="712,66,901,113"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a9bdda420ec5d44390a04215d8b1cbffd" title="rocksdb::DBImpl::~DBImpl" alt="" coords="951,21,1129,51"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#aaf39022d45b559b69933cfe719571c10" title="rocksdb::DBImpl::Flush" alt="" coords="960,75,1120,104"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#a789ea69cfa7ee4fccf934757a4641228" title="rocksdb::DBImpl::TEST\l_FlushMemTable" alt="" coords="959,231,1121,278"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#aaa4a148182ce98c83d363817e938ddd5" title="rocksdb::DBImpl::GetLive\lFiles" alt="" coords="1192,5,1365,51"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="1224,75,1333,104"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1224,128,1333,157"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1188,231,1369,278"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1440,184,1597,213"/><area shape="rect" id="node31" href="../../db/d95/a00391.html#a09218d973702b7be115bc4a65c0d97b9" title="rocksdb::DBTest::MakeTables" alt="" coords="1179,301,1379,331"/><area shape="rect" id="node36" href="../../de/de8/a00405.html#a49dbce26ebba1e0ac3f38a3af92b9757" title="rocksdb::DeleteFileTest\l::CreateTwoLevels" alt="" coords="1199,354,1359,401"/><area shape="rect" id="node38" href="../../d0/d88/a01231.html#a07eb4424cb2bef23ca200a806de76d9b" title="rocksdb::ReduceLevelTest\l::CompactMemTable" alt="" coords="1189,423,1368,470"/><area shape="rect" id="node29" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1464,240,1573,269"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="1660,184,1769,213"/><area shape="rect" id="node33" href="../../db/d95/a00391.html#af32d610cb80f870ed942c9ec7a053675" title="rocksdb::DBTest::FillLevels" alt="" coords="1427,301,1611,331"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5d5efdb5c1e9ec19aebcb0d76208ffe5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::Delete </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../da/d4b/a01848.html">WriteOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a6571e7ad4dfe25184e076fc3a937007a">rocksdb::DB</a>.</p>

<p>Reimplemented in <a class="el" href="../../db/db9/a00387.html#acac12b8fb10768cb6c10fb6ae836c837">rocksdb::DBImplReadOnly</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02755">2755</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l03437">rocksdb::DB::Delete()</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02593_source.html#l00094">Counters::remove()</a>, and <a class="el" href="../../d9/de7/a02572_source.html#l00812">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                                                                   {</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d8/ddd/a00380.html#a6571e7ad4dfe25184e076fc3a937007a">DB::Delete</a>(options, key);</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a5d5efdb5c1e9ec19aebcb0d76208ffe5_cgraph.png" border="0" usemap="#dd/df5/a00386_a5d5efdb5c1e9ec19aebcb0d76208ffe5_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a5d5efdb5c1e9ec19aebcb0d76208ffe5_cgraph" id="dd/df5/a00386_a5d5efdb5c1e9ec19aebcb0d76208ffe5_cgraph">
<area shape="rect" id="node3" href="../../d8/ddd/a00380.html#a6571e7ad4dfe25184e076fc3a937007a" title="rocksdb::DB::Delete" alt="" coords="221,113,363,143"/><area shape="rect" id="node5" href="../../d2/dbd/a01844.html#a17803ddbf9875d6b0bbac1b310ae3846" title="rocksdb::WriteBatch\l::Delete" alt="" coords="411,74,552,121"/><area shape="rect" id="node25" href="../../d8/ddd/a00380.html#ad5d37a09e90d0c22c9a0adca87267ebc" title="rocksdb::DB::Write" alt="" coords="415,144,548,173"/><area shape="rect" id="node7" href="../../da/d8c/a01845.html#a5d61953d919f082c48c4d4aada512004" title="rocksdb::WriteBatchInternal\l::SetCount" alt="" coords="600,5,784,51"/><area shape="rect" id="node11" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="600,74,784,121"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#af1cdcde94bcaeced42cd5925a5827232" title="rocksdb::PutLengthPrefixed\lSlice" alt="" coords="601,158,783,205"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#aabc7ce45ae48e15b24a6756f9b4fd694" title="rocksdb::EncodeFixed32" alt="" coords="833,13,999,43"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="833,75,999,104"/><area shape="rect" id="node17" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="847,128,985,157"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#afe24fa7da1cd551af92134aa66f96183" title="rocksdb::PutVarint32" alt="" coords="844,181,988,211"/><area shape="rect" id="node23" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="848,235,984,264"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a94c48680211f25845f5c35acd4b54ebb" title="rocksdb::EncodeVarint32" alt="" coords="1048,181,1216,211"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a5d5efdb5c1e9ec19aebcb0d76208ffe5_icgraph.png" border="0" usemap="#dd/df5/a00386_a5d5efdb5c1e9ec19aebcb0d76208ffe5_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a5d5efdb5c1e9ec19aebcb0d76208ffe5_icgraph" id="dd/df5/a00386_a5d5efdb5c1e9ec19aebcb0d76208ffe5_icgraph">
<area shape="rect" id="node3" href="../../d3/dc9/a00355.html#a0394d51fe796dc41b560f93c3936a845" title="Counters::remove" alt="" coords="223,5,348,35"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#ac6ef9d1e4162be93428d033486a1741a" title="rocksdb::TEST" alt="" coords="231,59,340,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a993778aa65fb4553d1c10eb4604bb0fb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::DeleteFile </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>name</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a04985803f9914f80a9f4bdd894771e2b">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l03355">3355</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d3b/a02610_source.html#l00027">rocksdb::FileMetaData::being_compacted</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00090">rocksdb::VersionEdit::DeleteFile()</a>, <a class="el" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">rocksdb::Env::DeleteFile()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00048">rocksdb::Status::InvalidArgument()</a>, <a class="el" href="../../d2/d80/a02645_source.html#l00027">rocksdb::kArchivedLogFile</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00025">rocksdb::kLogFile</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00027">rocksdb::kTableFile</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00045">rocksdb::Status::NotSupported()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01279">NumberLevels()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00036">rocksdb::Status::OK()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../da/d03/a02577_source.html#l00144">rocksdb::ParseFileName()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00511">PurgeObsoleteFiles()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00384">rocksdb::Options::wal_dir</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00650">PurgeObsoleteWALFiles()</a>, and <a class="el" href="../../d0/df5/a02576_source.html#l00147">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;                                        {</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> number;</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68">FileType</a> type;</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073d">WalFileType</a> log_type;</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc">ParseFileName</a>(<a class="code" href="../../d8/d24/a02001.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, &amp;number, &amp;type, &amp;log_type) ||</div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;      (type != <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a0caa3668acf3d5e92fafa8761eddb479">kTableFile</a> &amp;&amp; type != <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a68c3486771836efd9dd6d409e9cf28c4">kLogFile</a>)) {</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;DeleteFile %s failed.\n&quot;</span>, <a class="code" href="../../d8/d24/a02001.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>.c_str());</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba">Status::InvalidArgument</a>(<span class="stringliteral">&quot;Invalid file name&quot;</span>);</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;  }</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> status;</div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;  <span class="keywordflow">if</span> (type == <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a68c3486771836efd9dd6d409e9cf28c4">kLogFile</a>) {</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;    <span class="comment">// Only allow deleting archived log files</span></div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;    <span class="keywordflow">if</span> (log_type != <a class="code" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073daf6ba709136242bfba49ab92faf12d2dd">kArchivedLogFile</a>) {</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;DeleteFile %s failed.\n&quot;</span>, <a class="code" href="../../d8/d24/a02001.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>.c_str());</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8">Status::NotSupported</a>(<span class="stringliteral">&quot;Delete only supported for archived logs&quot;</span>);</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;    }</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;    status = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">DeleteFile</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a> + <span class="stringliteral">&quot;/&quot;</span> + <a class="code" href="../../d8/d24/a02001.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>.c_str());</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;    <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;DeleteFile %s failed.\n&quot;</span>, <a class="code" href="../../d8/d24/a02001.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>.c_str());</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;    }</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;    <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;  }</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;  <span class="keywordtype">int</span> level;</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;  FileMetaData metadata;</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;  <span class="keywordtype">int</span> maxlevel = <a class="code" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880">NumberLevels</a>();</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;  VersionEdit edit(maxlevel);</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;  DeletionState deletion_state;</div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;  {</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;    MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;    status = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;GetMetadataForFile(number, &amp;level, &amp;metadata);</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;    <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;DeleteFile %s failed. File not found\n&quot;</span>,</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;                             <a class="code" href="../../d8/d24/a02001.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>.c_str());</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba">Status::InvalidArgument</a>(<span class="stringliteral">&quot;File not found&quot;</span>);</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;    }</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;    assert((level &gt; 0) &amp;&amp; (level &lt; maxlevel));</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;    <span class="comment">// If the file is being compacted no need to delete.</span></div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;    <span class="keywordflow">if</span> (metadata.being_compacted) {</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;          <span class="stringliteral">&quot;DeleteFile %s Skipped. File about to be compacted\n&quot;</span>, <a class="code" href="../../d8/d24/a02001.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>.c_str());</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00">Status::OK</a>();</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;    }</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;    <span class="comment">// Only the files in the last level can be deleted externally.</span></div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;    <span class="comment">// This is to make sure that any deletion tombstones are not</span></div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    <span class="comment">// lost. Check that the level passed is the last level.</span></div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = level + 1; i &lt; maxlevel; i++) {</div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelFiles(i) != 0) {</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;            <span class="stringliteral">&quot;DeleteFile %s FAILED. File not in last level\n&quot;</span>, <a class="code" href="../../d8/d24/a02001.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>.c_str());</div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba">Status::InvalidArgument</a>(<span class="stringliteral">&quot;File not in last level&quot;</span>);</div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;      }</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;    }</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;    edit.DeleteFile(level, number);</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;    status = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LogAndApply(&amp;edit, &amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8">FindObsoleteFiles</a>(deletion_state, <span class="keyword">false</span>);</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;  } <span class="comment">// lock released here</span></div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;  <span class="keywordflow">if</span> (status.ok()) {</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;    <span class="comment">// remove files outside the db-lock</span></div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5">PurgeObsoleteFiles</a>(deletion_state);</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;  }</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;  <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a993778aa65fb4553d1c10eb4604bb0fb_cgraph.png" border="0" usemap="#dd/df5/a00386_a993778aa65fb4553d1c10eb4604bb0fb_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a993778aa65fb4553d1c10eb4604bb0fb_cgraph" id="dd/df5/a00386_a993778aa65fb4553d1c10eb4604bb0fb_cgraph">
<area shape="rect" id="node3" href="../../d2/d86/a01798.html#a9808f90e0c3ec496be67fc62cac0bd8f" title="rocksdb::VersionEdit\l::DeleteFile" alt="" coords="277,5,419,51"/><area shape="rect" id="node5" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="809,917,975,947"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="245,349,451,395"/><area shape="rect" id="node17" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba" title="rocksdb::Status::Invalid\lArgument" alt="" coords="268,1541,428,1587"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1912,689,2008,719"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="548,1328,676,1357"/><area shape="rect" id="node25" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8" title="rocksdb::Status::NotSupported" alt="" coords="1341,1595,1544,1624"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="243,1611,453,1640"/><area shape="rect" id="node30" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="1648,1313,1789,1343"/><area shape="rect" id="node33" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1651,559,1787,588"/><area shape="rect" id="node35" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="1087,1336,1252,1365"/><area shape="rect" id="node50" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="241,1062,455,1109"/><area shape="rect" id="node9" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="541,349,683,395"/><area shape="rect" id="node11" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="525,227,699,256"/><area shape="rect" id="node13" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="509,279,715,326"/><area shape="rect" id="node15" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="1081,380,1257,409"/><area shape="rect" id="node19" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1880,1448,2040,1477"/><area shape="rect" id="node37" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="1329,1491,1556,1520"/><area shape="rect" id="node39" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="1644,1516,1793,1545"/><area shape="rect" id="node41" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="1641,1379,1796,1426"/><area shape="rect" id="node43" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1892,1163,2028,1192"/><area shape="rect" id="node48" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="1355,1336,1531,1365"/><area shape="rect" id="node52" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="1088,1204,1251,1233"/><area shape="rect" id="node56" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1367,1077,1519,1107"/><area shape="rect" id="node61" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="524,1173,700,1203"/><area shape="rect" id="node63" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="1341,1131,1544,1160"/><area shape="rect" id="node67" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1875,831,2045,860"/><area shape="rect" id="node72" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="505,581,719,627"/><area shape="rect" id="node54" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1637,1189,1800,1219"/><area shape="rect" id="node69" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="2095,831,2244,860"/><area shape="rect" id="node74" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="792,589,992,619"/><area shape="rect" id="node79" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158" title="rocksdb::if" alt="" coords="851,277,933,307"/><area shape="rect" id="node85" href="../../d4/d87/a03436.html#a546d3e2e5c3b4aa8ee9828c7b519d501" title="rocksdb::ArchivalDirectory" alt="" coords="804,643,980,672"/><area shape="rect" id="node89" href="../../db/db1/a00460.html#a0b7781facd40158245aabf25ce686448" title="rocksdb::Env::GetFileModificationTime" alt="" coords="768,483,1016,512"/><area shape="rect" id="node92" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d" title="rocksdb::Env::GetFileSize" alt="" coords="1356,611,1529,640"/><area shape="rect" id="node94" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="849,536,935,565"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267" title="rocksdb::DBImpl::AppendSorted\lWalsOfType" alt="" coords="787,797,997,843"/><area shape="rect" id="node81" href="../../da/d71/a00814.html#ab25c6d03dbcd6168b3ae3762dc98fd51" title="rocksdb::LDBCommandExecute\lResult::FAILED" alt="" coords="1064,277,1275,323"/><area shape="rect" id="node83" href="../../da/d71/a00814.html#ae4210d600639c8c6ac04486ebc43c39b" title="rocksdb::LDBCommandExecute\lResult::LDBCommandExecuteResult" alt="" coords="1323,277,1563,323"/><area shape="rect" id="node98" href="../../dd/df5/a00386.html#a26b3cfbce68c226c861cfacd4a111fe1" title="rocksdb::DBImpl::CheckWal\lFileExistsAndEmpty" alt="" coords="1075,781,1264,827"/><area shape="rect" id="node109" href="../../dd/df5/a00386.html#a58d2431c9ec2de7473a8bc2f171c04b8" title="rocksdb::DBImpl::ReadFirst\lRecord" alt="" coords="1077,1002,1261,1049"/><area shape="rect" id="node138" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="1077,711,1261,758"/><area shape="rect" id="node112" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8" title="rocksdb::DBImpl::ReadFirstLine" alt="" coords="1339,973,1547,1003"/><area shape="rect" id="node127" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="1637,1136,1800,1165"/><area shape="rect" id="node136" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736" title="beast::IP::to_string" alt="" coords="1376,920,1509,949"/><area shape="rect" id="node116" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="1611,912,1827,941"/><area shape="rect" id="node119" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="1648,1015,1789,1062"/><area shape="rect" id="node123" href="../../d6/d66/a00916.html#ac156dfd78ec3a8dd539224668defc12d" title="rocksdb::LogReporter\l::Corruption" alt="" coords="1645,791,1792,838"/><area shape="rect" id="node140" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1360,664,1525,693"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a993778aa65fb4553d1c10eb4604bb0fb_icgraph.png" border="0" usemap="#dd/df5/a00386_a993778aa65fb4553d1c10eb4604bb0fb_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a993778aa65fb4553d1c10eb4604bb0fb_icgraph" id="dd/df5/a00386_a993778aa65fb4553d1c10eb4604bb0fb_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="241,1009,455,1055"/><area shape="rect" id="node104" href="../../d4/d87/a03436.html#ad19b60849d205b89e09ff716b7714f69" title="rocksdb::TEST" alt="" coords="293,1079,403,1108"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="505,1099,719,1146"/><area shape="rect" id="node102" href="../../dd/df5/a00386.html#ad62af2cf23b7a2da72715051e719e5f1" title="rocksdb::DBImpl::TEST\l_PurgeObsoleteteWAL" alt="" coords="531,1009,693,1055"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a2f6c0d55ec4f04c4b5f736f59fa51d4d" title="rocksdb::DBImpl::EnableFile\lDeletions" alt="" coords="772,1009,961,1055"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a4406b5ed5487f7562bd0fe1696c6092f" title="rocksdb::DBImpl::DeleteObsolete\lFiles" alt="" coords="1028,953,1247,999"/><area shape="rect" id="node87" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1579,1189,1776,1235"/><area shape="rect" id="node94" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="768,1129,965,1175"/><area shape="rect" id="node11" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1611,661,1744,691"/><area shape="rect" id="node13" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1851,74,2013,121"/><area shape="rect" id="node17" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1861,143,2003,190"/><area shape="rect" id="node21" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1832,213,2032,243"/><area shape="rect" id="node23" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1836,267,2028,296"/><area shape="rect" id="node31" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1877,320,1987,349"/><area shape="rect" id="node33" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1843,373,2021,403"/><area shape="rect" id="node37" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1852,426,2012,473"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1871,496,1993,525"/><area shape="rect" id="node49" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1864,549,2000,595"/><area shape="rect" id="node51" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1836,618,2028,665"/><area shape="rect" id="node53" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1836,687,2028,734"/><area shape="rect" id="node59" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1824,757,2040,787"/><area shape="rect" id="node63" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1851,810,2013,857"/><area shape="rect" id="node69" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1907,880,1957,909"/><area shape="rect" id="node71" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1863,933,2001,979"/><area shape="rect" id="node77" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1843,1002,2021,1049"/><area shape="rect" id="node79" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1851,1071,2013,1118"/><area shape="rect" id="node81" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1849,1141,2015,1171"/><area shape="rect" id="node83" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1863,1194,2001,1241"/><area shape="rect" id="node85" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1860,5,2004,51"/><area shape="rect" id="node15" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2120,13,2283,59"/><area shape="rect" id="node19" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2115,83,2288,112"/><area shape="rect" id="node25" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="2088,258,2315,305"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="2115,136,2288,165"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="2115,189,2288,235"/><area shape="rect" id="node35" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2176,328,2227,357"/><area shape="rect" id="node39" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="2121,381,2281,427"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2099,573,2304,603"/><area shape="rect" id="node45" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="2100,450,2303,497"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="2147,520,2256,549"/><area shape="rect" id="node55" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="2105,695,2297,742"/><area shape="rect" id="node57" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="2105,626,2297,673"/><area shape="rect" id="node61" href="../../db/d84/a02686.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2176,765,2227,795"/><area shape="rect" id="node65" href="../../da/dee/a00383.html#a8cdb390521098e2a5f737561e9eb1134" title="rocksdb::DBConstructor\l::DBConstructor" alt="" coords="2120,887,2283,934"/><area shape="rect" id="node67" href="../../da/dee/a00383.html#ae9772754567f1b3c0ca7d5285a56ac6d" title="rocksdb::DBConstructor\l::FinishImpl" alt="" coords="2120,818,2283,865"/><area shape="rect" id="node73" href="../../d3/daa/a01577.html#af7e726bf27e216787e7c331834ec6075" title="rocksdb::StressTest::Run" alt="" coords="2116,1027,2287,1056"/><area shape="rect" id="node75" href="../../d3/daa/a01577.html#aeac9f55bde5a11da0fcc2c88465de0c6" title="rocksdb::StressTest\l::Reopen" alt="" coords="2132,957,2271,1003"/><area shape="rect" id="node89" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1827,1264,2037,1293"/><area shape="rect" id="node91" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1309,1129,1531,1175"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1013,1141,1261,1171"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4406b5ed5487f7562bd0fe1696c6092f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::DeleteObsoleteFiles </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00635">635</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00511">PurgeObsoleteFiles()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>.</p>
<div class="fragment"><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                                 {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  DeletionState deletion_state;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8">FindObsoleteFiles</a>(deletion_state, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5">PurgeObsoleteFiles</a>(deletion_state);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a4406b5ed5487f7562bd0fe1696c6092f_cgraph.png" border="0" usemap="#dd/df5/a00386_a4406b5ed5487f7562bd0fe1696c6092f_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a4406b5ed5487f7562bd0fe1696c6092f_cgraph" id="dd/df5/a00386_a4406b5ed5487f7562bd0fe1696c6092f_cgraph">
<area shape="rect" id="node3" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1407,5,1548,51"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="1100,107,1305,154"/><area shape="rect" id="node14" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="273,781,487,827"/><area shape="rect" id="node8" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="1391,144,1564,173"/><area shape="rect" id="node10" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="1375,74,1580,121"/><area shape="rect" id="node12" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="1389,1400,1565,1429"/><area shape="rect" id="node16" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="563,1665,725,1695"/><area shape="rect" id="node20" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1401,1557,1553,1587"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="1120,781,1285,811"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1705,341,1801,371"/><area shape="rect" id="node40" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="556,144,732,173"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="1376,1453,1579,1483"/><area shape="rect" id="node45" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1685,1036,1821,1065"/><area shape="rect" id="node47" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1668,1713,1839,1743"/><area shape="rect" id="node51" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="1120,728,1285,757"/><area shape="rect" id="node53" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="537,1038,751,1085"/><area shape="rect" id="node134" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="1139,248,1267,277"/><area shape="rect" id="node18" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1672,1557,1835,1587"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="1364,557,1591,587"/><area shape="rect" id="node27" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="1679,548,1828,577"/><area shape="rect" id="node29" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="1676,746,1831,793"/><area shape="rect" id="node31" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1921,991,2057,1020"/><area shape="rect" id="node36" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="1389,712,1565,741"/><area shape="rect" id="node49" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1915,1713,2064,1743"/><area shape="rect" id="node55" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="824,993,1024,1023"/><area shape="rect" id="node60" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158" title="rocksdb::if" alt="" coords="883,1047,965,1076"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#a546d3e2e5c3b4aa8ee9828c7b519d501" title="rocksdb::ArchivalDirectory" alt="" coords="836,1100,1012,1129"/><area shape="rect" id="node70" href="../../db/db1/a00460.html#a0b7781facd40158245aabf25ce686448" title="rocksdb::Env::GetFileModificationTime" alt="" coords="800,1281,1048,1311"/><area shape="rect" id="node73" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d" title="rocksdb::Env::GetFileSize" alt="" coords="1391,1611,1564,1640"/><area shape="rect" id="node75" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="881,1335,967,1364"/><area shape="rect" id="node77" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267" title="rocksdb::DBImpl::AppendSorted\lWalsOfType" alt="" coords="819,1161,1029,1207"/><area shape="rect" id="node124" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="831,565,1017,595"/><area shape="rect" id="node62" href="../../da/d71/a00814.html#ab25c6d03dbcd6168b3ae3762dc98fd51" title="rocksdb::LDBCommandExecute\lResult::FAILED" alt="" coords="1097,967,1308,1014"/><area shape="rect" id="node64" href="../../da/d71/a00814.html#ae4210d600639c8c6ac04486ebc43c39b" title="rocksdb::LDBCommandExecute\lResult::LDBCommandExecuteResult" alt="" coords="1357,967,1597,1014"/><area shape="rect" id="node79" href="../../dd/df5/a00386.html#a26b3cfbce68c226c861cfacd4a111fe1" title="rocksdb::DBImpl::CheckWal\lFileExistsAndEmpty" alt="" coords="1108,1419,1297,1466"/><area shape="rect" id="node90" href="../../dd/df5/a00386.html#a58d2431c9ec2de7473a8bc2f171c04b8" title="rocksdb::DBImpl::ReadFirst\lRecord" alt="" coords="1111,1129,1295,1175"/><area shape="rect" id="node120" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="1111,1198,1295,1245"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8" title="rocksdb::DBImpl::ReadFirstLine" alt="" coords="1373,1240,1581,1269"/><area shape="rect" id="node104" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="1672,1104,1835,1133"/><area shape="rect" id="node108" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="1683,925,1824,955"/><area shape="rect" id="node115" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8" title="rocksdb::Status::NotSupported" alt="" coords="1376,453,1579,483"/><area shape="rect" id="node118" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736" title="beast::IP::to_string" alt="" coords="1411,1293,1544,1323"/><area shape="rect" id="node97" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="1645,1277,1861,1307"/><area shape="rect" id="node100" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="1683,1157,1824,1203"/><area shape="rect" id="node106" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1909,707,2069,736"/><area shape="rect" id="node122" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1395,1347,1560,1376"/><area shape="rect" id="node126" href="../../d2/d86/a01798.html#a9808f90e0c3ec496be67fc62cac0bd8f" title="rocksdb::VersionEdit\l::DeleteFile" alt="" coords="1132,557,1273,603"/><area shape="rect" id="node130" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba" title="rocksdb::Status::Invalid\lArgument" alt="" coords="1673,402,1833,449"/><area shape="rect" id="node137" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="1097,504,1308,533"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a4406b5ed5487f7562bd0fe1696c6092f_icgraph.png" border="0" usemap="#dd/df5/a00386_a4406b5ed5487f7562bd0fe1696c6092f_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a4406b5ed5487f7562bd0fe1696c6092f_icgraph" id="dd/df5/a00386_a4406b5ed5487f7562bd0fe1696c6092f_icgraph">
<area shape="rect" id="node3" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="273,645,407,675"/><area shape="rect" id="node5" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="483,21,645,67"/><area shape="rect" id="node11" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="493,121,635,167"/><area shape="rect" id="node17" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="464,205,664,235"/><area shape="rect" id="node19" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="468,259,660,288"/><area shape="rect" id="node31" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="509,323,619,352"/><area shape="rect" id="node33" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="475,376,653,405"/><area shape="rect" id="node37" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="484,429,644,475"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="503,499,625,528"/><area shape="rect" id="node53" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="496,602,632,649"/><area shape="rect" id="node55" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="468,671,660,718"/><area shape="rect" id="node57" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="468,741,660,787"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="456,811,672,840"/><area shape="rect" id="node69" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="483,863,645,910"/><area shape="rect" id="node75" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="539,933,589,963"/><area shape="rect" id="node77" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="495,986,633,1033"/><area shape="rect" id="node85" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="475,1055,653,1102"/><area shape="rect" id="node87" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="483,1125,645,1171"/><area shape="rect" id="node95" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="757,619,923,648"/><area shape="rect" id="node98" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="495,1194,633,1241"/><area shape="rect" id="node100" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="492,1263,636,1310"/><area shape="rect" id="node7" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="759,5,921,51"/><area shape="rect" id="node9" href="../../d9/d48/a00345.html#a08cff08de4bf7d2a6f51cb498a406f0f" title="rocksdb::CorruptionTest\l::CorruptionTest" alt="" coords="1036,5,1199,51"/><area shape="rect" id="node13" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="753,75,927,104"/><area shape="rect" id="node15" href="../../d9/d66/a02562.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1092,75,1143,104"/><area shape="rect" id="node21" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="727,127,953,174"/><area shape="rect" id="node23" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="753,197,927,227"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="753,250,927,297"/><area shape="rect" id="node25" href="../../db/d95/a00391.html#a509351e18607a06285412f6654253643" title="rocksdb::DBTest::DBTest" alt="" coords="1031,197,1204,227"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#a3761d111551d33530517a39f38f908d1" title="rocksdb::DBTest::ChangeOptions" alt="" coords="1008,259,1227,288"/><area shape="rect" id="node35" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="815,320,865,349"/><area shape="rect" id="node39" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="760,373,920,419"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="737,443,943,472"/><area shape="rect" id="node47" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="739,495,941,542"/><area shape="rect" id="node51" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="785,565,895,595"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#a28f3fa7104cc330d8f573f98682e000b" title="rocksdb::TEST" alt="" coords="1063,443,1172,472"/><area shape="rect" id="node49" href="../../dc/d6a/a02779.html#a1fa3253ca11014c1b01923a1674ff19c" title="main" alt="" coords="1092,561,1143,591"/><area shape="rect" id="node59" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="744,671,936,718"/><area shape="rect" id="node63" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="744,741,936,787"/><area shape="rect" id="node61" href="../../d0/dc7/a01402.html#aa4769c7f42641f11d37d9d1a0b381bef" title="rocksdb::SimpleTableDBTest\l::SimpleTableDBTest" alt="" coords="1021,671,1213,718"/><area shape="rect" id="node67" href="../../db/d84/a02686.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="815,811,865,840"/><area shape="rect" id="node71" href="../../da/dee/a00383.html#a8cdb390521098e2a5f737561e9eb1134" title="rocksdb::DBConstructor\l::DBConstructor" alt="" coords="759,863,921,910"/><area shape="rect" id="node73" href="../../da/dee/a00383.html#ae9772754567f1b3c0ca7d5285a56ac6d" title="rocksdb::DBConstructor\l::FinishImpl" alt="" coords="759,933,921,979"/><area shape="rect" id="node79" href="../../d3/daa/a01577.html#af7e726bf27e216787e7c331834ec6075" title="rocksdb::StressTest::Run" alt="" coords="755,1003,925,1032"/><area shape="rect" id="node83" href="../../d3/daa/a01577.html#aeac9f55bde5a11da0fcc2c88465de0c6" title="rocksdb::StressTest\l::Reopen" alt="" coords="771,1055,909,1102"/><area shape="rect" id="node81" href="../../d6/d50/a02694.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1092,1003,1143,1032"/><area shape="rect" id="node89" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="721,1125,959,1171"/><area shape="rect" id="node91" href="../../de/d9d/a00813.html#ab355fd20f7ef62b0cb2e673a6a2d9bec" title="rocksdb::LDBCommand::Run" alt="" coords="743,1195,937,1224"/><area shape="rect" id="node93" href="../../d0/d88/a01231.html#a66bef6f11f9e11d7ac84410cb5b8bf4a" title="rocksdb::ReduceLevelTest\l::ReduceLevels" alt="" coords="1028,1186,1207,1233"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a52e50f163faaf106e39a7b004a457ec4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::DisableFileDeletions </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a03dd54471b0ab3aadbd88200b305d9a9">rocksdb::DB</a>.</p>

<p>Reimplemented in <a class="el" href="../../db/db9/a00387.html#a1645be58aa250d6a11102e7fc13369bb">rocksdb::DBImplReadOnly</a>.</p>

<p>Definition at line <a class="el" href="../../dd/db2/a02563_source.html#l00023">23</a> of file <a class="el" href="../../dd/db2/a02563_source.html">db_filesnapshot.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00356">disable_delete_obsolete_files_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00036">rocksdb::Status::OK()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>.</p>
<div class="fragment"><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                                    {</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a3573b1eae3665c2cc757b8c396622b17">disable_delete_obsolete_files_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;File Deletions Disabled&quot;</span>);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00">Status::OK</a>();</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a52e50f163faaf106e39a7b004a457ec4_cgraph.png" border="0" usemap="#dd/df5/a00386_a52e50f163faaf106e39a7b004a457ec4_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a52e50f163faaf106e39a7b004a457ec4_cgraph" id="dd/df5/a00386_a52e50f163faaf106e39a7b004a457ec4_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="249,5,345,35"/><area shape="rect" id="node5" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="227,59,368,88"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="416,59,576,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a118052cb7b51c90604865d226452918b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::DoCompactionWork </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d95/a00299.html">CompactionState</a> *&#160;</td>
          <td class="paramname"><em>compact</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/dea/a00408.html">DeletionState</a> &amp;&#160;</td>
          <td class="paramname"><em>deletion_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02074">2074</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">rocksdb::port::AtomicPointer::Acquire_Load()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01887">AllocateCompactionOutputFileNumbers()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00329">bg_compaction_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00309">bg_cv_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00594">rocksdb::Compaction::BottomMostLevel()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00095">rocksdb::DBImpl::CompactionState::builder</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00392">rocksdb::DBImpl::CompactionStats::bytes_readn</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00395">rocksdb::DBImpl::CompactionStats::bytes_readnp1</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00398">rocksdb::DBImpl::CompactionStats::bytes_written</a>, <a class="el" href="../../dd/d75/a02639_source.html#l00062">rocksdb::Slice::clear()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00075">rocksdb::DBImpl::CompactionState::compaction</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00106">rocksdb::Options::compaction_filter</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00608">rocksdb::Options::compaction_filter_factory</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00058">rocksdb::COMPACTION_KEY_DROP_NEWER_ENTRY</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00059">rocksdb::COMPACTION_KEY_DROP_OBSOLETE</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00060">rocksdb::COMPACTION_KEY_DROP_USER</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00576">rocksdb::Options::compaction_style</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00168">rocksdb::COMPACTION_TIME</a>, <a class="el" href="../../db/d44/a02564_source.html#l00099">rocksdb::DBImpl::CompactionState::current_output()</a>, <a class="el" href="../../dd/d75/a02639_source.html#l00046">rocksdb::Slice::data()</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00135">rocksdb::InternalKey::DecodeFrom()</a>, <a class="el" href="../../d3/d09/a02539_source.html#l00036">ripple::Resource::drop</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00081">rocksdb::DBImpl::CompactionState::existing_snapshots</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00024">rocksdb::FileMetaData::file_size</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00401">rocksdb::DBImpl::CompactionStats::files_in_leveln</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00404">rocksdb::DBImpl::CompactionStats::files_in_levelnp1</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00407">rocksdb::DBImpl::CompactionStats::files_out_levelnp1</a>, <a class="el" href="../../db/d44/a02564_source.html#l02053">findEarliestVisibleSnapshot()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01952">FinishCompactionOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01113">FlushMemTableToOutputFile()</a>, <a class="el" href="../../dd/d05/a02601_source.html#l00064">rocksdb::SnapshotList::getAll()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00107">rocksdb::DBImpl::CompactionState::GetFilterContext()</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00181">rocksdb::GetInternalKeySeqno()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00312">imm_</a>, <a class="el" href="../../de/d48/a02589_source.html#l00038">rocksdb::MemTableList::imm_flush_needed</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00560">rocksdb::Compaction::input()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02009">InstallCompactionResults()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00051">rocksdb::Status::IOError()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03015">rocksdb::Compaction::IsBaseLevelForKey()</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00046">rocksdb::MemTableList::IsFlushPending()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00056">rocksdb::kCompactionStyleLevel</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00044">rocksdb::kMaxSequenceNumber</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00029">rocksdb::kTypeDeletion</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00031">rocksdb::kTypeMerge</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00030">rocksdb::kTypeValue</a>, <a class="el" href="../../db/d44/a02564_source.html#l00087">rocksdb::DBImpl::CompactionState::Output::largest</a>, <a class="el" href="../../db/d44/a02564_source.html#l00088">rocksdb::DBImpl::CompactionState::Output::largest_seqno</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00547">rocksdb::Compaction::level()</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../d5/dd8/a03083_source.html#l00035">ripple::max()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00401">rocksdb::Options::max_background_compactions</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00563">rocksdb::Compaction::MaxOutputFileSize()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00096">rocksdb::Options::merge_operator</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00389">rocksdb::DBImpl::CompactionStats::micros</a>, <a class="el" href="../../d5/dd8/a03083_source.html#l00031">ripple::min()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00167">rocksdb::Options::min_write_buffer_number_to_merge</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc">rocksdb::port::AtomicPointer::NoBarrier_Load()</a>, <a class="el" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">rocksdb::Env::NowMicros()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00557">rocksdb::Compaction::num_input_files()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01908">OpenCompactionOutputFile()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00094">rocksdb::DBImpl::CompactionState::outfile</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00550">rocksdb::Compaction::output_level()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00090">rocksdb::DBImpl::CompactionState::outputs</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00158">rocksdb::ParseInternalKey()</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00280">rocksdb::RecordTick()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01900">ReleaseCompactionUnusedFileNumbers()</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00591">rocksdb::Compaction::score()</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00049">rocksdb::ParsedInternalKey::sequence</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03040">rocksdb::Compaction::ShouldStopBefore()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00308">shutting_down_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00067">rocksdb::port::CondVar::SignalAll()</a>, <a class="el" href="../../dd/d75/a02639_source.html#l00049">rocksdb::Slice::size()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00087">rocksdb::DBImpl::CompactionState::Output::smallest</a>, <a class="el" href="../../db/d44/a02564_source.html#l00088">rocksdb::DBImpl::CompactionState::Output::smallest_seqno</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00322">snapshots_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00348">rocksdb::Options::statistics</a>, <a class="el" href="../../d6/d50/a02694_source.html#l00667">stats</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00429">stats_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03129">rocksdb::Compaction::Summary()</a>, <a class="el" href="../../dd/d75/a02639_source.html#l00072">rocksdb::Slice::ToString()</a>, <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00050">rocksdb::ParsedInternalKey::type</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00171">rocksdb::UpdateInternalKey()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00181">user_comparator()</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00048">rocksdb::ParsedInternalKey::user_key</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00288">value</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;                                                               {</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;  assert(compact);</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;  <a class="code" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> imm_micros = 0;  <span class="comment">// Micros spent doing imm_ compactions</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;      <span class="stringliteral">&quot;Compacting %d@%d + %d@%d files, score %.2f slots available %d&quot;</span>,</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;      compact-&gt;compaction-&gt;num_input_files(0),</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;      compact-&gt;compaction-&gt;level(),</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;      compact-&gt;compaction-&gt;num_input_files(1),</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;      compact-&gt;compaction-&gt;level() + 1,</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      compact-&gt;compaction-&gt;score(),</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acfc44c7252fbd8c8d98c42903014dbbc">max_background_compactions</a> - <a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a>);</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;  <span class="keywordtype">char</span> scratch[256];</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;  compact-&gt;compaction-&gt;Summary(scratch, <span class="keyword">sizeof</span>(scratch));</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Compaction start summary: %s\n&quot;</span>, scratch);</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  assert(<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelFiles(compact-&gt;compaction-&gt;level()) &gt; 0);</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;  assert(compact-&gt;builder == <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;  assert(!compact-&gt;outfile);</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> visible_at_tip = 0;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> earliest_snapshot;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> latest_snapshot = 0;</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a6bf69eb135ada49bd652b4421ccc14af">snapshots_</a>.<a class="code" href="../../dc/de6/a01426.html#ab55f97d15a5529dec33ece4781c23955">getAll</a>(compact-&gt;existing_snapshots);</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;  <span class="keywordflow">if</span> (compact-&gt;existing_snapshots.size() == 0) {</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="comment">// optimize for fast path if there are no snapshots</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;    visible_at_tip = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LastSequence();</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    earliest_snapshot = visible_at_tip;</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    latest_snapshot = compact-&gt;existing_snapshots.back();</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <span class="comment">// Add the current seqno as the &#39;latest&#39; virtual</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <span class="comment">// snapshot to the end of this list.</span></div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    compact-&gt;existing_snapshots.push_back(<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LastSequence());</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    earliest_snapshot = compact-&gt;existing_snapshots[0];</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;  }</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;  <span class="comment">// Is this compaction producing files at the bottommost level?</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;  <span class="keywordtype">bool</span> bottommost_level = compact-&gt;compaction-&gt;BottomMostLevel();</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;  <span class="comment">// Allocate the output file numbers before we release the lock</span></div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#aa4a580611125396a6e0072010fced806">AllocateCompactionOutputFileNumbers</a>(compact);</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;  <span class="comment">// Release mutex while we&#39;re actually doing the compaction work</span></div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> start_micros = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">NowMicros</a>();</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  unique_ptr&lt;Iterator&gt; input(<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;MakeInputIterator(compact-&gt;compaction));</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;  input-&gt;SeekToFirst();</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> status;</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  ParsedInternalKey ikey;</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;  std::string current_user_key;</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;  <span class="keywordtype">bool</span> has_current_user_key = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> last_sequence_for_key __attribute__((unused)) =</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a7f8b5699104535577fb0ca15fa1ead65">kMaxSequenceNumber</a>;</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> visible_in_snapshot = <a class="code" href="../../d4/d87/a03436.html#a7f8b5699104535577fb0ca15fa1ead65">kMaxSequenceNumber</a>;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;  std::string compaction_filter_value;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;  std::vector&lt;char&gt; delete_key; <span class="comment">// for compaction filter</span></div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;  MergeHelper merge(<a class="code" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0">user_comparator</a>(), <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6c52cebaebf5c0116b1aa8fc11a6333b">merge_operator</a>.get(),</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                    <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>.get(),</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                    <span class="keyword">false</span> <span class="comment">/* internal key corruption is expected */</span>);</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;  <span class="keyword">auto</span> compaction_filter = <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#ac47e9618314f4b2177834965aaad8cee">compaction_filter</a>;</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;  std::unique_ptr&lt;CompactionFilter&gt; compaction_filter_from_factory = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;  <span class="keywordflow">if</span> (!compaction_filter) {</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    <span class="keyword">auto</span> context = compact-&gt;GetFilterContext();</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    compaction_filter_from_factory =</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a44d59a16f824c80dee4ec1b86e25dd1b">compaction_filter_factory</a>-&gt;CreateCompactionFilter(context);</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    compaction_filter = compaction_filter_from_factory.get();</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;  }</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;  <span class="keywordflow">for</span> (; input-&gt;Valid() &amp;&amp; !<a class="code" href="../../dd/df5/a00386.html#aa30ff424691deb3432441334d3adb3cf">shutting_down_</a>.<a class="code" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">Acquire_Load</a>(); ) {</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;    <span class="comment">// Prioritize immutable compaction work</span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;    <span class="comment">// TODO: remove memtable flush from normal compaction work</span></div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#a034453ade9315531f470fe3f3a8a3145">imm_flush_needed</a>.<a class="code" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc">NoBarrier_Load</a>() != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> imm_start = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">NowMicros</a>();</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36">IsFlushPending</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a115f9538bf76bb2a2929567292510d98">min_write_buffer_number_to_merge</a>)) {</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e">FlushMemTableToOutputFile</a>(<span class="keyword">nullptr</span>, deletion_state);</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1">SignalAll</a>();  <span class="comment">// Wakeup MakeRoomForWrite() if necessary</span></div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;      }</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;      imm_micros += (<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">NowMicros</a>() - imm_start);</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;    }</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    Slice key = input-&gt;key();</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;    Slice <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a> = input-&gt;value();</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    <span class="keywordflow">if</span> (compact-&gt;compaction-&gt;ShouldStopBefore(key) &amp;&amp;</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        compact-&gt;builder != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;      status = <a class="code" href="../../dd/df5/a00386.html#ab378543940b68e279594acd5af9ef594">FinishCompactionOutputFile</a>(compact, input.get());</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      }</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    }</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <span class="comment">// Handle key/value, add to state, etc.</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../d5/d6b/a03428.html#ae12997de115c1cf0032794aa5ea1b15da34078bac5ac1af8f8cb7ab01d090c82e">drop</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    <span class="keywordtype">bool</span> current_entry_is_merging = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2">ParseInternalKey</a>(key, &amp;ikey)) {</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;      <span class="comment">// Do not hide error keys</span></div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      <span class="comment">// TODO: error key stays in db forever? Figure out the intention/rationale</span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      <span class="comment">// v10 error v8 : we cannot hide v8 even though it&#39;s pretty obvious.</span></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      current_user_key.clear();</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      has_current_user_key = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;      last_sequence_for_key = <a class="code" href="../../d4/d87/a03436.html#a7f8b5699104535577fb0ca15fa1ead65">kMaxSequenceNumber</a>;</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      visible_in_snapshot = <a class="code" href="../../d4/d87/a03436.html#a7f8b5699104535577fb0ca15fa1ead65">kMaxSequenceNumber</a>;</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;      <span class="keywordflow">if</span> (!has_current_user_key ||</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;          <a class="code" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0">user_comparator</a>()-&gt;Compare(ikey.user_key,</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                                     Slice(current_user_key)) != 0) {</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;        <span class="comment">// First occurrence of this user key</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;        current_user_key.assign(ikey.user_key.data(), ikey.user_key.size());</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;        has_current_user_key = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;        last_sequence_for_key = <a class="code" href="../../d4/d87/a03436.html#a7f8b5699104535577fb0ca15fa1ead65">kMaxSequenceNumber</a>;</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;        visible_in_snapshot = <a class="code" href="../../d4/d87/a03436.html#a7f8b5699104535577fb0ca15fa1ead65">kMaxSequenceNumber</a>;</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;        <span class="comment">// apply the compaction filter to the first occurrence of the user key</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        <span class="keywordflow">if</span> (compaction_filter &amp;&amp;</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;            ikey.type == <a class="code" href="../../d4/d87/a03436.html#ad653b44b47c92e895505a6696cae7b8caf51cbf3eca14c6038fc5db4c754d8671">kTypeValue</a> &amp;&amp;</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;            (visible_at_tip || ikey.sequence &gt; latest_snapshot)) {</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;          <span class="comment">// If the user has specified a compaction filter and the sequence</span></div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;          <span class="comment">// number is greater than any external snapshot, then invoke the</span></div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;          <span class="comment">// filter.</span></div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;          <span class="comment">// If the return value of the compaction filter is true, replace</span></div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;          <span class="comment">// the entry with a delete marker.</span></div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;          <span class="keywordtype">bool</span> value_changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;          compaction_filter_value.clear();</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;          <span class="keywordtype">bool</span> to_delete =</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;            compaction_filter-&gt;Filter(compact-&gt;compaction-&gt;level(),</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                                               ikey.user_key, <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>,</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;                                               &amp;compaction_filter_value,</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                                               &amp;value_changed);</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;          <span class="keywordflow">if</span> (to_delete) {</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;            <span class="comment">// make a copy of the original key</span></div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;            delete_key.assign(key.data(), key.data() + key.size());</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;            <span class="comment">// convert it to a delete</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;            <a class="code" href="../../d4/d87/a03436.html#aa87722c52593b34fb815ca86eede3494">UpdateInternalKey</a>(&amp;delete_key[0], delete_key.size(),</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                              ikey.sequence, <a class="code" href="../../d4/d87/a03436.html#ad653b44b47c92e895505a6696cae7b8ca833eb3ac860dec05c6ea8fa63b8afa47">kTypeDeletion</a>);</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;            <span class="comment">// anchor the key again</span></div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;            key = Slice(&amp;delete_key[0], delete_key.size());</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;            <span class="comment">// needed because ikey is backed by key</span></div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;            <a class="code" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2">ParseInternalKey</a>(key, &amp;ikey);</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;            <span class="comment">// no value associated with delete</span></div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;            value.clear();</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;            <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29daba31f0db986c51b86f6abac30425812f">COMPACTION_KEY_DROP_USER</a>);</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value_changed) {</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;            value = compaction_filter_value;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;          }</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;        }</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;      }</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;      <span class="comment">// If there are no snapshots, then this kv affect visibility at tip.</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      <span class="comment">// Otherwise, search though all existing snapshots to find</span></div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <span class="comment">// the earlist snapshot that is affected by this kv.</span></div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> prev_snapshot = 0; <span class="comment">// 0 means no previous snapshot</span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> visible = visible_at_tip ?</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;        visible_at_tip :</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#aeb1d7919e60faa30ad63a70ce932e109">findEarliestVisibleSnapshot</a>(ikey.sequence,</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                                    compact-&gt;existing_snapshots,</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                                    &amp;prev_snapshot);</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      <span class="keywordflow">if</span> (visible_in_snapshot == visible) {</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;        <span class="comment">// If the earliest snapshot is which this key is visible in</span></div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;        <span class="comment">// is the same as the visibily of a previous instance of the</span></div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        <span class="comment">// same key, then this kv is not visible in any snapshot.</span></div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;        <span class="comment">// Hidden by an newer entry for same user key</span></div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        <span class="comment">// TODO: why not &gt; ?</span></div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;        assert(last_sequence_for_key &gt;= ikey.sequence);</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        drop = <span class="keyword">true</span>;    <span class="comment">// (A)</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29da00eeea87af1c2679ad5afa6973989eaf">COMPACTION_KEY_DROP_NEWER_ENTRY</a>);</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ikey.type == <a class="code" href="../../d4/d87/a03436.html#ad653b44b47c92e895505a6696cae7b8ca833eb3ac860dec05c6ea8fa63b8afa47">kTypeDeletion</a> &amp;&amp;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;                 ikey.sequence &lt;= earliest_snapshot &amp;&amp;</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                 compact-&gt;compaction-&gt;IsBaseLevelForKey(ikey.user_key)) {</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;        <span class="comment">// For this user key:</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;        <span class="comment">// (1) there is no data in higher levels</span></div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;        <span class="comment">// (2) data in lower levels will have larger sequence numbers</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;        <span class="comment">// (3) data in layers that are being compacted here and have</span></div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;        <span class="comment">//     smaller sequence numbers will be dropped in the next</span></div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;        <span class="comment">//     few iterations of this loop (by rule (A) above).</span></div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;        <span class="comment">// Therefore this deletion marker is obsolete and can be dropped.</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;        drop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29dac3e06fc7882ecb6f7eb5f29918797bb2">COMPACTION_KEY_DROP_OBSOLETE</a>);</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ikey.type == <a class="code" href="../../d4/d87/a03436.html#ad653b44b47c92e895505a6696cae7b8caeb308026e3ab5ed47a847e0c5ab9358e">kTypeMerge</a>) {</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        <span class="comment">// We know the merge type entry is not hidden, otherwise we would</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;        <span class="comment">// have hit (A)</span></div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;        <span class="comment">// We encapsulate the merge related state machine in a different</span></div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;        <span class="comment">// object to minimize change to the existing flow. Turn out this</span></div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;        <span class="comment">// logic could also be nicely re-used for memtable flush purge</span></div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        <span class="comment">// optimization in BuildTable.</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        merge.MergeUntil(input.get(), prev_snapshot, bottommost_level,</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                         <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>);</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;        current_entry_is_merging = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;        <span class="keywordflow">if</span> (merge.IsSuccess()) {</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;          <span class="comment">// Successfully found Put/Delete/(end-of-key-range) while merging</span></div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;          <span class="comment">// Get the merge result</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;          key = merge.key();</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;          <a class="code" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2">ParseInternalKey</a>(key, &amp;ikey);</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;          value = merge.value();</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;          <span class="comment">// Did not find a Put/Delete/(end-of-key-range) while merging</span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;          <span class="comment">// We now have some stack of merge operands to write out.</span></div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;          <span class="comment">// NOTE: key,value, and ikey are now referring to old entries.</span></div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;          <span class="comment">//       These will be correctly set below.</span></div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;          assert(!merge.keys().empty());</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;          assert(merge.keys().size() == merge.values().size());</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;          <span class="comment">// Hack to make sure last_sequence_for_key is correct</span></div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;          <a class="code" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2">ParseInternalKey</a>(merge.keys().front(), &amp;ikey);</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        }</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;      }</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;      last_sequence_for_key = ikey.sequence;</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;      visible_in_snapshot = visible;</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    }</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="preprocessor"></span>    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;        <span class="stringliteral">&quot;  Compact: %s, seq %d, type: %d %d, drop: %d, is_base: %d, &quot;</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        <span class="stringliteral">&quot;%d smallest_snapshot: %d level: %d bottommost %d&quot;</span>,</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;        ikey.user_key.ToString().c_str(),</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;        (int)ikey.sequence, ikey.type, <a class="code" href="../../d4/d87/a03436.html#ad653b44b47c92e895505a6696cae7b8caf51cbf3eca14c6038fc5db4c754d8671">kTypeValue</a>, drop,</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;        compact-&gt;compaction-&gt;IsBaseLevelForKey(ikey.user_key),</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;        (int)last_sequence_for_key, (<span class="keywordtype">int</span>)earliest_snapshot,</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;        compact-&gt;compaction-&gt;level(), bottommost_level);</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    <span class="keywordflow">if</span> (!drop) {</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;      <span class="comment">// We may write a single key (e.g.: for Put/Delete or successful merge).</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;      <span class="comment">// Or we may instead have to write a sequence/list of keys.</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;      <span class="comment">// We have to write a sequence iff we have an unsuccessful merge</span></div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;      <span class="keywordtype">bool</span> has_merge_list = current_entry_is_merging &amp;&amp; !merge.IsSuccess();</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;      <span class="keyword">const</span> std::deque&lt;std::string&gt;* keys = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;      <span class="keyword">const</span> std::deque&lt;std::string&gt;* values = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      std::deque&lt;std::string&gt;::const_reverse_iterator key_iter;</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;      std::deque&lt;std::string&gt;::const_reverse_iterator value_iter;</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;      <span class="keywordflow">if</span> (has_merge_list) {</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;        keys = &amp;merge.keys();</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;        values = &amp;merge.values();</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;        key_iter = keys-&gt;rbegin();    <span class="comment">// The back (*rbegin()) is the first key</span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;        value_iter = values-&gt;rbegin();</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;        key = Slice(*key_iter);</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        value = Slice(*value_iter);</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;      }</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;      <span class="comment">// If we have a list of keys to write, traverse the list.</span></div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      <span class="comment">// If we have a single key to write, simply write that key.</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;      <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        <span class="comment">// Invariant: key,value,ikey will always be the next entry to write</span></div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        <span class="keywordtype">char</span>* kptr = (<span class="keywordtype">char</span>*)key.data();</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;        std::string kstr;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        <span class="comment">// Zeroing out the sequence number leads to better compression.</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;        <span class="comment">// If this is the bottommost level (no files in lower levels)</span></div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;        <span class="comment">// and the earliest snapshot is larger than this seqno</span></div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        <span class="comment">// then we can squash the seqno to zero.</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> == <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3a88cfee1400580317ff05c5e3fddc2796">kCompactionStyleLevel</a> &amp;&amp;</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;            bottommost_level &amp;&amp; ikey.sequence &lt; earliest_snapshot &amp;&amp;</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;            ikey.type != <a class="code" href="../../d4/d87/a03436.html#ad653b44b47c92e895505a6696cae7b8caeb308026e3ab5ed47a847e0c5ab9358e">kTypeMerge</a>) {</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;          assert(ikey.type != <a class="code" href="../../d4/d87/a03436.html#ad653b44b47c92e895505a6696cae7b8ca833eb3ac860dec05c6ea8fa63b8afa47">kTypeDeletion</a>);</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;          <span class="comment">// make a copy because updating in place would cause problems</span></div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;          <span class="comment">// with the priority queue that is managing the input key iterator</span></div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;          kstr.assign(key.data(), key.size());</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;          kptr = (<span class="keywordtype">char</span> *)kstr.c_str();</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;          <a class="code" href="../../d4/d87/a03436.html#aa87722c52593b34fb815ca86eede3494">UpdateInternalKey</a>(kptr, key.size(), (<a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>)0, ikey.type);</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;        }</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;        Slice newkey(kptr, key.size());</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;        assert((key.clear(), 1)); <span class="comment">// we do not need &#39;key&#39; anymore</span></div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;        <span class="comment">// Open output file if necessary</span></div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;        <span class="keywordflow">if</span> (compact-&gt;builder == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;          status = <a class="code" href="../../dd/df5/a00386.html#af9b32f2f68613634aaf0252e1fb143d2">OpenCompactionOutputFile</a>(compact);</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;          <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;          }</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;        }</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> seqno = <a class="code" href="../../d4/d87/a03436.html#a79e23f5792d55281c43f7a8ea8588fea">GetInternalKeySeqno</a>(newkey);</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;        <span class="keywordflow">if</span> (compact-&gt;builder-&gt;NumEntries() == 0) {</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;          compact-&gt;current_output()-&gt;smallest.DecodeFrom(newkey);</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;          compact-&gt;current_output()-&gt;smallest_seqno = seqno;</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;          compact-&gt;current_output()-&gt;smallest_seqno =</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff">std::min</a>(compact-&gt;current_output()-&gt;smallest_seqno, seqno);</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;        }</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;        compact-&gt;current_output()-&gt;largest.DecodeFrom(newkey);</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;        compact-&gt;builder-&gt;Add(newkey, value);</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;        compact-&gt;current_output()-&gt;largest_seqno =</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;          <a class="code" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785">std::max</a>(compact-&gt;current_output()-&gt;largest_seqno, seqno);</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;        <span class="comment">// Close output file if it is big enough</span></div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;        <span class="keywordflow">if</span> (compact-&gt;builder-&gt;FileSize() &gt;=</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;            compact-&gt;compaction-&gt;MaxOutputFileSize()) {</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;          status = <a class="code" href="../../dd/df5/a00386.html#ab378543940b68e279594acd5af9ef594">FinishCompactionOutputFile</a>(compact, input.get());</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;          <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;          }</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;        }</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;        <span class="comment">// If we have a list of entries, move to next element</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;        <span class="comment">// If we only had one entry, then break the loop.</span></div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;        <span class="keywordflow">if</span> (has_merge_list) {</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;          ++key_iter;</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;          ++value_iter;</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;          <span class="comment">// If at end of list</span></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;          <span class="keywordflow">if</span> (key_iter == keys-&gt;rend() || value_iter == values-&gt;rend()) {</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;            <span class="comment">// Sanity Check: if one ends, then both end</span></div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;            assert(key_iter == keys-&gt;rend() &amp;&amp; value_iter == values-&gt;rend());</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;          }</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;          <span class="comment">// Otherwise not at end of list. Update key, value, and ikey.</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;          key = Slice(*key_iter);</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;          value = Slice(*value_iter);</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;          <a class="code" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2">ParseInternalKey</a>(key, &amp;ikey);</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;        } <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;          <span class="comment">// Only had one item to begin with (Put/Delete)</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;        }</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;      }</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;    }</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;    <span class="comment">// MergeUntil has moved input to the next entry</span></div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    <span class="keywordflow">if</span> (!current_entry_is_merging) {</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;      input-&gt;Next();</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;    }</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;  }</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;  <span class="keywordflow">if</span> (status.ok() &amp;&amp; <a class="code" href="../../dd/df5/a00386.html#aa30ff424691deb3432441334d3adb3cf">shutting_down_</a>.<a class="code" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">Acquire_Load</a>()) {</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;    status = <a class="code" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc">Status::IOError</a>(<span class="stringliteral">&quot;Database shutdown started during compaction&quot;</span>);</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;  }</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;  <span class="keywordflow">if</span> (status.ok() &amp;&amp; compact-&gt;builder != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;    status = <a class="code" href="../../dd/df5/a00386.html#ab378543940b68e279594acd5af9ef594">FinishCompactionOutputFile</a>(compact, input.get());</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  }</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;  <span class="keywordflow">if</span> (status.ok()) {</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;    status = input-&gt;status();</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;  }</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;  input.reset();</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;  CompactionStats <a class="code" href="../../d6/d50/a02694.html#a5925d216740c89f43482df806fd14e8c">stats</a>;</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;  stats.micros = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">NowMicros</a>() - start_micros - imm_micros;</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>) {</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>-&gt;measureTime(<a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aeae4f56c3b91d240d60d3af98211d0448f">COMPACTION_TIME</a>, stats.micros);</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;  }</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;  stats.files_in_leveln = compact-&gt;compaction-&gt;num_input_files(0);</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;  stats.files_in_levelnp1 = compact-&gt;compaction-&gt;num_input_files(1);</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;  <span class="keywordtype">int</span> num_output_files = compact-&gt;outputs.size();</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;  <span class="keywordflow">if</span> (compact-&gt;builder != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;    <span class="comment">// An error occurred so ignore the last output.</span></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    assert(num_output_files &gt; 0);</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;    --num_output_files;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;  }</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;  stats.files_out_levelnp1 = num_output_files;</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; compact-&gt;compaction-&gt;num_input_files(0); i++)</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;    stats.bytes_readn += compact-&gt;compaction-&gt;input(0, i)-&gt;file_size;</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; compact-&gt;compaction-&gt;num_input_files(1); i++)</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;    stats.bytes_readnp1 += compact-&gt;compaction-&gt;input(1, i)-&gt;file_size;</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num_output_files; i++) {</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    stats.bytes_written += compact-&gt;outputs[i].file_size;</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;  }</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[compact-&gt;compaction-&gt;output_level()].Add(stats);</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;  <span class="comment">// if there were any unused file number (mostly in case of</span></div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;  <span class="comment">// compaction error), free up the entry from pending_putputs</span></div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#ab1a3a12c1f9b394536a0375966d4c65f">ReleaseCompactionUnusedFileNumbers</a>(compact);</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  <span class="keywordflow">if</span> (status.ok()) {</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    status = <a class="code" href="../../dd/df5/a00386.html#adffcba2faee783d86cfa72adbdcb10f0">InstallCompactionResults</a>(compact);</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;  }</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;  VersionSet::LevelSummaryStorage tmp;</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;      <span class="stringliteral">&quot;compacted to: %s, %.1f MB/sec, level %d, files in(%d, %d) out(%d) &quot;</span></div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;      <span class="stringliteral">&quot;MB in(%.1f, %.1f) out(%.1f), read-write-amplify(%.1f) &quot;</span></div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;      <span class="stringliteral">&quot;write-amplify(%.1f) %s\n&quot;</span>,</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LevelSummary(&amp;tmp),</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;      (stats.bytes_readn + stats.bytes_readnp1 + stats.bytes_written) /</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;          (<span class="keywordtype">double</span>) stats.micros,</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;      compact-&gt;compaction-&gt;output_level(),</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;      stats.files_in_leveln, stats.files_in_levelnp1, stats.files_out_levelnp1,</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;      stats.bytes_readn / 1048576.0,</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;      stats.bytes_readnp1 / 1048576.0,</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;      stats.bytes_written / 1048576.0,</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;      (stats.bytes_written + stats.bytes_readnp1 + stats.bytes_readn) /</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;          (<span class="keywordtype">double</span>) stats.bytes_readn,</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      stats.bytes_written / (double) stats.bytes_readn,</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;      status.ToString().c_str());</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;  <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a118052cb7b51c90604865d226452918b_cgraph.png" border="0" usemap="#dd/df5/a00386_a118052cb7b51c90604865d226452918b_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a118052cb7b51c90604865d226452918b_cgraph" id="dd/df5/a00386_a118052cb7b51c90604865d226452918b_cgraph">
<area shape="rect" id="node3" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="591,278,777,324"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#aa4a580611125396a6e0072010fced806" title="rocksdb::DBImpl::Allocate\lCompactionOutputFileNumbers" alt="" coords="316,76,521,123"/><area shape="rect" id="node9" href="../../d9/d5e/a00295.html#ae0e14955026684df1c7e261dc31fcb70" title="rocksdb::Compaction\l::num_input_files" alt="" coords="611,16,757,63"/><area shape="rect" id="node11" href="../../d9/d5e/a00295.html#a1db1e317f2592dea3a1f3e1ddb56197d" title="rocksdb::Compaction\l::BottomMostLevel" alt="" coords="345,1170,492,1216"/><area shape="rect" id="node13" href="../../de/daf/a01417.html#a8f740f146e792dc89409f8402a61ad04" title="rocksdb::Slice::clear" alt="" coords="348,1240,489,1269"/><area shape="rect" id="node15" href="../../df/d95/a00299.html#a67556dd7e1a4157598db71a86165dd40" title="rocksdb::DBImpl::Compaction\lState::current_output" alt="" coords="585,678,783,724"/><area shape="rect" id="node17" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="615,1370,753,1400"/><area shape="rect" id="node19" href="../../de/de6/a00723.html#a87df954d098adf219ebd79ae6f5b75f3" title="rocksdb::InternalKey\l::DecodeFrom" alt="" coords="348,1450,489,1496"/><area shape="rect" id="node22" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="616,1441,752,1470"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#aeb1d7919e60faa30ad63a70ce932e109" title="rocksdb::DBImpl::findEarliest\lVisibleSnapshot" alt="" coords="323,556,515,603"/><area shape="rect" id="node26" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="636,556,732,585"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#ab378543940b68e279594acd5af9ef594" title="rocksdb::DBImpl::FinishCompaction\lOutputFile" alt="" coords="303,727,535,774"/><area shape="rect" id="node33" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="616,817,752,846"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="324,436,513,483"/><area shape="rect" id="node41" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="605,608,763,655"/><area shape="rect" id="node43" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc" title="rocksdb::port::AtomicPointer\l::NoBarrier_Load" alt="" coords="833,866,1020,912"/><area shape="rect" id="node46" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="603,225,765,254"/><area shape="rect" id="node54" href="../../dc/de6/a01426.html#ab55f97d15a5529dec33ece4781c23955" title="rocksdb::SnapshotList\l::getAll" alt="" coords="343,1570,495,1616"/><area shape="rect" id="node56" href="../../df/d95/a00299.html#ad2f52f4205cf56125d0e9d1c4929727d" title="rocksdb::DBImpl::Compaction\lState::GetFilterContext" alt="" coords="320,1639,517,1686"/><area shape="rect" id="node58" href="../../d4/d87/a03436.html#a79e23f5792d55281c43f7a8ea8588fea" title="rocksdb::GetInternalKeySeqno" alt="" coords="319,1344,519,1373"/><area shape="rect" id="node62" href="../../d9/d5e/a00295.html#a31e5be150c385f6df320ee7f7daf7a9a" title="rocksdb::Compaction\l::input" alt="" coords="345,1708,492,1755"/><area shape="rect" id="node64" href="../../dd/df5/a00386.html#adffcba2faee783d86cfa72adbdcb10f0" title="rocksdb::DBImpl::Install\lCompactionResults" alt="" coords="337,215,500,262"/><area shape="rect" id="node69" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="611,155,757,202"/><area shape="rect" id="node73" href="../../d9/d5e/a00295.html#a53e0c2555b1e84479ba222ad0631d747" title="rocksdb::Compaction\l::IsBaseLevelForKey" alt="" coords="345,1778,492,1824"/><area shape="rect" id="node77" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="613,870,755,916"/><area shape="rect" id="node80" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="620,940,748,969"/><area shape="rect" id="node82" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="376,1848,461,1877"/><area shape="rect" id="node84" href="../../d9/d5e/a00295.html#a37f93f7e5f747a03eb37894c1e950e84" title="rocksdb::Compaction\l::MaxOutputFileSize" alt="" coords="345,1900,492,1947"/><area shape="rect" id="node86" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="377,1970,460,2000"/><area shape="rect" id="node89" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="332,2024,505,2053"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#af9b32f2f68613634aaf0252e1fb143d2" title="rocksdb::DBImpl::OpenCompaction\lOutputFile" alt="" coords="304,898,533,944"/><area shape="rect" id="node96" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="613,992,755,1039"/><area shape="rect" id="node99" href="../../d9/d5e/a00295.html#abfdd0bc6e7a457377c45f15c89be37e7" title="rocksdb::Compaction\l::output_level" alt="" coords="611,1062,757,1108"/><area shape="rect" id="node103" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2" title="rocksdb::ParseInternalKey" alt="" coords="331,1397,507,1426"/><area shape="rect" id="node107" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="348,2077,489,2106"/><area shape="rect" id="node109" href="../../dd/df5/a00386.html#ab1a3a12c1f9b394536a0375966d4c65f" title="rocksdb::DBImpl::Release\lCompactionUnusedFileNumbers" alt="" coords="313,146,524,192"/><area shape="rect" id="node112" href="../../d9/d5e/a00295.html#ab758c022170f7bb2421feae0d2f9de90" title="rocksdb::Compaction\l::score" alt="" coords="345,2130,492,2176"/><area shape="rect" id="node114" href="../../d9/d5e/a00295.html#a405df211f8acdf4a025b6667245985ec" title="rocksdb::Compaction\l::ShouldStopBefore" alt="" coords="345,2199,492,2246"/><area shape="rect" id="node116" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1" title="rocksdb::port::CondVar\l::SignalAll" alt="" coords="340,2268,497,2315"/><area shape="rect" id="node119" href="../../d9/d5e/a00295.html#a689b7c58190c1fee9c0fd22e7ff79ea3" title="rocksdb::Compaction\l::Summary" alt="" coords="345,2338,492,2384"/><area shape="rect" id="node121" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="337,2408,500,2437"/><area shape="rect" id="node123" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="333,2461,504,2490"/><area shape="rect" id="node126" href="../../d4/d87/a03436.html#aa87722c52593b34fb815ca86eede3494" title="rocksdb::UpdateInternalKey" alt="" coords="327,2514,511,2544"/><area shape="rect" id="node128" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0" title="rocksdb::DBImpl::user\l_comparator" alt="" coords="343,2567,495,2614"/><area shape="rect" id="node7" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="613,86,755,132"/><area shape="rect" id="node31" href="../../d2/d02/a00777.html#a5435c832490b19d4c3aebf7c4877098d" title="rocksdb::Iterator::\lstatus" alt="" coords="621,747,747,794"/><area shape="rect" id="node39" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="605,347,763,394"/><area shape="rect" id="node48" href="../../d7/dd4/a00968.html#ab919b8b2b4a57174e618272f0f6dd7a2" title="rocksdb::MemTableList\l::PickMemtablesToFlush" alt="" coords="601,416,767,463"/><area shape="rect" id="node50" href="../../d3/dcd/a00965.html#a1345f2a7f5bbb0416dfb6290ab6eea0b" title="rocksdb::MemTable::\lGetEdits" alt="" coords="612,486,756,532"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a118052cb7b51c90604865d226452918b_icgraph.png" border="0" usemap="#dd/df5/a00386_a118052cb7b51c90604865d226452918b_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a118052cb7b51c90604865d226452918b_icgraph" id="dd/df5/a00386_a118052cb7b51c90604865d226452918b_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="301,281,499,327"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="547,250,744,297"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="792,267,1040,296"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1088,258,1309,305"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1375,77,1537,123"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1357,146,1555,193"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1369,267,1543,296"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1368,1099,1544,1128"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1359,1462,1553,1509"/><area shape="rect" id="node56" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1389,891,1523,920"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1656,93,1765,123"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1620,23,1801,70"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1901,5,2059,35"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1925,59,2035,88"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1605,155,1816,184"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1636,261,1785,291"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1608,208,1813,237"/><area shape="rect" id="node32" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="1925,341,2035,371"/><area shape="rect" id="node34" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="1929,235,2031,264"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1877,533,2083,563"/><area shape="rect" id="node38" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="1897,288,2063,317"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="1925,181,2035,211"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1656,1573,1765,1603"/><area shape="rect" id="node50" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1632,1627,1789,1656"/><area shape="rect" id="node52" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="1925,1596,2035,1625"/><area shape="rect" id="node54" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="1885,1649,2075,1695"/><area shape="rect" id="node58" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1629,751,1792,798"/><area shape="rect" id="node62" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1640,821,1781,867"/><area shape="rect" id="node66" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1611,891,1811,920"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1615,944,1807,973"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1656,1067,1765,1096"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1621,1120,1800,1149"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1631,1173,1791,1219"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1649,699,1772,728"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1643,1242,1779,1289"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1615,1311,1807,1358"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1615,1381,1807,1427"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1603,1451,1819,1480"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1629,1503,1792,1550"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1685,315,1736,344"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1641,367,1780,414"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1621,437,1800,483"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1629,506,1792,553"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1628,576,1793,605"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1641,629,1780,675"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1639,997,1783,1043"/><area shape="rect" id="node60" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1899,751,2061,798"/><area shape="rect" id="node64" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1893,829,2067,859"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1867,935,2093,982"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2f6c0d55ec4f04c4b5f736f59fa51d4d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::EnableFileDeletions </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a462b134b3ceef9d10216a56b668d2945">rocksdb::DB</a>.</p>

<p>Reimplemented in <a class="el" href="../../db/db9/a00387.html#a66c4234e0ea012c0e40301375e1385a5">rocksdb::DBImplReadOnly</a>.</p>

<p>Definition at line <a class="el" href="../../dd/db2/a02563_source.html#l00030">30</a> of file <a class="el" href="../../dd/db2/a02563_source.html">db_filesnapshot.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00356">disable_delete_obsolete_files_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00036">rocksdb::Status::OK()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00511">PurgeObsoleteFiles()</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                                   {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  DeletionState deletion_state;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a3573b1eae3665c2cc757b8c396622b17">disable_delete_obsolete_files_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;File Deletions Enabled&quot;</span>);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8">FindObsoleteFiles</a>(deletion_state, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5">PurgeObsoleteFiles</a>(deletion_state);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00">Status::OK</a>();</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a2f6c0d55ec4f04c4b5f736f59fa51d4d_cgraph.png" border="0" usemap="#dd/df5/a00386_a2f6c0d55ec4f04c4b5f736f59fa51d4d_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a2f6c0d55ec4f04c4b5f736f59fa51d4d_cgraph" id="dd/df5/a00386_a2f6c0d55ec4f04c4b5f736f59fa51d4d_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="1071,1719,1276,1766"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1676,1853,1772,1883"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="1109,1663,1237,1692"/><area shape="rect" id="node17" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="1653,1339,1795,1368"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="244,1134,457,1181"/><area shape="rect" id="node5" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1377,1662,1519,1709"/><area shape="rect" id="node7" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="1361,1732,1535,1761"/><area shape="rect" id="node9" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="1345,1785,1551,1831"/><area shape="rect" id="node11" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="1360,1113,1536,1143"/><area shape="rect" id="node19" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1880,1365,2040,1395"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="533,1195,696,1224"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1372,956,1524,985"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="1091,247,1256,276"/><area shape="rect" id="node46" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="527,1299,703,1328"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="1347,1009,1549,1039"/><area shape="rect" id="node51" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1656,645,1792,675"/><area shape="rect" id="node53" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1639,40,1809,69"/><area shape="rect" id="node57" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="1091,1012,1256,1041"/><area shape="rect" id="node59" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="508,925,721,971"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1643,1009,1805,1039"/><area shape="rect" id="node32" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="1335,195,1561,224"/><area shape="rect" id="node34" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="1649,247,1799,276"/><area shape="rect" id="node36" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="1647,177,1801,223"/><area shape="rect" id="node38" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1892,489,2028,519"/><area shape="rect" id="node43" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="1360,299,1536,328"/><area shape="rect" id="node55" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1885,40,2035,69"/><area shape="rect" id="node61" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="795,880,995,909"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158" title="rocksdb::if" alt="" coords="853,1195,936,1224"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a546d3e2e5c3b4aa8ee9828c7b519d501" title="rocksdb::ArchivalDirectory" alt="" coords="807,933,983,963"/><area shape="rect" id="node76" href="../../db/db1/a00460.html#a0b7781facd40158245aabf25ce686448" title="rocksdb::Env::GetFileModificationTime" alt="" coords="771,987,1019,1016"/><area shape="rect" id="node79" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d" title="rocksdb::Env::GetFileSize" alt="" coords="1361,593,1535,623"/><area shape="rect" id="node81" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="852,1040,937,1069"/><area shape="rect" id="node83" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267" title="rocksdb::DBImpl::AppendSorted\lWalsOfType" alt="" coords="789,658,1000,705"/><area shape="rect" id="node127" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="801,1339,988,1368"/><area shape="rect" id="node68" href="../../da/d71/a00814.html#ab25c6d03dbcd6168b3ae3762dc98fd51" title="rocksdb::LDBCommandExecute\lResult::FAILED" alt="" coords="1068,1166,1279,1213"/><area shape="rect" id="node70" href="../../da/d71/a00814.html#ae4210d600639c8c6ac04486ebc43c39b" title="rocksdb::LDBCommandExecute\lResult::LDBCommandExecuteResult" alt="" coords="1328,1166,1568,1213"/><area shape="rect" id="node85" href="../../dd/df5/a00386.html#a26b3cfbce68c226c861cfacd4a111fe1" title="rocksdb::DBImpl::CheckWal\lFileExistsAndEmpty" alt="" coords="1079,670,1268,717"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#a58d2431c9ec2de7473a8bc2f171c04b8" title="rocksdb::DBImpl::ReadFirst\lRecord" alt="" coords="1081,790,1265,837"/><area shape="rect" id="node123" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="1081,499,1265,546"/><area shape="rect" id="node99" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8" title="rocksdb::DBImpl::ReadFirstLine" alt="" coords="1344,852,1552,881"/><area shape="rect" id="node110" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="1643,904,1805,933"/><area shape="rect" id="node118" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8" title="rocksdb::Status::NotSupported" alt="" coords="1347,1391,1549,1420"/><area shape="rect" id="node121" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736" title="beast::IP::to_string" alt="" coords="1381,799,1515,828"/><area shape="rect" id="node103" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="1616,731,1832,760"/><area shape="rect" id="node106" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="1653,783,1795,830"/><area shape="rect" id="node125" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1365,508,1531,537"/><area shape="rect" id="node129" href="../../d2/d86/a01798.html#a9808f90e0c3ec496be67fc62cac0bd8f" title="rocksdb::VersionEdit\l::DeleteFile" alt="" coords="1103,1390,1244,1437"/><area shape="rect" id="node133" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba" title="rocksdb::Status::Invalid\lArgument" alt="" coords="1644,1471,1804,1518"/><area shape="rect" id="node139" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="1068,1287,1279,1316"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aeb1d7919e60faa30ad63a70ce932e109"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> rocksdb::DBImpl::findEarliestVisibleSnapshot </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a>&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>snapshots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> *&#160;</td>
          <td class="paramname"><em>prev_snapshot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02053">2053</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, and <a class="el" href="../../d5/d95/a02720_source.html#l00036">prev</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>.</p>
<div class="fragment"><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;                                 {</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> <a class="code" href="../../d5/d95/a02720.html#aabbd2f01bb8ec4a7a0128bce5f8cdb1b">prev</a> __attribute__((unused)) = 0;</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> cur : snapshots) {</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    assert(<a class="code" href="../../d5/d95/a02720.html#aabbd2f01bb8ec4a7a0128bce5f8cdb1b">prev</a> &lt;= cur);</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="keywordflow">if</span> (cur &gt;= <a class="code" href="../../d2/dd6/a03414.html#a7378f09d8f10ef3ccbb2aeefe7ff41d3">in</a>) {</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      *prev_snapshot = <a class="code" href="../../d5/d95/a02720.html#aabbd2f01bb8ec4a7a0128bce5f8cdb1b">prev</a>;</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;      <span class="keywordflow">return</span> cur;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    }</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;    <a class="code" href="../../d5/d95/a02720.html#aabbd2f01bb8ec4a7a0128bce5f8cdb1b">prev</a> = cur; <span class="comment">// assignment</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;    assert(<a class="code" href="../../d5/d95/a02720.html#aabbd2f01bb8ec4a7a0128bce5f8cdb1b">prev</a>);</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  }</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;      <span class="stringliteral">&quot;Looking for seqid %lu but maxseqid is %lu&quot;</span>,</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;      (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="../../d2/dd6/a03414.html#a7378f09d8f10ef3ccbb2aeefe7ff41d3">in</a>,</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;      (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)snapshots[snapshots.size()-1]);</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;  assert(0);</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aeb1d7919e60faa30ad63a70ce932e109_cgraph.png" border="0" usemap="#dd/df5/a00386_aeb1d7919e60faa30ad63a70ce932e109_cgraph" alt=""/></div>
<map name="dd/df5/a00386_aeb1d7919e60faa30ad63a70ce932e109_cgraph" id="dd/df5/a00386_aeb1d7919e60faa30ad63a70ce932e109_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="249,13,345,43"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aeb1d7919e60faa30ad63a70ce932e109_icgraph.png" border="0" usemap="#dd/df5/a00386_aeb1d7919e60faa30ad63a70ce932e109_icgraph" alt=""/></div>
<map name="dd/df5/a00386_aeb1d7919e60faa30ad63a70ce932e109_icgraph" id="dd/df5/a00386_aeb1d7919e60faa30ad63a70ce932e109_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="249,289,495,319"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="544,281,741,327"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="789,250,987,297"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1035,267,1283,296"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1331,258,1552,305"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1617,77,1780,123"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1600,146,1797,193"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1612,267,1785,296"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1611,1105,1787,1135"/><area shape="rect" id="node50" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1601,1465,1796,1511"/><area shape="rect" id="node58" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1632,899,1765,928"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1899,93,2008,123"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1863,23,2044,70"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="2135,59,2292,88"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="2159,5,2268,35"/><area shape="rect" id="node25" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1848,155,2059,184"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1879,261,2028,291"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1851,208,2056,237"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2159,288,2268,317"/><area shape="rect" id="node36" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2163,341,2264,371"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2111,533,2316,563"/><area shape="rect" id="node40" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2131,235,2296,264"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="2159,181,2268,211"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1899,1573,2008,1603"/><area shape="rect" id="node52" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1875,1627,2032,1656"/><area shape="rect" id="node54" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="2159,1657,2268,1687"/><area shape="rect" id="node56" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="2119,1587,2308,1634"/><area shape="rect" id="node60" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1872,751,2035,798"/><area shape="rect" id="node64" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1883,821,2024,867"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1853,960,2053,989"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1857,1013,2049,1043"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1899,1067,2008,1096"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1864,1120,2043,1149"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1873,1173,2033,1219"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1892,699,2015,728"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1885,1242,2021,1289"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1857,1311,2049,1358"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1857,1381,2049,1427"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1845,1451,2061,1480"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1872,1503,2035,1550"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1928,315,1979,344"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1884,367,2023,414"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1864,437,2043,483"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1872,506,2035,553"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1871,576,2036,605"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1884,629,2023,675"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1881,890,2025,937"/><area shape="rect" id="node62" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2132,751,2295,798"/><area shape="rect" id="node66" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2127,829,2300,859"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab7c2980d0da47c4557512b51231ca07c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rocksdb::DBImpl::FindMinimumEmptyLevelFitting </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01208">1208</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01223">ReFitLevel()</a>.</p>
<div class="fragment"><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                                                  {</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  <span class="keywordtype">int</span> minimum_level = level;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = level - 1; i &gt; 0; --i) {</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="comment">// stop if level i is not empty</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelFiles(i) &gt; 0) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="comment">// stop if level i is too small (cannot fit the level files)</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;MaxBytesForLevel(i) &lt; <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelBytes(level)) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    minimum_level = i;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  }</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <span class="keywordflow">return</span> minimum_level;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ab7c2980d0da47c4557512b51231ca07c_cgraph.png" border="0" usemap="#dd/df5/a00386_ab7c2980d0da47c4557512b51231ca07c_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ab7c2980d0da47c4557512b51231ca07c_cgraph" id="dd/df5/a00386_ab7c2980d0da47c4557512b51231ca07c_cgraph">
<area shape="rect" id="node3" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="263,5,404,51"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ab7c2980d0da47c4557512b51231ca07c_icgraph.png" border="0" usemap="#dd/df5/a00386_ab7c2980d0da47c4557512b51231ca07c_icgraph" alt=""/></div>
<map name="dd/df5/a00386_ab7c2980d0da47c4557512b51231ca07c_icgraph" id="dd/df5/a00386_ab7c2980d0da47c4557512b51231ca07c_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a889fc527654cd063029f570c18173834" title="rocksdb::DBImpl::ReFitLevel" alt="" coords="263,32,452,61"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="501,23,683,70"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="732,5,889,35"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="756,59,865,88"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="940,5,1049,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3683f24e767a6e83d03acab509c64ba8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::FindObsoleteFiles </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/dea/a00408.html">DeletionState</a> &amp;&#160;</td>
          <td class="paramname"><em>deletion_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>force</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>no_full_scan</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00444">444</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00137">rocksdb::DBImpl::DeletionState::all_files</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00176">dbname_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00359">delete_obsolete_files_last_run_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00396">rocksdb::Options::delete_obsolete_files_period_micros</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00356">disable_delete_obsolete_files_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6">rocksdb::Env::GetChildren()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00129">rocksdb::DBImpl::DeletionState::HaveSomethingToDelete()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00150">rocksdb::DBImpl::DeletionState::log_number</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00150">rocksdb::DBImpl::DeletionState::manifest_file_number</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">rocksdb::Env::NowMicros()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00326">pending_outputs_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00150">rocksdb::DBImpl::DeletionState::prev_log_number</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00143">rocksdb::DBImpl::DeletionState::sst_delete_files</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00140">rocksdb::DBImpl::DeletionState::sst_live</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00384">rocksdb::Options::wal_dir</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01648">BackgroundCallFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03355">DeleteFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00635">DeleteObsoleteFiles()</a>, and <a class="el" href="../../dd/db2/a02563_source.html#l00030">EnableFileDeletions()</a>.</p>
<div class="fragment"><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                                                  {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="comment">// if deletion is disabled, do nothing</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a3573b1eae3665c2cc757b8c396622b17">disable_delete_obsolete_files_</a>) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keywordtype">bool</span> doing_the_full_scan = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">// logic for figurint out if we&#39;re doing the full scan</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordflow">if</span> (no_full_scan) {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    doing_the_full_scan = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (force || <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#ada05e62ae29498168924a6a6bddbc3b5">delete_obsolete_files_period_micros</a> == 0) {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    doing_the_full_scan = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> now_micros = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">NowMicros</a>();</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a1c7bbb1d0ce162afbd075c1dcd4fa74f">delete_obsolete_files_last_run_</a> +</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#ada05e62ae29498168924a6a6bddbc3b5">delete_obsolete_files_period_micros</a> &lt; now_micros) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      doing_the_full_scan = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a1c7bbb1d0ce162afbd075c1dcd4fa74f">delete_obsolete_files_last_run_</a> = now_micros;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    }</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="comment">// get obsolete files</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;GetObsoleteFiles(&amp;deletion_state.sst_delete_files);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="comment">// store the current filenum, lognum, etc</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  deletion_state.manifest_file_number = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;ManifestFileNumber();</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  deletion_state.log_number = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LogNumber();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  deletion_state.prev_log_number = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;PrevLogNumber();</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keywordflow">if</span> (!doing_the_full_scan &amp;&amp; !deletion_state.HaveSomethingToDelete()) {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="comment">// avoid filling up sst_live if we&#39;re sure that we</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="comment">// are not going to do the full scan and that we don&#39;t have</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="comment">// anything to delete at the moment</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  }</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">// don&#39;t delete live files</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  deletion_state.sst_live.assign(<a class="code" href="../../dd/df5/a00386.html#a1a62212922480c1ca92b25a555b3410e">pending_outputs_</a>.begin(),</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                                 <a class="code" href="../../dd/df5/a00386.html#a1a62212922480c1ca92b25a555b3410e">pending_outputs_</a>.end());</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;AddLiveFiles(&amp;deletion_state.sst_live);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="keywordflow">if</span> (doing_the_full_scan) {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="comment">// set of all files in the directory</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6">GetChildren</a>(<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>, &amp;deletion_state.all_files); <span class="comment">// Ignore errors</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">//Add log files in wal_dir</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a> != <a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>) {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      std::vector&lt;std::string&gt; log_files;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6">GetChildren</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>, &amp;log_files); <span class="comment">// Ignore errors</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      deletion_state.all_files.insert(</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        deletion_state.all_files.end(),</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        log_files.begin(),</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        log_files.end()</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      );</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    }</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a3683f24e767a6e83d03acab509c64ba8_cgraph.png" border="0" usemap="#dd/df5/a00386_a3683f24e767a6e83d03acab509c64ba8_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a3683f24e767a6e83d03acab509c64ba8_cgraph" id="dd/df5/a00386_a3683f24e767a6e83d03acab509c64ba8_cgraph">
<area shape="rect" id="node3" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="292,5,433,51"/><area shape="rect" id="node5" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="275,75,451,104"/><area shape="rect" id="node7" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="260,127,465,174"/><area shape="rect" id="node9" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="276,197,449,227"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a3683f24e767a6e83d03acab509c64ba8_icgraph.png" border="0" usemap="#dd/df5/a00386_a3683f24e767a6e83d03acab509c64ba8_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a3683f24e767a6e83d03acab509c64ba8_icgraph" id="dd/df5/a00386_a3683f24e767a6e83d03acab509c64ba8_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1032,283,1229,330"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1853,55,2051,102"/><area shape="rect" id="node91" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="259,267,445,296"/><area shape="rect" id="node97" href="../../dd/df5/a00386.html#a2f6c0d55ec4f04c4b5f736f59fa51d4d" title="rocksdb::DBImpl::EnableFile\lDeletions" alt="" coords="1036,353,1225,399"/><area shape="rect" id="node99" href="../../dd/df5/a00386.html#a4406b5ed5487f7562bd0fe1696c6092f" title="rocksdb::DBImpl::DeleteObsolete\lFiles" alt="" coords="1021,422,1240,469"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1288,317,1536,347"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1584,282,1805,329"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1871,175,2033,222"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1853,421,2051,467"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1865,245,2039,275"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1864,299,2040,328"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1855,351,2049,398"/><area shape="rect" id="node26" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1885,580,2019,609"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2101,5,2312,35"/><area shape="rect" id="node28" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2125,250,2288,297"/><area shape="rect" id="node32" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2136,319,2277,366"/><area shape="rect" id="node36" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2107,389,2307,419"/><area shape="rect" id="node38" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2111,443,2303,472"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2152,496,2261,525"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2117,549,2296,579"/><area shape="rect" id="node52" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2127,602,2287,649"/><area shape="rect" id="node56" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2145,672,2268,701"/><area shape="rect" id="node64" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2139,725,2275,771"/><area shape="rect" id="node66" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2111,794,2303,841"/><area shape="rect" id="node68" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2111,863,2303,910"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2099,933,2315,963"/><area shape="rect" id="node74" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2125,986,2288,1033"/><area shape="rect" id="node76" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2181,1056,2232,1085"/><area shape="rect" id="node78" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2137,1109,2276,1155"/><area shape="rect" id="node80" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2117,1178,2296,1225"/><area shape="rect" id="node82" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2125,1247,2288,1294"/><area shape="rect" id="node84" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2124,59,2289,88"/><area shape="rect" id="node86" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2137,111,2276,158"/><area shape="rect" id="node88" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2135,181,2279,227"/><area shape="rect" id="node30" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2395,234,2557,281"/><area shape="rect" id="node34" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2389,304,2563,333"/><area shape="rect" id="node40" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="2363,357,2589,403"/><area shape="rect" id="node42" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="2389,427,2563,456"/><area shape="rect" id="node44" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="2389,479,2563,526"/><area shape="rect" id="node50" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2451,549,2501,579"/><area shape="rect" id="node54" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="2396,602,2556,649"/><area shape="rect" id="node58" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2373,672,2579,701"/><area shape="rect" id="node60" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="2375,725,2577,771"/><area shape="rect" id="node62" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="2421,795,2531,824"/><area shape="rect" id="node70" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="2380,863,2572,910"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="495,197,708,243"/><area shape="rect" id="node107" href="../../d4/d87/a03436.html#ad19b60849d205b89e09ff716b7714f69" title="rocksdb::TEST" alt="" coords="547,267,656,296"/><area shape="rect" id="node95" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="759,297,972,343"/><area shape="rect" id="node105" href="../../dd/df5/a00386.html#ad62af2cf23b7a2da72715051e719e5f1" title="rocksdb::DBImpl::TEST\l_PurgeObsoleteteWAL" alt="" coords="784,197,947,243"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab378543940b68e279594acd5af9ef594"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::FinishCompactionOutputFile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d95/a00299.html">CompactionState</a> *&#160;</td>
          <td class="paramname"><em>compact</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d02/a00777.html">Iterator</a> *&#160;</td>
          <td class="paramname"><em>input</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01952">1952</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l00095">rocksdb::DBImpl::CompactionState::builder</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00170">rocksdb::COMPACTION_OUTFILE_SYNC_MICROS</a>, <a class="el" href="../../db/d44/a02564_source.html#l00099">rocksdb::DBImpl::CompactionState::current_output()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00356">rocksdb::Options::disableDataSync</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00086">rocksdb::DBImpl::CompactionState::Output::file_size</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00085">rocksdb::DBImpl::CompactionState::Output::number</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00094">rocksdb::DBImpl::CompactionState::outfile</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00348">rocksdb::Options::statistics</a>, <a class="el" href="../../d2/d02/a00777.html#a5435c832490b19d4c3aebf7c4877098d">rocksdb::Iterator::status()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00451">storage_options_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00301">table_cache_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00097">rocksdb::DBImpl::CompactionState::total_bytes</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00363">rocksdb::Options::use_fsync</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>.</p>
<div class="fragment"><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                                                           {</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;  assert(compact != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  assert(compact-&gt;outfile);</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;  assert(compact-&gt;builder != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> output_number = compact-&gt;current_output()-&gt;number;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  assert(output_number != 0);</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  <span class="comment">// Check for iterator errors</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = input-&gt;status();</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> current_entries = compact-&gt;builder-&gt;NumEntries();</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;  <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    s = compact-&gt;builder-&gt;Finish();</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    compact-&gt;builder-&gt;Abandon();</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  }</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> current_bytes = compact-&gt;builder-&gt;FileSize();</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  compact-&gt;current_output()-&gt;file_size = current_bytes;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;  compact-&gt;total_bytes += current_bytes;</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;  compact-&gt;builder.reset();</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;  <span class="comment">// Finish and check for file errors</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;  <span class="keywordflow">if</span> (s.ok() &amp;&amp; !<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6cc691fbf62b7f9c1b4b90a6d904519b">disableDataSync</a>) {</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6244d1e80d67ab065f2f7262ee2d8135">use_fsync</a>) {</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;      StopWatch sw(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aea3c2820786919203a95bbf7bdbaead654">COMPACTION_OUTFILE_SYNC_MICROS</a>);</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      s = compact-&gt;outfile-&gt;Fsync();</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;      StopWatch sw(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aea3c2820786919203a95bbf7bdbaead654">COMPACTION_OUTFILE_SYNC_MICROS</a>);</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;      s = compact-&gt;outfile-&gt;Sync();</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    }</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  }</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;  <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    s = compact-&gt;outfile-&gt;Close();</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;  }</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;  compact-&gt;outfile.reset();</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;  <span class="keywordflow">if</span> (s.ok() &amp;&amp; current_entries &gt; 0) {</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="comment">// Verify that the table is usable</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    Iterator* iter = <a class="code" href="../../dd/df5/a00386.html#a1b44e75ddaf3ea3befcd06b23ca9abb6">table_cache_</a>-&gt;NewIterator(ReadOptions(),</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                                               <a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>,</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;                                               output_number,</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;                                               current_bytes);</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    s = iter-&gt;status();</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    <span class="keyword">delete</span> iter;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;          <span class="stringliteral">&quot;Generated table #%lu: %lu keys, %lu bytes&quot;</span>,</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;          (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) output_number,</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;          (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) current_entries,</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;          (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) current_bytes);</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    }</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;  }</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ab378543940b68e279594acd5af9ef594_cgraph.png" border="0" usemap="#dd/df5/a00386_ab378543940b68e279594acd5af9ef594_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ab378543940b68e279594acd5af9ef594_cgraph" id="dd/df5/a00386_ab378543940b68e279594acd5af9ef594_cgraph">
<area shape="rect" id="node3" href="../../df/d95/a00299.html#a67556dd7e1a4157598db71a86165dd40" title="rocksdb::DBImpl::Compaction\lState::current_output" alt="" coords="289,5,487,51"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="340,75,436,104"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="320,128,456,157"/><area shape="rect" id="node9" href="../../d2/d02/a00777.html#a5435c832490b19d4c3aebf7c4877098d" title="rocksdb::Iterator::\lstatus" alt="" coords="325,181,451,227"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ab378543940b68e279594acd5af9ef594_icgraph.png" border="0" usemap="#dd/df5/a00386_ab378543940b68e279594acd5af9ef594_icgraph" alt=""/></div>
<map name="dd/df5/a00386_ab378543940b68e279594acd5af9ef594_icgraph" id="dd/df5/a00386_ab378543940b68e279594acd5af9ef594_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="289,289,535,319"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="584,281,781,327"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="829,250,1027,297"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1075,267,1323,296"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1371,258,1592,305"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1657,77,1820,123"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1640,146,1837,193"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1652,267,1825,296"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1651,1105,1827,1135"/><area shape="rect" id="node50" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1641,1465,1836,1511"/><area shape="rect" id="node58" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1672,899,1805,928"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1939,93,2048,123"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1903,23,2084,70"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="2175,59,2332,88"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="2199,5,2308,35"/><area shape="rect" id="node25" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1888,155,2099,184"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1919,261,2068,291"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1891,208,2096,237"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2199,288,2308,317"/><area shape="rect" id="node36" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2203,341,2304,371"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2151,533,2356,563"/><area shape="rect" id="node40" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2171,235,2336,264"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="2199,181,2308,211"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1939,1573,2048,1603"/><area shape="rect" id="node52" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1915,1627,2072,1656"/><area shape="rect" id="node54" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="2199,1657,2308,1687"/><area shape="rect" id="node56" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="2159,1587,2348,1634"/><area shape="rect" id="node60" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1912,751,2075,798"/><area shape="rect" id="node64" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1923,821,2064,867"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1893,960,2093,989"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1897,1013,2089,1043"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1939,1067,2048,1096"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1904,1120,2083,1149"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1913,1173,2073,1219"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1932,699,2055,728"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1925,1242,2061,1289"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1897,1311,2089,1358"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1897,1381,2089,1427"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1885,1451,2101,1480"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1912,1503,2075,1550"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1968,315,2019,344"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1924,367,2063,414"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1904,437,2083,483"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1912,506,2075,553"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1911,576,2076,605"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1924,629,2063,675"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1921,890,2065,937"/><area shape="rect" id="node62" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2172,751,2335,798"/><area shape="rect" id="node66" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2167,829,2340,859"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aaf39022d45b559b69933cfe719571c10"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::Flush </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d8/dd2/a00565.html">FlushOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a801b7ea75868fe262712c35d870c50af">rocksdb::DB</a>.</p>

<p>Reimplemented in <a class="el" href="../../db/db9/a00387.html#af9849818dd158fb2b147b06d30c347ce">rocksdb::DBImplReadOnly</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01291">1291</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l01554">FlushMemTable()</a>.</p>

<p>Referenced by <a class="el" href="../../dd/db2/a02563_source.html#l00043">GetLiveFiles()</a>, and <a class="el" href="../../d0/df5/a02576_source.html#l00253">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                                                {</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> status = <a class="code" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28">FlushMemTable</a>(options);</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aaf39022d45b559b69933cfe719571c10_cgraph.png" border="0" usemap="#dd/df5/a00386_aaf39022d45b559b69933cfe719571c10_cgraph" alt=""/></div>
<map name="dd/df5/a00386_aaf39022d45b559b69933cfe719571c10_cgraph" id="dd/df5/a00386_aaf39022d45b559b69933cfe719571c10_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="213,163,403,210"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="452,1471,609,1500"/><area shape="rect" id="node17" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="953,41,1089,71"/><area shape="rect" id="node113" href="../../dd/df5/a00386.html#a1db8d713be426c044273b2fa01c75c08" title="rocksdb::DBImpl::WaitFor\lFlushMemTable" alt="" coords="669,163,843,210"/><area shape="rect" id="node7" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="943,94,1100,141"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="659,865,853,911"/><area shape="rect" id="node19" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="951,233,1092,279"/><area shape="rect" id="node28" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="951,1471,1092,1500"/><area shape="rect" id="node30" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="951,302,1092,349"/><area shape="rect" id="node65" href="../../dd/df5/a00386.html#acbfdfdd72e490648da9f229fdcd06337" title="rocksdb::DBImpl::BuildBatch\lGroup" alt="" coords="661,1633,851,1679"/><area shape="rect" id="node69" href="../../da/d8c/a01845.html#a04c6bd515d35bda6ffa8ae21ab1e1478" title="rocksdb::WriteBatchInternal\l::ByteSize" alt="" coords="929,1574,1113,1621"/><area shape="rect" id="node71" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="1189,1757,1373,1803"/><area shape="rect" id="node78" href="../../da/d8c/a01845.html#a2c7f53a4c8d710fdbf229c917506f7ab" title="rocksdb::WriteBatchInternal\l::SetSequence" alt="" coords="664,1771,848,1818"/><area shape="rect" id="node85" href="../../d4/d87/a03436.html#a48457fd59325e708afa7fff617f87e05" title="rocksdb::StartPerfTimer" alt="" coords="676,1841,836,1871"/><area shape="rect" id="node89" href="../../da/d8c/a01845.html#af28dbb69a970e8ab218402339f0bb7ee" title="rocksdb::WriteBatchInternal\l::Contents" alt="" coords="664,1894,848,1941"/><area shape="rect" id="node91" href="../../d4/d87/a03436.html#af0bd42ecfc79c4765b60919d28702a29" title="rocksdb::BumpPerfTime" alt="" coords="675,1964,837,1993"/><area shape="rect" id="node95" href="../../da/d8c/a01845.html#aa10e1abb5f141e75e184bf456a5d65a6" title="rocksdb::WriteBatchInternal\l::InsertInto" alt="" coords="664,1702,848,1749"/><area shape="rect" id="node102" href="../../d4/d87/a03436.html#a9231fa7580b3932152d6f3bd39907320" title="rocksdb::SetTickerCount" alt="" coords="673,2017,839,2047"/><area shape="rect" id="node104" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="692,591,820,620"/><area shape="rect" id="node107" href="../../d2/dbd/a01844.html#a73502c77c1ebdf40417a34eb385e117e" title="rocksdb::WriteBatch\l::Clear" alt="" coords="685,745,827,791"/><area shape="rect" id="node109" href="../../d0/d39/a00314.html#a84d028d8d526b7ce592433ba836a1853" title="rocksdb::port::CondVar\l::Signal" alt="" coords="677,43,835,90"/><area shape="rect" id="node9" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1195,172,1368,201"/><area shape="rect" id="node13" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1211,1107,1352,1154"/><area shape="rect" id="node15" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="952,441,1091,487"/><area shape="rect" id="node22" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="901,511,1141,540"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#a4bd51a8c14d950ad017734df3a7b851c" title="rocksdb::DBImpl::Slowdown\lAmount" alt="" coords="928,563,1115,610"/><area shape="rect" id="node26" href="../../d8/d6c/a01563.html#a2265fb9a74a457ec56cc61f60ea5353e" title="rocksdb::StopWatch\l::ElapsedMicros" alt="" coords="951,633,1092,679"/><area shape="rect" id="node33" href="../../d3/dcd/a00965.html#a3232b72cba2586f3d6dbd08d8b4be86d" title="rocksdb::MemTable::\lApproximateMemoryUsage" alt="" coords="932,702,1111,749"/><area shape="rect" id="node35" href="../../dd/df5/a00386.html#a24b1211b5a5fbfccfe0818c32753ff5f" title="rocksdb::DBImpl::DelayLogging\lAndReset" alt="" coords="919,371,1124,418"/><area shape="rect" id="node37" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1233,576,1329,605"/><area shape="rect" id="node39" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="943,163,1100,210"/><area shape="rect" id="node43" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="979,873,1064,903"/><area shape="rect" id="node45" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="920,927,1123,956"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="945,980,1097,1009"/><area shape="rect" id="node49" href="../../d3/dcd/a00965.html#a08633ea1ccd8277c4bad90686e12e59d" title="rocksdb::MemTable::\lSetNextLogNumber" alt="" coords="949,1033,1093,1079"/><area shape="rect" id="node51" href="../../d7/dd4/a00968.html#a889613116ef509399ebb13a714e236d6" title="rocksdb::MemTableList::Add" alt="" coords="927,1103,1116,1132"/><area shape="rect" id="node53" href="../../d7/dd4/a00968.html#acd9439e034e085a62a05850d9ba39c7a" title="rocksdb::MemTableList\l::FlushRequested" alt="" coords="943,1155,1100,1202"/><area shape="rect" id="node55" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="916,1225,1127,1255"/><area shape="rect" id="node57" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="939,1279,1104,1308"/><area shape="rect" id="node59" href="../../d3/dcd/a00965.html#a81f80d2b6674d454e4b65f238281d716" title="rocksdb::MemTable::\lSetLogNumber" alt="" coords="949,1331,1093,1378"/><area shape="rect" id="node61" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="911,1401,1132,1447"/><area shape="rect" id="node67" href="../../da/d8c/a01845.html#a3e28aed1201077095cf66c5e242d1630" title="rocksdb::WriteBatchInternal\l::Append" alt="" coords="929,1697,1113,1743"/><area shape="rect" id="node75" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e" title="beast.util.Iter.first" alt="" coords="960,1644,1083,1673"/><area shape="rect" id="node73" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="1423,1765,1588,1795"/><area shape="rect" id="node80" href="../../d4/d87/a03436.html#a0a6b5f485f1b3d6f33ead2fc4d7c891c" title="rocksdb::EncodeFixed64" alt="" coords="939,1956,1104,1985"/><area shape="rect" id="node87" href="../../d6/d82/a01565.html#ab4ee8b0d656efc48fb33c09fe0c10646" title="rocksdb::StopWatchNano\l::Start" alt="" coords="936,2009,1107,2055"/><area shape="rect" id="node93" href="../../d6/d82/a01565.html#a7354735b3199a8e7ce3d1b7368460576" title="rocksdb::StopWatchNano\l::ElapsedNanos" alt="" coords="936,2078,1107,2125"/><area shape="rect" id="node97" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="929,1886,1113,1933"/><area shape="rect" id="node99" href="../../d2/dbd/a01844.html#ac5f77d59bf05e77679fc2ad832e1ccdf" title="rocksdb::WriteBatch\l::Iterate" alt="" coords="951,1817,1092,1863"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aaf39022d45b559b69933cfe719571c10_icgraph.png" border="0" usemap="#dd/df5/a00386_aaf39022d45b559b69933cfe719571c10_icgraph" alt=""/></div>
<map name="dd/df5/a00386_aaf39022d45b559b69933cfe719571c10_icgraph" id="dd/df5/a00386_aaf39022d45b559b69933cfe719571c10_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#aaa4a148182ce98c83d363817e938ddd5" title="rocksdb::DBImpl::GetLive\lFiles" alt="" coords="213,5,387,51"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="245,75,355,104"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad14868938ccf999100f441fcd9aa7c28"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::FlushMemTable </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d8/dd2/a00565.html">FlushOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01554">1554</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00733">rocksdb::FlushOptions::wait</a>, <a class="el" href="../../db/d44/a02564_source.html#l01564">WaitForFlushMemTable()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01291">Flush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01577">TEST_FlushMemTable()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>
<div class="fragment"><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                                                        {</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="comment">// nullptr batch means just wait for earlier writes to be done</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34">Write</a>(WriteOptions(), <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <span class="keywordflow">if</span> (s.ok() &amp;&amp; options.wait) {</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="comment">// Wait until the compaction completes</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    s = <a class="code" href="../../dd/df5/a00386.html#a1db8d713be426c044273b2fa01c75c08">WaitForFlushMemTable</a>();</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  }</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ad14868938ccf999100f441fcd9aa7c28_cgraph.png" border="0" usemap="#dd/df5/a00386_ad14868938ccf999100f441fcd9aa7c28_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ad14868938ccf999100f441fcd9aa7c28_cgraph" id="dd/df5/a00386_ad14868938ccf999100f441fcd9aa7c28_cgraph">
<area shape="rect" id="node3" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="745,5,881,35"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a1db8d713be426c044273b2fa01c75c08" title="rocksdb::DBImpl::WaitFor\lFlushMemTable" alt="" coords="461,109,635,155"/><area shape="rect" id="node14" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="244,761,401,791"/><area shape="rect" id="node7" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="735,109,892,155"/><area shape="rect" id="node10" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="735,178,892,225"/><area shape="rect" id="node12" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="987,221,1160,251"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="451,813,645,859"/><area shape="rect" id="node26" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="743,247,884,294"/><area shape="rect" id="node35" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="743,387,884,416"/><area shape="rect" id="node37" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="743,317,884,363"/><area shape="rect" id="node71" href="../../dd/df5/a00386.html#acbfdfdd72e490648da9f229fdcd06337" title="rocksdb::DBImpl::BuildBatch\lGroup" alt="" coords="453,1607,643,1654"/><area shape="rect" id="node75" href="../../da/d8c/a01845.html#a04c6bd515d35bda6ffa8ae21ab1e1478" title="rocksdb::WriteBatchInternal\l::ByteSize" alt="" coords="721,1538,905,1585"/><area shape="rect" id="node77" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="981,1771,1165,1818"/><area shape="rect" id="node84" href="../../da/d8c/a01845.html#a2c7f53a4c8d710fdbf229c917506f7ab" title="rocksdb::WriteBatchInternal\l::SetSequence" alt="" coords="456,1823,640,1870"/><area shape="rect" id="node91" href="../../d4/d87/a03436.html#a48457fd59325e708afa7fff617f87e05" title="rocksdb::StartPerfTimer" alt="" coords="468,2032,628,2061"/><area shape="rect" id="node95" href="../../da/d8c/a01845.html#af28dbb69a970e8ab218402339f0bb7ee" title="rocksdb::WriteBatchInternal\l::Contents" alt="" coords="456,1962,640,2009"/><area shape="rect" id="node97" href="../../d4/d87/a03436.html#af0bd42ecfc79c4765b60919d28702a29" title="rocksdb::BumpPerfTime" alt="" coords="467,2093,629,2123"/><area shape="rect" id="node101" href="../../da/d8c/a01845.html#aa10e1abb5f141e75e184bf456a5d65a6" title="rocksdb::WriteBatchInternal\l::InsertInto" alt="" coords="456,1893,640,1939"/><area shape="rect" id="node108" href="../../d4/d87/a03436.html#a9231fa7580b3932152d6f3bd39907320" title="rocksdb::SetTickerCount" alt="" coords="465,435,631,464"/><area shape="rect" id="node110" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="484,488,612,517"/><area shape="rect" id="node113" href="../../d2/dbd/a01844.html#a73502c77c1ebdf40417a34eb385e117e" title="rocksdb::WriteBatch\l::Clear" alt="" coords="477,541,619,587"/><area shape="rect" id="node115" href="../../d0/d39/a00314.html#a84d028d8d526b7ce592433ba836a1853" title="rocksdb::port::CondVar\l::Signal" alt="" coords="469,271,627,318"/><area shape="rect" id="node19" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1003,1321,1144,1367"/><area shape="rect" id="node21" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="744,1415,883,1462"/><area shape="rect" id="node29" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="693,1485,933,1515"/><area shape="rect" id="node31" href="../../dd/df5/a00386.html#a4bd51a8c14d950ad017734df3a7b851c" title="rocksdb::DBImpl::Slowdown\lAmount" alt="" coords="720,439,907,486"/><area shape="rect" id="node33" href="../../d8/d6c/a01563.html#a2265fb9a74a457ec56cc61f60ea5353e" title="rocksdb::StopWatch\l::ElapsedMicros" alt="" coords="743,509,884,555"/><area shape="rect" id="node40" href="../../d3/dcd/a00965.html#a3232b72cba2586f3d6dbd08d8b4be86d" title="rocksdb::MemTable::\lApproximateMemoryUsage" alt="" coords="724,578,903,625"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a24b1211b5a5fbfccfe0818c32753ff5f" title="rocksdb::DBImpl::DelayLogging\lAndReset" alt="" coords="711,647,916,694"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1025,687,1121,716"/><area shape="rect" id="node49" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="771,768,856,797"/><area shape="rect" id="node51" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="712,821,915,851"/><area shape="rect" id="node53" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="737,875,889,904"/><area shape="rect" id="node55" href="../../d3/dcd/a00965.html#a08633ea1ccd8277c4bad90686e12e59d" title="rocksdb::MemTable::\lSetNextLogNumber" alt="" coords="741,927,885,974"/><area shape="rect" id="node57" href="../../d7/dd4/a00968.html#a889613116ef509399ebb13a714e236d6" title="rocksdb::MemTableList::Add" alt="" coords="719,997,908,1027"/><area shape="rect" id="node59" href="../../d7/dd4/a00968.html#acd9439e034e085a62a05850d9ba39c7a" title="rocksdb::MemTableList\l::FlushRequested" alt="" coords="735,1050,892,1097"/><area shape="rect" id="node61" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="708,1120,919,1149"/><area shape="rect" id="node63" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="731,1173,896,1203"/><area shape="rect" id="node65" href="../../d3/dcd/a00965.html#a81f80d2b6674d454e4b65f238281d716" title="rocksdb::MemTable::\lSetLogNumber" alt="" coords="741,1226,885,1273"/><area shape="rect" id="node67" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="703,1295,924,1342"/><area shape="rect" id="node23" href="../../d0/dbf/a03363.html#a75c05654caed31bf91b09dbc14e681d1" title="beast::hash_metrics\l::detail::sqr" alt="" coords="1004,1415,1143,1462"/><area shape="rect" id="node73" href="../../da/d8c/a01845.html#a3e28aed1201077095cf66c5e242d1630" title="rocksdb::WriteBatchInternal\l::Append" alt="" coords="721,1607,905,1654"/><area shape="rect" id="node81" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e" title="beast.util.Iter.first" alt="" coords="752,1677,875,1707"/><area shape="rect" id="node79" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="1215,1780,1380,1809"/><area shape="rect" id="node86" href="../../d4/d87/a03436.html#a0a6b5f485f1b3d6f33ead2fc4d7c891c" title="rocksdb::EncodeFixed64" alt="" coords="731,1832,896,1861"/><area shape="rect" id="node93" href="../../d6/d82/a01565.html#ab4ee8b0d656efc48fb33c09fe0c10646" title="rocksdb::StopWatchNano\l::Start" alt="" coords="728,2023,899,2070"/><area shape="rect" id="node99" href="../../d6/d82/a01565.html#a7354735b3199a8e7ce3d1b7368460576" title="rocksdb::StopWatchNano\l::ElapsedNanos" alt="" coords="728,2093,899,2139"/><area shape="rect" id="node103" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="721,1954,905,2001"/><area shape="rect" id="node105" href="../../d2/dbd/a01844.html#ac5f77d59bf05e77679fc2ad832e1ccdf" title="rocksdb::WriteBatch\l::Iterate" alt="" coords="743,1885,884,1931"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ad14868938ccf999100f441fcd9aa7c28_icgraph.png" border="0" usemap="#dd/df5/a00386_ad14868938ccf999100f441fcd9aa7c28_icgraph" alt=""/></div>
<map name="dd/df5/a00386_ad14868938ccf999100f441fcd9aa7c28_icgraph" id="dd/df5/a00386_ad14868938ccf999100f441fcd9aa7c28_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#aaf39022d45b559b69933cfe719571c10" title="rocksdb::DBImpl::Flush" alt="" coords="253,75,413,104"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a789ea69cfa7ee4fccf934757a4641228" title="rocksdb::DBImpl::TEST\l_FlushMemTable" alt="" coords="252,231,415,278"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#a9bdda420ec5d44390a04215d8b1cbffd" title="rocksdb::DBImpl::~DBImpl" alt="" coords="244,301,423,331"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#aaa4a148182ce98c83d363817e938ddd5" title="rocksdb::DBImpl::GetLive\lFiles" alt="" coords="485,5,659,51"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="517,75,627,104"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="517,128,627,157"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="481,231,663,278"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="733,184,891,213"/><area shape="rect" id="node21" href="../../db/d95/a00391.html#a09218d973702b7be115bc4a65c0d97b9" title="rocksdb::DBTest::MakeTables" alt="" coords="472,301,672,331"/><area shape="rect" id="node26" href="../../de/de8/a00405.html#a49dbce26ebba1e0ac3f38a3af92b9757" title="rocksdb::DeleteFileTest\l::CreateTwoLevels" alt="" coords="492,354,652,401"/><area shape="rect" id="node28" href="../../d0/d88/a01231.html#a07eb4424cb2bef23ca200a806de76d9b" title="rocksdb::ReduceLevelTest\l::CompactMemTable" alt="" coords="483,423,661,470"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="757,240,867,269"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="953,184,1063,213"/><area shape="rect" id="node23" href="../../db/d95/a00391.html#af32d610cb80f870ed942c9ec7a053675" title="rocksdb::DBTest::FillLevels" alt="" coords="720,301,904,331"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3f1443d5437c4f0e98d7b0eb2839ef2e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::FlushMemTableToOutputFile </td>
          <td>(</td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>madeProgress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/dea/a00408.html">DeletionState</a> &amp;&#160;</td>
          <td class="paramname"><em>deletion_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01113">1113</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">rocksdb::port::AtomicPointer::Acquire_Load()</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00356">disable_delete_obsolete_files_</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00106">rocksdb::MemTable::GetEdits()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00312">imm_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00073">rocksdb::MemTableList::InstallMemtableFlushResults()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00051">rocksdb::Status::IOError()</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00046">rocksdb::MemTableList::IsFlushPending()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00146">rocksdb::DBImpl::DeletionState::log_delete_files</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00022">MaybeScheduleLogDBDeployStats()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02478">mem</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00167">rocksdb::Options::min_write_buffer_number_to_merge</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00326">pending_outputs_</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00056">rocksdb::MemTableList::PickMemtablesToFlush()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00049">rocksdb::VersionEdit::SetLogNumber()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00053">rocksdb::VersionEdit::SetPrevLogNumber()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00308">shutting_down_</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00039">rocksdb::MemTableList::size()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>, and <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01635">BackgroundFlush()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>.</p>
<div class="fragment"><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                                                                        {</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  assert(<a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717">size</a>() != 0);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36">IsFlushPending</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a115f9538bf76bb2a2929567292510d98">min_write_buffer_number_to_merge</a>)) {</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;FlushMemTableToOutputFile already in progress&quot;</span>);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc">Status::IOError</a>(<span class="stringliteral">&quot;FlushMemTableToOutputFile already in progress&quot;</span>);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  }</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  <span class="comment">// Save the contents of the earliest memtable as a new Table</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> file_number;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  std::vector&lt;MemTable*&gt; mems;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#ab919b8b2b4a57174e618272f0f6dd7a2">PickMemtablesToFlush</a>(&amp;mems);</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="keywordflow">if</span> (mems.empty()) {</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Nothing in memstore to flush&quot;</span>);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc">Status::IOError</a>(<span class="stringliteral">&quot;Nothing in memstore to flush&quot;</span>);</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  }</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  <span class="comment">// record the logfile_number_ before we release the mutex</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  <span class="comment">// entries mems are (implicitly) sorted in ascending order by their created</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <span class="comment">// time. We will use the first memtable&#39;s `edit` to keep the meta info for</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  <span class="comment">// this flush.</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  MemTable* m = mems[0];</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  VersionEdit* edit = m-&gt;GetEdits();</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  edit-&gt;SetPrevLogNumber(0);</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  <span class="comment">// SetLogNumber(log_num) indicates logs with number smaller than log_num</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <span class="comment">// will no longer be picked up for recovery.</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  edit-&gt;SetLogNumber(</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      mems.back()-&gt;GetNextLogNumber()</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  );</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  std::vector&lt;uint64_t&gt; logs_to_delete;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../db/d44/a02564.html#a0d98018e8146e811f356fa860a9839a0">mem</a> : mems) {</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    logs_to_delete.push_back(<a class="code" href="../../db/d44/a02564.html#a0d98018e8146e811f356fa860a9839a0">mem</a>-&gt;GetLogNumber());</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  }</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="comment">// This will release and re-acquire the mutex.</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../dd/df5/a00386.html#ac3d320a145d5d36cb2bbf9e57b39ae8a">WriteLevel0Table</a>(mems, edit, &amp;file_number);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <span class="keywordflow">if</span> (s.ok() &amp;&amp; <a class="code" href="../../dd/df5/a00386.html#aa30ff424691deb3432441334d3adb3cf">shutting_down_</a>.<a class="code" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">Acquire_Load</a>()) {</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    s = <a class="code" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc">Status::IOError</a>(</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      <span class="stringliteral">&quot;Database shutdown started during memtable compaction&quot;</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    );</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="comment">// Replace immutable memtable with the generated Table</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  s = <a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514">InstallMemtableFlushResults</a>(</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    mems, <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>.get(), s, &amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>.get(),</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    file_number, <a class="code" href="../../dd/df5/a00386.html#a1a62212922480c1ca92b25a555b3410e">pending_outputs_</a>);</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">if</span> (madeProgress) {</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      *madeProgress = 1;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    }</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df">MaybeScheduleLogDBDeployStats</a>();</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#a3573b1eae3665c2cc757b8c396622b17">disable_delete_obsolete_files_</a>) {</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="comment">// add to deletion state</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      deletion_state.log_delete_files.insert(</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;          deletion_state.log_delete_files.end(),</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;          logs_to_delete.begin(),</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;          logs_to_delete.end());</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    }</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  }</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a3f1443d5437c4f0e98d7b0eb2839ef2e_cgraph.png" border="0" usemap="#dd/df5/a00386_a3f1443d5437c4f0e98d7b0eb2839ef2e_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a3f1443d5437c4f0e98d7b0eb2839ef2e_cgraph" id="dd/df5/a00386_a3f1443d5437c4f0e98d7b0eb2839ef2e_cgraph">
<area shape="rect" id="node3" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="533,5,720,51"/><area shape="rect" id="node5" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1060,2129,1201,2175"/><area shape="rect" id="node7" href="../../d3/dcd/a00965.html#a1345f2a7f5bbb0416dfb6290ab6eea0b" title="rocksdb::MemTable::\lGetEdits" alt="" coords="281,2514,425,2561"/><area shape="rect" id="node9" href="../../d7/dd4/a00968.html#ac91fdc0526a34fee8369c19f92223514" title="rocksdb::MemTableList\l::InstallMemtableFlushResults" alt="" coords="255,1875,452,1922"/><area shape="rect" id="node12" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1063,376,1199,405"/><area shape="rect" id="node16" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="837,1293,933,1323"/><area shape="rect" id="node26" href="../../d2/d86/a01798.html#a8d557cf30bde88010eff4307cc3d385f" title="rocksdb::VersionEdit\l::SetLogNumber" alt="" coords="1060,2337,1201,2383"/><area shape="rect" id="node28" href="../../d2/d86/a01798.html#ab2a5ed0c015e8ccecf147de0bf2a6d12" title="rocksdb::VersionEdit\l::SetPrevLogNumber" alt="" coords="1059,2418,1203,2465"/><area shape="rect" id="node72" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="545,2240,708,2269"/><area shape="rect" id="node77" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="275,2583,432,2630"/><area shape="rect" id="node82" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df" title="rocksdb::DBImpl::MaybeSchedule\lLogDBDeployStats" alt="" coords="243,143,464,190"/><area shape="rect" id="node93" href="../../d7/dd4/a00968.html#ab919b8b2b4a57174e618272f0f6dd7a2" title="rocksdb::MemTableList\l::PickMemtablesToFlush" alt="" coords="271,2119,436,2166"/><area shape="rect" id="node98" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="275,2653,432,2699"/><area shape="rect" id="node100" href="../../dd/df5/a00386.html#ac3d320a145d5d36cb2bbf9e57b39ae8a" title="rocksdb::DBImpl::WriteLevel0\lTable" alt="" coords="528,891,725,938"/><area shape="rect" id="node14" href="../../de/d76/a00134.html#a30ba8a8f96b44b0802aee9bc9c16c58a" title="rocksdb::port::AtomicPointer\l::Release_Store" alt="" coords="533,2119,720,2166"/><area shape="rect" id="node18" href="../../d1/d42/a01800.html#a8d4bdcc8a079afc6fcac4f19fbaf1d50" title="rocksdb::VersionSet\l::LogAndApply" alt="" coords="557,1681,696,1727"/><area shape="rect" id="node68" href="../../d3/dcd/a00965.html#a35a338dd8c1096c850b1bdd3969aeee4" title="rocksdb::MemTable::\lUnref" alt="" coords="555,1875,699,1922"/><area shape="rect" id="node70" href="../../d2/d86/a01798.html#a9a7a27d2f256bfadb0b538c97c5524a1" title="rocksdb::VersionEdit\l::Clear" alt="" coords="556,1611,697,1658"/><area shape="rect" id="node21" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="807,2018,964,2065"/><area shape="rect" id="node23" href="../../d1/d42/a01800.html#abfc3ec9be932533630087e672fce75b3" title="rocksdb::VersionSet\l::LogAndApplyHelper" alt="" coords="813,2290,957,2337"/><area shape="rect" id="node30" href="../../d2/d86/a01798.html#a5eca07307a1eb4123a2b4d3370495d02" title="rocksdb::VersionEdit\l::SetNextFile" alt="" coords="1060,2261,1201,2307"/><area shape="rect" id="node32" href="../../d0/d27/a00239.html#a61a3b1cccd9c3d386297a9cf999781d6" title="rocksdb::VersionSet\l::Builder::SaveTo" alt="" coords="816,1741,955,1787"/><area shape="rect" id="node34" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="1061,1681,1200,1727"/><area shape="rect" id="node36" href="../../d1/d42/a01800.html#a1a39a05ce05a65f4ccaabf59d18c0162" title="rocksdb::VersionSet\l::NewFileNumber" alt="" coords="816,1949,955,1995"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#addb687ba13b100fdc18a512b23ba195b" title="rocksdb::DescriptorFileName" alt="" coords="789,1637,981,1667"/><area shape="rect" id="node42" href="../../d1/d42/a01800.html#ac723248f990dd0f5de3eca23b292a501" title="rocksdb::VersionSet\l::SizeBeingCompacted" alt="" coords="808,1810,963,1857"/><area shape="rect" id="node45" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="815,1170,956,1217"/><area shape="rect" id="node47" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="1029,1135,1232,1164"/><area shape="rect" id="node50" href="../../d1/d42/a01800.html#ab1e1ece4fbaa4098f0e08154f773cb61" title="rocksdb::VersionSet\l::WriteSnapshot" alt="" coords="816,1447,955,1494"/><area shape="rect" id="node55" href="../../d1/d42/a01800.html#a69fd2eaa5b9d9f087b21d46d0a2a27e3" title="rocksdb::VersionSet\l::Finalize" alt="" coords="816,1879,955,1926"/><area shape="rect" id="node58" href="../../d1/d42/a01800.html#a1161ffbcf7b18cde8bed5e361c7d3f0f" title="rocksdb::VersionSet\l::UpdateFilesBySize" alt="" coords="815,1567,956,1614"/><area shape="rect" id="node62" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="800,1240,971,1269"/><area shape="rect" id="node64" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="821,1048,949,1077"/><area shape="rect" id="node66" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="815,1101,956,1147"/><area shape="rect" id="node53" href="../../d2/d86/a01798.html#a62a14d8606dbc1d557b6e3bb55c617dd" title="rocksdb::VersionEdit\l::AddFile" alt="" coords="1060,1318,1201,1365"/><area shape="rect" id="node74" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="805,2360,965,2389"/><area shape="rect" id="node79" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc" title="rocksdb::port::AtomicPointer\l::NoBarrier_Load" alt="" coords="533,2583,720,2630"/><area shape="rect" id="node85" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="527,125,727,155"/><area shape="rect" id="node88" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="547,179,707,208"/><area shape="rect" id="node90" href="../../dd/df5/a00386.html#a3b86ec3494acbb6dbb8f2fdace967183" title="rocksdb::DBImpl::BGLogDBDeploy\lStats" alt="" coords="513,231,740,278"/><area shape="rect" id="node103" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="799,645,972,675"/><area shape="rect" id="node106" href="../../d4/d87/a03436.html#a678cf0fa28a2449c444344ea1feef654" title="rocksdb::NewMergingIterator" alt="" coords="791,699,980,728"/><area shape="rect" id="node108" href="../../dc/de6/a01426.html#aab9c275d08ac06c7ca97116328298b9c" title="rocksdb::SnapshotList\l::GetNewest" alt="" coords="809,751,961,798"/><area shape="rect" id="node110" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="811,821,960,851"/><area shape="rect" id="node113" href="../../d4/d87/a03436.html#a54b259d9ef3d218359bf85355d87aa8e" title="rocksdb::BuildTable" alt="" coords="817,875,953,904"/><area shape="rect" id="node117" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0" title="rocksdb::DBImpl::user\l_comparator" alt="" coords="809,453,961,499"/><area shape="rect" id="node121" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="805,523,965,552"/><area shape="rect" id="node125" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="815,575,956,622"/><area shape="rect" id="node127" href="../../d4/dd1/a01797.html#a8cd69a62e51d319948e7e85cdc5686c3" title="rocksdb::Version::PickLevel\lForMemTableOutput" alt="" coords="793,978,977,1025"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a3f1443d5437c4f0e98d7b0eb2839ef2e_icgraph.png" border="0" usemap="#dd/df5/a00386_a3f1443d5437c4f0e98d7b0eb2839ef2e_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a3f1443d5437c4f0e98d7b0eb2839ef2e_icgraph" id="dd/df5/a00386_a3f1443d5437c4f0e98d7b0eb2839ef2e_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="539,1002,736,1049"/><area shape="rect" id="node101" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="539,1105,736,1151"/><area shape="rect" id="node104" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="244,1011,489,1040"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="784,942,981,989"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1029,905,1277,935"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1325,947,1547,994"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1612,173,1775,219"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1595,1111,1792,1158"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1607,319,1780,348"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1605,1008,1781,1037"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1596,81,1791,127"/><area shape="rect" id="node56" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1627,955,1760,984"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1893,120,2003,149"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1857,173,2039,219"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="2129,128,2287,157"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="2153,181,2263,211"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1843,1684,2053,1713"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1873,265,2023,295"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1845,319,2051,348"/><area shape="rect" id="node32" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2153,288,2263,317"/><area shape="rect" id="node34" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2157,341,2259,371"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2105,395,2311,424"/><area shape="rect" id="node38" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2125,235,2291,264"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="2153,448,2263,477"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1893,1631,2003,1660"/><area shape="rect" id="node50" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1869,67,2027,96"/><area shape="rect" id="node52" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="2153,5,2263,35"/><area shape="rect" id="node54" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="2113,58,2303,105"/><area shape="rect" id="node58" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1867,1422,2029,1469"/><area shape="rect" id="node62" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1877,1561,2019,1607"/><area shape="rect" id="node64" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1848,372,2048,401"/><area shape="rect" id="node66" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1852,425,2044,455"/><area shape="rect" id="node68" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1893,479,2003,508"/><area shape="rect" id="node70" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1859,532,2037,561"/><area shape="rect" id="node72" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1868,585,2028,631"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1887,1369,2009,1399"/><area shape="rect" id="node77" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1880,654,2016,701"/><area shape="rect" id="node79" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1852,723,2044,770"/><area shape="rect" id="node81" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1852,793,2044,839"/><area shape="rect" id="node83" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1840,863,2056,892"/><area shape="rect" id="node85" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1867,915,2029,962"/><area shape="rect" id="node87" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1923,985,1973,1015"/><area shape="rect" id="node89" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1879,1038,2017,1085"/><area shape="rect" id="node91" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1859,1107,2037,1154"/><area shape="rect" id="node93" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1867,1177,2029,1223"/><area shape="rect" id="node95" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1865,1247,2031,1276"/><area shape="rect" id="node97" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1879,1299,2017,1346"/><area shape="rect" id="node99" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1876,1491,2020,1538"/><area shape="rect" id="node60" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2127,1422,2289,1469"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa86e47e55cc16361ca8bfb166c659f9a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::Get </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../da/d3f/a01215.html">ReadOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#ae6350a924ad1ac1129726e384a487da3">rocksdb::DB</a>.</p>

<p>Reimplemented in <a class="el" href="../../db/db9/a00387.html#aec7cba1ef92009fef81139c88020c9e1">rocksdb::DBImplReadOnly</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02548">2548</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l02554">GetImpl()</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d6a/a02779_source.html#l00077">rocksdb::StringLists::Get()</a>, <a class="el" href="../../d6/dfc/a02593_source.html#l00106">Counters::get()</a>, <a class="el" href="../../db/d8b/a02594_source.html#l00167">rocksdb::ProfileKeyComparison()</a>, and <a class="el" href="../../d1/d67/a02561_source.html#l00268">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;                                     {</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed">GetImpl</a>(options, key, <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>);</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aa86e47e55cc16361ca8bfb166c659f9a_cgraph.png" border="0" usemap="#dd/df5/a00386_aa86e47e55cc16361ca8bfb166c659f9a_cgraph" alt=""/></div>
<map name="dd/df5/a00386_aa86e47e55cc16361ca8bfb166c659f9a_cgraph" id="dd/df5/a00386_aa86e47e55cc16361ca8bfb166c659f9a_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="204,613,377,643"/><area shape="rect" id="node5" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="467,26,608,73"/><area shape="rect" id="node9" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="455,200,620,229"/><area shape="rect" id="node11" href="../../d7/dd4/a00968.html#a648b3af66b2d983e5ae3449b77279543" title="rocksdb::MemTableList\l::RefAll" alt="" coords="459,253,616,299"/><area shape="rect" id="node13" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="463,323,612,352"/><area shape="rect" id="node15" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="467,107,608,154"/><area shape="rect" id="node18" href="../../d3/dcd/a00965.html#a3b8151ce08ccef4707172fc89b74fa15" title="rocksdb::MemTable::Get" alt="" coords="719,364,884,393"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="989,5,1131,35"/><area shape="rect" id="node57" href="../../d7/dd4/a00968.html#a54372487e94967337831daf139814d96" title="rocksdb::MemTableList::Get" alt="" coords="444,667,631,696"/><area shape="rect" id="node59" href="../../d4/dd1/a01797.html#ac25d8c130a1d695a0047111eb9195214" title="rocksdb::Version::Get" alt="" coords="463,613,612,643"/><area shape="rect" id="node102" href="../../d4/dd1/a01797.html#a4a5cae829de750c2e3f2c587a16d4dba" title="rocksdb::Version::Update\lStats" alt="" coords="452,719,623,766"/><area shape="rect" id="node104" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="427,789,648,835"/><area shape="rect" id="node114" href="../../d3/dcd/a00965.html#a35a338dd8c1096c850b1bdd3969aeee4" title="rocksdb::MemTable::\lUnref" alt="" coords="465,858,609,905"/><area shape="rect" id="node116" href="../../d7/dd4/a00968.html#a2422dd76d6ba8c9b961eb4666ab8695f" title="rocksdb::MemTableList\l::UnrefAll" alt="" coords="459,927,616,974"/><area shape="rect" id="node118" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="457,997,617,1027"/><area shape="rect" id="node120" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="473,1051,601,1080"/><area shape="rect" id="node7" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="715,28,888,57"/><area shape="rect" id="node20" href="../../dd/d7a/a00921.html#a722151e196da98f851d5be7689dd5df7" title="rocksdb::LookupKey\l::memtable_key" alt="" coords="989,602,1131,649"/><area shape="rect" id="node22" href="../../dd/d7a/a00921.html#a2d6ce1ea4572d9a9f5034b5309f350c6" title="rocksdb::LookupKey\l::user_key" alt="" coords="989,722,1131,769"/><area shape="rect" id="node24" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="991,128,1129,157"/><area shape="rect" id="node26" href="../../d0/db9/a01552.html#adf9c2b80d52e927e63ca2bd97bf42f9a" title="rocksdb::Status::IsMerge\lInProgress" alt="" coords="976,791,1144,838"/><area shape="rect" id="node28" href="../../d4/d87/a03436.html#ad725181422bf6cf312bbea4b0b3c9d8c" title="rocksdb::GetVarint32Ptr" alt="" coords="1213,537,1376,567"/><area shape="rect" id="node30" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="955,861,1165,907"/><area shape="rect" id="node32" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="988,58,1132,105"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="977,181,1143,211"/><area shape="rect" id="node36" href="../../d3/dcd/a00965.html#a95d10369e342f47e06bca980f2300514" title="rocksdb::MemTable::\lGetLock" alt="" coords="988,463,1132,510"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#adeae0144b8eaea4c370172d4f6edaf48" title="rocksdb::GetLengthPrefixed\lSlice" alt="" coords="968,394,1152,441"/><area shape="rect" id="node41" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="989,1037,1131,1067"/><area shape="rect" id="node45" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="969,931,1151,960"/><area shape="rect" id="node47" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="992,235,1128,264"/><area shape="rect" id="node49" href="../../d0/db9/a01552.html#a415510a7cc15542538c80c790d2bb4af" title="rocksdb::Status::NotFound" alt="" coords="971,984,1149,1013"/><area shape="rect" id="node51" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="979,288,1141,317"/><area shape="rect" id="node53" href="../../d5/d9d/a03343.html#a5e50025bd0ee2702179fa614b832c796" title="beast::asio::swap" alt="" coords="997,341,1123,371"/><area shape="rect" id="node55" href="../../d0/db9/a01552.html#ae68d506384bf32b72c7db619eaeb508a" title="rocksdb::Status::MergeIn\lProgress" alt="" coords="976,533,1144,579"/><area shape="rect" id="node61" href="../../dd/d7a/a00921.html#aaa7837819393f54c0380f273d81230ff" title="rocksdb::LookupKey\l::internal_key" alt="" coords="731,670,872,717"/><area shape="rect" id="node65" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="992,1143,1128,1172"/><area shape="rect" id="node68" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="732,739,871,786"/><area shape="rect" id="node70" href="../../d4/d87/a03436.html#a382fc0a9bad90fe4253c354dd309f083" title="rocksdb::FindFile" alt="" coords="740,809,863,839"/><area shape="rect" id="node73" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="731,862,872,909"/><area shape="rect" id="node75" href="../../d4/d87/a03436.html#a9ec2949993edef94ca7b7b0b2b5ec514" title="rocksdb::NewestFirstBySeqNo" alt="" coords="700,932,903,961"/><area shape="rect" id="node77" href="../../d4/d87/a03436.html#a3cbc76c77ed89c8aeda2da9cfc2fe387" title="rocksdb::NewestFirst" alt="" coords="728,1089,875,1119"/><area shape="rect" id="node79" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="696,233,907,279"/><area shape="rect" id="node85" href="../../de/df9/a01624.html#aba951faee1e4e9224bc2c668c9ea01c3" title="rocksdb::TableCache::Get" alt="" coords="715,1036,888,1065"/><area shape="rect" id="node89" href="../../d4/d87/a03436.html#a1e88bee60ffea3814f6c0a8da82c3f53" title="rocksdb::SaveValue" alt="" coords="732,303,871,332"/><area shape="rect" id="node96" href="../../d4/d87/a03436.html#a05612b66eb40fce6e2d86f6e5d354e16" title="rocksdb::MarkKeyMayExist" alt="" coords="711,1143,892,1172"/><area shape="rect" id="node106" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="731,1246,872,1293"/><area shape="rect" id="node108" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="708,1315,895,1362"/><area shape="rect" id="node110" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="723,1385,880,1431"/><area shape="rect" id="node112" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="721,1455,881,1484"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aa86e47e55cc16361ca8bfb166c659f9a_icgraph.png" border="0" usemap="#dd/df5/a00386_aa86e47e55cc16361ca8bfb166c659f9a_icgraph" alt=""/></div>
<map name="dd/df5/a00386_aa86e47e55cc16361ca8bfb166c659f9a_icgraph" id="dd/df5/a00386_aa86e47e55cc16361ca8bfb166c659f9a_icgraph">
<area shape="rect" id="node3" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="224,5,389,35"/><area shape="rect" id="node7" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="256,59,357,88"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="204,112,409,141"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="252,165,361,195"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#aa48edf6e9bfc20808c158d90d1abe70e" title="rocksdb::TEST" alt="" coords="460,5,569,35"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a28f3fa7104cc330d8f573f98682e000b" title="rocksdb::TEST" alt="" coords="460,112,569,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab18101544e1b3b97a4789c160f2bc727"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::GetApproximateSizes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../dc/dee/a01166.html">Range</a> *&#160;</td>
          <td class="paramname"><em>range</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> *&#160;</td>
          <td class="paramname"><em>sizes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#ac1c50abb4487b7c1156028b12b1a9dd3">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l03322">3322</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../dc/db2/a02574_source.html#l00044">rocksdb::kMaxSequenceNumber</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00040">rocksdb::kValueTypeForSeek</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00595">rocksdb::Version::Unref()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>
<div class="fragment"><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;                     {</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;  <span class="comment">// TODO(opt): better implementation</span></div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;  Version* v;</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;  {</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;    MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current()-&gt;Ref();</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;    v = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current();</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;  }</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++) {</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;    <span class="comment">// Convert user_key into a corresponding internal key.</span></div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;    InternalKey k1(range[i].start, <a class="code" href="../../d4/d87/a03436.html#a7f8b5699104535577fb0ca15fa1ead65">kMaxSequenceNumber</a>, <a class="code" href="../../d4/d87/a03436.html#ab2eae1f77282af48d0fe375ed4ba1e0c">kValueTypeForSeek</a>);</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;    InternalKey k2(range[i].limit, <a class="code" href="../../d4/d87/a03436.html#a7f8b5699104535577fb0ca15fa1ead65">kMaxSequenceNumber</a>, <a class="code" href="../../d4/d87/a03436.html#ab2eae1f77282af48d0fe375ed4ba1e0c">kValueTypeForSeek</a>);</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> start = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;ApproximateOffsetOf(v, k1);</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> limit = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;ApproximateOffsetOf(v, k2);</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;    sizes[i] = (limit &gt;= start ? limit - start : 0);</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;  }</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;  {</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;    MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;    v-&gt;Unref();</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;  }</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ab18101544e1b3b97a4789c160f2bc727_cgraph.png" border="0" usemap="#dd/df5/a00386_ab18101544e1b3b97a4789c160f2bc727_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ab18101544e1b3b97a4789c160f2bc727_cgraph" id="dd/df5/a00386_ab18101544e1b3b97a4789c160f2bc727_cgraph">
<area shape="rect" id="node3" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="277,13,437,43"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afcef1eaa87f194ee6689e465e15801ed"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::GetImpl </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../da/d3f/a01215.html">ReadOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>value_found</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02554">2554</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d4c/a02641_source.html#l00070">rocksdb::BYTES_READ</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00166">rocksdb::DB_GET</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00390">rocksdb::Options::disable_seek_compaction</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00198">rocksdb::MemTableList::Get()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00416">rocksdb::Version::Get()</a>, <a class="el" href="../../df/d44/a02586_source.html#l00166">rocksdb::MemTable::Get()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00312">imm_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02478">mem</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00311">mem_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00290">merge_operands</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00065">rocksdb::NUMBER_KEYS_READ</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00280">rocksdb::RecordTick()</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00043">rocksdb::MemTable::Ref()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00591">rocksdb::Version::Ref()</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00025">rocksdb::MemTableList::RefAll()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00663">rocksdb::ReadOptions::snapshot</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00348">rocksdb::Options::statistics</a>, <a class="el" href="../../d6/d50/a02694_source.html#l00667">stats</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00046">rocksdb::MemTable::Unref()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00595">rocksdb::Version::Unref()</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00032">rocksdb::MemTableList::UnrefAll()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00578">rocksdb::Version::UpdateStats()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02548">Get()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02696">KeyMayExist()</a>.</p>
<div class="fragment"><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;                                          {</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s;</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;  StopWatch sw(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aea3d100ebac763a7163164167962d5958d">DB_GET</a>);</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> snapshot;</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;  <span class="keywordflow">if</span> (options.snapshot != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;    snapshot = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>SnapshotImpl*<span class="keyword">&gt;</span>(options.snapshot)-&gt;number_;</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;    snapshot = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LastSequence();</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;  }</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;  MemTable* <a class="code" href="../../db/d44/a02564.html#a0d98018e8146e811f356fa860a9839a0">mem</a> = <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>;</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;  MemTableList imm = <a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>;</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  Version* current = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current();</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;  mem-&gt;Ref();</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;  imm.RefAll();</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;  current-&gt;Ref();</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;  <span class="comment">// Unlock while reading from files and memtables</span></div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;  <span class="keywordtype">bool</span> have_stat_update = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;  Version::GetStats <a class="code" href="../../d6/d50/a02694.html#a5925d216740c89f43482df806fd14e8c">stats</a>;</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  <span class="comment">// Prepare to store a list of merge operations if merge occurs.</span></div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  std::deque&lt;std::string&gt; <a class="code" href="../../d6/dfc/a02612.html#a58dbba3da34434571a4e9e6c7ab6a4c7">merge_operands</a>;</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;  <span class="comment">// First look in the memtable, then in the immutable memtable (if any).</span></div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;  <span class="comment">// s is both in/out. When in, s could either be OK or MergeInProgress.</span></div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;  <span class="comment">// merge_operands will contain the sequence of merges in the latter case.</span></div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;  LookupKey lkey(key, snapshot);</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;  <span class="keywordflow">if</span> (mem-&gt;Get(lkey, <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>, &amp;s, &amp;merge_operands, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>)) {</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;    <span class="comment">// Done</span></div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (imm.Get(lkey, <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>, &amp;s, &amp;merge_operands, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>)) {</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;    <span class="comment">// Done</span></div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;    current-&gt;Get(options, lkey, <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>, &amp;s, &amp;merge_operands, &amp;stats,</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;                 <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>, <a class="code" href="../../d6/dfc/a02612.html#a087d12026d35e2170481e0128071e9e0">value_found</a>);</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;    have_stat_update = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;  }</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#abc2f2cbdf6ef20e4a45b876f9f5fc075">disable_seek_compaction</a> &amp;&amp;</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;      have_stat_update &amp;&amp; current-&gt;UpdateStats(stats)) {</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a">MaybeScheduleFlushOrCompaction</a>();</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;  }</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;  mem-&gt;Unref();</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;  imm.UnrefAll();</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;  current-&gt;Unref();</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;  <span class="comment">// Note, tickers are atomic now - no lock protection needed any more.</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29da13601c6e865ecbe3cad9bc297f45096a">NUMBER_KEYS_READ</a>);</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29dac8d899759fa0ed3ed7c1f6ed22b2889c">BYTES_READ</a>, <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;size());</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_afcef1eaa87f194ee6689e465e15801ed_cgraph.png" border="0" usemap="#dd/df5/a00386_afcef1eaa87f194ee6689e465e15801ed_cgraph" alt=""/></div>
<map name="dd/df5/a00386_afcef1eaa87f194ee6689e465e15801ed_cgraph" id="dd/df5/a00386_afcef1eaa87f194ee6689e465e15801ed_cgraph">
<area shape="rect" id="node3" href="../../d7/dd4/a00968.html#a54372487e94967337831daf139814d96" title="rocksdb::MemTableList::Get" alt="" coords="247,413,433,443"/><area shape="rect" id="node5" href="../../d4/dd1/a01797.html#ac25d8c130a1d695a0047111eb9195214" title="rocksdb::Version::Get" alt="" coords="265,901,415,931"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="792,669,933,699"/><area shape="rect" id="node61" href="../../d3/dcd/a00965.html#a3b8151ce08ccef4707172fc89b74fa15" title="rocksdb::MemTable::Get" alt="" coords="521,464,687,493"/><area shape="rect" id="node87" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="269,1370,411,1417"/><area shape="rect" id="node91" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="276,1509,404,1539"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="229,1562,451,1609"/><area shape="rect" id="node106" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="257,1632,423,1661"/><area shape="rect" id="node108" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="265,1685,415,1715"/><area shape="rect" id="node110" href="../../d7/dd4/a00968.html#a648b3af66b2d983e5ae3449b77279543" title="rocksdb::MemTableList\l::RefAll" alt="" coords="261,1738,419,1785"/><area shape="rect" id="node112" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="269,1439,411,1486"/><area shape="rect" id="node115" href="../../d3/dcd/a00965.html#a35a338dd8c1096c850b1bdd3969aeee4" title="rocksdb::MemTable::\lUnref" alt="" coords="268,1807,412,1854"/><area shape="rect" id="node117" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="260,1877,420,1907"/><area shape="rect" id="node119" href="../../d7/dd4/a00968.html#a2422dd76d6ba8c9b961eb4666ab8695f" title="rocksdb::MemTableList\l::UnrefAll" alt="" coords="261,1930,419,1977"/><area shape="rect" id="node121" href="../../d4/dd1/a01797.html#a4a5cae829de750c2e3f2c587a16d4dba" title="rocksdb::Version::Update\lStats" alt="" coords="255,1999,425,2046"/><area shape="rect" id="node7" href="../../dd/d7a/a00921.html#aaa7837819393f54c0380f273d81230ff" title="rocksdb::LookupKey\l::internal_key" alt="" coords="533,1223,675,1270"/><area shape="rect" id="node9" href="../../dd/d7a/a00921.html#a2d6ce1ea4572d9a9f5034b5309f350c6" title="rocksdb::LookupKey\l::user_key" alt="" coords="792,829,933,875"/><area shape="rect" id="node11" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="757,898,968,945"/><area shape="rect" id="node13" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="795,1371,931,1400"/><area shape="rect" id="node15" href="../../d0/db9/a01552.html#adf9c2b80d52e927e63ca2bd97bf42f9a" title="rocksdb::Status::IsMerge\lInProgress" alt="" coords="779,967,947,1014"/><area shape="rect" id="node17" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="535,978,673,1025"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a382fc0a9bad90fe4253c354dd309f083" title="rocksdb::FindFile" alt="" coords="543,1048,665,1077"/><area shape="rect" id="node21" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="791,5,935,51"/><area shape="rect" id="node23" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="533,1101,675,1147"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#a9ec2949993edef94ca7b7b0b2b5ec514" title="rocksdb::NewestFirstBySeqNo" alt="" coords="503,1171,705,1200"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#a3cbc76c77ed89c8aeda2da9cfc2fe387" title="rocksdb::NewestFirst" alt="" coords="531,568,677,597"/><area shape="rect" id="node29" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="499,119,709,166"/><area shape="rect" id="node38" href="../../de/df9/a01624.html#aba951faee1e4e9224bc2c668c9ea01c3" title="rocksdb::TableCache::Get" alt="" coords="517,1344,691,1373"/><area shape="rect" id="node41" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="792,1037,933,1067"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#a1e88bee60ffea3814f6c0a8da82c3f53" title="rocksdb::SaveValue" alt="" coords="535,261,673,291"/><area shape="rect" id="node53" href="../../d4/d87/a03436.html#a05612b66eb40fce6e2d86f6e5d354e16" title="rocksdb::MarkKeyMayExist" alt="" coords="513,621,695,651"/><area shape="rect" id="node55" href="../../d0/db9/a01552.html#a415510a7cc15542538c80c790d2bb4af" title="rocksdb::Status::NotFound" alt="" coords="773,723,952,752"/><area shape="rect" id="node57" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="772,776,953,805"/><area shape="rect" id="node32" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="780,181,945,211"/><area shape="rect" id="node34" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="793,75,932,104"/><area shape="rect" id="node36" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="795,128,931,157"/><area shape="rect" id="node49" href="../../d5/d9d/a03343.html#a5e50025bd0ee2702179fa614b832c796" title="beast::asio::swap" alt="" coords="800,235,925,264"/><area shape="rect" id="node51" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="781,288,944,317"/><area shape="rect" id="node63" href="../../dd/d7a/a00921.html#a722151e196da98f851d5be7689dd5df7" title="rocksdb::LookupKey\l::memtable_key" alt="" coords="792,549,933,595"/><area shape="rect" id="node68" href="../../d4/d87/a03436.html#ad725181422bf6cf312bbea4b0b3c9d8c" title="rocksdb::GetVarint32Ptr" alt="" coords="1016,484,1179,513"/><area shape="rect" id="node73" href="../../d3/dcd/a00965.html#a95d10369e342f47e06bca980f2300514" title="rocksdb::MemTable::\lGetLock" alt="" coords="791,410,935,457"/><area shape="rect" id="node75" href="../../d4/d87/a03436.html#adeae0144b8eaea4c370172d4f6edaf48" title="rocksdb::GetLengthPrefixed\lSlice" alt="" coords="771,341,955,387"/><area shape="rect" id="node85" href="../../d0/db9/a01552.html#ae68d506384bf32b72c7db619eaeb508a" title="rocksdb::Status::MergeIn\lProgress" alt="" coords="779,479,947,526"/><area shape="rect" id="node89" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="517,1448,691,1477"/><area shape="rect" id="node95" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="533,1746,675,1793"/><area shape="rect" id="node97" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="511,1501,697,1547"/><area shape="rect" id="node99" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="525,1570,683,1617"/><area shape="rect" id="node101" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="524,1640,684,1669"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="499,1693,709,1723"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_afcef1eaa87f194ee6689e465e15801ed_icgraph.png" border="0" usemap="#dd/df5/a00386_afcef1eaa87f194ee6689e465e15801ed_icgraph" alt=""/></div>
<map name="dd/df5/a00386_afcef1eaa87f194ee6689e465e15801ed_icgraph" id="dd/df5/a00386_afcef1eaa87f194ee6689e465e15801ed_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="259,112,408,141"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="231,192,436,221"/><area shape="rect" id="node5" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="507,5,672,35"/><area shape="rect" id="node9" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="539,59,640,88"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="487,112,692,141"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="535,165,644,195"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#aa48edf6e9bfc20808c158d90d1abe70e" title="rocksdb::TEST" alt="" coords="743,5,852,35"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a28f3fa7104cc330d8f573f98682e000b" title="rocksdb::TEST" alt="" coords="743,112,852,141"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="535,219,644,248"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af639734e3275f01b80d8ef8702450dfe"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> rocksdb::DBImpl::GetLatestSequenceNumber </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a71590d8fbc17ba01c39d2067cd26a084">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01296">1296</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../df/d65/a02607_source.html#l00200">rocksdb::TransactionLogIteratorImpl::IsBatchExpected()</a>, <a class="el" href="../../df/d65/a02607_source.html#l00148">rocksdb::TransactionLogIteratorImpl::NextImpl()</a>, and <a class="el" href="../../df/d65/a02607_source.html#l00076">rocksdb::TransactionLogIteratorImpl::RestrictedRead()</a>.</p>
<div class="fragment"><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                                                     {</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LastSequence();</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_af639734e3275f01b80d8ef8702450dfe_icgraph.png" border="0" usemap="#dd/df5/a00386_af639734e3275f01b80d8ef8702450dfe_icgraph" alt=""/></div>
<map name="dd/df5/a00386_af639734e3275f01b80d8ef8702450dfe_icgraph" id="dd/df5/a00386_af639734e3275f01b80d8ef8702450dfe_icgraph">
<area shape="rect" id="node3" href="../../d0/d42/a01707.html#a99b39841bf9c872f5da623a1c375fdc3" title="rocksdb::TransactionLogIterator\lImpl::IsBatchExpected" alt="" coords="241,34,447,81"/><area shape="rect" id="node11" href="../../d0/d42/a01707.html#a1ad9efe3af953b0b543f5b092eaa27ac" title="rocksdb::TransactionLogIterator\lImpl::NextImpl" alt="" coords="1011,74,1216,121"/><area shape="rect" id="node19" href="../../d0/d42/a01707.html#a9cab26b8d260525506c0305219266425" title="rocksdb::TransactionLogIterator\lImpl::RestrictedRead" alt="" coords="497,98,703,145"/><area shape="rect" id="node5" href="../../d0/d42/a01707.html#a192e03a3528b78afa45054cc7beb6768" title="rocksdb::TransactionLogIterator\lImpl::UpdateCurrentWriteBatch" alt="" coords="497,29,703,75"/><area shape="rect" id="node7" href="../../d0/d42/a01707.html#a9cec532b9abaf9cc6aff4b1c649ceae5" title="rocksdb::TransactionLogIterator\lImpl::SeekToStartSequence" alt="" coords="753,43,959,90"/><area shape="rect" id="node9" href="../../d0/d42/a01707.html#a33ae4d3693b009471c7798c8e78fd317" title="rocksdb::TransactionLogIterator\lImpl::TransactionLogIteratorImpl" alt="" coords="1008,5,1219,51"/><area shape="rect" id="node14" href="../../d0/d42/a01707.html#a4fd4d2bb33d65b2f5ef5cd80b927c846" title="rocksdb::TransactionLogIterator\lImpl::Next" alt="" coords="1268,74,1473,121"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aaa4a148182ce98c83d363817e938ddd5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::GetLiveFiles </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> *&#160;</td>
          <td class="paramname"><em>manifest_file_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>flush_memtable</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a1c645c8ae376c0acd11a3271ec3a59ad">rocksdb::DB</a>.</p>

<p>Reimplemented in <a class="el" href="../../db/db9/a00387.html#ab7754629ba386af239cd9465aafdd9e2">rocksdb::DBImplReadOnly</a>.</p>

<p>Definition at line <a class="el" href="../../dd/db2/a02563_source.html#l00043">43</a> of file <a class="el" href="../../dd/db2/a02563_source.html">db_filesnapshot.cc</a>.</p>

<p>References <a class="el" href="../../da/d03/a02577_source.html#l00086">rocksdb::CurrentFileName()</a>, <a class="el" href="../../da/d03/a02577_source.html#l00078">rocksdb::DescriptorFileName()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01291">Flush()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00036">rocksdb::Status::OK()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../da/d03/a02577_source.html#l00073">rocksdb::TableFileName()</a>, <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                                                 {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  *manifest_file_size = 0;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordflow">if</span> (flush_memtable) {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">// flush all dirty data to disk.</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> status =  <a class="code" href="../../dd/df5/a00386.html#aaf39022d45b559b69933cfe719571c10">Flush</a>(FlushOptions());</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Cannot Flush data %s\n&quot;</span>,</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;          status.ToString().c_str());</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  }</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">// Make a set of all of the live *.sst files</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  std::set&lt;uint64_t&gt; live;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;AddLiveFilesCurrentVersion(&amp;live);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  ret.clear();</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  ret.reserve(live.size() + 2); <span class="comment">//*.sst + CURRENT + MANIFEST</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">// create names of the live files. The names are not absolute</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">// paths, instead they are relative to dbname_;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> live_file : live) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    ret.push_back(<a class="code" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a">TableFileName</a>(<span class="stringliteral">&quot;&quot;</span>, live_file));</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  ret.push_back(<a class="code" href="../../d4/d87/a03436.html#a112e8c44dec6475699006a7f68830b1a">CurrentFileName</a>(<span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  ret.push_back(<a class="code" href="../../d4/d87/a03436.html#addb687ba13b100fdc18a512b23ba195b">DescriptorFileName</a>(<span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;ManifestFileNumber()));</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">// find length of manifest file while holding the mutex lock</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  *manifest_file_size = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;ManifestFileSize();</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00">Status::OK</a>();</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aaa4a148182ce98c83d363817e938ddd5_cgraph.png" border="0" usemap="#dd/df5/a00386_aaa4a148182ce98c83d363817e938ddd5_cgraph" alt=""/></div>
<map name="dd/df5/a00386_aaa4a148182ce98c83d363817e938ddd5_cgraph" id="dd/df5/a00386_aaa4a148182ce98c83d363817e938ddd5_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a112e8c44dec6475699006a7f68830b1a" title="rocksdb::CurrentFileName" alt="" coords="236,5,409,35"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#addb687ba13b100fdc18a512b23ba195b" title="rocksdb::DescriptorFileName" alt="" coords="227,59,419,88"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#aaf39022d45b559b69933cfe719571c10" title="rocksdb::DBImpl::Flush" alt="" coords="243,1313,403,1343"/><area shape="rect" id="node11" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1212,108,1348,137"/><area shape="rect" id="node50" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1488,1476,1584,1505"/><area shape="rect" id="node107" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="252,1829,393,1859"/><area shape="rect" id="node112" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="705,1779,868,1808"/><area shape="rect" id="node115" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="237,1883,408,1912"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="467,657,656,703"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a1db8d713be426c044273b2fa01c75c08" title="rocksdb::DBImpl::WaitFor\lFlushMemTable" alt="" coords="928,263,1101,310"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="708,849,865,879"/><area shape="rect" id="node15" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="1201,230,1359,277"/><area shape="rect" id="node18" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="1201,161,1359,207"/><area shape="rect" id="node20" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1449,329,1623,359"/><area shape="rect" id="node25" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="917,710,1112,757"/><area shape="rect" id="node32" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="1209,350,1351,397"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="1209,489,1351,519"/><area shape="rect" id="node43" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="1209,419,1351,466"/><area shape="rect" id="node76" href="../../dd/df5/a00386.html#acbfdfdd72e490648da9f229fdcd06337" title="rocksdb::DBImpl::BuildBatch\lGroup" alt="" coords="920,1590,1109,1637"/><area shape="rect" id="node78" href="../../da/d8c/a01845.html#a04c6bd515d35bda6ffa8ae21ab1e1478" title="rocksdb::WriteBatchInternal\l::ByteSize" alt="" coords="1188,1659,1372,1706"/><area shape="rect" id="node80" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="1188,1590,1372,1637"/><area shape="rect" id="node83" href="../../da/d8c/a01845.html#a2c7f53a4c8d710fdbf229c917506f7ab" title="rocksdb::WriteBatchInternal\l::SetSequence" alt="" coords="923,779,1107,826"/><area shape="rect" id="node88" href="../../d4/d87/a03436.html#a48457fd59325e708afa7fff617f87e05" title="rocksdb::StartPerfTimer" alt="" coords="935,849,1095,879"/><area shape="rect" id="node90" href="../../da/d8c/a01845.html#af28dbb69a970e8ab218402339f0bb7ee" title="rocksdb::WriteBatchInternal\l::Contents" alt="" coords="923,902,1107,949"/><area shape="rect" id="node92" href="../../d4/d87/a03436.html#af0bd42ecfc79c4765b60919d28702a29" title="rocksdb::BumpPerfTime" alt="" coords="933,972,1096,1001"/><area shape="rect" id="node94" href="../../da/d8c/a01845.html#aa10e1abb5f141e75e184bf456a5d65a6" title="rocksdb::WriteBatchInternal\l::InsertInto" alt="" coords="923,1025,1107,1071"/><area shape="rect" id="node96" href="../../d4/d87/a03436.html#a9231fa7580b3932152d6f3bd39907320" title="rocksdb::SetTickerCount" alt="" coords="932,1095,1097,1124"/><area shape="rect" id="node98" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="951,1148,1079,1177"/><area shape="rect" id="node101" href="../../d2/dbd/a01844.html#a73502c77c1ebdf40417a34eb385e117e" title="rocksdb::WriteBatch\l::Clear" alt="" coords="944,1201,1085,1247"/><area shape="rect" id="node103" href="../../d0/d39/a00314.html#a84d028d8d526b7ce592433ba836a1853" title="rocksdb::port::CondVar\l::Signal" alt="" coords="936,389,1093,435"/><area shape="rect" id="node27" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1209,1017,1351,1063"/><area shape="rect" id="node29" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="1211,1086,1349,1133"/><area shape="rect" id="node35" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="1160,1156,1400,1185"/><area shape="rect" id="node37" href="../../dd/df5/a00386.html#a4bd51a8c14d950ad017734df3a7b851c" title="rocksdb::DBImpl::Slowdown\lAmount" alt="" coords="1187,1209,1373,1255"/><area shape="rect" id="node39" href="../../d8/d6c/a01563.html#a2265fb9a74a457ec56cc61f60ea5353e" title="rocksdb::StopWatch\l::ElapsedMicros" alt="" coords="1209,1278,1351,1325"/><area shape="rect" id="node46" href="../../d3/dcd/a00965.html#a3232b72cba2586f3d6dbd08d8b4be86d" title="rocksdb::MemTable::\lApproximateMemoryUsage" alt="" coords="1191,1347,1369,1394"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#a24b1211b5a5fbfccfe0818c32753ff5f" title="rocksdb::DBImpl::DelayLogging\lAndReset" alt="" coords="1177,1467,1383,1514"/><area shape="rect" id="node55" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="1237,543,1323,572"/><area shape="rect" id="node57" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="1179,596,1381,625"/><area shape="rect" id="node59" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1204,1537,1356,1567"/><area shape="rect" id="node63" href="../../d3/dcd/a00965.html#a08633ea1ccd8277c4bad90686e12e59d" title="rocksdb::MemTable::\lSetNextLogNumber" alt="" coords="1208,649,1352,695"/><area shape="rect" id="node65" href="../../d7/dd4/a00968.html#a889613116ef509399ebb13a714e236d6" title="rocksdb::MemTableList::Add" alt="" coords="1185,719,1375,748"/><area shape="rect" id="node67" href="../../d7/dd4/a00968.html#acd9439e034e085a62a05850d9ba39c7a" title="rocksdb::MemTableList\l::FlushRequested" alt="" coords="1201,771,1359,818"/><area shape="rect" id="node69" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="1175,841,1385,871"/><area shape="rect" id="node71" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="1197,895,1363,924"/><area shape="rect" id="node73" href="../../d3/dcd/a00965.html#a81f80d2b6674d454e4b65f238281d716" title="rocksdb::MemTable::\lSetLogNumber" alt="" coords="1208,947,1352,994"/><area shape="rect" id="node61" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1455,1657,1617,1687"/><area shape="rect" id="node109" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="481,1829,641,1859"/><area shape="rect" id="node117" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="487,1883,636,1912"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2042e7d897313b6299bbab78267fdd09"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::GetLiveFilesMetaData </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d2/dab/a00886.html">LiveFileMetaData</a> &gt; *&#160;</td>
          <td class="paramname"><em>metadata</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented from <a class="el" href="../../d8/ddd/a00380.html#a2092d63c4024195d8d49f0ea0659075a">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l03424">3424</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../d0/df5/a02576_source.html#l00147">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;                                                                       {</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;GetLiveFilesMetaData(metadata);</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a2042e7d897313b6299bbab78267fdd09_icgraph.png" border="0" usemap="#dd/df5/a00386_a2042e7d897313b6299bbab78267fdd09_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a2042e7d897313b6299bbab78267fdd09_icgraph" id="dd/df5/a00386_a2042e7d897313b6299bbab78267fdd09_icgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#ad19b60849d205b89e09ff716b7714f69" title="rocksdb::TEST" alt="" coords="228,13,337,43"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2e2e51b73e463650be75ab726c67c3b4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/dcd/a00965.html">MemTable</a>* rocksdb::DBImpl::GetMemTable </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00185">185</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00311">mem_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d0b/a02566_source.html#l00053">rocksdb::DBImplReadOnly::Get()</a>, and <a class="el" href="../../db/d0b/a02566_source.html#l00081">rocksdb::DB::OpenForReadOnly()</a>.</p>
<div class="fragment"><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                          {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a2e2e51b73e463650be75ab726c67c3b4_icgraph.png" border="0" usemap="#dd/df5/a00386_a2e2e51b73e463650be75ab726c67c3b4_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a2e2e51b73e463650be75ab726c67c3b4_icgraph" id="dd/df5/a00386_a2e2e51b73e463650be75ab726c67c3b4_icgraph">
<area shape="rect" id="node3" href="../../db/db9/a00387.html#aec7cba1ef92009fef81139c88020c9e1" title="rocksdb::DBImplReadOnly::Get" alt="" coords="267,29,472,59"/><area shape="rect" id="node5" href="../../d8/ddd/a00380.html#a2c34ae639e95ce237f939d185a09c04b" title="rocksdb::DB::OpenForReadOnly" alt="" coords="264,83,475,112"/><area shape="rect" id="node7" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="533,5,675,51"/><area shape="rect" id="node13" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="523,74,685,121"/><area shape="rect" id="node27" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="532,143,676,190"/><area shape="rect" id="node9" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="767,13,940,43"/><area shape="rect" id="node11" href="../../d9/d66/a02562.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1099,13,1149,43"/><area shape="rect" id="node15" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="735,70,972,117"/><area shape="rect" id="node17" href="../../de/d9d/a00813.html#ab355fd20f7ef62b0cb2e673a6a2d9bec" title="rocksdb::LDBCommand::Run" alt="" coords="756,140,951,169"/><area shape="rect" id="node19" href="../../d0/d88/a01231.html#a66bef6f11f9e11d7ac84410cb5b8bf4a" title="rocksdb::ReduceLevelTest\l::ReduceLevels" alt="" coords="1035,101,1213,147"/><area shape="rect" id="node21" href="../../d8/d2d/a00815.html#ab1c1271385e6a551e4eb273dab723d9f" title="rocksdb::LDBCommandRunner\l::RunCommand" alt="" coords="1023,170,1225,217"/><area shape="rect" id="node23" href="../../dc/d5e/a00817.html#af544c31769c231e28233c2e632509832" title="rocksdb::LDBTool::Run" alt="" coords="1276,179,1433,208"/><area shape="rect" id="node25" href="../../de/dde/a02695.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1483,179,1533,208"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae57d4ca72d8c220fe8a384531433e585"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::DBImpl::GetProperty </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;&#160;</td>
          <td class="paramname"><em>property</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#adbfc80c222da108a0d89a55ed829726c">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l03116">3116</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00435">rocksdb::DBImpl::StatsSnapshot::bytes_new_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00433">rocksdb::DBImpl::StatsSnapshot::bytes_read_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00434">rocksdb::DBImpl::StatsSnapshot::bytes_written_</a>, <a class="el" href="../../db/d00/a02745_source.html#l00062">rocksdb::ConsumeDecimalNumber()</a>, <a class="el" href="../../dd/d75/a02639_source.html#l00052">rocksdb::Slice::empty()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00312">imm_</a>, <a class="el" href="../../da/d74/a02451_source.html#l00054">Json::in()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00442">last_stats_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">rocksdb::Env::NowMicros()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01279">NumberLevels()</a>, <a class="el" href="../../d3/d09/a02539_source.html#l00030">ripple::Resource::ok</a>, <a class="el" href="../../df/d11/a01915_source.html#l00188">std::chrono::prefix</a>, <a class="el" href="../../dd/d75/a02639_source.html#l00065">rocksdb::Slice::remove_prefix()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00436">rocksdb::DBImpl::StatsSnapshot::seconds_up_</a>, <a class="el" href="../../dd/d75/a02639_source.html#l00049">rocksdb::Slice::size()</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00039">rocksdb::MemTableList::size()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00374">stall_level0_num_files_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00378">stall_level0_num_files_count_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00372">stall_level0_slowdown_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00376">stall_level0_slowdown_count_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00375">stall_leveln_slowdown_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00379">stall_leveln_slowdown_count_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00373">stall_memtable_compaction_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00377">stall_memtable_compaction_count_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00382">started_at_</a>, <a class="el" href="../../dd/d75/a02639_source.html#l00093">rocksdb::Slice::starts_with()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00429">stats_</a>, <a class="el" href="../../d2/dd9/a02046_source.html#l00156">beast::IP::to_string()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00418">MaybeDumpStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;                                                                {</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;  <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;clear();</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;  Slice <a class="code" href="../../d2/dd6/a03414.html#a7378f09d8f10ef3ccbb2aeefe7ff41d3">in</a> = property;</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;  Slice <a class="code" href="../../d7/da0/a03474.html#a1976d8d4b21b2ffdc54122cc7b7ef4bca6d103da959e06d5ded60252ed0fd8a9a">prefix</a>(<span class="stringliteral">&quot;rocksdb.&quot;</span>);</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;  <span class="keywordflow">if</span> (!in.starts_with(<a class="code" href="../../d7/da0/a03474.html#a1976d8d4b21b2ffdc54122cc7b7ef4bca6d103da959e06d5ded60252ed0fd8a9a">prefix</a>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;  in.remove_prefix(<a class="code" href="../../d7/da0/a03474.html#a1976d8d4b21b2ffdc54122cc7b7ef4bca6d103da959e06d5ded60252ed0fd8a9a">prefix</a>.size());</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;  <span class="keywordflow">if</span> (in.starts_with(<span class="stringliteral">&quot;num-files-at-level&quot;</span>)) {</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;    in.remove_prefix(strlen(<span class="stringliteral">&quot;num-files-at-level&quot;</span>));</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> level;</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../d5/d6b/a03428.html#ae12997de115c1cf0032794aa5ea1b15daadeb01a5ff7ccf891ad10c735db17661">ok</a> = <a class="code" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5">ConsumeDecimalNumber</a>(&amp;in, &amp;level) &amp;&amp; in.empty();</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;    <span class="keywordflow">if</span> (!ok || (<span class="keywordtype">int</span>)level &gt;= <a class="code" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880">NumberLevels</a>()) {</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;      <span class="keywordtype">char</span> buf[100];</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;      snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>,</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;               <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelFiles(static_cast&lt;int&gt;(level)));</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;      *<a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a> = buf;</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;    }</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in == <span class="stringliteral">&quot;levelstats&quot;</span>) {</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;    <span class="keywordtype">char</span> buf[1000];</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;    snprintf(buf, <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;             <span class="stringliteral">&quot;Level Files Size(MB)\n&quot;</span></div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;             <span class="stringliteral">&quot;--------------------\n&quot;</span>);</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; <a class="code" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880">NumberLevels</a>(); level++) {</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;      snprintf(buf, <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;               <span class="stringliteral">&quot;%3d %8d %8.0f\n&quot;</span>,</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;               level,</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;               <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelFiles(level),</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;               <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelBytes(level) / 1048576.0);</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;      <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;    }</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in == <span class="stringliteral">&quot;stats&quot;</span>) {</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    <span class="keywordtype">char</span> buf[1000];</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> total_bytes_written = 0;</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> total_bytes_read = 0;</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> micros_up = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">NowMicros</a>() - <a class="code" href="../../dd/df5/a00386.html#a25b665f7651c915e7f8f0404dd9dc0d4">started_at_</a>;</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    <span class="comment">// Add &quot;+1&quot; to make sure seconds_up is &gt; 0 and avoid NaN later</span></div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    <span class="keywordtype">double</span> seconds_up = (micros_up + 1) / 1000000.0;</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> total_slowdown = 0;</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> total_slowdown_count = 0;</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> interval_bytes_written = 0;</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> interval_bytes_read = 0;</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> interval_bytes_new = 0;</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;    <span class="keywordtype">double</span>   interval_seconds_up = 0;</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;    <span class="comment">// Pardon the long line but I think it is easier to read this way.</span></div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;    snprintf(buf, <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;             <span class="stringliteral">&quot;                               Compactions\n&quot;</span></div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;             <span class="stringliteral">&quot;Level  Files Size(MB) Score Time(sec)  Read(MB) Write(MB)    Rn(MB)  Rnp1(MB)  Wnew(MB) RW-Amplify Read(MB/s) Write(MB/s)      Rn     Rnp1     Wnp1     NewW    Count  Ln-stall Stall-cnt\n&quot;</span></div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;             <span class="stringliteral">&quot;--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n&quot;</span></div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;             );</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;    <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> level = 0; level &lt; <a class="code" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880">NumberLevels</a>(); level++) {</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;      <span class="keywordtype">int</span> files = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelFiles(level);</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].micros &gt; 0 || files &gt; 0) {</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;        <a class="code" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> bytes_read = <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_readn +</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;                             <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_readnp1;</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;        <a class="code" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> bytes_new = <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_written -</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;                            <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_readnp1;</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;        <span class="keywordtype">double</span> amplify = (<a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_readn == 0)</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;            ? 0.0</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;            : (<a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_written +</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;               <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_readnp1 +</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;               <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_readn) /</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;                (double) <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_readn;</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;        total_bytes_read += bytes_read;</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;        total_bytes_written += <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_written;</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;        snprintf(</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;            buf, <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;            <span class="stringliteral">&quot;%3d %8d %8.0f %5.1f %9.0f %9.0f %9.0f %9.0f %9.0f %9.0f %10.1f %9.1f %11.1f %8d %8d %8d %8d %8d %9.1f %9lu\n&quot;</span>,</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;            level,</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;            files,</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelBytes(level) / 1048576.0,</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelBytes(level) /</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;                <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;MaxBytesForLevel(level),</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].micros / 1e6,</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;            bytes_read / 1048576.0,</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_written / 1048576.0,</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_readn / 1048576.0,</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_readnp1 / 1048576.0,</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;            bytes_new / 1048576.0,</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;            amplify,</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;            <span class="comment">// +1 to avoid division by 0</span></div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;            (bytes_read / 1048576.0) / ((<a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].micros+1) / 1000000.0),</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;            (<a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].bytes_written / 1048576.0) /</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;                ((<a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].micros+1) / 1000000.0),</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].files_in_leveln,</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].files_in_levelnp1,</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].files_out_levelnp1,</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].files_out_levelnp1 - <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].files_in_levelnp1,</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].count,</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#ad16938a69629762e5dc6be3578fba857">stall_leveln_slowdown_</a>[level] / 1000000.0,</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;            (<span class="keywordtype">unsigned</span> long) <a class="code" href="../../dd/df5/a00386.html#a35f210903f860d88d3ec82ae93e043c3">stall_leveln_slowdown_count_</a>[level]);</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;        total_slowdown += <a class="code" href="../../dd/df5/a00386.html#ad16938a69629762e5dc6be3578fba857">stall_leveln_slowdown_</a>[level];</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;        total_slowdown_count += <a class="code" href="../../dd/df5/a00386.html#a35f210903f860d88d3ec82ae93e043c3">stall_leveln_slowdown_count_</a>[level];</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;        <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;      }</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    }</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    interval_bytes_new = <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[0].bytes_written - <a class="code" href="../../dd/df5/a00386.html#aef63a9eac507c09f6105dfc1ca85a25d">last_stats_</a>.<a class="code" href="../../d5/df4/a01551.html#a136ce3298ba8bfb995fca85802b84f0c">bytes_new_</a>;</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    interval_bytes_read = total_bytes_read - <a class="code" href="../../dd/df5/a00386.html#aef63a9eac507c09f6105dfc1ca85a25d">last_stats_</a>.<a class="code" href="../../d5/df4/a01551.html#a0f8dfb88e8bda19e74f3057d446c3ae1">bytes_read_</a>;</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;    interval_bytes_written = total_bytes_written - <a class="code" href="../../dd/df5/a00386.html#aef63a9eac507c09f6105dfc1ca85a25d">last_stats_</a>.<a class="code" href="../../d5/df4/a01551.html#a6ad8ba215b62746c9c85d8dfb1484417">bytes_written_</a>;</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;    interval_seconds_up = seconds_up - <a class="code" href="../../dd/df5/a00386.html#aef63a9eac507c09f6105dfc1ca85a25d">last_stats_</a>.<a class="code" href="../../d5/df4/a01551.html#a48e3e836885df8165dc7e5285a1a20d6">seconds_up_</a>;</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;    snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;Uptime(secs): %.1f total, %.1f interval\n&quot;</span>,</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;             seconds_up, interval_seconds_up);</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;    <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;    snprintf(buf, <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;             <span class="stringliteral">&quot;Compaction IO cumulative (GB): &quot;</span></div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;             <span class="stringliteral">&quot;%.2f new, %.2f read, %.2f write, %.2f read+write\n&quot;</span>,</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;             <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[0].bytes_written / (1048576.0 * 1024),</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;             total_bytes_read / (1048576.0 * 1024),</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;             total_bytes_written / (1048576.0 * 1024),</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;             (total_bytes_read + total_bytes_written) / (1048576.0 * 1024));</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;    snprintf(buf, <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;             <span class="stringliteral">&quot;Compaction IO cumulative (MB/sec): &quot;</span></div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;             <span class="stringliteral">&quot;%.1f new, %.1f read, %.1f write, %.1f read+write\n&quot;</span>,</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;             <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[0].bytes_written / 1048576.0 / seconds_up,</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;             total_bytes_read / 1048576.0 / seconds_up,</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;             total_bytes_written / 1048576.0 / seconds_up,</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;             (total_bytes_read + total_bytes_written) / 1048576.0 / seconds_up);</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;    <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;    <span class="comment">// +1 to avoid divide by 0 and NaN</span></div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    snprintf(buf, <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;             <span class="stringliteral">&quot;Amplification cumulative: %.1f write, %.1f compaction\n&quot;</span>,</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;             (<span class="keywordtype">double</span>) total_bytes_written / (<a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[0].bytes_written+1),</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;             (<span class="keywordtype">double</span>) (total_bytes_written + total_bytes_read)</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;                  / (<a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[0].bytes_written+1));</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;    snprintf(buf, <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;             <span class="stringliteral">&quot;Compaction IO interval (MB): &quot;</span></div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;             <span class="stringliteral">&quot;%.2f new, %.2f read, %.2f write, %.2f read+write\n&quot;</span>,</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;             interval_bytes_new / 1048576.0,</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;             interval_bytes_read/ 1048576.0,</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;             interval_bytes_written / 1048576.0,</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;             (interval_bytes_read + interval_bytes_written) / 1048576.0);</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;    <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;    snprintf(buf, <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;             <span class="stringliteral">&quot;Compaction IO interval (MB/sec): &quot;</span></div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;             <span class="stringliteral">&quot;%.1f new, %.1f read, %.1f write, %.1f read+write\n&quot;</span>,</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;             interval_bytes_new / 1048576.0 / interval_seconds_up,</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;             interval_bytes_read / 1048576.0 / interval_seconds_up,</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;             interval_bytes_written / 1048576.0 / interval_seconds_up,</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;             (interval_bytes_read + interval_bytes_written)</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;                 / 1048576.0 / interval_seconds_up);</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;    <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;    <span class="comment">// +1 to avoid divide by 0 and NaN</span></div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;    snprintf(buf, <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;             <span class="stringliteral">&quot;Amplification interval: %.1f write, %.1f compaction\n&quot;</span>,</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;             (<span class="keywordtype">double</span>) interval_bytes_written / (interval_bytes_new+1),</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;             (<span class="keywordtype">double</span>) (interval_bytes_written + interval_bytes_read) /</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;                  (interval_bytes_new+1));</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;    <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;    snprintf(buf, <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;            <span class="stringliteral">&quot;Stalls(secs): %.3f level0_slowdown, %.3f level0_numfiles, &quot;</span></div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;            <span class="stringliteral">&quot;%.3f memtable_compaction, %.3f leveln_slowdown\n&quot;</span>,</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a9b4aea06a6f9f09239f48143743bbdd8">stall_level0_slowdown_</a> / 1000000.0,</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a182e2795f3be1489a771f3ddedce61b5">stall_level0_num_files_</a> / 1000000.0,</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a8a3ca004233cdbcb55f6f30069dbfcf9">stall_memtable_compaction_</a> / 1000000.0,</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;            total_slowdown / 1000000.0);</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;    <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;    snprintf(buf, <span class="keyword">sizeof</span>(buf),</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;            <span class="stringliteral">&quot;Stalls(count): %lu level0_slowdown, %lu level0_numfiles, &quot;</span></div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;            <span class="stringliteral">&quot;%lu memtable_compaction, %lu leveln_slowdown\n&quot;</span>,</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) <a class="code" href="../../dd/df5/a00386.html#a1bb02fe37022bebc791fedd92c78ed9b">stall_level0_slowdown_count_</a>,</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) <a class="code" href="../../dd/df5/a00386.html#a50104c0514607e212a634b2992deee15">stall_level0_num_files_count_</a>,</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) <a class="code" href="../../dd/df5/a00386.html#a44d8fc4443a936952c054b78675d5f1a">stall_memtable_compaction_count_</a>,</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) total_slowdown_count);</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;    <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>-&gt;append(buf);</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#aef63a9eac507c09f6105dfc1ca85a25d">last_stats_</a>.<a class="code" href="../../d5/df4/a01551.html#a0f8dfb88e8bda19e74f3057d446c3ae1">bytes_read_</a> = total_bytes_read;</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#aef63a9eac507c09f6105dfc1ca85a25d">last_stats_</a>.<a class="code" href="../../d5/df4/a01551.html#a6ad8ba215b62746c9c85d8dfb1484417">bytes_written_</a> = total_bytes_written;</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#aef63a9eac507c09f6105dfc1ca85a25d">last_stats_</a>.<a class="code" href="../../d5/df4/a01551.html#a136ce3298ba8bfb995fca85802b84f0c">bytes_new_</a> = <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[0].bytes_written;</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#aef63a9eac507c09f6105dfc1ca85a25d">last_stats_</a>.<a class="code" href="../../d5/df4/a01551.html#a48e3e836885df8165dc7e5285a1a20d6">seconds_up_</a> = seconds_up;</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in == <span class="stringliteral">&quot;sstables&quot;</span>) {</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;    *<a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a> = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current()-&gt;DebugString();</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in == <span class="stringliteral">&quot;num-immutable-mem-table&quot;</span>) {</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;    *<a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a> = <a class="code" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736">std::to_string</a>(<a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717">size</a>());</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;  }</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ae57d4ca72d8c220fe8a384531433e585_cgraph.png" border="0" usemap="#dd/df5/a00386_ae57d4ca72d8c220fe8a384531433e585_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ae57d4ca72d8c220fe8a384531433e585_cgraph" id="dd/df5/a00386_ae57d4ca72d8c220fe8a384531433e585_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="253,53,480,82"/><area shape="rect" id="node5" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="532,18,681,47"/><area shape="rect" id="node7" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="529,87,684,133"/><area shape="rect" id="node9" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="735,126,871,155"/><area shape="rect" id="node12" href="../../d2/dd6/a03414.html#a7378f09d8f10ef3ccbb2aeefe7ff41d3" title="Json::in" alt="" coords="333,207,400,237"/><area shape="rect" id="node14" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="280,261,453,290"/><area shape="rect" id="node16" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="261,314,472,343"/><area shape="rect" id="node20" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="288,367,445,413"/><area shape="rect" id="node22" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="279,437,455,466"/><area shape="rect" id="node24" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736" title="beast::IP::to_string" alt="" coords="300,490,433,519"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ae57d4ca72d8c220fe8a384531433e585_icgraph.png" border="0" usemap="#dd/df5/a00386_ae57d4ca72d8c220fe8a384531433e585_icgraph" alt=""/></div>
<map name="dd/df5/a00386_ae57d4ca72d8c220fe8a384531433e585_icgraph" id="dd/df5/a00386_ae57d4ca72d8c220fe8a384531433e585_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a9ca9562b2a7a0a8e0645db22648a2ac5" title="rocksdb::DBImpl::MaybeDump\lStats" alt="" coords="253,339,456,386"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="504,339,701,386"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="749,296,997,325"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1045,287,1267,334"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1332,158,1495,205"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1315,227,1512,274"/><area shape="rect" id="node27" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1315,969,1512,1015"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1327,348,1500,377"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1325,19,1501,48"/><area shape="rect" id="node50" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1316,77,1511,123"/><area shape="rect" id="node58" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1347,916,1480,945"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1613,119,1723,148"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1577,171,1759,218"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1849,129,2007,159"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1873,183,1983,212"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1563,241,1773,271"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1593,295,1743,324"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1565,348,1771,377"/><area shape="rect" id="node34" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="1845,347,2011,376"/><area shape="rect" id="node36" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="1877,240,1979,269"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1825,400,2031,429"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="1873,293,1983,323"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="1873,453,1983,483"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1613,12,1723,41"/><area shape="rect" id="node52" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1589,65,1747,95"/><area shape="rect" id="node54" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="1873,5,1983,35"/><area shape="rect" id="node56" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="1833,58,2023,105"/><area shape="rect" id="node60" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1587,1169,1749,1215"/><area shape="rect" id="node64" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1597,1238,1739,1285"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1568,1377,1768,1407"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1572,1431,1764,1460"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1613,1484,1723,1513"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1579,1537,1757,1567"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1588,1590,1748,1637"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1607,401,1729,431"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1600,454,1736,501"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1572,523,1764,570"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1572,593,1764,639"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1560,663,1776,692"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1587,715,1749,762"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1643,785,1693,815"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1599,838,1737,885"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1579,907,1757,954"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1587,977,1749,1023"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1585,1047,1751,1076"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1599,1099,1737,1146"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1596,1307,1740,1354"/><area shape="rect" id="node62" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1847,1169,2009,1215"/><area shape="rect" id="node66" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1841,1247,2015,1276"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afb3d7b24abbe10776fe76de685853433"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../d5/da5/a01424.html">Snapshot</a> * rocksdb::DBImpl::GetSnapshot </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a09ad7c62dfe7e8739732d37041d058f9">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02731">2731</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../dd/d05/a02601_source.html#l00045">rocksdb::SnapshotList::New()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00322">snapshots_</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../d9/de7/a02572_source.html#l00850">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;                                    {</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a6bf69eb135ada49bd652b4421ccc14af">snapshots_</a>.<a class="code" href="../../dc/de6/a01426.html#a726dfcfee523f18432b6ca2f21fbc755">New</a>(<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LastSequence());</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_afb3d7b24abbe10776fe76de685853433_cgraph.png" border="0" usemap="#dd/df5/a00386_afb3d7b24abbe10776fe76de685853433_cgraph" alt=""/></div>
<map name="dd/df5/a00386_afb3d7b24abbe10776fe76de685853433_cgraph" id="dd/df5/a00386_afb3d7b24abbe10776fe76de685853433_cgraph">
<area shape="rect" id="node3" href="../../dc/de6/a01426.html#a726dfcfee523f18432b6ca2f21fbc755" title="rocksdb::SnapshotList::New" alt="" coords="259,5,445,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_afb3d7b24abbe10776fe76de685853433_icgraph.png" border="0" usemap="#dd/df5/a00386_afb3d7b24abbe10776fe76de685853433_icgraph" alt=""/></div>
<map name="dd/df5/a00386_afb3d7b24abbe10776fe76de685853433_icgraph" id="dd/df5/a00386_afb3d7b24abbe10776fe76de685853433_icgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#acbdeb76b9516008a8f800772ac8d030e" title="rocksdb::TEST" alt="" coords="260,5,369,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa24437e34cff2bc2607adf5a382efe80"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::GetSortedWalFiles </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/d87/a03436.html#aaaf0d0ee1eb6c730ee241e600b26f980">VectorLogPtr</a> &amp;&#160;</td>
          <td class="paramname"><em>files</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a4cbc3ccd04ec78d0268b38397c2af029">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../dd/db2/a02563_source.html#l00083">83</a> of file <a class="el" href="../../dd/db2/a02563_source.html">db_filesnapshot.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l01442">AppendSortedWalsOfType()</a>, <a class="el" href="../../da/d03/a02577_source.html#l00065">rocksdb::ArchivalDirectory()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/db1/a00460.html#a8b523020a36e640a4820edc5535a8808">rocksdb::Env::FileExists()</a>, <a class="el" href="../../d2/d80/a02645_source.html#l00030">rocksdb::kAliveLogFile</a>, <a class="el" href="../../d2/d80/a02645_source.html#l00027">rocksdb::kArchivedLogFile</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00384">rocksdb::Options::wal_dir</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01300">GetUpdatesSince()</a>, and <a class="el" href="../../d0/df5/a02576_source.html#l00253">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                                                    {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// First get sorted files in archive dir, then append sorted files from main</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">// dir to maintain sorted order</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">// list wal files in archive dir.</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  std::string archivedir = <a class="code" href="../../d4/d87/a03436.html#a546d3e2e5c3b4aa8ee9828c7b519d501">ArchivalDirectory</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a8b523020a36e640a4820edc5535a8808">FileExists</a>(archivedir)) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    s = <a class="code" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267">AppendSortedWalsOfType</a>(archivedir, files, <a class="code" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073daf6ba709136242bfba49ab92faf12d2dd">kArchivedLogFile</a>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    }</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">// list wal files in main db dir.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267">AppendSortedWalsOfType</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>, files, <a class="code" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073da874001c1dff78414c7b1d24534730a22">kAliveLogFile</a>);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aa24437e34cff2bc2607adf5a382efe80_cgraph.png" border="0" usemap="#dd/df5/a00386_aa24437e34cff2bc2607adf5a382efe80_cgraph" alt=""/></div>
<map name="dd/df5/a00386_aa24437e34cff2bc2607adf5a382efe80_cgraph" id="dd/df5/a00386_aa24437e34cff2bc2607adf5a382efe80_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267" title="rocksdb::DBImpl::AppendSorted\lWalsOfType" alt="" coords="240,370,451,417"/><area shape="rect" id="node16" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1552,378,1688,407"/><area shape="rect" id="node132" href="../../d4/d87/a03436.html#a546d3e2e5c3b4aa8ee9828c7b519d501" title="rocksdb::ArchivalDirectory" alt="" coords="257,440,433,470"/><area shape="rect" id="node134" href="../../db/db1/a00460.html#a8b523020a36e640a4820edc5535a8808" title="rocksdb::Env::FileExists" alt="" coords="263,494,428,523"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a26b3cfbce68c226c861cfacd4a111fe1" title="rocksdb::DBImpl::CheckWal\lFileExistsAndEmpty" alt="" coords="499,430,688,477"/><area shape="rect" id="node11" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d" title="rocksdb::Env::GetFileSize" alt="" coords="755,439,928,468"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="765,386,917,415"/><area shape="rect" id="node18" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="505,276,681,306"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="1020,103,1185,132"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a58d2431c9ec2de7473a8bc2f171c04b8" title="rocksdb::DBImpl::ReadFirst\lRecord" alt="" coords="501,709,685,756"/><area shape="rect" id="node127" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="501,569,685,616"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="740,492,943,522"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1021,386,1184,415"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="1259,76,1485,106"/><area shape="rect" id="node27" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="1545,132,1695,162"/><area shape="rect" id="node29" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="1543,62,1697,109"/><area shape="rect" id="node31" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="2021,531,2157,560"/><area shape="rect" id="node36" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="1284,180,1460,210"/><area shape="rect" id="node41" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8" title="rocksdb::DBImpl::ReadFirstLine" alt="" coords="737,888,945,918"/><area shape="rect" id="node108" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="1021,1162,1184,1191"/><area shape="rect" id="node115" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="1032,1215,1173,1244"/><area shape="rect" id="node122" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8" title="rocksdb::Status::NotSupported" alt="" coords="1755,1276,1957,1306"/><area shape="rect" id="node125" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736" title="beast::IP::to_string" alt="" coords="775,718,908,747"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1324,1050,1420,1079"/><area shape="rect" id="node45" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1287,1110,1457,1139"/><area shape="rect" id="node49" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="995,658,1211,687"/><area shape="rect" id="node52" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="1032,828,1173,874"/><area shape="rect" id="node74" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="1765,1070,1947,1099"/><area shape="rect" id="node103" href="../../d6/d66/a00916.html#ac156dfd78ec3a8dd539224668defc12d" title="rocksdb::LogReporter\l::Corruption" alt="" coords="1029,1041,1176,1088"/><area shape="rect" id="node111" href="../../da/d8c/a01845.html#a49f498cf63e9c738c4d598398a6f8c9e" title="rocksdb::WriteBatchInternal\l::SetContents" alt="" coords="1280,657,1464,704"/><area shape="rect" id="node47" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1545,1122,1695,1151"/><area shape="rect" id="node54" href="../../d5/d54/a01213.html#acb5bb46275c505b8eab7bceac8affd36" title="rocksdb::log::Reader\l::SkipToInitialBlock" alt="" coords="1301,537,1443,584"/><area shape="rect" id="node62" href="../../de/daf/a01417.html#a8f740f146e792dc89409f8402a61ad04" title="rocksdb::Slice::clear" alt="" coords="1549,948,1691,978"/><area shape="rect" id="node65" href="../../d5/d54/a01213.html#a57eb93a86418bd4a2b32ee163aecea5d" title="rocksdb::log::Reader\l::ReadPhysicalRecord" alt="" coords="1296,828,1448,874"/><area shape="rect" id="node71" href="../../d5/d54/a01213.html#a7db406791cb13477c816733858ea1e51" title="rocksdb::log::Reader\l::ReportCorruption" alt="" coords="1549,1001,1691,1048"/><area shape="rect" id="node78" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1551,687,1689,716"/><area shape="rect" id="node57" href="../../d5/d54/a01213.html#a49fd67047e3128cc471e7c31c5db6f9c" title="rocksdb::log::Reader\l::ReportDrop" alt="" coords="1785,808,1927,854"/><area shape="rect" id="node60" href="../../d7/d04/a01246.html#a3489a71709b9f8a459daf7761fc8658e" title="rocksdb::log::Reader\l::Reporter::Corruption" alt="" coords="2016,808,2163,854"/><area shape="rect" id="node80" href="../../d7/db0/a03467.html#a8c50508656b8faef53619a2d4097eaf0" title="rocksdb::crc32c::Unmask" alt="" coords="1535,791,1705,820"/><area shape="rect" id="node82" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="1537,583,1703,612"/><area shape="rect" id="node84" href="../../d7/db0/a03467.html#a90a67ab6517f594a989c6cb4f3ff67f9" title="rocksdb::crc32c::Value" alt="" coords="1543,895,1697,924"/><area shape="rect" id="node76" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="2009,1199,2169,1228"/><area shape="rect" id="node86" href="../../d7/db0/a03467.html#aba0a720f8204028aa9b0f78f969d5f97" title="rocksdb::crc32c::Extend" alt="" coords="1775,895,1937,924"/><area shape="rect" id="node88" href="../../d7/db0/a03467.html#a174fe9c8cf3cb558b7accfdc10c6c04c" title="rocksdb::crc32c::CRC32" alt="" coords="2007,895,2172,924"/><area shape="rect" id="node90" href="../../d7/db0/a03467.html#aeb8537c518a4a8ac7e1d8f8ac1c6bb63" title="rocksdb::crc32c::Choose\l_CRC32" alt="" coords="2221,886,2389,933"/><area shape="rect" id="node92" href="../../d7/db0/a03467.html#a6abc7c8ed18979f0e12fcfb6460f9285" title="rocksdb::crc32c::isSSE42" alt="" coords="2439,834,2612,863"/><area shape="rect" id="node94" href="../../d7/db0/a03467.html#ab6bf1f9041f7859fe1aae6312f650115" title="rocksdb::crc32c::Fast\l_CRC32" alt="" coords="2451,886,2600,933"/><area shape="rect" id="node96" href="../../d7/db0/a03467.html#aabbb4470a0a8566fff676e40a5c3a491" title="rocksdb::crc32c::Slow\l_CRC32" alt="" coords="2661,917,2813,964"/><area shape="rect" id="node129" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="759,600,924,630"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aa24437e34cff2bc2607adf5a382efe80_icgraph.png" border="0" usemap="#dd/df5/a00386_aa24437e34cff2bc2607adf5a382efe80_icgraph" alt=""/></div>
<map name="dd/df5/a00386_aa24437e34cff2bc2607adf5a382efe80_icgraph" id="dd/df5/a00386_aa24437e34cff2bc2607adf5a382efe80_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#aefb7a749f364c505a5a6b06d977cbc71" title="rocksdb::DBImpl::GetUpdates\lSince" alt="" coords="241,5,439,51"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="285,75,395,104"/><area shape="rect" id="node5" href="../../db/d95/a00391.html#aa7a0e63b4ab38f47f7e65f92961c6625" title="rocksdb::DBTest::OpenTransaction\lLogIter" alt="" coords="489,5,716,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aefb7a749f364c505a5a6b06d977cbc71"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::GetUpdatesSince </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a>&#160;</td>
          <td class="paramname"><em>seq_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unique_ptr&lt; <a class="el" href="../../db/dbe/a01706.html">TransactionLogIterator</a> &gt; *&#160;</td>
          <td class="paramname"><em>iter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#acf2a0f67e2ffbb560f8430f1f02dc903">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01300">1300</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d4c/a02641_source.html#l00107">rocksdb::GET_UPDATES_SINCE_CALLS</a>, <a class="el" href="../../dd/db2/a02563_source.html#l00083">GetSortedWalFiles()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00051">rocksdb::Status::IOError()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00280">rocksdb::RecordTick()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01330">RetainProbableWalFiles()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00348">rocksdb::Options::statistics</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00451">storage_options_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00384">rocksdb::Options::wal_dir</a>.</p>

<p>Referenced by <a class="el" href="../../d9/de7/a02572_source.html#l00657">rocksdb::DBTest::OpenTransactionLogIter()</a>.</p>
<div class="fragment"><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                                                                         {</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29da61c2a244a587158cad8c83c648752fc5">GET_UPDATES_SINCE_CALLS</a>);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  <span class="keywordflow">if</span> (seq &gt; <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LastSequence()) {</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc">Status::IOError</a>(<span class="stringliteral">&quot;Requested sequence not yet written in the db&quot;</span>);</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  }</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  <span class="comment">//  Get all sorted Wal Files.</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <span class="comment">//  Do binary search and open files and find the seq number.</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  std::unique_ptr&lt;VectorLogPtr&gt; wal_files(<span class="keyword">new</span> <a class="code" href="../../d4/d87/a03436.html#aaaf0d0ee1eb6c730ee241e600b26f980">VectorLogPtr</a>);</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../dd/df5/a00386.html#aa24437e34cff2bc2607adf5a382efe80">GetSortedWalFiles</a>(*wal_files);</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  }</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  s = <a class="code" href="../../dd/df5/a00386.html#acb375cca04c4521fd39126db3ffcf9e9">RetainProbableWalFiles</a>(*wal_files, seq);</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  }</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  iter-&gt;reset(</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="keyword">new</span> TransactionLogIteratorImpl(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>,</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                                   &amp;<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>,</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                                   <a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>,</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                                   seq,</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                                   std::move(wal_files),</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;                                   <span class="keyword">this</span>));</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="keywordflow">return</span> (*iter)-&gt;status();</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aefb7a749f364c505a5a6b06d977cbc71_cgraph.png" border="0" usemap="#dd/df5/a00386_aefb7a749f364c505a5a6b06d977cbc71_cgraph" alt=""/></div>
<map name="dd/df5/a00386_aefb7a749f364c505a5a6b06d977cbc71_cgraph" id="dd/df5/a00386_aefb7a749f364c505a5a6b06d977cbc71_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#aa24437e34cff2bc2607adf5a382efe80" title="rocksdb::DBImpl::GetSorted\lWalFiles" alt="" coords="269,494,456,541"/><area shape="rect" id="node18" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1832,435,1968,464"/><area shape="rect" id="node101" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="1301,1395,1464,1424"/><area shape="rect" id="node132" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="292,1495,433,1524"/><area shape="rect" id="node134" href="../../dd/df5/a00386.html#acb375cca04c4521fd39126db3ffcf9e9" title="rocksdb::DBImpl::RetainProbable\lWalFiles" alt="" coords="255,1309,471,1355"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267" title="rocksdb::DBImpl::AppendSorted\lWalsOfType" alt="" coords="520,555,731,602"/><area shape="rect" id="node125" href="../../d4/d87/a03436.html#a546d3e2e5c3b4aa8ee9828c7b519d501" title="rocksdb::ArchivalDirectory" alt="" coords="537,449,713,479"/><area shape="rect" id="node127" href="../../db/db1/a00460.html#a8b523020a36e640a4820edc5535a8808" title="rocksdb::Env::FileExists" alt="" coords="543,503,708,532"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a26b3cfbce68c226c861cfacd4a111fe1" title="rocksdb::DBImpl::CheckWal\lFileExistsAndEmpty" alt="" coords="779,642,968,689"/><area shape="rect" id="node13" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d" title="rocksdb::Env::GetFileSize" alt="" coords="1035,523,1208,552"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1045,680,1197,709"/><area shape="rect" id="node20" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="785,539,961,568"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="1300,187,1465,216"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a58d2431c9ec2de7473a8bc2f171c04b8" title="rocksdb::DBImpl::ReadFirst\lRecord" alt="" coords="781,1038,965,1085"/><area shape="rect" id="node120" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="781,469,965,515"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="1020,627,1223,656"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1301,621,1464,651"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="1539,160,1765,189"/><area shape="rect" id="node29" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="1825,255,1975,284"/><area shape="rect" id="node31" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="1823,173,1977,219"/><area shape="rect" id="node33" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="2301,696,2437,725"/><area shape="rect" id="node38" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="1564,213,1740,243"/><area shape="rect" id="node43" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8" title="rocksdb::DBImpl::ReadFirstLine" alt="" coords="1017,1047,1225,1076"/><area shape="rect" id="node108" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="1312,1291,1453,1320"/><area shape="rect" id="node115" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8" title="rocksdb::Status::NotSupported" alt="" coords="2035,1343,2237,1372"/><area shape="rect" id="node118" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736" title="beast::IP::to_string" alt="" coords="1055,1100,1188,1129"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1604,1083,1700,1112"/><area shape="rect" id="node47" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1567,1136,1737,1165"/><area shape="rect" id="node51" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="1275,915,1491,944"/><area shape="rect" id="node54" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="1312,845,1453,891"/><area shape="rect" id="node76" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="2045,1187,2227,1216"/><area shape="rect" id="node96" href="../../d6/d66/a00916.html#ac156dfd78ec3a8dd539224668defc12d" title="rocksdb::LogReporter\l::Corruption" alt="" coords="1309,1069,1456,1115"/><area shape="rect" id="node104" href="../../da/d8c/a01845.html#a49f498cf63e9c738c4d598398a6f8c9e" title="rocksdb::WriteBatchInternal\l::SetContents" alt="" coords="1560,1013,1744,1059"/><area shape="rect" id="node49" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1825,1136,1975,1165"/><area shape="rect" id="node56" href="../../d5/d54/a01213.html#acb5bb46275c505b8eab7bceac8affd36" title="rocksdb::log::Reader\l::SkipToInitialBlock" alt="" coords="1581,671,1723,718"/><area shape="rect" id="node64" href="../../de/daf/a01417.html#a8f740f146e792dc89409f8402a61ad04" title="rocksdb::Slice::clear" alt="" coords="1829,800,1971,829"/><area shape="rect" id="node67" href="../../d5/d54/a01213.html#a57eb93a86418bd4a2b32ee163aecea5d" title="rocksdb::log::Reader\l::ReadPhysicalRecord" alt="" coords="1576,741,1728,787"/><area shape="rect" id="node73" href="../../d5/d54/a01213.html#a7db406791cb13477c816733858ea1e51" title="rocksdb::log::Reader\l::ReportCorruption" alt="" coords="1829,853,1971,899"/><area shape="rect" id="node80" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1831,923,1969,952"/><area shape="rect" id="node59" href="../../d5/d54/a01213.html#a49fd67047e3128cc471e7c31c5db6f9c" title="rocksdb::log::Reader\l::ReportDrop" alt="" coords="2065,626,2207,673"/><area shape="rect" id="node62" href="../../d7/d04/a01246.html#a3489a71709b9f8a459daf7761fc8658e" title="rocksdb::log::Reader\l::Reporter::Corruption" alt="" coords="2296,626,2443,673"/><area shape="rect" id="node82" href="../../d7/db0/a03467.html#a8c50508656b8faef53619a2d4097eaf0" title="rocksdb::crc32c::Unmask" alt="" coords="1815,747,1985,776"/><area shape="rect" id="node84" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="1817,488,1983,517"/><area shape="rect" id="node86" href="../../d7/db0/a03467.html#a90a67ab6517f594a989c6cb4f3ff67f9" title="rocksdb::crc32c::Value" alt="" coords="1823,541,1977,571"/><area shape="rect" id="node78" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="2289,1317,2449,1347"/><area shape="rect" id="node88" href="../../d7/db0/a03467.html#aba0a720f8204028aa9b0f78f969d5f97" title="rocksdb::crc32c::Extend" alt="" coords="2055,5,2217,35"/><area shape="rect" id="node90" href="../../d7/db0/a03467.html#a174fe9c8cf3cb558b7accfdc10c6c04c" title="rocksdb::crc32c::CRC32" alt="" coords="2287,5,2452,35"/><area shape="rect" id="node122" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1039,469,1204,499"/><area shape="rect" id="node136" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="583,1343,668,1372"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aefb7a749f364c505a5a6b06d977cbc71_icgraph.png" border="0" usemap="#dd/df5/a00386_aefb7a749f364c505a5a6b06d977cbc71_icgraph" alt=""/></div>
<map name="dd/df5/a00386_aefb7a749f364c505a5a6b06d977cbc71_icgraph" id="dd/df5/a00386_aefb7a749f364c505a5a6b06d977cbc71_icgraph">
<area shape="rect" id="node3" href="../../db/d95/a00391.html#aa7a0e63b4ab38f47f7e65f92961c6625" title="rocksdb::DBTest::OpenTransaction\lLogIter" alt="" coords="255,5,481,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="adffcba2faee783d86cfa72adbdcb10f0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::InstallCompactionResults </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d95/a00299.html">CompactionState</a> *&#160;</td>
          <td class="paramname"><em>compact</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02009">2009</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d3b/a02610_source.html#l00072">rocksdb::VersionEdit::AddFile()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l03007">rocksdb::Compaction::AddInputDeletions()</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00075">rocksdb::DBImpl::CompactionState::compaction</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00576">rocksdb::Options::compaction_style</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00554">rocksdb::Compaction::edit()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00086">rocksdb::DBImpl::CompactionState::Output::file_size</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00051">rocksdb::Status::IOError()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00057">rocksdb::kCompactionStyleUniversal</a>, <a class="el" href="../../db/d44/a02564_source.html#l00087">rocksdb::DBImpl::CompactionState::Output::largest</a>, <a class="el" href="../../db/d44/a02564_source.html#l00088">rocksdb::DBImpl::CompactionState::Output::largest_seqno</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00547">rocksdb::Compaction::level()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00557">rocksdb::Compaction::num_input_files()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00085">rocksdb::DBImpl::CompactionState::Output::number</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00090">rocksdb::DBImpl::CompactionState::outputs</a>, <a class="el" href="../../db/d44/a02564_source.html#l00087">rocksdb::DBImpl::CompactionState::Output::smallest</a>, <a class="el" href="../../db/d44/a02564_source.html#l00088">rocksdb::DBImpl::CompactionState::Output::smallest_seqno</a>, <a class="el" href="../../db/d44/a02564_source.html#l00097">rocksdb::DBImpl::CompactionState::total_bytes</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>.</p>
<div class="fragment"><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                                                                {</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  <span class="comment">// paranoia: verify that the files that we started with</span></div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  <span class="comment">// still exist in the current version and in the same original level.</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  <span class="comment">// This ensures that a concurrent compaction did not erroneously</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;  <span class="comment">// pick the same files to compact.</span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;VerifyCompactionFileConsistency(compact-&gt;compaction)) {</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,  <span class="stringliteral">&quot;Compaction %d@%d + %d@%d files aborted&quot;</span>,</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;      compact-&gt;compaction-&gt;num_input_files(0),</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;      compact-&gt;compaction-&gt;level(),</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;      compact-&gt;compaction-&gt;num_input_files(1),</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      compact-&gt;compaction-&gt;level() + 1);</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc">Status::IOError</a>(<span class="stringliteral">&quot;Compaction input files inconsistent&quot;</span>);</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;  }</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,  <span class="stringliteral">&quot;Compacted %d@%d + %d@%d files =&gt; %lld bytes&quot;</span>,</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;      compact-&gt;compaction-&gt;num_input_files(0),</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;      compact-&gt;compaction-&gt;level(),</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;      compact-&gt;compaction-&gt;num_input_files(1),</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      compact-&gt;compaction-&gt;level() + 1,</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;      <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(compact-&gt;total_bytes));</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  <span class="comment">// Add compaction outputs</span></div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;  compact-&gt;compaction-&gt;AddInputDeletions(compact-&gt;compaction-&gt;edit());</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> level = compact-&gt;compaction-&gt;level();</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; compact-&gt;outputs.size(); i++) {</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    <span class="keyword">const</span> CompactionState::Output&amp; out = compact-&gt;outputs[i];</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    compact-&gt;compaction-&gt;edit()-&gt;AddFile(</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;        (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> == <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a>) ?</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;          level : level + 1,</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;        out.number, out.file_size, out.smallest, out.largest,</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;        out.smallest_seqno, out.largest_seqno);</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;  }</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LogAndApply(compact-&gt;compaction-&gt;edit(), &amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_adffcba2faee783d86cfa72adbdcb10f0_cgraph.png" border="0" usemap="#dd/df5/a00386_adffcba2faee783d86cfa72adbdcb10f0_cgraph" alt=""/></div>
<map name="dd/df5/a00386_adffcba2faee783d86cfa72adbdcb10f0_cgraph" id="dd/df5/a00386_adffcba2faee783d86cfa72adbdcb10f0_cgraph">
<area shape="rect" id="node3" href="../../d2/d86/a01798.html#a62a14d8606dbc1d557b6e3bb55c617dd" title="rocksdb::VersionEdit\l::AddFile" alt="" coords="228,5,369,51"/><area shape="rect" id="node5" href="../../d9/d5e/a00295.html#a34f2d63bc992cde8c8d327f10be1b58a" title="rocksdb::Compaction\l::AddInputDeletions" alt="" coords="225,74,372,121"/><area shape="rect" id="node9" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="228,143,369,190"/><area shape="rect" id="node11" href="../../d9/d5e/a00295.html#a7bcdee632345fcfc238ed97309936291" title="rocksdb::Compaction\l::edit" alt="" coords="225,213,372,259"/><area shape="rect" id="node13" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="217,283,380,312"/><area shape="rect" id="node17" href="../../d9/d5e/a00295.html#ac2973e8fa4631c42de42b3d343e62989" title="rocksdb::Compaction\l::level" alt="" coords="225,335,372,382"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="251,405,347,435"/><area shape="rect" id="node21" href="../../d9/d5e/a00295.html#ae0e14955026684df1c7e261dc31fcb70" title="rocksdb::Compaction\l::num_input_files" alt="" coords="225,458,372,505"/><area shape="rect" id="node7" href="../../d2/d86/a01798.html#a9808f90e0c3ec496be67fc62cac0bd8f" title="rocksdb::VersionEdit\l::DeleteFile" alt="" coords="439,74,580,121"/><area shape="rect" id="node15" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="429,283,589,312"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_adffcba2faee783d86cfa72adbdcb10f0_icgraph.png" border="0" usemap="#dd/df5/a00386_adffcba2faee783d86cfa72adbdcb10f0_icgraph" alt=""/></div>
<map name="dd/df5/a00386_adffcba2faee783d86cfa72adbdcb10f0_icgraph" id="dd/df5/a00386_adffcba2faee783d86cfa72adbdcb10f0_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="217,289,463,319"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="512,281,709,327"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="757,250,955,297"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1003,267,1251,296"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1299,258,1520,305"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1585,77,1748,123"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1568,146,1765,193"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1580,267,1753,296"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1579,1105,1755,1135"/><area shape="rect" id="node50" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1569,1465,1764,1511"/><area shape="rect" id="node58" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1600,899,1733,928"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1867,93,1976,123"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1831,23,2012,70"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="2103,59,2260,88"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="2127,5,2236,35"/><area shape="rect" id="node25" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1816,155,2027,184"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1847,261,1996,291"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1819,208,2024,237"/><area shape="rect" id="node34" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2099,288,2264,317"/><area shape="rect" id="node36" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2131,341,2232,371"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2079,533,2284,563"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2127,235,2236,264"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="2127,181,2236,211"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1867,1573,1976,1603"/><area shape="rect" id="node52" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1843,1627,2000,1656"/><area shape="rect" id="node54" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="2127,1657,2236,1687"/><area shape="rect" id="node56" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="2087,1587,2276,1634"/><area shape="rect" id="node60" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1840,751,2003,798"/><area shape="rect" id="node64" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1851,821,1992,867"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1821,960,2021,989"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1825,1013,2017,1043"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1867,1067,1976,1096"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1832,1120,2011,1149"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1841,1173,2001,1219"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1860,699,1983,728"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1853,1242,1989,1289"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1825,1311,2017,1358"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1825,1381,2017,1427"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1813,1451,2029,1480"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1840,1503,2003,1550"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1896,315,1947,344"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1852,367,1991,414"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1832,437,2011,483"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1840,506,2003,553"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1839,576,2004,605"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1852,629,1991,675"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1849,890,1993,937"/><area shape="rect" id="node62" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2100,751,2263,798"/><area shape="rect" id="node66" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2095,829,2268,859"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a15fbc3b2d454e4ace04cf01a4ed30124"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::DBImpl::KeyMayExist </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../da/d3f/a01215.html">ReadOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>value_found</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented from <a class="el" href="../../d8/ddd/a00380.html#a17165bfaf29a7b0b1fc36bf684954e53">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02696">2696</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l02554">GetImpl()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00638">rocksdb::kBlockCacheTier</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00682">rocksdb::ReadOptions::read_tier</a>.</p>

<p>Referenced by <a class="el" href="../../d9/de7/a02572_source.html#l00704">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;                                            {</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dfc/a02612.html#a087d12026d35e2170481e0128071e9e0">value_found</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;    <span class="comment">// falsify later if key-may-exist but can&#39;t fetch value</span></div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    *<a class="code" href="../../d6/dfc/a02612.html#a087d12026d35e2170481e0128071e9e0">value_found</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;  }</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;  ReadOptions roptions = options;</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  roptions.read_tier = <a class="code" href="../../d4/d87/a03436.html#ada48f016396d2137192e1be412e8d56bac175137ac605553ec952300411cc70c3">kBlockCacheTier</a>; <span class="comment">// read from block cache only</span></div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;  <span class="keyword">auto</span> s = <a class="code" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed">GetImpl</a>(roptions, key, <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a>, <a class="code" href="../../d6/dfc/a02612.html#a087d12026d35e2170481e0128071e9e0">value_found</a>);</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;  <span class="comment">// If options.block_cache != nullptr and the index block of the table didn&#39;t</span></div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  <span class="comment">// not present in block_cache, the return value will be Status::Incomplete.</span></div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;  <span class="comment">// In this case, key may still exist in the table.</span></div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;  <span class="keywordflow">return</span> s.ok() || s.IsIncomplete();</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a15fbc3b2d454e4ace04cf01a4ed30124_cgraph.png" border="0" usemap="#dd/df5/a00386_a15fbc3b2d454e4ace04cf01a4ed30124_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a15fbc3b2d454e4ace04cf01a4ed30124_cgraph" id="dd/df5/a00386_a15fbc3b2d454e4ace04cf01a4ed30124_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="263,1376,436,1405"/><area shape="rect" id="node5" href="../../d7/dd4/a00968.html#a54372487e94967337831daf139814d96" title="rocksdb::MemTableList::Get" alt="" coords="503,635,689,664"/><area shape="rect" id="node7" href="../../d4/dd1/a01797.html#ac25d8c130a1d695a0047111eb9195214" title="rocksdb::Version::Get" alt="" coords="521,739,671,768"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="1048,1007,1189,1036"/><area shape="rect" id="node63" href="../../d3/dcd/a00965.html#a3b8151ce08ccef4707172fc89b74fa15" title="rocksdb::MemTable::Get" alt="" coords="777,312,943,341"/><area shape="rect" id="node89" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="525,1245,667,1291"/><area shape="rect" id="node93" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="532,1315,660,1344"/><area shape="rect" id="node95" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="485,1367,707,1414"/><area shape="rect" id="node106" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="513,1437,679,1467"/><area shape="rect" id="node108" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="521,1491,671,1520"/><area shape="rect" id="node110" href="../../d7/dd4/a00968.html#a648b3af66b2d983e5ae3449b77279543" title="rocksdb::MemTableList\l::RefAll" alt="" coords="517,1543,675,1590"/><area shape="rect" id="node112" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="525,1175,667,1222"/><area shape="rect" id="node115" href="../../d3/dcd/a00965.html#a35a338dd8c1096c850b1bdd3969aeee4" title="rocksdb::MemTable::\lUnref" alt="" coords="524,1613,668,1659"/><area shape="rect" id="node117" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="516,1683,676,1712"/><area shape="rect" id="node119" href="../../d7/dd4/a00968.html#a2422dd76d6ba8c9b961eb4666ab8695f" title="rocksdb::MemTableList\l::UnrefAll" alt="" coords="517,1735,675,1782"/><area shape="rect" id="node121" href="../../d4/dd1/a01797.html#a4a5cae829de750c2e3f2c587a16d4dba" title="rocksdb::Version::Update\lStats" alt="" coords="511,1805,681,1851"/><area shape="rect" id="node9" href="../../dd/d7a/a00921.html#aaa7837819393f54c0380f273d81230ff" title="rocksdb::LookupKey\l::internal_key" alt="" coords="789,610,931,657"/><area shape="rect" id="node11" href="../../dd/d7a/a00921.html#a2d6ce1ea4572d9a9f5034b5309f350c6" title="rocksdb::LookupKey\l::user_key" alt="" coords="1048,58,1189,105"/><area shape="rect" id="node13" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="1013,127,1224,174"/><area shape="rect" id="node15" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1051,1189,1187,1219"/><area shape="rect" id="node17" href="../../d0/db9/a01552.html#adf9c2b80d52e927e63ca2bd97bf42f9a" title="rocksdb::Status::IsMerge\lInProgress" alt="" coords="1035,197,1203,243"/><area shape="rect" id="node19" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="791,365,929,411"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a382fc0a9bad90fe4253c354dd309f083" title="rocksdb::FindFile" alt="" coords="799,435,921,464"/><area shape="rect" id="node23" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="1047,594,1191,641"/><area shape="rect" id="node25" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="789,487,931,534"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#a9ec2949993edef94ca7b7b0b2b5ec514" title="rocksdb::NewestFirstBySeqNo" alt="" coords="759,557,961,587"/><area shape="rect" id="node29" href="../../d4/d87/a03436.html#a3cbc76c77ed89c8aeda2da9cfc2fe387" title="rocksdb::NewestFirst" alt="" coords="787,853,933,883"/><area shape="rect" id="node31" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="755,730,965,777"/><area shape="rect" id="node40" href="../../de/df9/a01624.html#aba951faee1e4e9224bc2c668c9ea01c3" title="rocksdb::TableCache::Get" alt="" coords="773,1163,947,1192"/><area shape="rect" id="node43" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="1048,1060,1189,1089"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#a1e88bee60ffea3814f6c0a8da82c3f53" title="rocksdb::SaveValue" alt="" coords="791,800,929,829"/><area shape="rect" id="node55" href="../../d4/d87/a03436.html#a05612b66eb40fce6e2d86f6e5d354e16" title="rocksdb::MarkKeyMayExist" alt="" coords="769,957,951,987"/><area shape="rect" id="node57" href="../../d0/db9/a01552.html#a415510a7cc15542538c80c790d2bb4af" title="rocksdb::Status::NotFound" alt="" coords="1029,931,1208,960"/><area shape="rect" id="node59" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="1028,5,1209,35"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1036,664,1201,693"/><area shape="rect" id="node36" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1049,771,1188,800"/><area shape="rect" id="node38" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1051,717,1187,747"/><area shape="rect" id="node51" href="../../d5/d9d/a03343.html#a5e50025bd0ee2702179fa614b832c796" title="beast::asio::swap" alt="" coords="1056,877,1181,907"/><area shape="rect" id="node53" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="1037,824,1200,853"/><area shape="rect" id="node65" href="../../dd/d7a/a00921.html#a722151e196da98f851d5be7689dd5df7" title="rocksdb::LookupKey\l::memtable_key" alt="" coords="1048,525,1189,571"/><area shape="rect" id="node70" href="../../d4/d87/a03436.html#ad725181422bf6cf312bbea4b0b3c9d8c" title="rocksdb::GetVarint32Ptr" alt="" coords="1272,305,1435,335"/><area shape="rect" id="node75" href="../../d3/dcd/a00965.html#a95d10369e342f47e06bca980f2300514" title="rocksdb::MemTable::\lGetLock" alt="" coords="1047,386,1191,433"/><area shape="rect" id="node77" href="../../d4/d87/a03436.html#adeae0144b8eaea4c370172d4f6edaf48" title="rocksdb::GetLengthPrefixed\lSlice" alt="" coords="1027,266,1211,313"/><area shape="rect" id="node87" href="../../d0/db9/a01552.html#ae68d506384bf32b72c7db619eaeb508a" title="rocksdb::Status::MergeIn\lProgress" alt="" coords="1035,455,1203,502"/><area shape="rect" id="node91" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="773,1267,947,1296"/><area shape="rect" id="node97" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="789,1442,931,1489"/><area shape="rect" id="node99" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="767,1511,953,1558"/><area shape="rect" id="node101" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="781,1319,939,1366"/><area shape="rect" id="node103" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="780,1389,940,1419"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a15fbc3b2d454e4ace04cf01a4ed30124_icgraph.png" border="0" usemap="#dd/df5/a00386_a15fbc3b2d454e4ace04cf01a4ed30124_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a15fbc3b2d454e4ace04cf01a4ed30124_icgraph" id="dd/df5/a00386_a15fbc3b2d454e4ace04cf01a4ed30124_icgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="263,5,372,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a28a74ad04d23968571f1da281e4a6fa7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rocksdb::DBImpl::Level0StopWriteTrigger </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a35b53d2afae45788c247d5b89ca03726">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01287">1287</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d2/de3/a02637_source.html#l00280">rocksdb::Options::level0_stop_writes_trigger</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>.</p>
<div class="fragment"><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                                   {</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a87841920dd59354a972c6e748c1a8232">level0_stop_writes_trigger</a>;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5ce77d938c703a205124f8ef0cd6156c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::LogDBDeployStats </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/d12/a02571_source.html#l00052">52</a> of file <a class="el" href="../../d7/d12/a02571_source.html">db_stats_logger.cc</a>.</p>

<p>References <a class="el" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">rocksdb::port::AtomicPointer::Acquire_Load()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00309">bg_cv_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00335">bg_logstats_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00445">db_absolute_path_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b">rocksdb::Env::GetCurrentTime()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00316">host_name_</a>, <a class="el" href="../../d8/d70/a02629_source.html#l00026">rocksdb::kMajorVersion</a>, <a class="el" href="../../d8/d70/a02629_source.html#l00027">rocksdb::kMinorVersion</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00351">logger_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00308">shutting_down_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00067">rocksdb::port::CondVar::SignalAll()</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../d7/d12/a02571_source.html#l00047">BGLogDBDeployStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                              {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#aa30ff424691deb3432441334d3adb3cf">shutting_down_</a>.<a class="code" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">Acquire_Load</a>()) {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#ab308f5a73496bf663add416d38b1eb3b">bg_logstats_scheduled_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1">SignalAll</a>();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordtype">char</span> tmp_ver[100];</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  sprintf(tmp_ver, <span class="stringliteral">&quot;%d.%d&quot;</span>, <a class="code" href="../../d4/d87/a03436.html#ad1766a6dff1a323f457f2a1fcb826311">kMajorVersion</a>, <a class="code" href="../../d4/d87/a03436.html#a5dadfd46d8951a668f565ef65bb2837f">kMinorVersion</a>);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  std::string version_info(tmp_ver);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> file_total_size = 0;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <a class="code" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> file_total_num = 0;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumberLevels(); i++) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    file_total_num += <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelFiles(i);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    file_total_size += <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelBytes(i);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  VersionSet::LevelSummaryStorage scratch;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* file_num_summary = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LevelSummary(&amp;scratch);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  std::string file_num_per_level(file_num_summary);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  std::string data_size_per_level(file_num_summary);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <a class="code" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> unix_ts;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b">GetCurrentTime</a>(&amp;unix_ts);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a8170a5a4d3a3f498851720b843b48f9f">logger_</a>-&gt;Log_Deploy_Stats(version_info, <a class="code" href="../../dd/df5/a00386.html#a851172acb183ae096ea0a767407d421c">host_name_</a>,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#ac70f13459b5221663e10f148dc876f42">db_absolute_path_</a>, file_total_size, file_total_num, file_num_per_level,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      data_size_per_level, unix_ts);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#ab308f5a73496bf663add416d38b1eb3b">bg_logstats_scheduled_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1">SignalAll</a>();</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a5ce77d938c703a205124f8ef0cd6156c_cgraph.png" border="0" usemap="#dd/df5/a00386_a5ce77d938c703a205124f8ef0cd6156c_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a5ce77d938c703a205124f8ef0cd6156c_cgraph" id="dd/df5/a00386_a5ce77d938c703a205124f8ef0cd6156c_cgraph">
<area shape="rect" id="node3" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="271,5,457,51"/><area shape="rect" id="node5" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="264,75,464,104"/><area shape="rect" id="node7" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="293,127,435,174"/><area shape="rect" id="node11" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1" title="rocksdb::port::CondVar\l::SignalAll" alt="" coords="285,197,443,243"/><area shape="rect" id="node14" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="293,266,435,313"/><area shape="rect" id="node9" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="513,205,687,235"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a5ce77d938c703a205124f8ef0cd6156c_icgraph.png" border="0" usemap="#dd/df5/a00386_a5ce77d938c703a205124f8ef0cd6156c_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a5ce77d938c703a205124f8ef0cd6156c_icgraph" id="dd/df5/a00386_a5ce77d938c703a205124f8ef0cd6156c_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a3b86ec3494acbb6dbb8f2fdace967183" title="rocksdb::DBImpl::BGLogDBDeploy\lStats" alt="" coords="265,639,492,686"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df" title="rocksdb::DBImpl::MaybeSchedule\lLogDBDeployStats" alt="" coords="541,639,763,686"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="811,558,1000,605"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1589,613,1787,659"/><area shape="rect" id="node21" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2432,661,2565,691"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1344,567,1541,614"/><area shape="rect" id="node99" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1344,485,1541,531"/><area shape="rect" id="node102" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="1049,545,1295,575"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1835,647,2083,676"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="2131,586,2352,633"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2400,555,2597,602"/><area shape="rect" id="node23" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2672,19,2835,66"/><area shape="rect" id="node27" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2683,119,2824,166"/><area shape="rect" id="node31" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2653,205,2853,235"/><area shape="rect" id="node33" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2657,259,2849,288"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2699,320,2808,349"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2664,373,2843,403"/><area shape="rect" id="node47" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2673,426,2833,473"/><area shape="rect" id="node51" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2692,496,2815,525"/><area shape="rect" id="node59" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2685,549,2821,595"/><area shape="rect" id="node61" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2657,618,2849,665"/><area shape="rect" id="node63" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2657,687,2849,734"/><area shape="rect" id="node69" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2645,757,2861,787"/><area shape="rect" id="node73" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2672,810,2835,857"/><area shape="rect" id="node79" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2728,880,2779,909"/><area shape="rect" id="node81" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2684,933,2823,979"/><area shape="rect" id="node87" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2664,1002,2843,1049"/><area shape="rect" id="node89" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2672,1071,2835,1118"/><area shape="rect" id="node93" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2671,1141,2836,1171"/><area shape="rect" id="node95" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2684,1194,2823,1241"/><area shape="rect" id="node97" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2681,1263,2825,1310"/><area shape="rect" id="node25" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2948,5,3111,51"/><area shape="rect" id="node29" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2943,75,3116,104"/><area shape="rect" id="node35" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="2916,127,3143,174"/><area shape="rect" id="node37" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="2943,197,3116,227"/><area shape="rect" id="node39" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="2943,250,3116,297"/><area shape="rect" id="node45" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="3004,320,3055,349"/><area shape="rect" id="node49" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="2949,373,3109,419"/><area shape="rect" id="node53" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2927,443,3132,472"/><area shape="rect" id="node55" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="2928,495,3131,542"/><area shape="rect" id="node57" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="2975,565,3084,595"/><area shape="rect" id="node65" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="2933,618,3125,665"/><area shape="rect" id="node67" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="2933,687,3125,734"/><area shape="rect" id="node71" href="../../db/d84/a02686.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="3004,757,3055,787"/><area shape="rect" id="node75" href="../../da/dee/a00383.html#a8cdb390521098e2a5f737561e9eb1134" title="rocksdb::DBConstructor\l::DBConstructor" alt="" coords="2948,810,3111,857"/><area shape="rect" id="node77" href="../../da/dee/a00383.html#ae9772754567f1b3c0ca7d5285a56ac6d" title="rocksdb::DBConstructor\l::FinishImpl" alt="" coords="2948,879,3111,926"/><area shape="rect" id="node83" href="../../d3/daa/a01577.html#af7e726bf27e216787e7c331834ec6075" title="rocksdb::StressTest::Run" alt="" coords="2944,949,3115,979"/><area shape="rect" id="node85" href="../../d3/daa/a01577.html#aeac9f55bde5a11da0fcc2c88465de0c6" title="rocksdb::StressTest\l::Reopen" alt="" coords="2960,1002,3099,1049"/><area shape="rect" id="node91" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="2911,1071,3148,1118"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa86eaccec6e3d9e5146c13ca31b2918f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::MakeRoomForWrite </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>force</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02953">2953</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d4/d61/a02588_source.html#l00175">rocksdb::MemTableList::Add()</a>, <a class="el" href="../../df/d44/a02586_source.html#l00060">rocksdb::MemTable::ApproximateMemoryUsage()</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00309">bg_cv_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00349">bg_error_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00448">delayed_writes_</a>, <a class="el" href="../../db/d44/a02564_source.html#l03348">DelayLoggingAndReset()</a>, <a class="el" href="../../df/d25/a02764_source.html#l00026">rocksdb::StopWatch::ElapsedMicros()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../de/d48/a02589_source.html#l00084">rocksdb::MemTableList::FlushRequested()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00442">rocksdb::Options::hard_rate_limit</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00183">rocksdb::HARD_RATE_LIMIT_DELAY_COUNT</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00312">imm_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00178">internal_comparator_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00277">rocksdb::Options::level0_slowdown_writes_trigger</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00280">rocksdb::Options::level0_stop_writes_trigger</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00314">log_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00313">logfile_number_</a>, <a class="el" href="../../da/d03/a02577_source.html#l00060">rocksdb::LogFileName()</a>, <a class="el" href="../../d5/dd8/a03083_source.html#l00035">ripple::max()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00158">rocksdb::Options::max_write_buffer_number</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00311">mem_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00310">mem_rep_factory_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47">rocksdb::Env::NewWritableFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01279">NumberLevels()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00447">rocksdb::Options::rate_limit_delay_max_milliseconds</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00080">rocksdb::RATE_LIMIT_DELAY_MILLIS</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00280">rocksdb::RecordTick()</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00043">rocksdb::MemTable::Ref()</a>, <a class="el" href="../../d5/d1b/a01971_source.html#l00116">beast::hash_metrics::detail::score()</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00126">rocksdb::MemTable::SetLogNumber()</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00118">rocksdb::MemTable::SetNextLogNumber()</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00039">rocksdb::MemTableList::size()</a>, <a class="el" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b">rocksdb::Env::SleepForMicroseconds()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02930">SlowdownAmount()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00437">rocksdb::Options::soft_rate_limit</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00184">rocksdb::SOFT_RATE_LIMIT_DELAY_COUNT</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00182">rocksdb::STALL_L0_NUM_FILES_COUNT</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00079">rocksdb::STALL_L0_NUM_FILES_MICROS</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00180">rocksdb::STALL_L0_SLOWDOWN_COUNT</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00075">rocksdb::STALL_L0_SLOWDOWN_MICROS</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00374">stall_level0_num_files_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00378">stall_level0_num_files_count_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00372">stall_level0_slowdown_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00376">stall_level0_slowdown_count_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00375">stall_leveln_slowdown_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00379">stall_leveln_slowdown_count_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00373">stall_memtable_compaction_</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00181">rocksdb::STALL_MEMTABLE_COMPACTION_COUNT</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00377">stall_memtable_compaction_count_</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00077">rocksdb::STALL_MEMTABLE_COMPACTION_MICROS</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00348">rocksdb::Options::statistics</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00451">storage_options_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, <a class="el" href="../../d0/d3f/a02630_source.html#l00058">rocksdb::EnvOptions::use_mmap_writes</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00059">rocksdb::port::CondVar::Wait()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00384">rocksdb::Options::wal_dir</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00152">rocksdb::Options::write_buffer_size</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00319">writers_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>.</p>
<div class="fragment"><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;                                          {</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;  assert(!<a class="code" href="../../dd/df5/a00386.html#a2d3abc2f19390f60d4a922b98dd23450">writers_</a>.empty());</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;  <span class="keywordtype">bool</span> allow_delay = !force;</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;  <span class="keywordtype">bool</span> allow_hard_rate_limit_delay = !force;</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;  <span class="keywordtype">bool</span> allow_soft_rate_limit_delay = !force;</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rate_limit_delay_millis = 0;</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s;</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527">score</a>;</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#a79aec493ad501d3e044e08f610591926">bg_error_</a>.<a class="code" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425">ok</a>()) {</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;      <span class="comment">// Yield previous error</span></div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;      s = <a class="code" href="../../dd/df5/a00386.html#a79aec493ad501d3e044e08f610591926">bg_error_</a>;</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;        allow_delay &amp;&amp;</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelFiles(0) &gt;=</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;          <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#adf7dd332263dc0c5f23b08840a4c866b">level0_slowdown_writes_trigger</a>) {</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;      <span class="comment">// We are getting close to hitting a hard limit on the number of</span></div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;      <span class="comment">// L0 files.  Rather than delaying a single write by several</span></div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;      <span class="comment">// seconds when we hit the hard limit, start delaying each</span></div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;      <span class="comment">// individual write by 0-1ms to reduce latency variance.  Also,</span></div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      <span class="comment">// this delay hands over some CPU to the compaction thread in</span></div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;      <span class="comment">// case it is sharing the same core as the writer.</span></div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;      <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> delayed;</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;      {</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        StopWatch sw(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aea89c4c3744012c3d1527d288d2250e7df">STALL_L0_SLOWDOWN_COUNT</a>);</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b">SleepForMicroseconds</a>(</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;          <a class="code" href="../../dd/df5/a00386.html#a4bd51a8c14d950ad017734df3a7b851c">SlowdownAmount</a>(<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelFiles(0),</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;                         <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#adf7dd332263dc0c5f23b08840a4c866b">level0_slowdown_writes_trigger</a>,</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;                         <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a87841920dd59354a972c6e748c1a8232">level0_stop_writes_trigger</a>)</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;        );</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;        delayed = sw.ElapsedMicros();</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;      }</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29da284e4162809ec793b459813f5d38037a">STALL_L0_SLOWDOWN_MICROS</a>, delayed);</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a9b4aea06a6f9f09239f48143743bbdd8">stall_level0_slowdown_</a> += delayed;</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a1bb02fe37022bebc791fedd92c78ed9b">stall_level0_slowdown_count_</a>++;</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;      allow_delay = <span class="keyword">false</span>;  <span class="comment">// Do not delay a single write more than once</span></div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a7ac5de89c53f110bb27112295ea2314d">delayed_writes_</a>++;</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!force &amp;&amp;</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;               (<a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>-&gt;<a class="code" href="../../d3/dcd/a00965.html#a3232b72cba2586f3d6dbd08d8b4be86d">ApproximateMemoryUsage</a>() &lt;= <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a48ec9672854e5fcd4bd33ad294c8d882">write_buffer_size</a>)) {</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;      <span class="comment">// There is room in current memtable</span></div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      <span class="keywordflow">if</span> (allow_delay) {</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a24b1211b5a5fbfccfe0818c32753ff5f">DelayLoggingAndReset</a>();</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;      }</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717">size</a>() == <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6499c030f28722065f341ce48d0eea09">max_write_buffer_number</a> - 1) {</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;      <span class="comment">// We have filled up the current memtable, but the previous</span></div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;      <span class="comment">// ones are still being compacted, so we wait.</span></div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a24b1211b5a5fbfccfe0818c32753ff5f">DelayLoggingAndReset</a>();</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;wait for memtable compaction...\n&quot;</span>);</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;      <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> stall;</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;      {</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        StopWatch sw(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>,</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;          <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aea04cf31ec8bb82067621ddd8b4e48afa2">STALL_MEMTABLE_COMPACTION_COUNT</a>);</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36">Wait</a>();</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;        stall = sw.ElapsedMicros();</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;      }</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29dac3c6a052bf1c212a6ad28ce4807fede2">STALL_MEMTABLE_COMPACTION_MICROS</a>, stall);</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a8a3ca004233cdbcb55f6f30069dbfcf9">stall_memtable_compaction_</a> += stall;</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a44d8fc4443a936952c054b78675d5f1a">stall_memtable_compaction_count_</a>++;</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelFiles(0) &gt;=</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;               <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a87841920dd59354a972c6e748c1a8232">level0_stop_writes_trigger</a>) {</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;      <span class="comment">// There are too many level-0 files.</span></div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a24b1211b5a5fbfccfe0818c32753ff5f">DelayLoggingAndReset</a>();</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;wait for fewer level0 files...\n&quot;</span>);</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;      <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> stall;</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      {</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;        StopWatch sw(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aea8ebbf9dd2e3ce498d03da502de0118c9">STALL_L0_NUM_FILES_COUNT</a>);</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36">Wait</a>();</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;        stall = sw.ElapsedMicros();</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;      }</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29da1bfc7f0d1478bf12fadecc00e326cdf1">STALL_L0_NUM_FILES_MICROS</a>, stall);</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a182e2795f3be1489a771f3ddedce61b5">stall_level0_num_files_</a> += stall;</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a50104c0514607e212a634b2992deee15">stall_level0_num_files_count_</a>++;</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;        allow_hard_rate_limit_delay &amp;&amp;</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a707a7c586e82ec22720f053589ebcc6a">hard_rate_limit</a> &gt; 1.0 &amp;&amp;</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;        (score = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;MaxCompactionScore()) &gt; <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a707a7c586e82ec22720f053589ebcc6a">hard_rate_limit</a>) {</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;      <span class="comment">// Delay a write when the compaction score for any level is too large.</span></div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;      <span class="keywordtype">int</span> max_level = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;MaxCompactionScoreLevel();</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;      <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> delayed;</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;      {</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;        StopWatch sw(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aeaded3246d0f57ad493206eb3f7c609094">HARD_RATE_LIMIT_DELAY_COUNT</a>);</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b">SleepForMicroseconds</a>(1000);</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;        delayed = sw.ElapsedMicros();</div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;      }</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#ad16938a69629762e5dc6be3578fba857">stall_leveln_slowdown_</a>[max_level] += delayed;</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a35f210903f860d88d3ec82ae93e043c3">stall_leveln_slowdown_count_</a>[max_level]++;</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;      <span class="comment">// Make sure the following value doesn&#39;t round to zero.</span></div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;      <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rate_limit = <a class="code" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785">std::max</a>((delayed / 1000), (<a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>) 1);</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;      rate_limit_delay_millis += rate_limit;</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29da6552e6351b7100ba2d6c3e2f294a36e7">RATE_LIMIT_DELAY_MILLIS</a>, rate_limit);</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#add69edb4f87e20089a00287bab348afa">rate_limit_delay_max_milliseconds</a> &gt; 0 &amp;&amp;</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;          rate_limit_delay_millis &gt;=</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;          (<span class="keywordtype">unsigned</span>)<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#add69edb4f87e20089a00287bab348afa">rate_limit_delay_max_milliseconds</a>) {</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;        allow_hard_rate_limit_delay = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;      }</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;        allow_soft_rate_limit_delay &amp;&amp;</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a4f9d273dd6ceef9e1a2d9e0e6f10e498">soft_rate_limit</a> &gt; 0.0 &amp;&amp;</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;        (score = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;MaxCompactionScore()) &gt; <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a4f9d273dd6ceef9e1a2d9e0e6f10e498">soft_rate_limit</a>) {</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;      <span class="comment">// Delay a write when the compaction score for any level is too large.</span></div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;      <span class="comment">// TODO: add statistics</span></div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;      {</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;        StopWatch sw(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aea410b302993e12085ed5bb46e7b56f191">SOFT_RATE_LIMIT_DELAY_COUNT</a>);</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b">SleepForMicroseconds</a>(<a class="code" href="../../dd/df5/a00386.html#a4bd51a8c14d950ad017734df3a7b851c">SlowdownAmount</a>(</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;          score,</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;          <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a4f9d273dd6ceef9e1a2d9e0e6f10e498">soft_rate_limit</a>,</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;          <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a707a7c586e82ec22720f053589ebcc6a">hard_rate_limit</a>)</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;        );</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;        rate_limit_delay_millis += sw.ElapsedMicros();</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;      }</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;      allow_soft_rate_limit_delay = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;      <span class="comment">// Attempt to switch to a new memtable and trigger compaction of old</span></div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a24b1211b5a5fbfccfe0818c32753ff5f">DelayLoggingAndReset</a>();</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;      assert(<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;PrevLogNumber() == 0);</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;      <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> new_log_number = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NewFileNumber();</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;      unique_ptr&lt;WritableFile&gt; lfile;</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;      EnvOptions soptions(<a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>);</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;      soptions.use_mmap_writes = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;      s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47">NewWritableFile</a>(</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;            <a class="code" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477">LogFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>, new_log_number),</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;            &amp;lfile,</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;            soptions</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;          );</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;      <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;        <span class="comment">// Avoid chewing through file number space in a tight loop.</span></div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;ReuseFileNumber(new_log_number);</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;      }</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;      <span class="comment">// Our final size should be less than write_buffer_size</span></div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;      <span class="comment">// (compression, etc) but err on the side of caution.</span></div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;      lfile-&gt;SetPreallocationBlockSize(1.1 * <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a48ec9672854e5fcd4bd33ad294c8d882">write_buffer_size</a>);</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a39586d8f5ff2cd8c0d99d96763b8ccc6">logfile_number_</a> = new_log_number;</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a0801eebdc654c9987f70ba512e9c45f4">log_</a>.reset(<span class="keyword">new</span> log::Writer(std::move(lfile)));</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>-&gt;<a class="code" href="../../d3/dcd/a00965.html#a08633ea1ccd8277c4bad90686e12e59d">SetNextLogNumber</a>(<a class="code" href="../../dd/df5/a00386.html#a39586d8f5ff2cd8c0d99d96763b8ccc6">logfile_number_</a>);</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#a889613116ef509399ebb13a714e236d6">Add</a>(<a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>);</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;      <span class="keywordflow">if</span> (force) {</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#acd9439e034e085a62a05850d9ba39c7a">FlushRequested</a>();</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;      }</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a> = <span class="keyword">new</span> MemTable(</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;          <a class="code" href="../../dd/df5/a00386.html#aa92d556db5d7f5bc58f2531cd124729d">internal_comparator_</a>, <a class="code" href="../../dd/df5/a00386.html#a6372d47ec4455946aa5754c002a4fbf0">mem_rep_factory_</a>, <a class="code" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880">NumberLevels</a>(), <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>);</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>-&gt;<a class="code" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5">Ref</a>();</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;          <span class="stringliteral">&quot;New memtable created with log file: #%lu\n&quot;</span>,</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;          (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="../../dd/df5/a00386.html#a39586d8f5ff2cd8c0d99d96763b8ccc6">logfile_number_</a>);</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>-&gt;<a class="code" href="../../d3/dcd/a00965.html#a81f80d2b6674d454e4b65f238281d716">SetLogNumber</a>(<a class="code" href="../../dd/df5/a00386.html#a39586d8f5ff2cd8c0d99d96763b8ccc6">logfile_number_</a>);</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;      force = <span class="keyword">false</span>;   <span class="comment">// Do not force another compaction if have room</span></div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a">MaybeScheduleFlushOrCompaction</a>();</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;    }</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;  }</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aa86eaccec6e3d9e5146c13ca31b2918f_cgraph.png" border="0" usemap="#dd/df5/a00386_aa86eaccec6e3d9e5146c13ca31b2918f_cgraph" alt=""/></div>
<map name="dd/df5/a00386_aa86eaccec6e3d9e5146c13ca31b2918f_cgraph" id="dd/df5/a00386_aa86eaccec6e3d9e5146c13ca31b2918f_cgraph">
<area shape="rect" id="node3" href="../../d7/dd4/a00968.html#a889613116ef509399ebb13a714e236d6" title="rocksdb::MemTableList::Add" alt="" coords="264,83,453,112"/><area shape="rect" id="node9" href="../../d3/dcd/a00965.html#a3232b72cba2586f3d6dbd08d8b4be86d" title="rocksdb::MemTable::\lApproximateMemoryUsage" alt="" coords="269,143,448,190"/><area shape="rect" id="node13" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1391,415,1532,462"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a24b1211b5a5fbfccfe0818c32753ff5f" title="rocksdb::DBImpl::DelayLogging\lAndReset" alt="" coords="815,365,1020,411"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1413,756,1509,785"/><area shape="rect" id="node19" href="../../d8/d6c/a01563.html#a2265fb9a74a457ec56cc61f60ea5353e" title="rocksdb::StopWatch\l::ElapsedMicros" alt="" coords="847,194,988,241"/><area shape="rect" id="node23" href="../../d7/dd4/a00968.html#acd9439e034e085a62a05850d9ba39c7a" title="rocksdb::MemTableList\l::FlushRequested" alt="" coords="280,586,437,633"/><area shape="rect" id="node25" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="1119,1885,1260,1931"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1385,363,1537,392"/><area shape="rect" id="node34" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="316,1412,401,1441"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="248,1297,469,1343"/><area shape="rect" id="node56" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1393,1228,1529,1257"/><area shape="rect" id="node82" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="1069,1661,1309,1691"/><area shape="rect" id="node85" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="1119,1765,1260,1811"/><area shape="rect" id="node123" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="257,1668,460,1697"/><area shape="rect" id="node125" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="253,1721,464,1751"/><area shape="rect" id="node128" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="288,1775,429,1804"/><area shape="rect" id="node130" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="276,1828,441,1857"/><area shape="rect" id="node132" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="289,2209,428,2255"/><area shape="rect" id="node136" href="../../d3/dcd/a00965.html#a81f80d2b6674d454e4b65f238281d716" title="rocksdb::MemTable::\lSetLogNumber" alt="" coords="287,1931,431,1978"/><area shape="rect" id="node138" href="../../d3/dcd/a00965.html#a08633ea1ccd8277c4bad90686e12e59d" title="rocksdb::MemTable::\lSetNextLogNumber" alt="" coords="287,2001,431,2047"/><area shape="rect" id="node140" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="280,2070,437,2117"/><area shape="rect" id="node143" href="../../dd/df5/a00386.html#a4bd51a8c14d950ad017734df3a7b851c" title="rocksdb::DBImpl::Slowdown\lAmount" alt="" coords="265,2139,452,2186"/><area shape="rect" id="node146" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="839,1966,996,2013"/><area shape="rect" id="node5" href="../../d3/dcd/a00965.html#a09738ceda2e4adcbe9146664516cf699" title="rocksdb::MemTable::\lMarkImmutable" alt="" coords="569,74,713,121"/><area shape="rect" id="node7" href="../../de/d76/a00134.html#a30ba8a8f96b44b0802aee9bc9c16c58a" title="rocksdb::port::AtomicPointer\l::Release_Store" alt="" coords="548,5,735,51"/><area shape="rect" id="node11" href="../../d7/d70/a00106.html#a87df854c19bfd3a5843682b36ddae7b9" title="rocksdb::ArenaImpl\l::ApproximateMemoryUsage" alt="" coords="548,143,735,190"/><area shape="rect" id="node21" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="1375,309,1548,339"/><area shape="rect" id="node27" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1375,1833,1548,1863"/><area shape="rect" id="node32" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1627,363,1789,392"/><area shape="rect" id="node39" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="1368,1471,1555,1518"/><area shape="rect" id="node41" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="1383,1281,1540,1327"/><area shape="rect" id="node45" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="1381,1691,1541,1720"/><area shape="rect" id="node47" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="536,1332,747,1361"/><area shape="rect" id="node88" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="517,1123,765,1152"/><area shape="rect" id="node43" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc" title="rocksdb::port::AtomicPointer\l::NoBarrier_Load" alt="" coords="1615,1281,1801,1327"/><area shape="rect" id="node49" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="819,1277,1016,1323"/><area shape="rect" id="node52" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1091,1250,1288,1297"/><area shape="rect" id="node58" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="1087,415,1292,462"/><area shape="rect" id="node61" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="1359,526,1564,573"/><area shape="rect" id="node67" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="1397,917,1525,947"/><area shape="rect" id="node71" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="1083,909,1296,955"/><area shape="rect" id="node76" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1376,1007,1547,1036"/><area shape="rect" id="node79" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1" title="rocksdb::port::CondVar\l::SignalAll" alt="" coords="1111,1591,1268,1638"/><area shape="rect" id="node90" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="819,1114,1016,1161"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1091,1029,1288,1075"/><area shape="rect" id="node107" href="../../dd/df5/a00386.html#a9ca9562b2a7a0a8e0645db22648a2ac5" title="rocksdb::DBImpl::MaybeDump\lStats" alt="" coords="1088,586,1291,633"/><area shape="rect" id="node112" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df" title="rocksdb::DBImpl::MaybeSchedule\lLogDBDeployStats" alt="" coords="1079,1471,1300,1518"/><area shape="rect" id="node134" href="../../d0/dbf/a03363.html#a75c05654caed31bf91b09dbc14e681d1" title="beast::hash_metrics\l::detail::sqr" alt="" coords="572,2209,711,2255"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aa86eaccec6e3d9e5146c13ca31b2918f_icgraph.png" border="0" usemap="#dd/df5/a00386_aa86eaccec6e3d9e5146c13ca31b2918f_icgraph" alt=""/></div>
<map name="dd/df5/a00386_aa86eaccec6e3d9e5146c13ca31b2918f_icgraph" id="dd/df5/a00386_aa86eaccec6e3d9e5146c13ca31b2918f_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="249,209,407,239"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="496,179,605,208"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="456,231,645,278"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#aaf39022d45b559b69933cfe719571c10" title="rocksdb::DBImpl::Flush" alt="" coords="704,75,864,104"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a789ea69cfa7ee4fccf934757a4641228" title="rocksdb::DBImpl::TEST\l_FlushMemTable" alt="" coords="703,231,865,278"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#a9bdda420ec5d44390a04215d8b1cbffd" title="rocksdb::DBImpl::~DBImpl" alt="" coords="695,301,873,331"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#aaa4a148182ce98c83d363817e938ddd5" title="rocksdb::DBImpl::GetLive\lFiles" alt="" coords="936,5,1109,51"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="968,75,1077,104"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="968,128,1077,157"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="932,231,1113,278"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1184,184,1341,213"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#a09218d973702b7be115bc4a65c0d97b9" title="rocksdb::DBTest::MakeTables" alt="" coords="923,301,1123,331"/><area shape="rect" id="node32" href="../../de/de8/a00405.html#a49dbce26ebba1e0ac3f38a3af92b9757" title="rocksdb::DeleteFileTest\l::CreateTwoLevels" alt="" coords="943,354,1103,401"/><area shape="rect" id="node34" href="../../d0/d88/a01231.html#a07eb4424cb2bef23ca200a806de76d9b" title="rocksdb::ReduceLevelTest\l::CompactMemTable" alt="" coords="933,423,1112,470"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1208,240,1317,269"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="1404,184,1513,213"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#af32d610cb80f870ed942c9ec7a053675" title="rocksdb::DBTest::FillLevels" alt="" coords="1171,301,1355,331"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9cf2899c898a18ab3f2f2414fc94872e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rocksdb::DBImpl::MaxMemCompactionLevel </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a3aeca434e4819cde454a755e03a8ebfd">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01283">1283</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d2/de3/a02637_source.html#l00288">rocksdb::Options::max_mem_compaction_level</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>.</p>

<p>Referenced by <a class="el" href="../../d1/d67/a02561_source.html#l00306">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                                  {</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acc03f1982800fd926cee95d1e77fe1ff">max_mem_compaction_level</a>;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a9cf2899c898a18ab3f2f2414fc94872e_icgraph.png" border="0" usemap="#dd/df5/a00386_a9cf2899c898a18ab3f2f2414fc94872e_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a9cf2899c898a18ab3f2f2414fc94872e_icgraph" id="dd/df5/a00386_a9cf2899c898a18ab3f2f2414fc94872e_icgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a18a5cfea930214507a93a1fefbae75cf" title="rocksdb::TEST" alt="" coords="308,13,417,43"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9ca9562b2a7a0a8e0645db22648a2ac5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::MaybeDumpStats </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00418">418</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00365">last_stats_dump_time_microsec_</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">rocksdb::Env::NowMicros()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00409">PrintStatistics()</a>, <a class="el" href="../../d6/d50/a02694_source.html#l00667">stats</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00542">rocksdb::Options::stats_dump_period_sec</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>.</p>
<div class="fragment"><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                            {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#ae964ab029fabdb74a176ca6873b375d3">stats_dump_period_sec</a> == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> now_micros = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">NowMicros</a>();</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a07c615f6afce7171a2d78fe7d9813f31">last_stats_dump_time_microsec_</a> +</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#ae964ab029fabdb74a176ca6873b375d3">stats_dump_period_sec</a> * 1000000</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      &lt;= now_micros) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">// Multiple threads could race in here simultaneously.</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// However, the last one will update last_stats_dump_time_microsec_</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="comment">// atomically. We could see more than one dump during one dump</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="comment">// period in rare cases.</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a07c615f6afce7171a2d78fe7d9813f31">last_stats_dump_time_microsec_</a> = now_micros;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    std::string <a class="code" href="../../d6/d50/a02694.html#a5925d216740c89f43482df806fd14e8c">stats</a>;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#ae57d4ca72d8c220fe8a384531433e585">GetProperty</a>(<span class="stringliteral">&quot;rocksdb.stats&quot;</span>, &amp;stats);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;%s&quot;</span>, stats.c_str());</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#aa52b644196bb47c051055a7a9a827fcd">PrintStatistics</a>();</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a9ca9562b2a7a0a8e0645db22648a2ac5_cgraph.png" border="0" usemap="#dd/df5/a00386_a9ca9562b2a7a0a8e0645db22648a2ac5_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a9ca9562b2a7a0a8e0645db22648a2ac5_cgraph" id="dd/df5/a00386_a9ca9562b2a7a0a8e0645db22648a2ac5_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#ae57d4ca72d8c220fe8a384531433e585" title="rocksdb::DBImpl::GetProperty" alt="" coords="263,262,460,291"/><area shape="rect" id="node16" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="541,491,715,521"/><area shape="rect" id="node28" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="580,557,676,586"/><area shape="rect" id="node31" href="../../dd/df5/a00386.html#aa52b644196bb47c051055a7a9a827fcd" title="rocksdb::DBImpl::PrintStatistics" alt="" coords="256,581,467,610"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="515,54,741,83"/><area shape="rect" id="node7" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="793,19,943,49"/><area shape="rect" id="node9" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="791,88,945,135"/><area shape="rect" id="node11" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="996,127,1132,157"/><area shape="rect" id="node14" href="../../d2/dd6/a03414.html#a7378f09d8f10ef3ccbb2aeefe7ff41d3" title="Json::in" alt="" coords="595,209,661,238"/><area shape="rect" id="node18" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="523,262,733,291"/><area shape="rect" id="node22" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="549,315,707,361"/><area shape="rect" id="node24" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="540,385,716,414"/><area shape="rect" id="node26" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736" title="beast::IP::to_string" alt="" coords="561,438,695,467"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a9ca9562b2a7a0a8e0645db22648a2ac5_icgraph.png" border="0" usemap="#dd/df5/a00386_a9ca9562b2a7a0a8e0645db22648a2ac5_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a9ca9562b2a7a0a8e0645db22648a2ac5_icgraph" id="dd/df5/a00386_a9ca9562b2a7a0a8e0645db22648a2ac5_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="256,339,453,386"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="501,296,749,325"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="797,287,1019,334"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1084,158,1247,205"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1067,227,1264,274"/><area shape="rect" id="node25" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1067,969,1264,1015"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1079,348,1252,377"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1077,19,1253,48"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1068,77,1263,123"/><area shape="rect" id="node56" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1099,916,1232,945"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1365,119,1475,148"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1329,171,1511,218"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1611,129,1768,159"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1635,183,1744,212"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1315,241,1525,271"/><area shape="rect" id="node30" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1345,295,1495,324"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1317,348,1523,377"/><area shape="rect" id="node32" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="1607,293,1772,323"/><area shape="rect" id="node34" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="1639,347,1740,376"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1587,400,1792,429"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="1635,240,1744,269"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="1635,453,1744,483"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1365,12,1475,41"/><area shape="rect" id="node50" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1341,65,1499,95"/><area shape="rect" id="node52" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="1635,5,1744,35"/><area shape="rect" id="node54" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="1595,58,1784,105"/><area shape="rect" id="node58" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1339,1169,1501,1215"/><area shape="rect" id="node62" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1349,1238,1491,1285"/><area shape="rect" id="node66" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1320,1308,1520,1337"/><area shape="rect" id="node68" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1324,1361,1516,1391"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1365,1484,1475,1513"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1331,1537,1509,1567"/><area shape="rect" id="node76" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1340,1590,1500,1637"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1359,401,1481,431"/><area shape="rect" id="node81" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1352,454,1488,501"/><area shape="rect" id="node83" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1324,523,1516,570"/><area shape="rect" id="node85" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1324,593,1516,639"/><area shape="rect" id="node87" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1312,663,1528,692"/><area shape="rect" id="node89" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1339,715,1501,762"/><area shape="rect" id="node91" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1395,785,1445,815"/><area shape="rect" id="node93" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1351,838,1489,885"/><area shape="rect" id="node95" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1331,907,1509,954"/><area shape="rect" id="node97" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1339,977,1501,1023"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1337,1047,1503,1076"/><area shape="rect" id="node101" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1351,1099,1489,1146"/><area shape="rect" id="node103" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1348,1414,1492,1461"/><area shape="rect" id="node60" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1608,1169,1771,1215"/><area shape="rect" id="node64" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1603,1247,1776,1276"/><area shape="rect" id="node70" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1576,1353,1803,1399"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a933c2a47a906fd7bcfdc3bfe77c9ea6e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::MaybeIgnoreError </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/db9/a01552.html">Status</a> *&#160;</td>
          <td class="paramname"><em>s</em>)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00392">392</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00036">rocksdb::Status::OK()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00125">rocksdb::Options::paranoid_checks</a>, and <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00874">RecoverLogFile()</a>.</p>
<div class="fragment"><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                             {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">if</span> (s-&gt;ok() || <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a3caefadde126ce359200ea7742e3dba7">paranoid_checks</a>) {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="comment">// No change needed</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Ignoring error %s&quot;</span>, s-&gt;ToString().c_str());</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    *s = <a class="code" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00">Status::OK</a>();</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a933c2a47a906fd7bcfdc3bfe77c9ea6e_cgraph.png" border="0" usemap="#dd/df5/a00386_a933c2a47a906fd7bcfdc3bfe77c9ea6e_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a933c2a47a906fd7bcfdc3bfe77c9ea6e_cgraph" id="dd/df5/a00386_a933c2a47a906fd7bcfdc3bfe77c9ea6e_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="293,5,389,35"/><area shape="rect" id="node5" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="271,59,412,88"/><area shape="rect" id="node9" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="273,112,409,141"/><area shape="rect" id="node11" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="256,165,427,195"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="475,59,635,88"/><area shape="rect" id="node13" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="480,165,629,195"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a933c2a47a906fd7bcfdc3bfe77c9ea6e_icgraph.png" border="0" usemap="#dd/df5/a00386_a933c2a47a906fd7bcfdc3bfe77c9ea6e_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a933c2a47a906fd7bcfdc3bfe77c9ea6e_icgraph" id="dd/df5/a00386_a933c2a47a906fd7bcfdc3bfe77c9ea6e_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#adb8cf2e0f98f8368db32bea16bcf3cb7" title="rocksdb::DBImpl::Recover\lLogFile" alt="" coords="257,637,433,683"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#afe079cf353957e6c79ed794cbc0bb9fc" title="rocksdb::DBImpl::Recover" alt="" coords="484,645,660,675"/><area shape="rect" id="node7" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="711,645,844,675"/><area shape="rect" id="node9" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="920,21,1083,67"/><area shape="rect" id="node15" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="931,121,1072,167"/><area shape="rect" id="node21" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="901,205,1101,235"/><area shape="rect" id="node23" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="905,259,1097,288"/><area shape="rect" id="node35" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="947,323,1056,352"/><area shape="rect" id="node37" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="912,376,1091,405"/><area shape="rect" id="node41" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="921,429,1081,475"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="940,499,1063,528"/><area shape="rect" id="node57" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="933,602,1069,649"/><area shape="rect" id="node59" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="905,671,1097,718"/><area shape="rect" id="node61" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="905,741,1097,787"/><area shape="rect" id="node69" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="893,811,1109,840"/><area shape="rect" id="node73" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="920,863,1083,910"/><area shape="rect" id="node79" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="976,933,1027,963"/><area shape="rect" id="node81" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="932,986,1071,1033"/><area shape="rect" id="node87" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="912,1055,1091,1102"/><area shape="rect" id="node89" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="920,1125,1083,1171"/><area shape="rect" id="node95" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1195,619,1360,648"/><area shape="rect" id="node98" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="932,1194,1071,1241"/><area shape="rect" id="node100" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="929,1263,1073,1310"/><area shape="rect" id="node11" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1196,5,1359,51"/><area shape="rect" id="node13" href="../../d9/d48/a00345.html#a08cff08de4bf7d2a6f51cb498a406f0f" title="rocksdb::CorruptionTest\l::CorruptionTest" alt="" coords="1473,5,1636,51"/><area shape="rect" id="node17" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1191,75,1364,104"/><area shape="rect" id="node19" href="../../d9/d66/a02562.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1529,75,1580,104"/><area shape="rect" id="node25" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1164,127,1391,174"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="1191,197,1364,227"/><area shape="rect" id="node31" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="1191,250,1364,297"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#a509351e18607a06285412f6654253643" title="rocksdb::DBTest::DBTest" alt="" coords="1468,197,1641,227"/><area shape="rect" id="node33" href="../../db/d95/a00391.html#a3761d111551d33530517a39f38f908d1" title="rocksdb::DBTest::ChangeOptions" alt="" coords="1445,259,1664,288"/><area shape="rect" id="node39" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1252,320,1303,349"/><area shape="rect" id="node43" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="1197,373,1357,419"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1175,443,1380,472"/><area shape="rect" id="node51" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="1176,495,1379,542"/><area shape="rect" id="node55" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="1223,565,1332,595"/><area shape="rect" id="node49" href="../../d4/d87/a03436.html#a28f3fa7104cc330d8f573f98682e000b" title="rocksdb::TEST" alt="" coords="1500,443,1609,472"/><area shape="rect" id="node53" href="../../dc/d6a/a02779.html#a1fa3253ca11014c1b01923a1674ff19c" title="main" alt="" coords="1529,561,1580,591"/><area shape="rect" id="node63" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="1181,671,1373,718"/><area shape="rect" id="node67" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="1181,741,1373,787"/><area shape="rect" id="node65" href="../../d0/dc7/a01402.html#aa4769c7f42641f11d37d9d1a0b381bef" title="rocksdb::SimpleTableDBTest\l::SimpleTableDBTest" alt="" coords="1459,671,1651,718"/><area shape="rect" id="node71" href="../../db/d84/a02686.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1252,811,1303,840"/><area shape="rect" id="node75" href="../../da/dee/a00383.html#a8cdb390521098e2a5f737561e9eb1134" title="rocksdb::DBConstructor\l::DBConstructor" alt="" coords="1196,863,1359,910"/><area shape="rect" id="node77" href="../../da/dee/a00383.html#ae9772754567f1b3c0ca7d5285a56ac6d" title="rocksdb::DBConstructor\l::FinishImpl" alt="" coords="1196,933,1359,979"/><area shape="rect" id="node83" href="../../d3/daa/a01577.html#af7e726bf27e216787e7c331834ec6075" title="rocksdb::StressTest::Run" alt="" coords="1192,1003,1363,1032"/><area shape="rect" id="node85" href="../../d3/daa/a01577.html#aeac9f55bde5a11da0fcc2c88465de0c6" title="rocksdb::StressTest\l::Reopen" alt="" coords="1208,1055,1347,1102"/><area shape="rect" id="node91" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="1159,1125,1396,1171"/><area shape="rect" id="node93" href="../../de/d9d/a00813.html#ab355fd20f7ef62b0cb2e673a6a2d9bec" title="rocksdb::LDBCommand::Run" alt="" coords="1180,1195,1375,1224"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6f3ccd58266e8fd7a1b513ebef01928a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::MaybeScheduleFlushOrCompaction </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01600">1600</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">rocksdb::port::AtomicPointer::Acquire_Load()</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00329">bg_compaction_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00332">bg_flush_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00454">bg_work_gate_closed_</a>, <a class="el" href="../../db/d44/a02564_source.html#l01631">BGWorkCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01627">BGWorkFlush()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00312">imm_</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00046">rocksdb::MemTableList::IsFlushPending()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00346">manual_compaction_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00401">rocksdb::Options::max_background_compactions</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00413">rocksdb::Options::max_background_flushes</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00167">rocksdb::Options::min_write_buffer_number_to_merge</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867">rocksdb::Env::Schedule()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00308">shutting_down_</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01648">BackgroundCallFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02554">GetImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02616">MultiGet()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l01485">TEST_CompactRange()</a>.</p>
<div class="fragment"><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                                            {</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a64f1e254c5aaa8e73231273933cdeef6">bg_work_gate_closed_</a>) {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    <span class="comment">// gate closed for backgrond work</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#aa30ff424691deb3432441334d3adb3cf">shutting_down_</a>.<a class="code" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">Acquire_Load</a>()) {</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="comment">// DB is being deleted; no more background compactions</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="keywordtype">bool</span> is_flush_pending =</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36">IsFlushPending</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a115f9538bf76bb2a2929567292510d98">min_write_buffer_number_to_merge</a>);</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <span class="keywordflow">if</span> (is_flush_pending &amp;&amp;</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        (<a class="code" href="../../dd/df5/a00386.html#aca89b02f26787b31bba9a8690b4be42d">bg_flush_scheduled_</a> &lt; <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#ad717a693361008e48cdc0ce1fb72df84">max_background_flushes</a>)) {</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      <span class="comment">// memtable flush needed</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#aca89b02f26787b31bba9a8690b4be42d">bg_flush_scheduled_</a>++;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867">Schedule</a>(&amp;<a class="code" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47">DBImpl::BGWorkFlush</a>, <span class="keyword">this</span>, Env::Priority::HIGH);</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    }</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../dd/df5/a00386.html#ab8d415c46a300bbfcaaa95e812a51179">manual_compaction_</a> ||</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;         <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NeedsCompaction() ||</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;         (is_flush_pending &amp;&amp; (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#ad717a693361008e48cdc0ce1fb72df84">max_background_flushes</a> &lt;= 0))) &amp;&amp;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> &lt; <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acfc44c7252fbd8c8d98c42903014dbbc">max_background_compactions</a>) {</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      <span class="comment">// compaction needed, or memtable flush needed but HIGH pool not enabled.</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a>++;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867">Schedule</a>(&amp;<a class="code" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7">DBImpl::BGWorkCompaction</a>, <span class="keyword">this</span>, Env::Priority::LOW);</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    }</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;  }</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a6f3ccd58266e8fd7a1b513ebef01928a_cgraph.png" border="0" usemap="#dd/df5/a00386_a6f3ccd58266e8fd7a1b513ebef01928a_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a6f3ccd58266e8fd7a1b513ebef01928a_cgraph" id="dd/df5/a00386_a6f3ccd58266e8fd7a1b513ebef01928a_cgraph">
<area shape="rect" id="node3" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="1917,462,2104,509"/><area shape="rect" id="node5" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1667,798,1808,845"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="275,1767,523,1796"/><area shape="rect" id="node43" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="1659,538,1816,585"/><area shape="rect" id="node55" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="1931,2920,2091,2949"/><area shape="rect" id="node146" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="293,1516,504,1545"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="571,1790,768,1837"/><area shape="rect" id="node12" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="819,810,1016,857"/><area shape="rect" id="node19" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1943,1463,2079,1492"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1689,1772,1785,1801"/><area shape="rect" id="node49" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df" title="rocksdb::DBImpl::MaybeSchedule\lLogDBDeployStats" alt="" coords="1627,2291,1848,2338"/><area shape="rect" id="node61" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="1400,1479,1541,1526"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="1407,1771,1535,1800"/><area shape="rect" id="node73" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1" title="rocksdb::port::CondVar\l::SignalAll" alt="" coords="1392,1599,1549,1646"/><area shape="rect" id="node76" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1652,2799,1823,2828"/><area shape="rect" id="node80" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="1400,1410,1541,1457"/><area shape="rect" id="node89" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="1088,1951,1293,1998"/><area shape="rect" id="node94" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="1368,1874,1573,1921"/><area shape="rect" id="node101" href="../../dd/df5/a00386.html#a9ca9562b2a7a0a8e0645db22648a2ac5" title="rocksdb::DBImpl::MaybeDump\lStats" alt="" coords="816,2063,1019,2110"/><area shape="rect" id="node114" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="1084,2405,1297,2451"/><area shape="rect" id="node142" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="1071,1747,1311,1776"/><area shape="rect" id="node16" href="../../dd/df5/a00386.html#a0d04c5afc2255f2160046afed2398cbd" title="rocksdb::DBImpl::Cleanup\lCompaction" alt="" coords="1383,674,1559,721"/><area shape="rect" id="node21" href="../../de/de6/a00723.html#a1f29087f48fd168fe431e4b884f5aed1" title="rocksdb::InternalKey\l::DebugString" alt="" coords="1120,298,1261,345"/><area shape="rect" id="node29" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="1068,1136,1313,1165"/><area shape="rect" id="node39" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="1376,914,1565,961"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2" title="rocksdb::ParseInternalKey" alt="" coords="1383,419,1559,448"/><area shape="rect" id="node25" href="../../d6/d80/a01076.html#a36870425cc00e160004d62bd6118a24d" title="rocksdb::ParsedInternalKey\l::DebugString" alt="" coords="1380,298,1561,345"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#a4bf89f1a48c96450ef0d88b5c9f0a1ec" title="rocksdb::EscapeString" alt="" coords="1393,245,1548,275"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#aa4a580611125396a6e0072010fced806" title="rocksdb::DBImpl::Allocate\lCompactionOutputFileNumbers" alt="" coords="1368,845,1573,891"/><area shape="rect" id="node35" href="../../d9/d5e/a00295.html#a1db1e317f2592dea3a1f3e1ddb56197d" title="rocksdb::Compaction\l::BottomMostLevel" alt="" coords="1397,1189,1544,1235"/><area shape="rect" id="node37" href="../../de/daf/a01417.html#a8f740f146e792dc89409f8402a61ad04" title="rocksdb::Slice::clear" alt="" coords="1400,1136,1541,1165"/><area shape="rect" id="node45" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc" title="rocksdb::port::AtomicPointer\l::NoBarrier_Load" alt="" coords="1917,577,2104,623"/><area shape="rect" id="node69" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="1384,1995,1557,2024"/><area shape="rect" id="node52" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="1911,2413,2111,2443"/><area shape="rect" id="node57" href="../../dd/df5/a00386.html#a3b86ec3494acbb6dbb8f2fdace967183" title="rocksdb::DBImpl::BGLogDBDeploy\lStats" alt="" coords="1897,2291,2124,2338"/><area shape="rect" id="node63" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1651,1488,1824,1517"/><area shape="rect" id="node78" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1936,2799,2085,2828"/><area shape="rect" id="node92" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="1649,2361,1825,2391"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#ae57d4ca72d8c220fe8a384531433e585" title="rocksdb::DBImpl::GetProperty" alt="" coords="1092,2072,1289,2101"/><area shape="rect" id="node108" href="../../dd/df5/a00386.html#aa52b644196bb47c051055a7a9a827fcd" title="rocksdb::DBImpl::PrintStatistics" alt="" coords="1085,2176,1296,2205"/><area shape="rect" id="node116" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="1389,2525,1552,2555"/><area shape="rect" id="node118" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1395,2579,1547,2608"/><area shape="rect" id="node120" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="1655,2585,1820,2615"/><area shape="rect" id="node123" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="1383,2352,1559,2381"/><area shape="rect" id="node125" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="1369,2632,1572,2661"/><area shape="rect" id="node129" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="1655,2721,1820,2751"/><area shape="rect" id="node131" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="1364,2405,1577,2451"/><area shape="rect" id="node148" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="819,1559,1016,1606"/><area shape="rect" id="node151" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1092,974,1289,1021"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a6f3ccd58266e8fd7a1b513ebef01928a_icgraph.png" border="0" usemap="#dd/df5/a00386_a6f3ccd58266e8fd7a1b513ebef01928a_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a6f3ccd58266e8fd7a1b513ebef01928a_icgraph" id="dd/df5/a00386_a6f3ccd58266e8fd7a1b513ebef01928a_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="529,43,727,90"/><area shape="rect" id="node8" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="275,163,472,210"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="275,43,472,90"/><area shape="rect" id="node16" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="287,284,460,313"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="276,1103,471,1150"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="285,1484,461,1513"/><area shape="rect" id="node44" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="307,896,440,925"/><area shape="rect" id="node99" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="292,1692,455,1739"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="784,82,1032,112"/><area shape="rect" id="node10" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="523,168,733,197"/><area shape="rect" id="node18" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="553,274,703,304"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="525,221,731,250"/><area shape="rect" id="node20" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="825,301,991,330"/><area shape="rect" id="node22" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="857,354,959,384"/><area shape="rect" id="node24" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="805,608,1011,637"/><area shape="rect" id="node26" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="853,248,963,277"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="853,194,963,224"/><area shape="rect" id="node34" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="549,1586,707,1616"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="853,1556,963,1585"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="813,1608,1003,1655"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="573,1640,683,1669"/><area shape="rect" id="node46" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="547,887,709,934"/><area shape="rect" id="node50" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="557,956,699,1003"/><area shape="rect" id="node54" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="528,1026,728,1056"/><area shape="rect" id="node56" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="532,1080,724,1109"/><area shape="rect" id="node64" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="573,1133,683,1162"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="539,1186,717,1216"/><area shape="rect" id="node70" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="548,1308,708,1355"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="567,834,689,864"/><area shape="rect" id="node75" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="560,1378,696,1424"/><area shape="rect" id="node77" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="532,1447,724,1494"/><area shape="rect" id="node79" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="532,1516,724,1563"/><area shape="rect" id="node81" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="520,328,736,357"/><area shape="rect" id="node83" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="547,380,709,427"/><area shape="rect" id="node85" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="603,450,653,480"/><area shape="rect" id="node87" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="559,503,697,550"/><area shape="rect" id="node89" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="539,572,717,619"/><area shape="rect" id="node91" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="547,642,709,688"/><area shape="rect" id="node93" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="545,712,711,741"/><area shape="rect" id="node95" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="559,764,697,811"/><area shape="rect" id="node97" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="556,1239,700,1286"/><area shape="rect" id="node48" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="827,883,989,930"/><area shape="rect" id="node52" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="821,953,995,982"/><area shape="rect" id="node58" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="795,1075,1021,1122"/><area shape="rect" id="node60" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="821,1145,995,1174"/><area shape="rect" id="node62" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="821,1006,995,1052"/><area shape="rect" id="node68" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="883,1198,933,1228"/><area shape="rect" id="node101" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="573,1762,683,1792"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="537,1692,719,1739"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4ab5900a7770dcb2a687bfd41269f2df"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::MaybeScheduleLogDBDeployStats </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/d12/a02571_source.html#l00022">22</a> of file <a class="el" href="../../d7/d12/a02571_source.html">db_stats_logger.cc</a>.</p>

<p>References <a class="el" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">rocksdb::port::AtomicPointer::Acquire_Load()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00335">bg_logstats_scheduled_</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00047">BGLogDBDeployStats()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00369">rocksdb::Options::db_stats_log_interval</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b">rocksdb::Env::GetCurrentTime()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00316">host_name_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00353">last_log_ts</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00351">logger_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867">rocksdb::Env::Schedule()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00308">shutting_down_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01113">FlushMemTableToOutputFile()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>.</p>
<div class="fragment"><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;                                           {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="comment">// There is a lock in the actual logger.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#a8170a5a4d3a3f498851720b843b48f9f">logger_</a> || <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#ab2013254e3e5f93441ff1999be3c24aa">db_stats_log_interval</a> &lt; 0</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;      || <a class="code" href="../../dd/df5/a00386.html#a851172acb183ae096ea0a767407d421c">host_name_</a>.empty()) {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  }</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../dd/df5/a00386.html#ab308f5a73496bf663add416d38b1eb3b">bg_logstats_scheduled_</a> || <a class="code" href="../../dd/df5/a00386.html#aa30ff424691deb3432441334d3adb3cf">shutting_down_</a>.<a class="code" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf">Acquire_Load</a>()) {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">// Already scheduled</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> current_ts = 0;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> st = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b">GetCurrentTime</a>(&amp;current_ts);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">if</span> (!st.ok()) {</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordflow">if</span> ((current_ts - <a class="code" href="../../dd/df5/a00386.html#a44c1ebfd047bdb17d99296bb152bac93">last_log_ts</a>) &lt; <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#ab2013254e3e5f93441ff1999be3c24aa">db_stats_log_interval</a>) {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    }</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a44c1ebfd047bdb17d99296bb152bac93">last_log_ts</a> = current_ts;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#ab308f5a73496bf663add416d38b1eb3b">bg_logstats_scheduled_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867">Schedule</a>(&amp;<a class="code" href="../../dd/df5/a00386.html#a3b86ec3494acbb6dbb8f2fdace967183">DBImpl::BGLogDBDeployStats</a>, <span class="keyword">this</span>);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a4ab5900a7770dcb2a687bfd41269f2df_cgraph.png" border="0" usemap="#dd/df5/a00386_a4ab5900a7770dcb2a687bfd41269f2df_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a4ab5900a7770dcb2a687bfd41269f2df_cgraph" id="dd/df5/a00386_a4ab5900a7770dcb2a687bfd41269f2df_cgraph">
<area shape="rect" id="node3" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="817,5,1004,51"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a3b86ec3494acbb6dbb8f2fdace967183" title="rocksdb::DBImpl::BGLogDBDeploy\lStats" alt="" coords="276,126,503,173"/><area shape="rect" id="node10" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="811,75,1011,104"/><area shape="rect" id="node23" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="321,196,457,225"/><area shape="rect" id="node25" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="309,249,469,279"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a5ce77d938c703a205124f8ef0cd6156c" title="rocksdb::DBImpl::LogDBDeploy\lStats" alt="" coords="553,127,761,174"/><area shape="rect" id="node12" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="840,127,981,174"/><area shape="rect" id="node16" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1" title="rocksdb::port::CondVar\l::SignalAll" alt="" coords="832,197,989,243"/><area shape="rect" id="node19" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="840,266,981,313"/><area shape="rect" id="node14" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1060,205,1233,235"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a4ab5900a7770dcb2a687bfd41269f2df_icgraph.png" border="0" usemap="#dd/df5/a00386_a4ab5900a7770dcb2a687bfd41269f2df_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a4ab5900a7770dcb2a687bfd41269f2df_icgraph" id="dd/df5/a00386_a4ab5900a7770dcb2a687bfd41269f2df_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="275,566,472,613"/><area shape="rect" id="node15" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1144,645,1277,675"/><area shape="rect" id="node98" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="549,425,739,471"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="520,575,768,604"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="829,574,1051,621"/><area shape="rect" id="node10" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1112,543,1309,590"/><area shape="rect" id="node12" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1112,434,1309,481"/><area shape="rect" id="node17" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1384,19,1547,66"/><area shape="rect" id="node21" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1395,119,1536,166"/><area shape="rect" id="node25" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1365,205,1565,235"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1369,259,1561,288"/><area shape="rect" id="node35" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1411,323,1520,352"/><area shape="rect" id="node37" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1376,376,1555,405"/><area shape="rect" id="node41" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1385,429,1545,475"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1404,499,1527,528"/><area shape="rect" id="node55" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1397,602,1533,649"/><area shape="rect" id="node57" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1369,671,1561,718"/><area shape="rect" id="node59" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1369,741,1561,787"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1357,811,1573,840"/><area shape="rect" id="node69" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1384,863,1547,910"/><area shape="rect" id="node75" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1440,933,1491,963"/><area shape="rect" id="node77" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1396,986,1535,1033"/><area shape="rect" id="node83" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1376,1055,1555,1102"/><area shape="rect" id="node85" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1384,1125,1547,1171"/><area shape="rect" id="node91" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1659,619,1824,648"/><area shape="rect" id="node94" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1396,1194,1535,1241"/><area shape="rect" id="node96" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1393,1263,1537,1310"/><area shape="rect" id="node19" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1660,5,1823,51"/><area shape="rect" id="node23" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1655,75,1828,104"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1628,127,1855,174"/><area shape="rect" id="node31" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="1655,197,1828,227"/><area shape="rect" id="node33" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="1655,250,1828,297"/><area shape="rect" id="node39" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1716,320,1767,349"/><area shape="rect" id="node43" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="1661,373,1821,419"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1639,443,1844,472"/><area shape="rect" id="node49" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="1640,495,1843,542"/><area shape="rect" id="node53" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="1687,565,1796,595"/><area shape="rect" id="node51" href="../../dc/d6a/a02779.html#a1fa3253ca11014c1b01923a1674ff19c" title="main" alt="" coords="1909,561,1960,591"/><area shape="rect" id="node61" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="1645,671,1837,718"/><area shape="rect" id="node63" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="1645,741,1837,787"/><area shape="rect" id="node67" href="../../db/d84/a02686.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1716,811,1767,840"/><area shape="rect" id="node71" href="../../da/dee/a00383.html#a8cdb390521098e2a5f737561e9eb1134" title="rocksdb::DBConstructor\l::DBConstructor" alt="" coords="1660,863,1823,910"/><area shape="rect" id="node73" href="../../da/dee/a00383.html#ae9772754567f1b3c0ca7d5285a56ac6d" title="rocksdb::DBConstructor\l::FinishImpl" alt="" coords="1660,933,1823,979"/><area shape="rect" id="node79" href="../../d3/daa/a01577.html#af7e726bf27e216787e7c331834ec6075" title="rocksdb::StressTest::Run" alt="" coords="1656,1003,1827,1032"/><area shape="rect" id="node81" href="../../d3/daa/a01577.html#aeac9f55bde5a11da0fcc2c88465de0c6" title="rocksdb::StressTest\l::Reopen" alt="" coords="1672,1055,1811,1102"/><area shape="rect" id="node87" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="1623,1125,1860,1171"/><area shape="rect" id="node89" href="../../de/d9d/a00813.html#ab355fd20f7ef62b0cb2e673a6a2d9bec" title="rocksdb::LDBCommand::Run" alt="" coords="1644,1195,1839,1224"/><area shape="rect" id="node101" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="841,454,1039,501"/><area shape="rect" id="node104" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="817,351,1063,380"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4b355ac2e2039e00d858b96905d79d71"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::Merge </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../da/d4b/a01848.html">WriteOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#af6702472d68f092ade92c1eb8a6c0300">rocksdb::DB</a>.</p>

<p>Reimplemented in <a class="el" href="../../db/db9/a00387.html#ab60f441e96ea25d5c86074725b2393c1">rocksdb::DBImplReadOnly</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02746">2746</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l03443">rocksdb::DB::Merge()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00096">rocksdb::Options::merge_operator</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00045">rocksdb::Status::NotSupported()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>.</p>

<p>Referenced by <a class="el" href="../../d6/dfc/a02593_source.html#l00168">MergeBasedCounters::add()</a>, and <a class="el" href="../../dc/d6a/a02779_source.html#l00064">rocksdb::StringLists::Append()</a>.</p>
<div class="fragment"><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;                                       {</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6c52cebaebf5c0116b1aa8fc11a6333b">merge_operator</a>) {</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8">Status::NotSupported</a>(<span class="stringliteral">&quot;Provide a merge_operator when opening DB&quot;</span>);</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d8/ddd/a00380.html#af6702472d68f092ade92c1eb8a6c0300">DB::Merge</a>(o, key, val);</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;  }</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a4b355ac2e2039e00d858b96905d79d71_cgraph.png" border="0" usemap="#dd/df5/a00386_a4b355ac2e2039e00d858b96905d79d71_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a4b355ac2e2039e00d858b96905d79d71_cgraph" id="dd/df5/a00386_a4b355ac2e2039e00d858b96905d79d71_cgraph">
<area shape="rect" id="node3" href="../../d8/ddd/a00380.html#af6702472d68f092ade92c1eb8a6c0300" title="rocksdb::DB::Merge" alt="" coords="251,144,389,173"/><area shape="rect" id="node27" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8" title="rocksdb::Status::NotSupported" alt="" coords="219,197,421,227"/><area shape="rect" id="node5" href="../../d2/dbd/a01844.html#ab2c611e4e5d774ecd115082bce617e7a" title="rocksdb::WriteBatch\l::Merge" alt="" coords="479,74,620,121"/><area shape="rect" id="node25" href="../../d8/ddd/a00380.html#ad5d37a09e90d0c22c9a0adca87267ebc" title="rocksdb::DB::Write" alt="" coords="483,144,616,173"/><area shape="rect" id="node7" href="../../da/d8c/a01845.html#a5d61953d919f082c48c4d4aada512004" title="rocksdb::WriteBatchInternal\l::SetCount" alt="" coords="677,5,861,51"/><area shape="rect" id="node11" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="677,74,861,121"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#af1cdcde94bcaeced42cd5925a5827232" title="rocksdb::PutLengthPrefixed\lSlice" alt="" coords="679,162,860,209"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#aabc7ce45ae48e15b24a6756f9b4fd694" title="rocksdb::EncodeFixed32" alt="" coords="911,13,1076,43"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="911,75,1076,104"/><area shape="rect" id="node17" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="924,128,1063,157"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#afe24fa7da1cd551af92134aa66f96183" title="rocksdb::PutVarint32" alt="" coords="921,181,1065,211"/><area shape="rect" id="node23" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="925,235,1061,264"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a94c48680211f25845f5c35acd4b54ebb" title="rocksdb::EncodeVarint32" alt="" coords="1125,181,1293,211"/><area shape="rect" id="node29" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="469,197,629,227"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a4b355ac2e2039e00d858b96905d79d71_icgraph.png" border="0" usemap="#dd/df5/a00386_a4b355ac2e2039e00d858b96905d79d71_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a4b355ac2e2039e00d858b96905d79d71_icgraph" id="dd/df5/a00386_a4b355ac2e2039e00d858b96905d79d71_icgraph">
<area shape="rect" id="node3" href="../../de/d4e/a00972.html#aaf818024e7d2d5f6aa7dd19b6711d631" title="MergeBasedCounters::add" alt="" coords="220,5,396,35"/><area shape="rect" id="node5" href="../../de/d40/a01592.html#abe4e79261354600253dd63f19f19eb27" title="rocksdb::StringLists\l::Append" alt="" coords="239,58,377,105"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a427b25417806c153b1d7cad902ec9ae5" title="rocksdb::TEST" alt="" coords="447,67,556,96"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a19d8fbac12db943503c6a28d35c44e44"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="../../d0/db9/a01552.html">Status</a> &gt; rocksdb::DBImpl::MultiGet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../da/d3f/a01215.html">ReadOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../de/daf/a01417.html">Slice</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>keys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; *&#160;</td>
          <td class="paramname"><em>values</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a951924bc05418ecee8b162fe19344ed4">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02616">2616</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d4c/a02641_source.html#l00175">rocksdb::DB_MULTIGET</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00390">rocksdb::Options::disable_seek_compaction</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00198">rocksdb::MemTableList::Get()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00416">rocksdb::Version::Get()</a>, <a class="el" href="../../df/d44/a02586_source.html#l00166">rocksdb::MemTable::Get()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00312">imm_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02478">mem</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00311">mem_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00290">merge_operands</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00087">rocksdb::NUMBER_MULTIGET_BYTES_READ</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00085">rocksdb::NUMBER_MULTIGET_CALLS</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00086">rocksdb::NUMBER_MULTIGET_KEYS_READ</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00280">rocksdb::RecordTick()</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00043">rocksdb::MemTable::Ref()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00591">rocksdb::Version::Ref()</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00025">rocksdb::MemTableList::RefAll()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00663">rocksdb::ReadOptions::snapshot</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00348">rocksdb::Options::statistics</a>, <a class="el" href="../../d6/d50/a02694_source.html#l00667">stats</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00046">rocksdb::MemTable::Unref()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00595">rocksdb::Version::Unref()</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00032">rocksdb::MemTableList::UnrefAll()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00578">rocksdb::Version::UpdateStats()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00288">value</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../d9/de7/a02572_source.html#l04661">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;                                                                   {</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;  StopWatch sw(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aeaefac6b92fcba922246c5d2b05aebcdce">DB_MULTIGET</a>);</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> snapshot;</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;  <span class="keywordflow">if</span> (options.snapshot != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;    snapshot = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>SnapshotImpl*<span class="keyword">&gt;</span>(options.snapshot)-&gt;number_;</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    snapshot = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LastSequence();</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;  }</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  MemTable* <a class="code" href="../../db/d44/a02564.html#a0d98018e8146e811f356fa860a9839a0">mem</a> = <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;  MemTableList imm = <a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>;</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  Version* current = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current();</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;  mem-&gt;Ref();</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;  imm.RefAll();</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;  current-&gt;Ref();</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;  <span class="comment">// Unlock while reading from files and memtables</span></div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;  <span class="keywordtype">bool</span> have_stat_update = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;  Version::GetStats <a class="code" href="../../d6/d50/a02694.html#a5925d216740c89f43482df806fd14e8c">stats</a>;</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;  <span class="comment">// Prepare to store a list of merge operations if merge occurs.</span></div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;  std::deque&lt;std::string&gt; <a class="code" href="../../d6/dfc/a02612.html#a58dbba3da34434571a4e9e6c7ab6a4c7">merge_operands</a>;</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;  <span class="comment">// Note: this always resizes the values array</span></div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;  <span class="keywordtype">int</span> numKeys = keys.size();</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;  std::vector&lt;Status&gt; statList(numKeys);</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;  values-&gt;resize(numKeys);</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;  <span class="comment">// Keep track of bytes that we read for statistics-recording later</span></div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> bytesRead = 0;</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;  <span class="comment">// For each of the given keys, apply the entire &quot;get&quot; process as follows:</span></div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;  <span class="comment">// First look in the memtable, then in the immutable memtable (if any).</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;  <span class="comment">// s is both in/out. When in, s could either be OK or MergeInProgress.</span></div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;  <span class="comment">// merge_operands will contain the sequence of merges in the latter case.</span></div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numKeys; ++i) {</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    merge_operands.clear();</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a>&amp; s = statList[i];</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    std::string* <a class="code" href="../../d6/dfc/a02612.html#a38c8b88c432e666ad10b0c5573e1160a">value</a> = &amp;(*values)[i];</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;    LookupKey lkey(keys[i], snapshot);</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;    <span class="keywordflow">if</span> (mem-&gt;Get(lkey, value, &amp;s, &amp;merge_operands, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>)) {</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;      <span class="comment">// Done</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (imm.Get(lkey, value, &amp;s, &amp;merge_operands, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>)) {</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;      <span class="comment">// Done</span></div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;      current-&gt;Get(options, lkey, value, &amp;s, &amp;merge_operands, &amp;stats, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>);</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;      have_stat_update = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    }</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;    <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;      bytesRead += value-&gt;size();</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;    }</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;  }</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;  <span class="comment">// Post processing (decrement reference counts and record statistics)</span></div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#abc2f2cbdf6ef20e4a45b876f9f5fc075">disable_seek_compaction</a> &amp;&amp;</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;      have_stat_update &amp;&amp; current-&gt;UpdateStats(stats)) {</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a">MaybeScheduleFlushOrCompaction</a>();</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;  }</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;  mem-&gt;Unref();</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;  imm.UnrefAll();</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;  current-&gt;Unref();</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29daba7bdf4036a1781702a5cd7ac8a5b566">NUMBER_MULTIGET_CALLS</a>);</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29da7d1850fe5d3d27ab21b933b8c024ce4d">NUMBER_MULTIGET_KEYS_READ</a>, numKeys);</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29daef6da24f9a0532e7c85eafad72784d50">NUMBER_MULTIGET_BYTES_READ</a>, bytesRead);</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;  <span class="keywordflow">return</span> statList;</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a19d8fbac12db943503c6a28d35c44e44_cgraph.png" border="0" usemap="#dd/df5/a00386_a19d8fbac12db943503c6a28d35c44e44_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a19d8fbac12db943503c6a28d35c44e44_cgraph" id="dd/df5/a00386_a19d8fbac12db943503c6a28d35c44e44_cgraph">
<area shape="rect" id="node3" href="../../d7/dd4/a00968.html#a54372487e94967337831daf139814d96" title="rocksdb::MemTableList::Get" alt="" coords="249,11,436,40"/><area shape="rect" id="node5" href="../../d4/dd1/a01797.html#ac25d8c130a1d695a0047111eb9195214" title="rocksdb::Version::Get" alt="" coords="268,743,417,772"/><area shape="rect" id="node13" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="835,1181,971,1211"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="832,5,973,35"/><area shape="rect" id="node61" href="../../d3/dcd/a00965.html#a3b8151ce08ccef4707172fc89b74fa15" title="rocksdb::MemTable::Get" alt="" coords="543,300,708,329"/><area shape="rect" id="node87" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="272,1275,413,1322"/><area shape="rect" id="node91" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="279,1415,407,1444"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="232,1467,453,1514"/><area shape="rect" id="node107" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="260,1537,425,1567"/><area shape="rect" id="node109" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="268,1591,417,1620"/><area shape="rect" id="node111" href="../../d7/dd4/a00968.html#a648b3af66b2d983e5ae3449b77279543" title="rocksdb::MemTableList\l::RefAll" alt="" coords="264,1643,421,1690"/><area shape="rect" id="node113" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="272,1345,413,1391"/><area shape="rect" id="node116" href="../../d3/dcd/a00965.html#a35a338dd8c1096c850b1bdd3969aeee4" title="rocksdb::MemTable::\lUnref" alt="" coords="271,1713,415,1759"/><area shape="rect" id="node118" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="263,1783,423,1812"/><area shape="rect" id="node120" href="../../d7/dd4/a00968.html#a2422dd76d6ba8c9b961eb4666ab8695f" title="rocksdb::MemTableList\l::UnrefAll" alt="" coords="264,1835,421,1882"/><area shape="rect" id="node122" href="../../d4/dd1/a01797.html#a4a5cae829de750c2e3f2c587a16d4dba" title="rocksdb::Version::Update\lStats" alt="" coords="257,1905,428,1951"/><area shape="rect" id="node7" href="../../dd/d7a/a00921.html#aaa7837819393f54c0380f273d81230ff" title="rocksdb::LookupKey\l::internal_key" alt="" coords="555,598,696,645"/><area shape="rect" id="node9" href="../../dd/d7a/a00921.html#a2d6ce1ea4572d9a9f5034b5309f350c6" title="rocksdb::LookupKey\l::user_key" alt="" coords="832,898,973,945"/><area shape="rect" id="node11" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="797,967,1008,1014"/><area shape="rect" id="node15" href="../../d0/db9/a01552.html#adf9c2b80d52e927e63ca2bd97bf42f9a" title="rocksdb::Status::IsMerge\lInProgress" alt="" coords="819,722,987,769"/><area shape="rect" id="node17" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="556,353,695,399"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a382fc0a9bad90fe4253c354dd309f083" title="rocksdb::FindFile" alt="" coords="564,423,687,452"/><area shape="rect" id="node21" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="831,533,975,579"/><area shape="rect" id="node23" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="555,475,696,522"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#a9ec2949993edef94ca7b7b0b2b5ec514" title="rocksdb::NewestFirstBySeqNo" alt="" coords="524,545,727,575"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#a3cbc76c77ed89c8aeda2da9cfc2fe387" title="rocksdb::NewestFirst" alt="" coords="552,871,699,900"/><area shape="rect" id="node29" href="../../d0/d72/a00724.html#a5a44464365280d5c9649746930e1aee8" title="rocksdb::InternalKeyComparator\l::Compare" alt="" coords="520,230,731,277"/><area shape="rect" id="node38" href="../../de/df9/a01624.html#aba951faee1e4e9224bc2c668c9ea01c3" title="rocksdb::TableCache::Get" alt="" coords="539,1129,712,1159"/><area shape="rect" id="node41" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="832,1037,973,1067"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#a1e88bee60ffea3814f6c0a8da82c3f53" title="rocksdb::SaveValue" alt="" coords="556,165,695,195"/><area shape="rect" id="node53" href="../../d4/d87/a03436.html#a05612b66eb40fce6e2d86f6e5d354e16" title="rocksdb::MarkKeyMayExist" alt="" coords="535,975,716,1004"/><area shape="rect" id="node55" href="../../d0/db9/a01552.html#a415510a7cc15542538c80c790d2bb4af" title="rocksdb::Status::NotFound" alt="" coords="813,792,992,821"/><area shape="rect" id="node57" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="812,845,993,875"/><area shape="rect" id="node32" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="820,272,985,301"/><area shape="rect" id="node34" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="833,219,972,248"/><area shape="rect" id="node36" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="835,59,971,88"/><area shape="rect" id="node49" href="../../d5/d9d/a03343.html#a5e50025bd0ee2702179fa614b832c796" title="beast::asio::swap" alt="" coords="840,165,965,195"/><area shape="rect" id="node51" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="821,112,984,141"/><area shape="rect" id="node63" href="../../dd/d7a/a00921.html#a722151e196da98f851d5be7689dd5df7" title="rocksdb::LookupKey\l::memtable_key" alt="" coords="832,463,973,510"/><area shape="rect" id="node68" href="../../d4/d87/a03436.html#ad725181422bf6cf312bbea4b0b3c9d8c" title="rocksdb::GetVarint32Ptr" alt="" coords="1056,641,1219,671"/><area shape="rect" id="node73" href="../../d3/dcd/a00965.html#a95d10369e342f47e06bca980f2300514" title="rocksdb::MemTable::\lGetLock" alt="" coords="831,325,975,371"/><area shape="rect" id="node75" href="../../d4/d87/a03436.html#adeae0144b8eaea4c370172d4f6edaf48" title="rocksdb::GetLengthPrefixed\lSlice" alt="" coords="811,602,995,649"/><area shape="rect" id="node85" href="../../d0/db9/a01552.html#ae68d506384bf32b72c7db619eaeb508a" title="rocksdb::Status::MergeIn\lProgress" alt="" coords="819,394,987,441"/><area shape="rect" id="node89" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="539,1292,712,1321"/><area shape="rect" id="node95" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="532,1598,719,1645"/><area shape="rect" id="node97" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="555,1353,696,1399"/><area shape="rect" id="node99" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="501,1423,749,1452"/><area shape="rect" id="node101" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="520,1476,731,1505"/><area shape="rect" id="node103" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="547,1529,704,1575"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a19d8fbac12db943503c6a28d35c44e44_icgraph.png" border="0" usemap="#dd/df5/a00386_a19d8fbac12db943503c6a28d35c44e44_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a19d8fbac12db943503c6a28d35c44e44_icgraph" id="dd/df5/a00386_a19d8fbac12db943503c6a28d35c44e44_icgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="233,5,343,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="adca3cc37d179c0402363d4cae6529d72"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::NewDB </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00363">363</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../dc/d28/a02584_source.html#l00032">rocksdb::log::Writer::AddRecord()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00176">dbname_</a>, <a class="el" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">rocksdb::Env::DeleteFile()</a>, <a class="el" href="../../da/d03/a02577_source.html#l00078">rocksdb::DescriptorFileName()</a>, <a class="el" href="../../df/d40/a02609_source.html#l00049">rocksdb::VersionEdit::EncodeTo()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00516">rocksdb::Options::manifest_preallocation_size</a>, <a class="el" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47">rocksdb::Env::NewWritableFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01279">NumberLevels()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00045">rocksdb::VersionEdit::SetComparatorName()</a>, <a class="el" href="../../da/d03/a02577_source.html#l00233">rocksdb::SetCurrentFile()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00061">rocksdb::VersionEdit::SetLastSequence()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00049">rocksdb::VersionEdit::SetLogNumber()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00057">rocksdb::VersionEdit::SetNextFile()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00451">storage_options_</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00181">user_comparator()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00768">Recover()</a>.</p>
<div class="fragment"><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                     {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  VersionEdit new_db(<a class="code" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880">NumberLevels</a>());</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  new_db.SetComparatorName(<a class="code" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0">user_comparator</a>()-&gt;Name());</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  new_db.SetLogNumber(0);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  new_db.SetNextFile(2);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  new_db.SetLastSequence(0);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keyword">const</span> std::string manifest = <a class="code" href="../../d4/d87/a03436.html#addb687ba13b100fdc18a512b23ba195b">DescriptorFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>, 1);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  unique_ptr&lt;WritableFile&gt; file;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47">NewWritableFile</a>(manifest, &amp;file, <a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  file-&gt;SetPreallocationBlockSize(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a086b5af5118b08030c6bc9a28135da3c">manifest_preallocation_size</a>);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    log::Writer log(std::move(file));</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    std::string record;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    new_db.EncodeTo(&amp;record);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    s = log.AddRecord(record);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  }</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="comment">// Make &quot;CURRENT&quot; file that points to the new manifest file.</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    s = <a class="code" href="../../d4/d87/a03436.html#a387951cc646ab45c3ef918e66797e0d6">SetCurrentFile</a>(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>, 1);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">DeleteFile</a>(manifest);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_adca3cc37d179c0402363d4cae6529d72_cgraph.png" border="0" usemap="#dd/df5/a00386_adca3cc37d179c0402363d4cae6529d72_cgraph" alt=""/></div>
<map name="dd/df5/a00386_adca3cc37d179c0402363d4cae6529d72_cgraph" id="dd/df5/a00386_adca3cc37d179c0402363d4cae6529d72_cgraph">
<area shape="rect" id="node3" href="../../da/d18/a01850.html#a38f817406010aa11b3e9ece52425cae2" title="rocksdb::log::Writer\l::AddRecord" alt="" coords="528,323,664,370"/><area shape="rect" id="node37" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1025,459,1161,488"/><area shape="rect" id="node40" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="1011,936,1176,965"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#addb687ba13b100fdc18a512b23ba195b" title="rocksdb::DescriptorFileName" alt="" coords="500,444,692,473"/><area shape="rect" id="node44" href="../../d2/d86/a01798.html#a6b9fe2d268b89b432b49827445798943" title="rocksdb::VersionEdit\l::EncodeTo" alt="" coords="265,142,407,189"/><area shape="rect" id="node63" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="992,872,1195,901"/><area shape="rect" id="node65" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="231,856,441,885"/><area shape="rect" id="node68" href="../../d2/d86/a01798.html#a314e38c243876ccf58dac6c3b18180e6" title="rocksdb::VersionEdit\l::SetComparatorName" alt="" coords="260,615,412,662"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a387951cc646ab45c3ef918e66797e0d6" title="rocksdb::SetCurrentFile" alt="" coords="256,725,416,755"/><area shape="rect" id="node102" href="../../d2/d86/a01798.html#a576049674a35517dc121fe6e1838b550" title="rocksdb::VersionEdit\l::SetLastSequence" alt="" coords="265,1089,407,1135"/><area shape="rect" id="node104" href="../../d2/d86/a01798.html#a8d557cf30bde88010eff4307cc3d385f" title="rocksdb::VersionEdit\l::SetLogNumber" alt="" coords="265,1158,407,1205"/><area shape="rect" id="node106" href="../../d2/d86/a01798.html#a5eca07307a1eb4123a2b4d3370495d02" title="rocksdb::VersionEdit\l::SetNextFile" alt="" coords="265,1227,407,1274"/><area shape="rect" id="node108" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0" title="rocksdb::DBImpl::user\l_comparator" alt="" coords="260,1297,412,1343"/><area shape="rect" id="node5" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="777,233,916,263"/><area shape="rect" id="node7" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="779,356,915,385"/><area shape="rect" id="node9" href="../../da/d18/a01850.html#aa1a71db57537317c5621593b04750216" title="rocksdb::log::Writer\l::EmitPhysicalRecord" alt="" coords="772,286,921,333"/><area shape="rect" id="node11" href="../../d7/db0/a03467.html#aba0a720f8204028aa9b0f78f969d5f97" title="rocksdb::crc32c::Extend" alt="" coords="1012,241,1175,271"/><area shape="rect" id="node33" href="../../d7/db0/a03467.html#a878557cbe7e1259455691fa1eb7b2743" title="rocksdb::crc32c::Mask" alt="" coords="1016,295,1171,324"/><area shape="rect" id="node35" href="../../d4/d87/a03436.html#aabc7ce45ae48e15b24a6756f9b4fd694" title="rocksdb::EncodeFixed32" alt="" coords="1011,348,1176,377"/><area shape="rect" id="node13" href="../../d7/db0/a03467.html#a174fe9c8cf3cb558b7accfdc10c6c04c" title="rocksdb::crc32c::CRC32" alt="" coords="1244,241,1409,271"/><area shape="rect" id="node15" href="../../d7/db0/a03467.html#aeb8537c518a4a8ac7e1d8f8ac1c6bb63" title="rocksdb::crc32c::Choose\l_CRC32" alt="" coords="1459,233,1627,279"/><area shape="rect" id="node17" href="../../d7/db0/a03467.html#a6abc7c8ed18979f0e12fcfb6460f9285" title="rocksdb::crc32c::isSSE42" alt="" coords="1676,180,1849,209"/><area shape="rect" id="node19" href="../../d7/db0/a03467.html#ab6bf1f9041f7859fe1aae6312f650115" title="rocksdb::crc32c::Fast\l_CRC32" alt="" coords="1688,233,1837,279"/><area shape="rect" id="node27" href="../../d7/db0/a03467.html#aabbb4470a0a8566fff676e40a5c3a491" title="rocksdb::crc32c::Slow\l_CRC32" alt="" coords="1899,293,2051,339"/><area shape="rect" id="node21" href="../../d7/db0/a03467.html#aa5eeccea7be6cc99acab7223cc1c7baf" title="rocksdb::crc32c::LE\l_LOAD64" alt="" coords="1905,223,2044,270"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="2100,235,2265,264"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="2316,267,2481,296"/><area shape="rect" id="node29" href="../../d7/db0/a03467.html#a72b216c9d4dfeeaea89e2410eec06ff9" title="rocksdb::crc32c::LE\l_LOAD32" alt="" coords="2113,289,2252,335"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#afe24fa7da1cd551af92134aa66f96183" title="rocksdb::PutVarint32" alt="" coords="775,180,919,209"/><area shape="rect" id="node50" href="../../d4/d87/a03436.html#af1cdcde94bcaeced42cd5925a5827232" title="rocksdb::PutLengthPrefixed\lSlice" alt="" coords="505,231,687,278"/><area shape="rect" id="node55" href="../../d4/d87/a03436.html#aa7b83a93a0d06b7c3324f7ef95051c21" title="rocksdb::PutVarint64" alt="" coords="524,5,668,35"/><area shape="rect" id="node59" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e" title="beast.util.Iter.first" alt="" coords="535,59,657,88"/><area shape="rect" id="node61" href="../../de/de6/a00723.html#a6d86d2cfbd4205b41f29f84cdedf3c22" title="rocksdb::InternalKey\l::Encode" alt="" coords="525,111,667,158"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a94c48680211f25845f5c35acd4b54ebb" title="rocksdb::EncodeVarint32" alt="" coords="1009,180,1177,209"/><area shape="rect" id="node57" href="../../d4/d87/a03436.html#a04ab81feb839c834d2bf339b687491e0" title="rocksdb::EncodeVarint64" alt="" coords="763,5,931,35"/><area shape="rect" id="node70" href="../../de/daf/a01417.html#ac5faa24d39a613c0ce7965d2bd9cf958" title="rocksdb::Slice::ToString" alt="" coords="515,497,677,527"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a112e8c44dec6475699006a7f68830b1a" title="rocksdb::CurrentFileName" alt="" coords="509,620,683,649"/><area shape="rect" id="node79" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="519,550,673,597"/><area shape="rect" id="node82" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="508,831,684,860"/><area shape="rect" id="node84" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="508,884,684,913"/><area shape="rect" id="node86" href="../../d4/d87/a03436.html#aab2522c126c1764a6be83c9756465d7b" title="rocksdb::TempFileName" alt="" coords="513,673,679,703"/><area shape="rect" id="node91" href="../../d4/d87/a03436.html#ae8468f39019126b0e12d6059ada48e6b" title="rocksdb::WriteStringToFileSync" alt="" coords="493,777,699,807"/><area shape="rect" id="node88" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="765,673,928,703"/><area shape="rect" id="node93" href="../../d4/d87/a03436.html#a5e656fbd23ad07c1be2a1c433e41b6a0" title="rocksdb::DoWriteStringToFile" alt="" coords="749,799,944,828"/><area shape="rect" id="node95" href="../../d9/d75/a01843.html#aa21c4bf5040156fe25e6580495bab7a9" title="rocksdb::WritableFile\l::Append" alt="" coords="1021,797,1165,843"/><area shape="rect" id="node100" href="../../d9/d75/a01843.html#a739dc13d33b6716dce73e44a472ba1dd" title="rocksdb::WritableFile\l::Sync" alt="" coords="1021,727,1165,774"/><area shape="rect" id="node110" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="491,1297,701,1343"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_adca3cc37d179c0402363d4cae6529d72_icgraph.png" border="0" usemap="#dd/df5/a00386_adca3cc37d179c0402363d4cae6529d72_icgraph" alt=""/></div>
<map name="dd/df5/a00386_adca3cc37d179c0402363d4cae6529d72_icgraph" id="dd/df5/a00386_adca3cc37d179c0402363d4cae6529d72_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#afe079cf353957e6c79ed794cbc0bb9fc" title="rocksdb::DBImpl::Recover" alt="" coords="231,645,407,675"/><area shape="rect" id="node5" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="457,645,591,675"/><area shape="rect" id="node7" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="667,21,829,67"/><area shape="rect" id="node13" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="677,121,819,167"/><area shape="rect" id="node19" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="648,205,848,235"/><area shape="rect" id="node21" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="652,259,844,288"/><area shape="rect" id="node33" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="693,323,803,352"/><area shape="rect" id="node35" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="659,376,837,405"/><area shape="rect" id="node39" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="668,429,828,475"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="687,499,809,528"/><area shape="rect" id="node55" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="680,602,816,649"/><area shape="rect" id="node57" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="652,671,844,718"/><area shape="rect" id="node59" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="652,741,844,787"/><area shape="rect" id="node67" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="640,811,856,840"/><area shape="rect" id="node71" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="667,863,829,910"/><area shape="rect" id="node77" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="723,933,773,963"/><area shape="rect" id="node79" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="679,986,817,1033"/><area shape="rect" id="node87" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="659,1055,837,1102"/><area shape="rect" id="node89" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="667,1125,829,1171"/><area shape="rect" id="node95" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="941,619,1107,648"/><area shape="rect" id="node98" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="679,1194,817,1241"/><area shape="rect" id="node100" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="676,1263,820,1310"/><area shape="rect" id="node9" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="943,5,1105,51"/><area shape="rect" id="node11" href="../../d9/d48/a00345.html#a08cff08de4bf7d2a6f51cb498a406f0f" title="rocksdb::CorruptionTest\l::CorruptionTest" alt="" coords="1220,5,1383,51"/><area shape="rect" id="node15" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="937,75,1111,104"/><area shape="rect" id="node17" href="../../d9/d66/a02562.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1276,75,1327,104"/><area shape="rect" id="node23" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="911,127,1137,174"/><area shape="rect" id="node25" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="937,197,1111,227"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="937,250,1111,297"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#a509351e18607a06285412f6654253643" title="rocksdb::DBTest::DBTest" alt="" coords="1215,197,1388,227"/><area shape="rect" id="node31" href="../../db/d95/a00391.html#a3761d111551d33530517a39f38f908d1" title="rocksdb::DBTest::ChangeOptions" alt="" coords="1192,259,1411,288"/><area shape="rect" id="node37" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="999,320,1049,349"/><area shape="rect" id="node41" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="944,373,1104,419"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="921,443,1127,472"/><area shape="rect" id="node49" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="923,495,1125,542"/><area shape="rect" id="node53" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="969,565,1079,595"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#a28f3fa7104cc330d8f573f98682e000b" title="rocksdb::TEST" alt="" coords="1247,443,1356,472"/><area shape="rect" id="node51" href="../../dc/d6a/a02779.html#a1fa3253ca11014c1b01923a1674ff19c" title="main" alt="" coords="1276,561,1327,591"/><area shape="rect" id="node61" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="928,671,1120,718"/><area shape="rect" id="node65" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="928,741,1120,787"/><area shape="rect" id="node63" href="../../d0/dc7/a01402.html#aa4769c7f42641f11d37d9d1a0b381bef" title="rocksdb::SimpleTableDBTest\l::SimpleTableDBTest" alt="" coords="1205,671,1397,718"/><area shape="rect" id="node69" href="../../db/d84/a02686.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="999,811,1049,840"/><area shape="rect" id="node73" href="../../da/dee/a00383.html#a8cdb390521098e2a5f737561e9eb1134" title="rocksdb::DBConstructor\l::DBConstructor" alt="" coords="943,863,1105,910"/><area shape="rect" id="node75" href="../../da/dee/a00383.html#ae9772754567f1b3c0ca7d5285a56ac6d" title="rocksdb::DBConstructor\l::FinishImpl" alt="" coords="943,933,1105,979"/><area shape="rect" id="node81" href="../../d3/daa/a01577.html#af7e726bf27e216787e7c331834ec6075" title="rocksdb::StressTest::Run" alt="" coords="939,1003,1109,1032"/><area shape="rect" id="node85" href="../../d3/daa/a01577.html#aeac9f55bde5a11da0fcc2c88465de0c6" title="rocksdb::StressTest\l::Reopen" alt="" coords="955,1055,1093,1102"/><area shape="rect" id="node83" href="../../d6/d50/a02694.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1276,1003,1327,1032"/><area shape="rect" id="node91" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="905,1125,1143,1171"/><area shape="rect" id="node93" href="../../de/d9d/a00813.html#ab355fd20f7ef62b0cb2e673a6a2d9bec" title="rocksdb::LDBCommand::Run" alt="" coords="927,1195,1121,1224"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4b410d980071bc0ca4fd10b0156c2442"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d2/d02/a00777.html">Iterator</a> * rocksdb::DBImpl::NewInternalIterator </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../da/d3f/a01215.html">ReadOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> *&#160;</td>
          <td class="paramname"><em>latest_snapshot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02499">2499</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d4/d61/a02588_source.html#l00209">rocksdb::MemTableList::GetMemTables()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00312">imm_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00178">internal_comparator_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00311">mem_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../df/d44/a02586_source.html#l00126">rocksdb::MemTable::NewIterator()</a>, <a class="el" href="../../de/db4/a02684_source.html#l00217">rocksdb::NewMergingIterator()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00043">rocksdb::MemTable::Ref()</a>, <a class="el" href="../../df/dad/a02682_source.html#l00031">rocksdb::Iterator::RegisterCleanup()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00451">storage_options_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d0b/a02566_source.html#l00070">rocksdb::DBImplReadOnly::NewIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02714">NewIterator()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02538">TEST_NewInternalIterator()</a>.</p>
<div class="fragment"><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;                                                                       {</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;  IterState* cleanup = <span class="keyword">new</span> IterState;</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;  *latest_snapshot = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LastSequence();</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;  <span class="comment">// Collect together all needed child iterators for mem</span></div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  std::vector&lt;Iterator*&gt; list;</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>-&gt;<a class="code" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5">Ref</a>();</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;  list.push_back(<a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>-&gt;<a class="code" href="../../d3/dcd/a00965.html#a1bf0bce45391c71385c38e7ddc82b5ea">NewIterator</a>(options));</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;  cleanup-&gt;mem.push_back(<a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>);</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;  <span class="comment">// Collect together all needed child iterators for imm_</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;  std::vector&lt;MemTable*&gt; immutables;</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#a8cb81a60498b73bf3044668780e63b75">GetMemTables</a>(&amp;immutables);</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; immutables.size(); i++) {</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;    MemTable* m = immutables[i];</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;    m-&gt;Ref();</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    list.push_back(m-&gt;NewIterator(options));</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    cleanup-&gt;mem.push_back(m);</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;  }</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;  <span class="comment">// Collect iterators for files in L0 - Ln</span></div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current()-&gt;AddIterators(options, <a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>, &amp;list);</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;  Iterator* internal_iter =</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a678cf0fa28a2449c444344ea1feef654">NewMergingIterator</a>(&amp;<a class="code" href="../../dd/df5/a00386.html#aa92d556db5d7f5bc58f2531cd124729d">internal_comparator_</a>, &amp;list[0], list.size());</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current()-&gt;Ref();</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;  cleanup-&gt;mu = &amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>;</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;  cleanup-&gt;db = <span class="keyword">this</span>;</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;  cleanup-&gt;version = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current();</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;  internal_iter-&gt;RegisterCleanup(CleanupIteratorState, cleanup, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  <span class="keywordflow">return</span> internal_iter;</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a4b410d980071bc0ca4fd10b0156c2442_cgraph.png" border="0" usemap="#dd/df5/a00386_a4b410d980071bc0ca4fd10b0156c2442_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a4b410d980071bc0ca4fd10b0156c2442_cgraph" id="dd/df5/a00386_a4b410d980071bc0ca4fd10b0156c2442_cgraph">
<area shape="rect" id="node3" href="../../d7/dd4/a00968.html#a8cb81a60498b73bf3044668780e63b75" title="rocksdb::MemTableList\l::GetMemTables" alt="" coords="271,5,428,51"/><area shape="rect" id="node5" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="279,74,420,121"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="285,144,413,173"/><area shape="rect" id="node11" href="../../d3/dcd/a00965.html#a1bf0bce45391c71385c38e7ddc82b5ea" title="rocksdb::MemTable::\lNewIterator" alt="" coords="277,197,421,243"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a678cf0fa28a2449c444344ea1feef654" title="rocksdb::NewMergingIterator" alt="" coords="255,389,444,419"/><area shape="rect" id="node21" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="267,336,432,365"/><area shape="rect" id="node23" href="../../d2/d02/a00777.html#a668d7cfe0b950c1ee2806a3a3d21bb90" title="rocksdb::Iterator::\lRegisterCleanup" alt="" coords="287,447,412,494"/><area shape="rect" id="node37" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="279,266,420,313"/><area shape="rect" id="node7" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="499,179,672,208"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#abf92c452806fb54068f27e6034878f16" title="rocksdb::NewEmptyIterator" alt="" coords="495,388,676,417"/><area shape="rect" id="node17" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="725,367,867,396"/><area shape="rect" id="node19" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="915,365,1075,395"/><area shape="rect" id="node25" href="../../da/d6b/a02352.html#ae3e0dbf7ac3255e91d16cd24fd2c2b1d" title="Cleanup" alt="" coords="551,467,620,496"/><area shape="rect" id="node27" href="../../da/d6b/a02352.html#ac70ab821a6607b4a1b909582dc37a069" title="sqlite3DbFree" alt="" coords="745,469,847,499"/><area shape="rect" id="node29" href="../../da/d6b/a02352.html#a770fa05ff9717b75e16f4d968a77b897" title="isLookaside" alt="" coords="1145,509,1236,539"/><area shape="rect" id="node31" href="../../da/d6b/a02352.html#acf77da68932b6bc163c5e68547ecc3e7" title="sqlite3_mutex_held" alt="" coords="1124,431,1257,460"/><area shape="rect" id="node33" href="../../da/d6b/a02352.html#aa397e5a8a03495203a0767abf0a71f86" title="sqlite3DbMallocSize" alt="" coords="924,469,1065,499"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a4b410d980071bc0ca4fd10b0156c2442_icgraph.png" border="0" usemap="#dd/df5/a00386_a4b410d980071bc0ca4fd10b0156c2442_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a4b410d980071bc0ca4fd10b0156c2442_icgraph" id="dd/df5/a00386_a4b410d980071bc0ca4fd10b0156c2442_icgraph">
<area shape="rect" id="node3" href="../../db/db9/a00387.html#a11b9bff7fc00d9f55b58d65d07ca7548" title="rocksdb::DBImplReadOnly\l::NewIterator" alt="" coords="263,5,441,51"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#abca482230e9c3c9bab5276e8b932dae5" title="rocksdb::DBImpl::NewIterator" alt="" coords="255,75,449,104"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#ae9769b218862adb599d44cd43b19cd3f" title="rocksdb::DBImpl::TEST\l_NewInternalIterator" alt="" coords="271,127,433,174"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a9bb7866c7c33bc353a4568a149194033" title="rocksdb::TEST" alt="" coords="552,75,661,104"/><area shape="rect" id="node11" href="../../db/d95/a00391.html#ac2a6ca9463f817fd6492f87083ff0562" title="rocksdb::DBTest::AllEntriesFor" alt="" coords="505,132,708,161"/><area shape="rect" id="node13" href="../../dd/dc1/a00721.html#af0961cfce37fc5a8b9d9a10e50073f92" title="rocksdb::InternalDumpCommand\l::DoCommand" alt="" coords="500,185,713,231"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abca482230e9c3c9bab5276e8b932dae5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d2/d02/a00777.html">Iterator</a> * rocksdb::DBImpl::NewIterator </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../da/d3f/a01215.html">ReadOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a4aaff1029d25cb3717189d841746ad54">rocksdb::DB</a>.</p>

<p>Reimplemented in <a class="el" href="../../db/db9/a00387.html#a11b9bff7fc00d9f55b58d65d07ca7548">rocksdb::DBImplReadOnly</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02714">2714</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00176">dbname_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../dc/d81/a02568_source.html#l00470">rocksdb::NewDBIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02499">NewInternalIterator()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00676">rocksdb::ReadOptions::prefix</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00259">rocksdb::Options::prefix_extractor</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00663">rocksdb::ReadOptions::snapshot</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00181">user_comparator()</a>.</p>

<p>Referenced by <a class="el" href="../../d9/de7/a02572_source.html#l01018">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;                                                        {</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> latest_snapshot;</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;  Iterator* iter = <a class="code" href="../../dd/df5/a00386.html#a4b410d980071bc0ca4fd10b0156c2442">NewInternalIterator</a>(options, &amp;latest_snapshot);</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;  iter = <a class="code" href="../../d4/d87/a03436.html#a4a4df41854b1585c66e18cead6a7da82">NewDBIterator</a>(</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;             &amp;<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>, <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>, <a class="code" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0">user_comparator</a>(), iter,</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;             (options.snapshot != <span class="keyword">nullptr</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;              ? reinterpret_cast&lt;const SnapshotImpl*&gt;(options.snapshot)-&gt;number_</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;              : latest_snapshot));</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;  <span class="keywordflow">if</span> (options.prefix) {</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;    <span class="comment">// use extra wrapper to exclude any keys from the results which</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <span class="comment">// don&#39;t begin with the prefix</span></div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;    iter = <span class="keyword">new</span> PrefixFilterIterator(iter, *options.prefix,</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;                                    <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a387ad02190d309635e636f51d0648824">prefix_extractor</a>);</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;  }</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;  <span class="keywordflow">return</span> iter;</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_abca482230e9c3c9bab5276e8b932dae5_cgraph.png" border="0" usemap="#dd/df5/a00386_abca482230e9c3c9bab5276e8b932dae5_cgraph" alt=""/></div>
<map name="dd/df5/a00386_abca482230e9c3c9bab5276e8b932dae5_cgraph" id="dd/df5/a00386_abca482230e9c3c9bab5276e8b932dae5_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a4a4df41854b1585c66e18cead6a7da82" title="rocksdb::NewDBIterator" alt="" coords="269,244,432,273"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a4b410d980071bc0ca4fd10b0156c2442" title="rocksdb::DBImpl::NewInternal\lIterator" alt="" coords="252,297,449,343"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0" title="rocksdb::DBImpl::user\l_comparator" alt="" coords="275,454,427,501"/><area shape="rect" id="node7" href="../../d7/dd4/a00968.html#a8cb81a60498b73bf3044668780e63b75" title="rocksdb::MemTableList\l::GetMemTables" alt="" coords="525,105,683,151"/><area shape="rect" id="node9" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="533,366,675,413"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="540,244,668,273"/><area shape="rect" id="node15" href="../../d3/dcd/a00965.html#a1bf0bce45391c71385c38e7ddc82b5ea" title="rocksdb::MemTable::\lNewIterator" alt="" coords="532,297,676,343"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#a678cf0fa28a2449c444344ea1feef654" title="rocksdb::NewMergingIterator" alt="" coords="509,489,699,519"/><area shape="rect" id="node25" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="521,436,687,465"/><area shape="rect" id="node27" href="../../d2/d02/a00777.html#a668d7cfe0b950c1ee2806a3a3d21bb90" title="rocksdb::Iterator::\lRegisterCleanup" alt="" coords="541,35,667,82"/><area shape="rect" id="node41" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="533,174,675,221"/><area shape="rect" id="node11" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="763,279,936,308"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#abf92c452806fb54068f27e6034878f16" title="rocksdb::NewEmptyIterator" alt="" coords="759,489,940,519"/><area shape="rect" id="node21" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="989,489,1131,519"/><area shape="rect" id="node23" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1179,489,1339,519"/><area shape="rect" id="node29" href="../../da/d6b/a02352.html#ae3e0dbf7ac3255e91d16cd24fd2c2b1d" title="Cleanup" alt="" coords="815,44,884,73"/><area shape="rect" id="node31" href="../../da/d6b/a02352.html#ac70ab821a6607b4a1b909582dc37a069" title="sqlite3DbFree" alt="" coords="1009,44,1111,73"/><area shape="rect" id="node33" href="../../da/d6b/a02352.html#a770fa05ff9717b75e16f4d968a77b897" title="isLookaside" alt="" coords="1409,84,1500,113"/><area shape="rect" id="node35" href="../../da/d6b/a02352.html#acf77da68932b6bc163c5e68547ecc3e7" title="sqlite3_mutex_held" alt="" coords="1388,5,1521,35"/><area shape="rect" id="node37" href="../../da/d6b/a02352.html#aa397e5a8a03495203a0767abf0a71f86" title="sqlite3DbMallocSize" alt="" coords="1188,44,1329,73"/><area shape="rect" id="node46" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="499,542,709,589"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_abca482230e9c3c9bab5276e8b932dae5_icgraph.png" border="0" usemap="#dd/df5/a00386_abca482230e9c3c9bab5276e8b932dae5_icgraph" alt=""/></div>
<map name="dd/df5/a00386_abca482230e9c3c9bab5276e8b932dae5_icgraph" id="dd/df5/a00386_abca482230e9c3c9bab5276e8b932dae5_icgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a9bb7866c7c33bc353a4568a149194033" title="rocksdb::TEST" alt="" coords="252,5,361,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aaecfe0733c5634343143bf3e9f705880"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rocksdb::DBImpl::NumberLevels </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a52fabdea6213b3743ad7c5a30b3ff1c5">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01279">1279</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d2/de3/a02637_source.html#l00268">rocksdb::Options::num_levels</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01184">CompactRange()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03355">DeleteFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00363">NewDB()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>, <a class="el" href="../../db/d0b/a02566_source.html#l00081">rocksdb::DB::OpenForReadOnly()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00874">RecoverLogFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01223">ReFitLevel()</a>, and <a class="el" href="../../d1/d67/a02561_source.html#l00321">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                         {</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a4eae6dfafa0a0574fba2d8a3209122c4">num_levels</a>;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aaecfe0733c5634343143bf3e9f705880_icgraph.png" border="0" usemap="#dd/df5/a00386_aaecfe0733c5634343143bf3e9f705880_icgraph" alt=""/></div>
<map name="dd/df5/a00386_aaecfe0733c5634343143bf3e9f705880_icgraph" id="dd/df5/a00386_aaecfe0733c5634343143bf3e9f705880_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="532,81,713,127"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="273,300,460,329"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#ae57d4ca72d8c220fe8a384531433e585" title="rocksdb::DBImpl::GetProperty" alt="" coords="268,241,465,271"/><area shape="rect" id="node29" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="269,374,464,421"/><area shape="rect" id="node37" href="../../dd/df5/a00386.html#adca3cc37d179c0402363d4cae6529d72" title="rocksdb::DBImpl::NewDB" alt="" coords="280,513,453,543"/><area shape="rect" id="node41" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="820,649,953,679"/><area shape="rect" id="node96" href="../../d8/ddd/a00380.html#a2c34ae639e95ce237f939d185a09c04b" title="rocksdb::DB::OpenForReadOnly" alt="" coords="781,1221,992,1251"/><area shape="rect" id="node101" href="../../dd/df5/a00386.html#adb8cf2e0f98f8368db32bea16bcf3cb7" title="rocksdb::DBImpl::Recover\lLogFile" alt="" coords="279,443,455,490"/><area shape="rect" id="node104" href="../../dd/df5/a00386.html#a889fc527654cd063029f570c18173834" title="rocksdb::DBImpl::ReFitLevel" alt="" coords="272,177,461,207"/><area shape="rect" id="node107" href="../../d4/d87/a03436.html#a0e71e2ebffd8a4841a05d0f8c1d770c1" title="rocksdb::TEST" alt="" coords="312,668,421,697"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="808,89,965,119"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="832,36,941,65"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="1096,5,1205,35"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="516,219,729,266"/><area shape="rect" id="node22" href="../../d4/d87/a03436.html#ad19b60849d205b89e09ff716b7714f69" title="rocksdb::TEST" alt="" coords="568,289,677,319"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="780,275,993,322"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#ad62af2cf23b7a2da72715051e719e5f1" title="rocksdb::DBImpl::TEST\l_PurgeObsoleteteWAL" alt="" coords="805,206,968,253"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1052,58,1249,105"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#a9ca9562b2a7a0a8e0645db22648a2ac5" title="rocksdb::DBImpl::MaybeDump\lStats" alt="" coords="521,150,724,197"/><area shape="rect" id="node31" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="544,393,701,423"/><area shape="rect" id="node33" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="832,432,941,461"/><area shape="rect" id="node35" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="792,362,981,409"/><area shape="rect" id="node39" href="../../dd/df5/a00386.html#afe079cf353957e6c79ed794cbc0bb9fc" title="rocksdb::DBImpl::Recover" alt="" coords="535,513,711,543"/><area shape="rect" id="node43" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1069,1055,1232,1102"/><area shape="rect" id="node47" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1080,1317,1221,1363"/><area shape="rect" id="node51" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1051,1125,1251,1155"/><area shape="rect" id="node53" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1055,128,1247,157"/><area shape="rect" id="node61" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1096,181,1205,211"/><area shape="rect" id="node63" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1061,235,1240,264"/><area shape="rect" id="node67" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1071,287,1231,334"/><area shape="rect" id="node69" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1089,357,1212,387"/><area shape="rect" id="node71" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1083,410,1219,457"/><area shape="rect" id="node73" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1055,479,1247,526"/><area shape="rect" id="node75" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1055,549,1247,595"/><area shape="rect" id="node77" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1043,619,1259,648"/><area shape="rect" id="node79" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1069,671,1232,718"/><area shape="rect" id="node81" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1125,741,1176,771"/><area shape="rect" id="node83" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1081,794,1220,841"/><area shape="rect" id="node85" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1061,863,1240,910"/><area shape="rect" id="node87" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1069,1178,1232,1225"/><area shape="rect" id="node89" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1068,933,1233,963"/><area shape="rect" id="node91" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1081,986,1220,1033"/><area shape="rect" id="node93" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1079,1247,1223,1294"/><area shape="rect" id="node45" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1339,1055,1501,1102"/><area shape="rect" id="node49" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1333,1325,1507,1355"/><area shape="rect" id="node55" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1307,50,1533,97"/><area shape="rect" id="node57" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="1333,120,1507,149"/><area shape="rect" id="node59" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="1333,173,1507,219"/><area shape="rect" id="node65" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1395,243,1445,272"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af9b32f2f68613634aaf0252e1fb143d2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::OpenCompactionOutputFile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d95/a00299.html">CompactionState</a> *&#160;</td>
          <td class="paramname"><em>compact</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01908">1908</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l00091">rocksdb::DBImpl::CompactionState::allocated_file_numbers</a>, <a class="el" href="../../db/d44/a02564_source.html#l00095">rocksdb::DBImpl::CompactionState::builder</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00148">rocksdb::InternalKey::Clear()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00075">rocksdb::DBImpl::CompactionState::compaction</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00176">dbname_</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00566">rocksdb::Compaction::enable_compression()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00205">rocksdb::GetCompressionType()</a>, <a class="el" href="../../dd/d98/a02557_source.html#l00029">rocksdb::GetTableBuilder()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../db/d44/a02564_source.html#l00087">rocksdb::DBImpl::CompactionState::Output::largest</a>, <a class="el" href="../../db/d44/a02564_source.html#l00088">rocksdb::DBImpl::CompactionState::Output::largest_seqno</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47">rocksdb::Env::NewWritableFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00085">rocksdb::DBImpl::CompactionState::Output::number</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00094">rocksdb::DBImpl::CompactionState::outfile</a>, <a class="el" href="../../db/d6a/a02613_source.html#l00550">rocksdb::Compaction::output_level()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00090">rocksdb::DBImpl::CompactionState::outputs</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00326">pending_outputs_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00087">rocksdb::DBImpl::CompactionState::Output::smallest</a>, <a class="el" href="../../db/d44/a02564_source.html#l00088">rocksdb::DBImpl::CompactionState::Output::smallest_seqno</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00451">storage_options_</a>, <a class="el" href="../../da/d03/a02577_source.html#l00073">rocksdb::TableFileName()</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>.</p>
<div class="fragment"><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                                                                {</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;  assert(compact != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  assert(compact-&gt;builder == <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> file_number;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  <span class="comment">// If we have not yet exhausted the pre-allocated file numbers,</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;  <span class="comment">// then use the one from the front. Otherwise, we have to acquire</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;  <span class="comment">// the heavyweight lock and allocate a new file number.</span></div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  <span class="keywordflow">if</span> (!compact-&gt;allocated_file_numbers.empty()) {</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;    file_number = compact-&gt;allocated_file_numbers.front();</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    compact-&gt;allocated_file_numbers.pop_front();</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    file_number = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NewFileNumber();</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a1a62212922480c1ca92b25a555b3410e">pending_outputs_</a>.insert(file_number);</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  }</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;  CompactionState::Output out;</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;  out.number = file_number;</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;  out.smallest.Clear();</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;  out.largest.Clear();</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;  out.smallest_seqno = out.largest_seqno = 0;</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  compact-&gt;outputs.push_back(out);</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;  <span class="comment">// Make the output file</span></div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;  std::string fname = <a class="code" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a">TableFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>, file_number);</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47">NewWritableFile</a>(fname, &amp;compact-&gt;outfile, <a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>);</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <span class="comment">// Over-estimate slightly so we don&#39;t end up just barely crossing</span></div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    <span class="comment">// the threshold.</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    compact-&gt;outfile-&gt;SetPreallocationBlockSize(</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      1.1 * <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;MaxFileSizeForLevel(compact-&gt;compaction-&gt;output_level()));</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a8c3484ddfcf7ef9be3a93db6d37a997f">CompressionType</a> compression_type = <a class="code" href="../../d4/d87/a03436.html#a598f3fcda600219521f15efd7eab64ce">GetCompressionType</a>(</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>, compact-&gt;compaction-&gt;output_level(),</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        compact-&gt;compaction-&gt;enable_compression());</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    compact-&gt;builder.reset(</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#ae570859de3fcc573a6f3d6f42bbd6627">GetTableBuilder</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>, compact-&gt;outfile.get(), compression_type));</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;  }</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_af9b32f2f68613634aaf0252e1fb143d2_cgraph.png" border="0" usemap="#dd/df5/a00386_af9b32f2f68613634aaf0252e1fb143d2_cgraph" alt=""/></div>
<map name="dd/df5/a00386_af9b32f2f68613634aaf0252e1fb143d2_cgraph" id="dd/df5/a00386_af9b32f2f68613634aaf0252e1fb143d2_cgraph">
<area shape="rect" id="node3" href="../../de/de6/a00723.html#af2bf0f2689f28795fc9d0533b6f04acf" title="rocksdb::InternalKey\l::Clear" alt="" coords="313,5,455,51"/><area shape="rect" id="node5" href="../../d9/d5e/a00295.html#ab5d7edf951beec5584614cc52e362232" title="rocksdb::Compaction\l::enable_compression" alt="" coords="309,74,459,121"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a598f3fcda600219521f15efd7eab64ce" title="rocksdb::GetCompressionType" alt="" coords="283,144,485,173"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#ae570859de3fcc573a6f3d6f42bbd6627" title="rocksdb::GetTableBuilder" alt="" coords="300,197,468,227"/><area shape="rect" id="node15" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="313,250,455,297"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="320,320,448,349"/><area shape="rect" id="node21" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="283,373,485,403"/><area shape="rect" id="node23" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="316,427,452,456"/><area shape="rect" id="node25" href="../../d9/d5e/a00295.html#abfdd0bc6e7a457377c45f15c89be37e7" title="rocksdb::Compaction\l::output_level" alt="" coords="311,479,457,526"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="303,619,465,648"/><area shape="rect" id="node31" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="313,549,455,595"/><area shape="rect" id="node9" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="579,117,664,147"/><area shape="rect" id="node11" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="580,171,663,200"/><area shape="rect" id="node17" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="535,408,708,437"/><area shape="rect" id="node29" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="540,619,703,648"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_af9b32f2f68613634aaf0252e1fb143d2_icgraph.png" border="0" usemap="#dd/df5/a00386_af9b32f2f68613634aaf0252e1fb143d2_icgraph" alt=""/></div>
<map name="dd/df5/a00386_af9b32f2f68613634aaf0252e1fb143d2_icgraph" id="dd/df5/a00386_af9b32f2f68613634aaf0252e1fb143d2_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="284,799,529,828"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="579,790,776,837"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="824,759,1021,806"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1069,776,1317,805"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1365,767,1587,814"/><area shape="rect" id="node14" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1635,5,1832,51"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1647,125,1820,155"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1636,982,1831,1029"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1645,1332,1821,1361"/><area shape="rect" id="node48" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1667,776,1800,805"/><area shape="rect" id="node99" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1652,1538,1815,1585"/><area shape="rect" id="node16" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1883,13,2093,43"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1913,120,2063,149"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1885,67,2091,96"/><area shape="rect" id="node24" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2175,147,2340,176"/><area shape="rect" id="node26" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2207,200,2308,229"/><area shape="rect" id="node28" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2155,392,2360,421"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2203,93,2312,123"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="2203,40,2312,69"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1909,1432,2067,1461"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="2203,1463,2312,1492"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="2163,1393,2352,1439"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1933,1485,2043,1515"/><area shape="rect" id="node50" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1907,610,2069,657"/><area shape="rect" id="node54" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1917,679,2059,726"/><area shape="rect" id="node58" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1888,749,2088,779"/><area shape="rect" id="node60" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1892,803,2084,832"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1933,925,2043,955"/><area shape="rect" id="node68" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1899,979,2077,1008"/><area shape="rect" id="node70" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1908,1031,2068,1078"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1927,557,2049,587"/><area shape="rect" id="node75" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1920,1101,2056,1147"/><area shape="rect" id="node77" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1892,1170,2084,1217"/><area shape="rect" id="node79" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1892,1239,2084,1286"/><area shape="rect" id="node81" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1880,1309,2096,1339"/><area shape="rect" id="node83" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1907,1362,2069,1409"/><area shape="rect" id="node85" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1963,173,2013,203"/><area shape="rect" id="node87" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1919,226,2057,273"/><area shape="rect" id="node89" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1899,295,2077,342"/><area shape="rect" id="node91" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1907,365,2069,411"/><area shape="rect" id="node93" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1905,435,2071,464"/><area shape="rect" id="node95" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1919,487,2057,534"/><area shape="rect" id="node97" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1916,855,2060,902"/><area shape="rect" id="node52" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2176,610,2339,657"/><area shape="rect" id="node56" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2171,688,2344,717"/><area shape="rect" id="node62" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="2144,767,2371,814"/><area shape="rect" id="node64" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="2171,837,2344,867"/><area shape="rect" id="node101" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1933,1608,2043,1637"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1897,1538,2079,1585"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7de98af70f00c70c1b81bedd7fc02716"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../dd/df5/a00386.html">DBImpl</a> &amp;&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aa52b644196bb47c051055a7a9a827fcd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::PrintStatistics </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00409">409</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d9/d66/a02562_source.html#l00233">dbstats</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00348">rocksdb::Options::statistics</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00418">MaybeDumpStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                             {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keyword">auto</span> <a class="code" href="../../d9/d66/a02562.html#a0c6ea073990cf9110a0e5f37fdf9e59f">dbstats</a> = <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d9/d66/a02562.html#a0c6ea073990cf9110a0e5f37fdf9e59f">dbstats</a>) {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="stringliteral">&quot;STATISTCS:\n %s&quot;</span>,</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <a class="code" href="../../d9/d66/a02562.html#a0c6ea073990cf9110a0e5f37fdf9e59f">dbstats</a>-&gt;ToString().c_str());</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aa52b644196bb47c051055a7a9a827fcd_cgraph.png" border="0" usemap="#dd/df5/a00386_aa52b644196bb47c051055a7a9a827fcd_cgraph" alt=""/></div>
<map name="dd/df5/a00386_aa52b644196bb47c051055a7a9a827fcd_cgraph" id="dd/df5/a00386_aa52b644196bb47c051055a7a9a827fcd_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="265,5,361,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aa52b644196bb47c051055a7a9a827fcd_icgraph.png" border="0" usemap="#dd/df5/a00386_aa52b644196bb47c051055a7a9a827fcd_icgraph" alt=""/></div>
<map name="dd/df5/a00386_aa52b644196bb47c051055a7a9a827fcd_icgraph" id="dd/df5/a00386_aa52b644196bb47c051055a7a9a827fcd_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a9ca9562b2a7a0a8e0645db22648a2ac5" title="rocksdb::DBImpl::MaybeDump\lStats" alt="" coords="264,151,467,198"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="515,151,712,198"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="760,160,1008,189"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1056,203,1277,250"/><area shape="rect" id="node12" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1325,143,1523,190"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1325,5,1523,51"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1337,264,1511,293"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1327,1087,1521,1134"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1336,1468,1512,1497"/><area shape="rect" id="node48" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1357,880,1491,909"/><area shape="rect" id="node99" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1343,74,1505,121"/><area shape="rect" id="node14" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1573,152,1784,181"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1604,259,1753,288"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1576,205,1781,235"/><area shape="rect" id="node24" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="1865,285,2031,315"/><area shape="rect" id="node26" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="1897,339,1999,368"/><area shape="rect" id="node28" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1845,469,2051,499"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="1893,232,2003,261"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="1893,179,2003,208"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1600,1571,1757,1600"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="1893,1601,2003,1631"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="1853,1531,2043,1578"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1624,1624,1733,1653"/><area shape="rect" id="node50" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1597,626,1760,673"/><area shape="rect" id="node54" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1608,695,1749,742"/><area shape="rect" id="node58" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1579,765,1779,795"/><area shape="rect" id="node60" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1583,819,1775,848"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1624,941,1733,971"/><area shape="rect" id="node68" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1589,995,1768,1024"/><area shape="rect" id="node70" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1599,1047,1759,1094"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1617,573,1740,603"/><area shape="rect" id="node75" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1611,1117,1747,1163"/><area shape="rect" id="node77" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1583,1186,1775,1233"/><area shape="rect" id="node79" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1583,1255,1775,1302"/><area shape="rect" id="node81" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1571,1325,1787,1355"/><area shape="rect" id="node83" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1597,1378,1760,1425"/><area shape="rect" id="node85" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1653,1448,1704,1477"/><area shape="rect" id="node87" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1609,1501,1748,1547"/><area shape="rect" id="node89" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1589,311,1768,358"/><area shape="rect" id="node91" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1597,381,1760,427"/><area shape="rect" id="node93" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1596,451,1761,480"/><area shape="rect" id="node95" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1609,503,1748,550"/><area shape="rect" id="node97" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1607,871,1751,918"/><area shape="rect" id="node52" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1867,626,2029,673"/><area shape="rect" id="node56" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1861,704,2035,733"/><area shape="rect" id="node62" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1835,783,2061,830"/><area shape="rect" id="node64" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="1861,853,2035,883"/><area shape="rect" id="node101" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1624,91,1733,120"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1588,21,1769,67"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9b3b0cce1e70a97d4d797ba7d5511dd5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::PurgeObsoleteFiles </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/dea/a00408.html">DeletionState</a> &amp;&#160;</td>
          <td class="paramname"><em>deletion_state</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00511">511</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00137">rocksdb::DBImpl::DeletionState::all_files</a>, <a class="el" href="../../da/d03/a02577_source.html#l00068">rocksdb::ArchivedLogFileName()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00376">rocksdb::Options::db_log_dir</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00176">dbname_</a>, <a class="el" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">rocksdb::Env::DeleteFile()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00029">rocksdb::kCurrentFile</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00026">rocksdb::kDBLockFile</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00028">rocksdb::kDescriptorFile</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00430">rocksdb::Options::keep_log_file_num</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00033">rocksdb::kIdentityFile</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00031">rocksdb::kInfoLogFile</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00025">rocksdb::kLogFile</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00032">rocksdb::kMetaDatabase</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00027">rocksdb::kTableFile</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00030">rocksdb::kTempFile</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00146">rocksdb::DBImpl::DeletionState::log_delete_files</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00150">rocksdb::DBImpl::DeletionState::log_number</a>, <a class="el" href="../../da/d03/a02577_source.html#l00060">rocksdb::LogFileName()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00150">rocksdb::DBImpl::DeletionState::manifest_file_number</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../da/d03/a02577_source.html#l00144">rocksdb::ParseFileName()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00150">rocksdb::DBImpl::DeletionState::prev_log_number</a>, <a class="el" href="../../db/d44/a02564_source.html#l00650">PurgeObsoleteWALFiles()</a>, <a class="el" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8">rocksdb::Env::RenameFile()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00143">rocksdb::DBImpl::DeletionState::sst_delete_files</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00140">rocksdb::DBImpl::DeletionState::sst_live</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00301">table_cache_</a>, <a class="el" href="../../da/d03/a02577_source.html#l00073">rocksdb::TableFileName()</a>, <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00384">rocksdb::Options::wal_dir</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00510">rocksdb::Options::WAL_size_limit_MB</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00509">rocksdb::Options::WAL_ttl_seconds</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01648">BackgroundCallFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03355">DeleteFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00635">DeleteObsoleteFiles()</a>, and <a class="el" href="../../dd/db2/a02563_source.html#l00030">EnableFileDeletions()</a>.</p>
<div class="fragment"><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                                                    {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="comment">// this checks if FindObsoleteFiles() was run before. If not, don&#39;t do</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">// PurgeObsoleteFiles(). If FindObsoleteFiles() was run, we need to also</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="comment">// run PurgeObsoleteFiles(), even if disable_delete_obsolete_files_ is true</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.manifest_file_number == 0) {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> number;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68">FileType</a> type;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  std::vector&lt;std::string&gt; old_log_files;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="comment">// Now, convert live list to an unordered set, WITHOUT mutex held;</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="comment">// set is slow.</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  std::unordered_set&lt;uint64_t&gt; live_set(<a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.sst_live.begin(),</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                        <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.sst_live.end());</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files.reserve(<a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files.size() +</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.sst_delete_files.size());</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> file : <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.sst_delete_files) {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files.push_back(<a class="code" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a">TableFileName</a>(<span class="stringliteral">&quot;&quot;</span>, file-&gt;number).substr(1));</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keyword">delete</span> file;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files.reserve(<a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files.size() +</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.log_delete_files.size());</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> filenum : <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.log_delete_files) {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">if</span> (filenum &gt; 0) {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files.push_back(<a class="code" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477">LogFileName</a>(<span class="stringliteral">&quot;&quot;</span>, filenum).substr(1));</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="comment">// dedup state.all_files so we don&#39;t try to delete the same</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="comment">// file twice</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  sort(<a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files.begin(), <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files.end());</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keyword">auto</span> unique_end = unique(<a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files.begin(), <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files.end());</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files.begin() + i &lt; unique_end; i++) {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc">ParseFileName</a>(<a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files[i], &amp;number, &amp;type)) {</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="keywordtype">bool</span> keep = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      <span class="keywordflow">switch</span> (type) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a68c3486771836efd9dd6d409e9cf28c4">kLogFile</a>:</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;          keep = ((number &gt;= <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.log_number) ||</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                  (number == <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.prev_log_number));</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a711869562f3d369dc16b7701a51e2836">kDescriptorFile</a>:</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;          <span class="comment">// Keep my manifest file, and any newer incarnations&#39;</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;          <span class="comment">// (in case there is a race that allows other incarnations)</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;          keep = (number &gt;= <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.manifest_file_number);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a0caa3668acf3d5e92fafa8761eddb479">kTableFile</a>:</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;          keep = (live_set.find(number) != live_set.end());</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a4b736b8ec7cce5ddab2fc79256e99638">kTempFile</a>:</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;          <span class="comment">// Any temp files that are currently being written to must</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;          <span class="comment">// be recorded in pending_outputs_, which is inserted into &quot;live&quot;</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;          keep = (live_set.find(number) != live_set.end());</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a15d8f97882e0fb9c544925c665c145af">kInfoLogFile</a>:</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;          keep = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          <span class="keywordflow">if</span> (number != 0) {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            old_log_files.push_back(<a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files[i]);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;          }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68ada2f39a032d848b5f9f96c14573a60ca">kCurrentFile</a>:</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a44cf7a52c825c885ac8ae7306cc48a15">kDBLockFile</a>:</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a9db327eea1c2dcdf7f168c54761a76b9">kIdentityFile</a>:</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68abfe55dd7d09c5d969c92755e9cef57aa">kMetaDatabase</a>:</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;          keep = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <span class="keywordflow">if</span> (!keep) {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">if</span> (type == <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a0caa3668acf3d5e92fafa8761eddb479">kTableFile</a>) {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;          <span class="comment">// evict from cache</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;          <a class="code" href="../../dd/df5/a00386.html#a1b44e75ddaf3ea3befcd06b23ca9abb6">table_cache_</a>-&gt;Evict(number);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        std::string fname = ((type == <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a68c3486771836efd9dd6d409e9cf28c4">kLogFile</a>) ? <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a> : <a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>) +</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            <span class="stringliteral">&quot;/&quot;</span> + <a class="code" href="../../d8/d24/a02001.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>.all_files[i];</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            <span class="stringliteral">&quot;Delete type=%d #%lu&quot;</span>,</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            <span class="keywordtype">int</span>(type),</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)number);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> st;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="keywordflow">if</span> (type == <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a68c3486771836efd9dd6d409e9cf28c4">kLogFile</a> &amp;&amp; (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#aa73f5eb95eebb5c22c118839c49e9d6e">WAL_ttl_seconds</a> &gt; 0 ||</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;              <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#abfb13cb9e2920fa97f1de810cf3910a2">WAL_size_limit_MB</a> &gt; 0)) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            st = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8">RenameFile</a>(fname,</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                <a class="code" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6">ArchivedLogFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>, number));</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="keywordflow">if</span> (!st.ok()) {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;              <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                  <span class="stringliteral">&quot;RenameFile logfile #%lu FAILED -- %s\n&quot;</span>,</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                  (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)number, st.ToString().c_str());</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          st = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">DeleteFile</a>(fname);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;          <span class="keywordflow">if</span> (!st.ok()) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Delete type=%d #%lu FAILED -- %s\n&quot;</span>,</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                <span class="keywordtype">int</span>(type), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)number, st.ToString().c_str());</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;          }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="comment">// Delete old info log files.</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="keywordtype">size_t</span> old_log_file_count = old_log_files.size();</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="comment">// NOTE: Currently we only support log purge when options_.db_log_dir is</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="comment">// located in `dbname` directory.</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordflow">if</span> (old_log_file_count &gt;= <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#adc377517f64ada6a20cefe2832d7d4c1">keep_log_file_num</a> &amp;&amp;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acc7b93ff4f6bbdff44f46f3a23d7413a">db_log_dir</a>.empty()) {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    std::sort(old_log_files.begin(), old_log_files.end());</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordtype">size_t</span> end = old_log_file_count - <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#adc377517f64ada6a20cefe2832d7d4c1">keep_log_file_num</a>;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt;= end; i++) {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      std::string&amp; to_delete = old_log_files.at(i);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="comment">// Log(options_.info_log, &quot;Delete type=%d %s\n&quot;,</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="comment">//     int(kInfoLogFile), to_delete.c_str());</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">DeleteFile</a>(<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a> + <span class="stringliteral">&quot;/&quot;</span> + to_delete);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46">PurgeObsoleteWALFiles</a>();</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a9b3b0cce1e70a97d4d797ba7d5511dd5_cgraph.png" border="0" usemap="#dd/df5/a00386_a9b3b0cce1e70a97d4d797ba7d5511dd5_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a9b3b0cce1e70a97d4d797ba7d5511dd5_cgraph" id="dd/df5/a00386_a9b3b0cce1e70a97d4d797ba7d5511dd5_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="1109,1207,1312,1236"/><area shape="rect" id="node7" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="853,59,1019,88"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1680,1272,1776,1301"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1135,1260,1287,1289"/><area shape="rect" id="node14" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="872,5,1000,35"/><area shape="rect" id="node16" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1419,945,1555,975"/><area shape="rect" id="node18" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="853,1367,1019,1396"/><area shape="rect" id="node33" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="271,733,484,779"/><area shape="rect" id="node39" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1643,1656,1813,1685"/><area shape="rect" id="node138" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="289,1929,465,1959"/><area shape="rect" id="node140" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="296,1495,459,1524"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1405,1453,1568,1483"/><area shape="rect" id="node20" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="1097,1572,1324,1601"/><area shape="rect" id="node22" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="1412,1603,1561,1632"/><area shape="rect" id="node24" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="1409,1511,1564,1558"/><area shape="rect" id="node26" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1660,1431,1796,1460"/><area shape="rect" id="node31" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="1123,1367,1299,1396"/><area shape="rect" id="node35" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="557,479,757,508"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158" title="rocksdb::if" alt="" coords="616,639,699,668"/><area shape="rect" id="node49" href="../../d4/d87/a03436.html#a546d3e2e5c3b4aa8ee9828c7b519d501" title="rocksdb::ArchivalDirectory" alt="" coords="569,532,745,561"/><area shape="rect" id="node51" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="1123,636,1299,665"/><area shape="rect" id="node54" href="../../db/db1/a00460.html#a0b7781facd40158245aabf25ce686448" title="rocksdb::Env::GetFileModificationTime" alt="" coords="533,585,781,615"/><area shape="rect" id="node57" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d" title="rocksdb::Env::GetFileSize" alt="" coords="1124,793,1297,823"/><area shape="rect" id="node59" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="615,1035,700,1064"/><area shape="rect" id="node61" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267" title="rocksdb::DBImpl::AppendSorted\lWalsOfType" alt="" coords="552,965,763,1011"/><area shape="rect" id="node112" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="564,360,751,389"/><area shape="rect" id="node41" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1863,1656,2012,1685"/><area shape="rect" id="node45" href="../../da/d71/a00814.html#ab25c6d03dbcd6168b3ae3762dc98fd51" title="rocksdb::LDBCommandExecute\lResult::FAILED" alt="" coords="831,594,1041,641"/><area shape="rect" id="node47" href="../../da/d71/a00814.html#ae4210d600639c8c6ac04486ebc43c39b" title="rocksdb::LDBCommandExecute\lResult::LDBCommandExecuteResult" alt="" coords="1091,566,1331,613"/><area shape="rect" id="node63" href="../../dd/df5/a00386.html#a26b3cfbce68c226c861cfacd4a111fe1" title="rocksdb::DBImpl::CheckWal\lFileExistsAndEmpty" alt="" coords="841,1070,1031,1117"/><area shape="rect" id="node74" href="../../dd/df5/a00386.html#a58d2431c9ec2de7473a8bc2f171c04b8" title="rocksdb::DBImpl::ReadFirst\lRecord" alt="" coords="844,995,1028,1042"/><area shape="rect" id="node108" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="844,1297,1028,1343"/><area shape="rect" id="node77" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8" title="rocksdb::DBImpl::ReadFirstLine" alt="" coords="1107,1153,1315,1183"/><area shape="rect" id="node92" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="1405,999,1568,1028"/><area shape="rect" id="node96" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="1416,412,1557,441"/><area shape="rect" id="node103" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8" title="rocksdb::Status::NotSupported" alt="" coords="1109,689,1312,719"/><area shape="rect" id="node106" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736" title="beast::IP::to_string" alt="" coords="1144,1049,1277,1079"/><area shape="rect" id="node81" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="1379,1160,1595,1189"/><area shape="rect" id="node84" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="1416,1333,1557,1379"/><area shape="rect" id="node88" href="../../d6/d66/a00916.html#ac156dfd78ec3a8dd539224668defc12d" title="rocksdb::LogReporter\l::Corruption" alt="" coords="1413,1263,1560,1310"/><area shape="rect" id="node94" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1648,387,1808,416"/><area shape="rect" id="node110" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1128,1313,1293,1343"/><area shape="rect" id="node114" href="../../d2/d86/a01798.html#a9808f90e0c3ec496be67fc62cac0bd8f" title="rocksdb::VersionEdit\l::DeleteFile" alt="" coords="865,111,1007,158"/><area shape="rect" id="node117" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="833,291,1039,338"/><area shape="rect" id="node126" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba" title="rocksdb::Status::Invalid\lArgument" alt="" coords="1407,227,1567,274"/><area shape="rect" id="node132" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="831,412,1041,441"/><area shape="rect" id="node119" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1140,326,1281,373"/><area shape="rect" id="node122" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="1108,395,1313,442"/><area shape="rect" id="node124" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="1124,273,1297,303"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a9b3b0cce1e70a97d4d797ba7d5511dd5_icgraph.png" border="0" usemap="#dd/df5/a00386_a9b3b0cce1e70a97d4d797ba7d5511dd5_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a9b3b0cce1e70a97d4d797ba7d5511dd5_icgraph" id="dd/df5/a00386_a9b3b0cce1e70a97d4d797ba7d5511dd5_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="269,383,467,430"/><area shape="rect" id="node10" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1080,55,1277,102"/><area shape="rect" id="node93" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="275,577,461,607"/><area shape="rect" id="node102" href="../../dd/df5/a00386.html#a4406b5ed5487f7562bd0fe1696c6092f" title="rocksdb::DBImpl::DeleteObsolete\lFiles" alt="" coords="812,471,1031,518"/><area shape="rect" id="node105" href="../../dd/df5/a00386.html#a2f6c0d55ec4f04c4b5f736f59fa51d4d" title="rocksdb::DBImpl::EnableFile\lDeletions" alt="" coords="273,630,463,677"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="515,368,763,397"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="811,307,1032,354"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1080,421,1277,467"/><area shape="rect" id="node18" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1092,368,1265,397"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1081,125,1276,171"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1091,195,1267,224"/><area shape="rect" id="node24" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1112,580,1245,609"/><area shape="rect" id="node90" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1097,247,1260,294"/><area shape="rect" id="node12" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1328,5,1539,35"/><area shape="rect" id="node26" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1352,250,1515,297"/><area shape="rect" id="node30" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1363,319,1504,366"/><area shape="rect" id="node34" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1333,389,1533,419"/><area shape="rect" id="node36" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1337,443,1529,472"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1379,496,1488,525"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1344,549,1523,579"/><area shape="rect" id="node50" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1353,602,1513,649"/><area shape="rect" id="node54" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1372,672,1495,701"/><area shape="rect" id="node62" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1365,725,1501,771"/><area shape="rect" id="node64" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1337,794,1529,841"/><area shape="rect" id="node66" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1337,863,1529,910"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1325,933,1541,963"/><area shape="rect" id="node74" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1352,986,1515,1033"/><area shape="rect" id="node76" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1408,1056,1459,1085"/><area shape="rect" id="node78" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1364,1109,1503,1155"/><area shape="rect" id="node80" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1344,1178,1523,1225"/><area shape="rect" id="node82" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1352,1247,1515,1294"/><area shape="rect" id="node84" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1351,59,1516,88"/><area shape="rect" id="node86" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1364,111,1503,158"/><area shape="rect" id="node88" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1361,181,1505,227"/><area shape="rect" id="node28" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1621,234,1784,281"/><area shape="rect" id="node32" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1616,304,1789,333"/><area shape="rect" id="node38" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1589,357,1816,403"/><area shape="rect" id="node40" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="1616,427,1789,456"/><area shape="rect" id="node42" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="1616,479,1789,526"/><area shape="rect" id="node48" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1677,549,1728,579"/><area shape="rect" id="node52" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="1623,602,1783,649"/><area shape="rect" id="node56" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1600,672,1805,701"/><area shape="rect" id="node58" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="1601,725,1804,771"/><area shape="rect" id="node60" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="1648,795,1757,824"/><area shape="rect" id="node68" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="1607,855,1799,902"/><area shape="rect" id="node70" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="1607,925,1799,971"/><area shape="rect" id="node95" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="532,535,745,582"/><area shape="rect" id="node100" href="../../d4/d87/a03436.html#ad19b60849d205b89e09ff716b7714f69" title="rocksdb::TEST" alt="" coords="584,605,693,635"/><area shape="rect" id="node98" href="../../dd/df5/a00386.html#ad62af2cf23b7a2da72715051e719e5f1" title="rocksdb::DBImpl::TEST\l_PurgeObsoleteteWAL" alt="" coords="840,541,1003,587"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7c148333899c4965e7f0c90bce0abd46"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::PurgeObsoleteWALFiles </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00650">650</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l01442">AppendSortedWalsOfType()</a>, <a class="el" href="../../da/d03/a02577_source.html#l00065">rocksdb::ArchivalDirectory()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00369">default_interval_to_delete_obsolete_WAL_</a>, <a class="el" href="../../db/d44/a02564_source.html#l03355">DeleteFile()</a>, <a class="el" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">rocksdb::Env::DeleteFile()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6">rocksdb::Env::GetChildren()</a>, <a class="el" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b">rocksdb::Env::GetCurrentTime()</a>, <a class="el" href="../../db/db1/a00460.html#a0b7781facd40158245aabf25ce686448">rocksdb::Env::GetFileModificationTime()</a>, <a class="el" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d">rocksdb::Env::GetFileSize()</a>, <a class="el" href="../../d6/d0b/a02741_source.html#l01359">rocksdb::if()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d2/d80/a02645_source.html#l00027">rocksdb::kArchivedLogFile</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00025">rocksdb::kLogFile</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d5/dd8/a03083_source.html#l00035">ripple::max()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../da/d03/a02577_source.html#l00144">rocksdb::ParseFileName()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00362">purge_wal_files_last_run_</a>, <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00384">rocksdb::Options::wal_dir</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00510">rocksdb::Options::WAL_size_limit_MB</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00509">rocksdb::Options::WAL_ttl_seconds</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00511">PurgeObsoleteFiles()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l01690">TEST_PurgeObsoleteteWAL()</a>.</p>
<div class="fragment"><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                                   {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keywordtype">bool</span> <span class="keyword">const</span> ttl_enabled = <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#aa73f5eb95eebb5c22c118839c49e9d6e">WAL_ttl_seconds</a> &gt; 0;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="keywordtype">bool</span> <span class="keyword">const</span> size_limit_enabled =  <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#abfb13cb9e2920fa97f1de810cf3910a2">WAL_size_limit_MB</a> &gt; 0;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keywordflow">if</span> (!ttl_enabled &amp;&amp; !size_limit_enabled) {</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <a class="code" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> current_time;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b">GetCurrentTime</a>(&amp;current_time);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Can&#39;t get current time: %s&quot;</span>, s.ToString().c_str());</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    assert(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  }</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> <span class="keyword">const</span> now_seconds = <span class="keyword">static_cast&lt;</span><a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a><span class="keyword">&gt;</span>(current_time);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> <span class="keyword">const</span> time_to_check = (ttl_enabled &amp;&amp; !size_limit_enabled) ?</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#aa73f5eb95eebb5c22c118839c49e9d6e">WAL_ttl_seconds</a> / 2 : <a class="code" href="../../dd/df5/a00386.html#ac49af7a9a13d9dc7a31f0d406e44f257">default_interval_to_delete_obsolete_WAL_</a>;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158">if</a> (<a class="code" href="../../dd/df5/a00386.html#aa753be868ff8a4028802e24903106836">purge_wal_files_last_run_</a> + time_to_check &gt; now_seconds) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  }</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#aa753be868ff8a4028802e24903106836">purge_wal_files_last_run_</a> = now_seconds;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  std::string archival_dir = <a class="code" href="../../d4/d87/a03436.html#a546d3e2e5c3b4aa8ee9828c7b519d501">ArchivalDirectory</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  std::vector&lt;std::string&gt; files;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6">GetChildren</a>(archival_dir, &amp;files);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Can&#39;t get archive files: %s&quot;</span>, s.ToString().c_str());</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    assert(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="keywordtype">size_t</span> log_files_num = 0;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> log_file_size = 0;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> : files) {</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> number;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68">FileType</a> type;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc">ParseFileName</a>(<a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a>, &amp;number, &amp;type) &amp;&amp; type == <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a68c3486771836efd9dd6d409e9cf28c4">kLogFile</a>) {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      std::string <span class="keyword">const</span> file_path = archival_dir + <span class="stringliteral">&quot;/&quot;</span> + <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a>;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="keywordflow">if</span> (ttl_enabled) {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> file_m_time;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> <span class="keyword">const</span> s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a0b7781facd40158245aabf25ce686448">GetFileModificationTime</a>(file_path,</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;          &amp;file_m_time);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;          <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Can&#39;t get file mod time: %s: %s&quot;</span>,</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;              file_path.c_str(), s.ToString().c_str());</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="keywordflow">if</span> (now_seconds - file_m_time &gt; <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#aa73f5eb95eebb5c22c118839c49e9d6e">WAL_ttl_seconds</a>) {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;          <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> <span class="keyword">const</span> s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">DeleteFile</a>(file_path);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;          <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Can&#39;t delete file: %s: %s&quot;</span>,</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                file_path.c_str(), s.ToString().c_str());</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;          }</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        }</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="keywordflow">if</span> (size_limit_enabled) {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> file_size;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> <span class="keyword">const</span> s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d">GetFileSize</a>(file_path, &amp;file_size);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;          <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Can&#39;t get file size: %s: %s&quot;</span>,</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;              file_path.c_str(), s.ToString().c_str());</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;          <span class="keywordflow">if</span> (file_size &gt; 0) {</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            log_file_size = <a class="code" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785">std::max</a>(log_file_size, file_size);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            ++log_files_num;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8">DeleteFile</a>(file_path);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;              <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Can&#39;t delete file: %s: %s&quot;</span>,</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                  file_path.c_str(), s.ToString().c_str());</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            }</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;          }</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      }</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    }</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  }</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="keywordflow">if</span> (0 == log_files_num || !size_limit_enabled) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordtype">size_t</span> <span class="keyword">const</span> files_keep_num = <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#abfb13cb9e2920fa97f1de810cf3910a2">WAL_size_limit_MB</a> *</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    1024 * 1024 / log_file_size;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="keywordflow">if</span> (log_files_num &lt;= files_keep_num) {</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keywordtype">size_t</span> files_del_num = log_files_num - files_keep_num;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#aaaf0d0ee1eb6c730ee241e600b26f980">VectorLogPtr</a> archived_logs;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267">AppendSortedWalsOfType</a>(archival_dir, archived_logs, <a class="code" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073daf6ba709136242bfba49ab92faf12d2dd">kArchivedLogFile</a>);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="keywordflow">if</span> (files_del_num &gt; archived_logs.size()) {</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Trying to delete more archived log files than &quot;</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="stringliteral">&quot;exist. Deleting all&quot;</span>);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    files_del_num = archived_logs.size();</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; files_del_num; ++i) {</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    std::string <span class="keyword">const</span> file_path = archived_logs[i]-&gt;PathName();</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> <span class="keyword">const</span> s = <a class="code" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb">DeleteFile</a>(file_path);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Can&#39;t delete file: %s: %s&quot;</span>,</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;          file_path.c_str(), s.ToString().c_str());</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  }</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a7c148333899c4965e7f0c90bce0abd46_cgraph.png" border="0" usemap="#dd/df5/a00386_a7c148333899c4965e7f0c90bce0abd46_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a7c148333899c4965e7f0c90bce0abd46_cgraph" id="dd/df5/a00386_a7c148333899c4965e7f0c90bce0abd46_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267" title="rocksdb::DBImpl::AppendSorted\lWalsOfType" alt="" coords="288,607,499,654"/><area shape="rect" id="node11" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d" title="rocksdb::Env::GetFileSize" alt="" coords="863,93,1036,123"/><area shape="rect" id="node16" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1163,300,1299,329"/><area shape="rect" id="node18" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="861,1235,1037,1264"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="867,1584,1032,1613"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1429,1079,1525,1108"/><area shape="rect" id="node45" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1392,464,1563,493"/><area shape="rect" id="node80" href="../../d4/d87/a03436.html#a546d3e2e5c3b4aa8ee9828c7b519d501" title="rocksdb::ArchivalDirectory" alt="" coords="305,1635,481,1664"/><area shape="rect" id="node82" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="300,1088,487,1117"/><area shape="rect" id="node86" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="867,1480,1032,1509"/><area shape="rect" id="node127" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="293,1688,493,1717"/><area shape="rect" id="node129" href="../../db/db1/a00460.html#a0b7781facd40158245aabf25ce686448" title="rocksdb::Env::GetFileModificationTime" alt="" coords="269,1741,517,1771"/><area shape="rect" id="node132" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158" title="rocksdb::if" alt="" coords="352,1795,435,1824"/><area shape="rect" id="node139" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="351,1848,436,1877"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a26b3cfbce68c226c861cfacd4a111fe1" title="rocksdb::DBImpl::CheckWal\lFileExistsAndEmpty" alt="" coords="579,314,768,361"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="873,765,1025,795"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a58d2431c9ec2de7473a8bc2f171c04b8" title="rocksdb::DBImpl::ReadFirst\lRecord" alt="" coords="581,607,765,654"/><area shape="rect" id="node76" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="581,194,765,241"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="848,712,1051,741"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1149,923,1312,952"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="1117,1661,1344,1691"/><area shape="rect" id="node27" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="1403,1611,1552,1640"/><area shape="rect" id="node29" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="1400,1663,1555,1710"/><area shape="rect" id="node31" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1619,1149,1755,1179"/><area shape="rect" id="node36" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="1143,1507,1319,1536"/><area shape="rect" id="node41" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8" title="rocksdb::DBImpl::ReadFirstLine" alt="" coords="845,557,1053,587"/><area shape="rect" id="node60" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="1149,816,1312,845"/><area shape="rect" id="node64" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="1160,869,1301,899"/><area shape="rect" id="node71" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8" title="rocksdb::Status::NotSupported" alt="" coords="848,1027,1051,1056"/><area shape="rect" id="node74" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736" title="beast::IP::to_string" alt="" coords="883,352,1016,381"/><area shape="rect" id="node49" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="1123,541,1339,571"/><area shape="rect" id="node52" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="1407,615,1548,662"/><area shape="rect" id="node56" href="../../d6/d66/a00916.html#ac156dfd78ec3a8dd539224668defc12d" title="rocksdb::LogReporter\l::Corruption" alt="" coords="1157,645,1304,691"/><area shape="rect" id="node47" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1612,464,1761,493"/><area shape="rect" id="node62" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1397,921,1557,951"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="867,147,1032,176"/><area shape="rect" id="node84" href="../../d2/d86/a01798.html#a9808f90e0c3ec496be67fc62cac0bd8f" title="rocksdb::VersionEdit\l::DeleteFile" alt="" coords="603,1141,744,1187"/><area shape="rect" id="node88" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="571,1311,776,1358"/><area shape="rect" id="node97" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba" title="rocksdb::Status::Invalid\lArgument" alt="" coords="593,866,753,913"/><area shape="rect" id="node101" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="885,1131,1013,1160"/><area shape="rect" id="node104" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="568,1088,779,1117"/><area shape="rect" id="node109" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="567,797,780,843"/><area shape="rect" id="node90" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="879,1410,1020,1457"/><area shape="rect" id="node93" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="847,1287,1052,1334"/><area shape="rect" id="node95" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="863,1357,1036,1387"/><area shape="rect" id="node119" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="861,869,1037,899"/><area shape="rect" id="node121" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="868,923,1031,952"/><area shape="rect" id="node134" href="../../da/d71/a00814.html#ab25c6d03dbcd6168b3ae3762dc98fd51" title="rocksdb::LDBCommandExecute\lResult::FAILED" alt="" coords="568,1786,779,1833"/><area shape="rect" id="node136" href="../../da/d71/a00814.html#ae4210d600639c8c6ac04486ebc43c39b" title="rocksdb::LDBCommandExecute\lResult::LDBCommandExecuteResult" alt="" coords="829,1786,1069,1833"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a7c148333899c4965e7f0c90bce0abd46_icgraph.png" border="0" usemap="#dd/df5/a00386_a7c148333899c4965e7f0c90bce0abd46_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a7c148333899c4965e7f0c90bce0abd46_icgraph" id="dd/df5/a00386_a7c148333899c4965e7f0c90bce0abd46_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="271,1167,484,1214"/><area shape="rect" id="node105" href="../../dd/df5/a00386.html#ad62af2cf23b7a2da72715051e719e5f1" title="rocksdb::DBImpl::TEST\l_PurgeObsoleteteWAL" alt="" coords="296,1303,459,1350"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="533,1198,731,1245"/><area shape="rect" id="node12" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1344,1129,1541,1175"/><area shape="rect" id="node95" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="539,1268,725,1297"/><area shape="rect" id="node100" href="../../dd/df5/a00386.html#a4406b5ed5487f7562bd0fe1696c6092f" title="rocksdb::DBImpl::DeleteObsolete\lFiles" alt="" coords="1076,718,1295,765"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a2f6c0d55ec4f04c4b5f736f59fa51d4d" title="rocksdb::DBImpl::EnableFile\lDeletions" alt="" coords="537,1078,727,1125"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="779,1203,1027,1232"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1075,1241,1296,1287"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1344,1494,1541,1541"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1356,1249,1529,1279"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1345,1302,1540,1349"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1355,1372,1531,1401"/><area shape="rect" id="node26" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1376,661,1509,691"/><area shape="rect" id="node92" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1361,1425,1524,1471"/><area shape="rect" id="node14" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1592,1264,1803,1293"/><area shape="rect" id="node28" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1616,143,1779,190"/><area shape="rect" id="node32" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1627,213,1768,259"/><area shape="rect" id="node36" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1597,283,1797,312"/><area shape="rect" id="node38" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1601,336,1793,365"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1643,389,1752,419"/><area shape="rect" id="node48" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1608,443,1787,472"/><area shape="rect" id="node52" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1617,495,1777,542"/><area shape="rect" id="node56" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1636,565,1759,595"/><area shape="rect" id="node64" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1629,618,1765,665"/><area shape="rect" id="node66" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1601,687,1793,734"/><area shape="rect" id="node68" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1601,757,1793,803"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1589,827,1805,856"/><area shape="rect" id="node76" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1616,879,1779,926"/><area shape="rect" id="node78" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1672,949,1723,979"/><area shape="rect" id="node80" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1628,1002,1767,1049"/><area shape="rect" id="node82" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1608,1071,1787,1118"/><area shape="rect" id="node84" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1616,1141,1779,1187"/><area shape="rect" id="node86" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1615,1211,1780,1240"/><area shape="rect" id="node88" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1628,5,1767,51"/><area shape="rect" id="node90" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1625,74,1769,121"/><area shape="rect" id="node30" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1885,127,2048,174"/><area shape="rect" id="node34" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1880,197,2053,227"/><area shape="rect" id="node40" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1853,250,2080,297"/><area shape="rect" id="node42" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="1880,320,2053,349"/><area shape="rect" id="node44" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="1880,373,2053,419"/><area shape="rect" id="node50" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1941,443,1992,472"/><area shape="rect" id="node54" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="1887,495,2047,542"/><area shape="rect" id="node58" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1864,565,2069,595"/><area shape="rect" id="node60" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="1865,618,2068,665"/><area shape="rect" id="node62" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="1912,688,2021,717"/><area shape="rect" id="node70" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="1871,749,2063,795"/><area shape="rect" id="node72" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="1871,818,2063,865"/><area shape="rect" id="node98" href="../../d4/d87/a03436.html#ad19b60849d205b89e09ff716b7714f69" title="rocksdb::TEST" alt="" coords="848,1361,957,1391"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae3f878f99daf7f0c7cc8146423027b17"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::Put </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../da/d4b/a01848.html">WriteOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> &amp;&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#a981f3dc15e13dd3cf31435ea2608414f">rocksdb::DB</a>.</p>

<p>Reimplemented in <a class="el" href="../../db/db9/a00387.html#a1c1ac49932d75d721c1ef01380fe24ca">rocksdb::DBImplReadOnly</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02742">2742</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l03431">rocksdb::DB::Put()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d8b/a02594_source.html#l00167">rocksdb::ProfileKeyComparison()</a>, <a class="el" href="../../d6/dfc/a02593_source.html#l00080">Counters::set()</a>, and <a class="el" href="../../d1/d67/a02561_source.html#l00268">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;                                                                            {</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d8/ddd/a00380.html#a981f3dc15e13dd3cf31435ea2608414f">DB::Put</a>(o, key, val);</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ae3f878f99daf7f0c7cc8146423027b17_cgraph.png" border="0" usemap="#dd/df5/a00386_ae3f878f99daf7f0c7cc8146423027b17_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ae3f878f99daf7f0c7cc8146423027b17_cgraph" id="dd/df5/a00386_ae3f878f99daf7f0c7cc8146423027b17_cgraph">
<area shape="rect" id="node3" href="../../d8/ddd/a00380.html#a981f3dc15e13dd3cf31435ea2608414f" title="rocksdb::DB::Put" alt="" coords="203,109,325,139"/><area shape="rect" id="node5" href="../../d2/dbd/a01844.html#ade37e4f14b7b0d1471365e5a7d85b678" title="rocksdb::WriteBatch::Put" alt="" coords="375,83,543,112"/><area shape="rect" id="node25" href="../../d8/ddd/a00380.html#ad5d37a09e90d0c22c9a0adca87267ebc" title="rocksdb::DB::Write" alt="" coords="392,136,525,165"/><area shape="rect" id="node7" href="../../da/d8c/a01845.html#a5d61953d919f082c48c4d4aada512004" title="rocksdb::WriteBatchInternal\l::SetCount" alt="" coords="592,5,776,51"/><area shape="rect" id="node11" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="592,74,776,121"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#af1cdcde94bcaeced42cd5925a5827232" title="rocksdb::PutLengthPrefixed\lSlice" alt="" coords="593,158,775,205"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#aabc7ce45ae48e15b24a6756f9b4fd694" title="rocksdb::EncodeFixed32" alt="" coords="825,13,991,43"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="825,75,991,104"/><area shape="rect" id="node17" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="839,128,977,157"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#afe24fa7da1cd551af92134aa66f96183" title="rocksdb::PutVarint32" alt="" coords="836,181,980,211"/><area shape="rect" id="node23" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="840,235,976,264"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a94c48680211f25845f5c35acd4b54ebb" title="rocksdb::EncodeVarint32" alt="" coords="1040,181,1208,211"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ae3f878f99daf7f0c7cc8146423027b17_icgraph.png" border="0" usemap="#dd/df5/a00386_ae3f878f99daf7f0c7cc8146423027b17_icgraph" alt=""/></div>
<map name="dd/df5/a00386_ae3f878f99daf7f0c7cc8146423027b17_icgraph" id="dd/df5/a00386_ae3f878f99daf7f0c7cc8146423027b17_icgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="204,5,409,35"/><area shape="rect" id="node7" href="../../d3/dc9/a00355.html#a5c1ffc329ca7c1e658864da406e0d5f1" title="Counters::set" alt="" coords="256,59,357,88"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="252,112,361,141"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a28f3fa7104cc330d8f573f98682e000b" title="rocksdb::TEST" alt="" coords="460,5,569,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8a0816871126bc130e6e4f3ad8f81da8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::ReadFirstLine </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/dbd/a01844.html">WriteBatch</a> *const&#160;</td>
          <td class="paramname"><em>batch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01387">1387</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d34/a02608_source.html#l00022">rocksdb::LogReporter::Corruption()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00042">rocksdb::Status::Corruption()</a>, <a class="el" href="../../db/d34/a02608_source.html#l00020">rocksdb::LogReporter::env</a>, <a class="el" href="../../df/d5e/a02690_source.html#l00023">env</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/d34/a02608_source.html#l00021">rocksdb::LogReporter::info_log</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00051">rocksdb::Status::IOError()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3">rocksdb::Env::NewSequentialFile()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00036">rocksdb::Status::OK()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00125">rocksdb::Options::paranoid_checks</a>, <a class="el" href="../../d6/dae/a02581_source.html#l00064">rocksdb::log::Reader::ReadRecord()</a>, <a class="el" href="../../d6/dca/a02616_source.html#l00236">rocksdb::WriteBatchInternal::SetContents()</a>, <a class="el" href="../../dd/d75/a02639_source.html#l00049">rocksdb::Slice::size()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00451">storage_options_</a>, and <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01363">ReadFirstRecord()</a>.</p>
<div class="fragment"><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;                                                      {</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <span class="keyword">struct </span>LogReporter : <span class="keyword">public</span> log::Reader::Reporter {</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    Env* <a class="code" href="../../df/d5e/a02690.html#a5cd3f8825058fa594646d13638c40d6d">env</a>;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    Logger* info_log;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* fname;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a>* status;  <span class="comment">// nullptr if options_.paranoid_checks==false</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> Corruption(<span class="keywordtype">size_t</span> bytes, <span class="keyword">const</span> <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a>&amp; s) {</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(info_log, <span class="stringliteral">&quot;%s%s: dropping %d bytes; %s&quot;</span>,</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;          (this-&gt;status == <span class="keyword">nullptr</span> ? <span class="stringliteral">&quot;(ignoring error) &quot;</span> : <span class="stringliteral">&quot;&quot;</span>),</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;          fname, static_cast&lt;int&gt;(bytes), s.ToString().c_str());</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;      <span class="keywordflow">if</span> (this-&gt;status != <span class="keyword">nullptr</span> &amp;&amp; this-&gt;status-&gt;ok()) *this-&gt;status = s;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    }</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  };</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  unique_ptr&lt;SequentialFile&gt; file;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> status = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3">NewSequentialFile</a>(fname, &amp;file, <a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>);</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  }</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  LogReporter reporter;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  reporter.env = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  reporter.info_log = <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>.get();</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  reporter.fname = fname.c_str();</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  reporter.status = (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a3caefadde126ce359200ea7742e3dba7">paranoid_checks</a> ? &amp;status : <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  log::Reader reader(std::move(file), &amp;reporter, <span class="keyword">true</span><span class="comment">/*checksum*/</span>,</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                     0<span class="comment">/*initial_offset*/</span>);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  std::string scratch;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  Slice record;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="keywordflow">if</span> (reader.ReadRecord(&amp;record, &amp;scratch) &amp;&amp; status.ok()) {</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">if</span> (record.size() &lt; 12) {</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      reporter.Corruption(</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;          record.size(), <a class="code" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d">Status::Corruption</a>(<span class="stringliteral">&quot;log record too small&quot;</span>));</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc">Status::IOError</a>(<span class="stringliteral">&quot;Corruption noted&quot;</span>);</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      <span class="comment">//  TODO read record&#39;s till the first no corrupt entry?</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    }</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <a class="code" href="../../da/d8c/a01845.html#a49f498cf63e9c738c4d598398a6f8c9e">WriteBatchInternal::SetContents</a>(batch, record);</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00">Status::OK</a>();</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  }</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc">Status::IOError</a>(<span class="stringliteral">&quot;Error reading from file &quot;</span> + fname);</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a8a0816871126bc130e6e4f3ad8f81da8_cgraph.png" border="0" usemap="#dd/df5/a00386_a8a0816871126bc130e6e4f3ad8f81da8_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a8a0816871126bc130e6e4f3ad8f81da8_cgraph" id="dd/df5/a00386_a8a0816871126bc130e6e4f3ad8f81da8_cgraph">
<area shape="rect" id="node3" href="../../d6/d66/a00916.html#ac156dfd78ec3a8dd539224668defc12d" title="rocksdb::LogReporter\l::Corruption" alt="" coords="299,50,445,97"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="572,29,668,59"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="535,119,705,148"/><area shape="rect" id="node11" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="983,276,1164,305"/><area shape="rect" id="node15" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="992,223,1155,252"/><area shape="rect" id="node19" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="264,275,480,304"/><area shape="rect" id="node21" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="301,171,443,200"/><area shape="rect" id="node24" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="779,396,915,425"/><area shape="rect" id="node26" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="301,499,443,546"/><area shape="rect" id="node33" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1229,831,1365,860"/><area shape="rect" id="node84" href="../../da/d8c/a01845.html#a49f498cf63e9c738c4d598398a6f8c9e" title="rocksdb::WriteBatchInternal\l::SetContents" alt="" coords="528,951,712,998"/><area shape="rect" id="node9" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="772,119,921,148"/><area shape="rect" id="node13" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1217,223,1377,252"/><area shape="rect" id="node28" href="../../d5/d54/a01213.html#acb5bb46275c505b8eab7bceac8affd36" title="rocksdb::log::Reader\l::SkipToInitialBlock" alt="" coords="549,439,691,486"/><area shape="rect" id="node37" href="../../de/daf/a01417.html#a8f740f146e792dc89409f8402a61ad04" title="rocksdb::Slice::clear" alt="" coords="776,500,917,529"/><area shape="rect" id="node40" href="../../d5/d54/a01213.html#a57eb93a86418bd4a2b32ee163aecea5d" title="rocksdb::log::Reader\l::ReadPhysicalRecord" alt="" coords="544,594,696,641"/><area shape="rect" id="node46" href="../../d5/d54/a01213.html#a7db406791cb13477c816733858ea1e51" title="rocksdb::log::Reader\l::ReportCorruption" alt="" coords="776,326,917,373"/><area shape="rect" id="node50" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="777,913,916,943"/><area shape="rect" id="node31" href="../../d5/d54/a01213.html#a49fd67047e3128cc471e7c31c5db6f9c" title="rocksdb::log::Reader\l::ReportDrop" alt="" coords="1003,486,1144,533"/><area shape="rect" id="node35" href="../../d7/d04/a01246.html#a3489a71709b9f8a459daf7761fc8658e" title="rocksdb::log::Reader\l::Reporter::Corruption" alt="" coords="1224,486,1371,533"/><area shape="rect" id="node52" href="../../d7/db0/a03467.html#a8c50508656b8faef53619a2d4097eaf0" title="rocksdb::crc32c::Unmask" alt="" coords="761,759,932,788"/><area shape="rect" id="node54" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="2287,684,2452,713"/><area shape="rect" id="node56" href="../../d7/db0/a03467.html#a90a67ab6517f594a989c6cb4f3ff67f9" title="rocksdb::crc32c::Value" alt="" coords="769,655,924,684"/><area shape="rect" id="node79" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="996,793,1151,839"/><area shape="rect" id="node58" href="../../d7/db0/a03467.html#aba0a720f8204028aa9b0f78f969d5f97" title="rocksdb::crc32c::Extend" alt="" coords="992,655,1155,684"/><area shape="rect" id="node60" href="../../d7/db0/a03467.html#a174fe9c8cf3cb558b7accfdc10c6c04c" title="rocksdb::crc32c::CRC32" alt="" coords="1215,685,1380,715"/><area shape="rect" id="node62" href="../../d7/db0/a03467.html#aeb8537c518a4a8ac7e1d8f8ac1c6bb63" title="rocksdb::crc32c::Choose\l_CRC32" alt="" coords="1429,693,1597,739"/><area shape="rect" id="node64" href="../../d7/db0/a03467.html#a6abc7c8ed18979f0e12fcfb6460f9285" title="rocksdb::crc32c::isSSE42" alt="" coords="1647,655,1820,684"/><area shape="rect" id="node66" href="../../d7/db0/a03467.html#ab6bf1f9041f7859fe1aae6312f650115" title="rocksdb::crc32c::Fast\l_CRC32" alt="" coords="1659,707,1808,754"/><area shape="rect" id="node73" href="../../d7/db0/a03467.html#aabbb4470a0a8566fff676e40a5c3a491" title="rocksdb::crc32c::Slow\l_CRC32" alt="" coords="1869,745,2021,791"/><area shape="rect" id="node68" href="../../d7/db0/a03467.html#aa5eeccea7be6cc99acab7223cc1c7baf" title="rocksdb::crc32c::LE\l_LOAD64" alt="" coords="1876,675,2015,722"/><area shape="rect" id="node70" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="2071,684,2236,713"/><area shape="rect" id="node75" href="../../d7/db0/a03467.html#a72b216c9d4dfeeaea89e2410eec06ff9" title="rocksdb::crc32c::LE\l_LOAD32" alt="" coords="2084,741,2223,787"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a8a0816871126bc130e6e4f3ad8f81da8_icgraph.png" border="0" usemap="#dd/df5/a00386_a8a0816871126bc130e6e4f3ad8f81da8_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a8a0816871126bc130e6e4f3ad8f81da8_icgraph" id="dd/df5/a00386_a8a0816871126bc130e6e4f3ad8f81da8_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a58d2431c9ec2de7473a8bc2f171c04b8" title="rocksdb::DBImpl::ReadFirst\lRecord" alt="" coords="265,834,449,881"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267" title="rocksdb::DBImpl::AppendSorted\lWalsOfType" alt="" coords="499,834,709,881"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#aa24437e34cff2bc2607adf5a382efe80" title="rocksdb::DBImpl::GetSorted\lWalFiles" alt="" coords="772,758,959,805"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="759,938,972,985"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#aefb7a749f364c505a5a6b06d977cbc71" title="rocksdb::DBImpl::GetUpdates\lSince" alt="" coords="1031,758,1228,805"/><area shape="rect" id="node13" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="1075,705,1184,735"/><area shape="rect" id="node11" href="../../db/d95/a00391.html#aa7a0e63b4ab38f47f7e65f92961c6625" title="rocksdb::DBTest::OpenTransaction\lLogIter" alt="" coords="1287,677,1513,723"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="1023,907,1236,954"/><area shape="rect" id="node105" href="../../dd/df5/a00386.html#ad62af2cf23b7a2da72715051e719e5f1" title="rocksdb::DBImpl::TEST\l_PurgeObsoleteteWAL" alt="" coords="1048,1027,1211,1074"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1301,907,1499,954"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2128,1194,2325,1241"/><area shape="rect" id="node95" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="1307,1072,1493,1101"/><area shape="rect" id="node100" href="../../dd/df5/a00386.html#a4406b5ed5487f7562bd0fe1696c6092f" title="rocksdb::DBImpl::DeleteObsolete\lFiles" alt="" coords="1860,703,2079,750"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a2f6c0d55ec4f04c4b5f736f59fa51d4d" title="rocksdb::DBImpl::EnableFile\lDeletions" alt="" coords="1305,746,1495,793"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1563,968,1811,997"/><area shape="rect" id="node23" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1859,951,2080,998"/><area shape="rect" id="node31" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="2128,829,2325,875"/><area shape="rect" id="node34" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="2140,1072,2313,1101"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="2129,1125,2324,1171"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="2139,899,2315,928"/><area shape="rect" id="node40" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2160,649,2293,679"/><area shape="rect" id="node92" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="2145,951,2308,998"/><area shape="rect" id="node28" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2376,1264,2587,1293"/><area shape="rect" id="node42" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2400,197,2563,243"/><area shape="rect" id="node46" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2411,266,2552,313"/><area shape="rect" id="node50" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2381,336,2581,365"/><area shape="rect" id="node52" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2385,389,2577,419"/><area shape="rect" id="node60" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2427,443,2536,472"/><area shape="rect" id="node62" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2392,496,2571,525"/><area shape="rect" id="node64" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2401,549,2561,595"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2420,619,2543,648"/><area shape="rect" id="node68" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2413,671,2549,718"/><area shape="rect" id="node70" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2385,741,2577,787"/><area shape="rect" id="node72" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2385,810,2577,857"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2373,880,2589,909"/><area shape="rect" id="node76" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2400,933,2563,979"/><area shape="rect" id="node78" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2456,1003,2507,1032"/><area shape="rect" id="node80" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2412,1055,2551,1102"/><area shape="rect" id="node82" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2392,1125,2571,1171"/><area shape="rect" id="node84" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2400,1194,2563,1241"/><area shape="rect" id="node86" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2399,5,2564,35"/><area shape="rect" id="node88" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2412,58,2551,105"/><area shape="rect" id="node90" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2409,127,2553,174"/><area shape="rect" id="node44" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2669,197,2832,243"/><area shape="rect" id="node48" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2664,271,2837,300"/><area shape="rect" id="node54" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="2637,323,2864,370"/><area shape="rect" id="node56" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="2664,393,2837,423"/><area shape="rect" id="node58" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="2664,446,2837,493"/><area shape="rect" id="node98" href="../../d4/d87/a03436.html#ad19b60849d205b89e09ff716b7714f69" title="rocksdb::TEST" alt="" coords="1632,1072,1741,1101"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a58d2431c9ec2de7473a8bc2f171c04b8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::ReadFirstRecord </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073d">WalFileType</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td>
          <td class="paramname"><em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/dbd/a01844.html">WriteBatch</a> *const&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01363">1363</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../da/d03/a02577_source.html#l00068">rocksdb::ArchivedLogFileName()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00051">rocksdb::Status::IOError()</a>, <a class="el" href="../../d2/d80/a02645_source.html#l00030">rocksdb::kAliveLogFile</a>, <a class="el" href="../../d2/d80/a02645_source.html#l00027">rocksdb::kArchivedLogFile</a>, <a class="el" href="../../da/d03/a02577_source.html#l00060">rocksdb::LogFileName()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00045">rocksdb::Status::NotSupported()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00036">rocksdb::Status::OK()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../db/d44/a02564_source.html#l01387">ReadFirstLine()</a>, <a class="el" href="../../d2/dd9/a02046_source.html#l00156">beast::IP::to_string()</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00384">rocksdb::Options::wal_dir</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01442">AppendSortedWalsOfType()</a>.</p>
<div class="fragment"><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                                                         {</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  <span class="keywordflow">if</span> (type == <a class="code" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073da874001c1dff78414c7b1d24534730a22">kAliveLogFile</a>) {</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    std::string fname = <a class="code" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477">LogFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>, number);</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> status = <a class="code" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8">ReadFirstLine</a>(fname, result);</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;      <span class="comment">//  check if the file got moved to archive.</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;      std::string archived_file =</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6">ArchivedLogFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>, number);</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;      <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8">ReadFirstLine</a>(archived_file, result);</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc">Status::IOError</a>(<span class="stringliteral">&quot;Log File has been deleted: &quot;</span> + archived_file);</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      }</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    }</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00">Status::OK</a>();</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="../../d4/d87/a03436.html#adcd0b81dd6f88374232c7cee0202073daf6ba709136242bfba49ab92faf12d2dd">kArchivedLogFile</a>) {</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    std::string fname = <a class="code" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6">ArchivedLogFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>, number);</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> status = <a class="code" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8">ReadFirstLine</a>(fname, result);</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  }</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8">Status::NotSupported</a>(<span class="stringliteral">&quot;File Type Not Known: &quot;</span> + <a class="code" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736">std::to_string</a>(type));</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a58d2431c9ec2de7473a8bc2f171c04b8_cgraph.png" border="0" usemap="#dd/df5/a00386_a58d2431c9ec2de7473a8bc2f171c04b8_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a58d2431c9ec2de7473a8bc2f171c04b8_cgraph" id="dd/df5/a00386_a58d2431c9ec2de7473a8bc2f171c04b8_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="244,5,447,35"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="525,163,688,192"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="269,59,421,88"/><area shape="rect" id="node14" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8" title="rocksdb::Status::NotSupported" alt="" coords="1216,111,1419,140"/><area shape="rect" id="node17" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="536,216,677,245"/><area shape="rect" id="node20" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1013,1121,1149,1151"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8" title="rocksdb::DBImpl::ReadFirstLine" alt="" coords="241,409,449,439"/><area shape="rect" id="node105" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736" title="beast::IP::to_string" alt="" coords="279,1108,412,1137"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="525,32,688,61"/><area shape="rect" id="node9" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1471,189,1631,219"/><area shape="rect" id="node24" href="../../d6/d66/a00916.html#ac156dfd78ec3a8dd539224668defc12d" title="rocksdb::LogReporter\l::Corruption" alt="" coords="533,370,680,417"/><area shape="rect" id="node26" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="807,379,903,408"/><area shape="rect" id="node28" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="769,323,940,352"/><area shape="rect" id="node32" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="1227,268,1408,297"/><area shape="rect" id="node37" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="499,688,715,717"/><area shape="rect" id="node41" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="536,618,677,665"/><area shape="rect" id="node48" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1483,643,1619,672"/><area shape="rect" id="node99" href="../../da/d8c/a01845.html#a49f498cf63e9c738c4d598398a6f8c9e" title="rocksdb::WriteBatchInternal\l::SetContents" alt="" coords="763,482,947,529"/><area shape="rect" id="node30" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1007,323,1156,352"/><area shape="rect" id="node43" href="../../d5/d54/a01213.html#acb5bb46275c505b8eab7bceac8affd36" title="rocksdb::log::Reader\l::SkipToInitialBlock" alt="" coords="784,937,925,983"/><area shape="rect" id="node52" href="../../de/daf/a01417.html#a8f740f146e792dc89409f8402a61ad04" title="rocksdb::Slice::clear" alt="" coords="1011,639,1152,668"/><area shape="rect" id="node55" href="../../d5/d54/a01213.html#a57eb93a86418bd4a2b32ee163aecea5d" title="rocksdb::log::Reader\l::ReadPhysicalRecord" alt="" coords="779,802,931,849"/><area shape="rect" id="node61" href="../../d5/d54/a01213.html#a7db406791cb13477c816733858ea1e51" title="rocksdb::log::Reader\l::ReportCorruption" alt="" coords="1011,691,1152,738"/><area shape="rect" id="node65" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="1012,535,1151,564"/><area shape="rect" id="node46" href="../../d5/d54/a01213.html#a49fd67047e3128cc471e7c31c5db6f9c" title="rocksdb::log::Reader\l::ReportDrop" alt="" coords="1247,879,1388,926"/><area shape="rect" id="node50" href="../../d7/d04/a01246.html#a3489a71709b9f8a459daf7761fc8658e" title="rocksdb::log::Reader\l::Reporter::Corruption" alt="" coords="1477,879,1624,926"/><area shape="rect" id="node67" href="../../d7/db0/a03467.html#a8c50508656b8faef53619a2d4097eaf0" title="rocksdb::crc32c::Unmask" alt="" coords="996,863,1167,892"/><area shape="rect" id="node69" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="2540,1025,2705,1055"/><area shape="rect" id="node71" href="../../d7/db0/a03467.html#a90a67ab6517f594a989c6cb4f3ff67f9" title="rocksdb::crc32c::Value" alt="" coords="1004,1068,1159,1097"/><area shape="rect" id="node94" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="1240,690,1395,737"/><area shape="rect" id="node73" href="../../d7/db0/a03467.html#aba0a720f8204028aa9b0f78f969d5f97" title="rocksdb::crc32c::Extend" alt="" coords="1236,1073,1399,1103"/><area shape="rect" id="node75" href="../../d7/db0/a03467.html#a174fe9c8cf3cb558b7accfdc10c6c04c" title="rocksdb::crc32c::CRC32" alt="" coords="1468,1081,1633,1111"/><area shape="rect" id="node77" href="../../d7/db0/a03467.html#aeb8537c518a4a8ac7e1d8f8ac1c6bb63" title="rocksdb::crc32c::Choose\l_CRC32" alt="" coords="1683,1077,1851,1123"/><area shape="rect" id="node79" href="../../d7/db0/a03467.html#a6abc7c8ed18979f0e12fcfb6460f9285" title="rocksdb::crc32c::isSSE42" alt="" coords="1900,1141,2073,1171"/><area shape="rect" id="node81" href="../../d7/db0/a03467.html#ab6bf1f9041f7859fe1aae6312f650115" title="rocksdb::crc32c::Fast\l_CRC32" alt="" coords="1912,1021,2061,1067"/><area shape="rect" id="node88" href="../../d7/db0/a03467.html#aabbb4470a0a8566fff676e40a5c3a491" title="rocksdb::crc32c::Slow\l_CRC32" alt="" coords="2123,1086,2275,1133"/><area shape="rect" id="node83" href="../../d7/db0/a03467.html#aa5eeccea7be6cc99acab7223cc1c7baf" title="rocksdb::crc32c::LE\l_LOAD64" alt="" coords="2129,1017,2268,1063"/><area shape="rect" id="node85" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="2324,1025,2489,1055"/><area shape="rect" id="node90" href="../../d7/db0/a03467.html#a72b216c9d4dfeeaea89e2410eec06ff9" title="rocksdb::crc32c::LE\l_LOAD32" alt="" coords="2337,1082,2476,1129"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a58d2431c9ec2de7473a8bc2f171c04b8_icgraph.png" border="0" usemap="#dd/df5/a00386_a58d2431c9ec2de7473a8bc2f171c04b8_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a58d2431c9ec2de7473a8bc2f171c04b8_icgraph" id="dd/df5/a00386_a58d2431c9ec2de7473a8bc2f171c04b8_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267" title="rocksdb::DBImpl::AppendSorted\lWalsOfType" alt="" coords="240,834,451,881"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#aa24437e34cff2bc2607adf5a382efe80" title="rocksdb::DBImpl::GetSorted\lWalFiles" alt="" coords="513,758,700,805"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="500,938,713,985"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#aefb7a749f364c505a5a6b06d977cbc71" title="rocksdb::DBImpl::GetUpdates\lSince" alt="" coords="772,758,969,805"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="816,705,925,735"/><area shape="rect" id="node9" href="../../db/d95/a00391.html#aa7a0e63b4ab38f47f7e65f92961c6625" title="rocksdb::DBTest::OpenTransaction\lLogIter" alt="" coords="1028,677,1255,723"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="764,907,977,954"/><area shape="rect" id="node105" href="../../dd/df5/a00386.html#ad62af2cf23b7a2da72715051e719e5f1" title="rocksdb::DBImpl::TEST\l_PurgeObsoleteteWAL" alt="" coords="789,1027,952,1074"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1043,907,1240,954"/><area shape="rect" id="node24" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1869,1194,2067,1241"/><area shape="rect" id="node95" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="1048,1072,1235,1101"/><area shape="rect" id="node100" href="../../dd/df5/a00386.html#a4406b5ed5487f7562bd0fe1696c6092f" title="rocksdb::DBImpl::DeleteObsolete\lFiles" alt="" coords="1601,703,1820,750"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a2f6c0d55ec4f04c4b5f736f59fa51d4d" title="rocksdb::DBImpl::EnableFile\lDeletions" alt="" coords="1047,746,1236,793"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1304,968,1552,997"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1600,951,1821,998"/><area shape="rect" id="node29" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1869,829,2067,875"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1881,1072,2055,1101"/><area shape="rect" id="node34" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1871,1125,2065,1171"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1880,899,2056,928"/><area shape="rect" id="node38" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1901,649,2035,679"/><area shape="rect" id="node92" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1887,951,2049,998"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2117,1264,2328,1293"/><area shape="rect" id="node40" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2141,197,2304,243"/><area shape="rect" id="node44" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2152,266,2293,313"/><area shape="rect" id="node48" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2123,336,2323,365"/><area shape="rect" id="node50" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2127,389,2319,419"/><area shape="rect" id="node58" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2168,443,2277,472"/><area shape="rect" id="node60" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2133,496,2312,525"/><area shape="rect" id="node64" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2143,549,2303,595"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2161,619,2284,648"/><area shape="rect" id="node68" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2155,671,2291,718"/><area shape="rect" id="node70" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2127,741,2319,787"/><area shape="rect" id="node72" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2127,810,2319,857"/><area shape="rect" id="node74" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2115,880,2331,909"/><area shape="rect" id="node76" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2141,933,2304,979"/><area shape="rect" id="node78" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2197,1003,2248,1032"/><area shape="rect" id="node80" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2153,1055,2292,1102"/><area shape="rect" id="node82" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2133,1125,2312,1171"/><area shape="rect" id="node84" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2141,1194,2304,1241"/><area shape="rect" id="node86" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2140,5,2305,35"/><area shape="rect" id="node88" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2153,58,2292,105"/><area shape="rect" id="node90" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2151,127,2295,174"/><area shape="rect" id="node42" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2411,197,2573,243"/><area shape="rect" id="node46" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2405,267,2579,296"/><area shape="rect" id="node52" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="2379,319,2605,366"/><area shape="rect" id="node54" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="2405,389,2579,419"/><area shape="rect" id="node56" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="2405,442,2579,489"/><area shape="rect" id="node62" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2467,512,2517,541"/><area shape="rect" id="node98" href="../../d4/d87/a03436.html#ad19b60849d205b89e09ff716b7714f69" title="rocksdb::TEST" alt="" coords="1373,1072,1483,1101"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afe079cf353957e6c79ed794cbc0bb9fc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::Recover </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d2/d86/a01798.html">VersionEdit</a> *&#160;</td>
          <td class="paramname"><em>edit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/dcd/a00965.html">MemTable</a> *&#160;</td>
          <td class="paramname"><em>external_table</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>error_if_log_file_exist</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00768">768</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00042">rocksdb::Status::Corruption()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00110">rocksdb::Options::create_if_missing</a>, <a class="el" href="../../db/db1/a00460.html#a52a10880d70d77d1dcad9f2fb20ce171">rocksdb::Env::CreateDirIfMissing()</a>, <a class="el" href="../../da/d03/a02577_source.html#l00086">rocksdb::CurrentFileName()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00304">db_lock_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00176">dbname_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00114">rocksdb::Options::error_if_exists</a>, <a class="el" href="../../db/db1/a00460.html#a8b523020a36e640a4820edc5535a8808">rocksdb::Env::FileExists()</a>, <a class="el" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6">rocksdb::Env::GetChildren()</a>, <a class="el" href="../../da/d03/a02577_source.html#l00130">rocksdb::IdentityFileName()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00048">rocksdb::Status::InvalidArgument()</a>, <a class="el" href="../../d9/dfb/a02578_source.html#l00025">rocksdb::kLogFile</a>, <a class="el" href="../../db/db1/a00460.html#a680d05d86580d65e4c1cfe16dd099385">rocksdb::Env::LockFile()</a>, <a class="el" href="../../da/d03/a02577_source.html#l00090">rocksdb::LockFileName()</a>, <a class="el" href="../../de/d94/a02597_source.html#l00097">max_sequence</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../db/d44/a02564_source.html#l00363">NewDB()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../da/d03/a02577_source.html#l00144">rocksdb::ParseFileName()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00874">RecoverLogFile()</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00093">rocksdb::SEQUENCE_NUMBER</a>, <a class="el" href="../../da/d03/a02577_source.html#l00251">rocksdb::SetIdentityFile()</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00290">rocksdb::SetTickerCount()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00348">rocksdb::Options::statistics</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>, and <a class="el" href="../../d2/de3/a02637_source.html#l00384">rocksdb::Options::wal_dir</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>.</p>
<div class="fragment"><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                                  {</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  assert(<a class="code" href="../../dd/df5/a00386.html#a178d9c0a3dc95d6e5e1a0485bdeb8bc9">db_lock_</a> == <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="keywordflow">if</span> (!external_table) {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="comment">// We call CreateDirIfMissing() as the directory may already exist (if we</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="comment">// are reopening a DB), when this happens we don&#39;t want creating the</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="comment">// directory to cause an error. However, we need to check if creating the</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">// directory fails or else we may get an obscure message about the lock</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="comment">// file not existing. One real-world example of this occurring is if</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="comment">// env-&gt;CreateDirIfMissing() doesn&#39;t create intermediate directories, e.g.</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="comment">// when dbname_ is &quot;dir/db&quot; but when &quot;dir&quot; doesn&#39;t exist.</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a52a10880d70d77d1dcad9f2fb20ce171">CreateDirIfMissing</a>(<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a680d05d86580d65e4c1cfe16dd099385">LockFile</a>(<a class="code" href="../../d4/d87/a03436.html#a820e85c65a3dad99ec67d4414c1b8ccb">LockFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>), &amp;<a class="code" href="../../dd/df5/a00386.html#a178d9c0a3dc95d6e5e1a0485bdeb8bc9">db_lock_</a>);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    }</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a8b523020a36e640a4820edc5535a8808">FileExists</a>(<a class="code" href="../../d4/d87/a03436.html#a112e8c44dec6475699006a7f68830b1a">CurrentFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>))) {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a142f086b510037187b86b1f25ccff779">create_if_missing</a>) {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="comment">// TODO: add merge_operator name check</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        s = <a class="code" href="../../dd/df5/a00386.html#adca3cc37d179c0402363d4cae6529d72">NewDB</a>();</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;          <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        }</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba">Status::InvalidArgument</a>(</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>, <span class="stringliteral">&quot;does not exist (create_if_missing is false)&quot;</span>);</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      }</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a2bed073509a0bf46ebd3fa5a047ca88b">error_if_exists</a>) {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba">Status::InvalidArgument</a>(</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>, <span class="stringliteral">&quot;exists (error_if_exists is true)&quot;</span>);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    }</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="comment">// Check for the IDENTITY file and create it if not there</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a8b523020a36e640a4820edc5535a8808">FileExists</a>(<a class="code" href="../../d4/d87/a03436.html#ae569241bbac7237a7c1bdb1d2ebff31e">IdentityFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>))) {</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      s = <a class="code" href="../../d4/d87/a03436.html#a27807ffab7c639e7f7615cd5456efcb1">SetIdentityFile</a>(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  }</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;Recover();</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> <a class="code" href="../../de/d94/a02597.html#a52c1b794512261f530db50c720acb0c4">max_sequence</a>(0);</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="comment">// Recover from all newer log files than the ones named in the</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="comment">// descriptor (new log files may have been added by the previous</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="comment">// incarnation without registering them in the descriptor).</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="comment">// Note that PrevLogNumber() is no longer used, but we pay</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="comment">// attention to it in case we are recovering a database</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="comment">// produced by an older version of rocksdb.</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> min_log = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LogNumber();</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> prev_log = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;PrevLogNumber();</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    std::vector&lt;std::string&gt; filenames;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    s = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6">GetChildren</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>, &amp;filenames);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">if</span> (!s.ok()) {</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    }</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> number;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68">FileType</a> type;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    std::vector&lt;uint64_t&gt; logs;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; filenames.size(); i++) {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc">ParseFileName</a>(filenames[i], &amp;number, &amp;type)</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;          &amp;&amp; type == <a class="code" href="../../d4/d87/a03436.html#aa1b125c515f0b62c868d2f20864c4c68a68c3486771836efd9dd6d409e9cf28c4">kLogFile</a></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;          &amp;&amp; ((number &gt;= min_log) || (number == prev_log))) {</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        logs.push_back(number);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      }</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    }</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordflow">if</span> (logs.size() &gt; 0 &amp;&amp; error_if_log_file_exist) {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d">Status::Corruption</a>(<span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;          <span class="stringliteral">&quot;The db was opened in readonly mode with error_if_log_file_exist&quot;</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;          <span class="stringliteral">&quot;flag but a log file already exists&quot;</span>);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="comment">// Recover in the order in which the logs were generated</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    std::sort(logs.begin(), logs.end());</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; logs.size(); i++) {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      s = <a class="code" href="../../dd/df5/a00386.html#adb8cf2e0f98f8368db32bea16bcf3cb7">RecoverLogFile</a>(logs[i], edit, &amp;<a class="code" href="../../de/d94/a02597.html#a52c1b794512261f530db50c720acb0c4">max_sequence</a>, external_table);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      <span class="comment">// The previous incarnation may not have written any MANIFEST</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      <span class="comment">// records after allocating this log number.  So we manually</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <span class="comment">// update the file number allocation counter in VersionSet.</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;MarkFileNumberUsed(logs[i]);</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    }</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordflow">if</span> (s.ok()) {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LastSequence() &lt; <a class="code" href="../../de/d94/a02597.html#a52c1b794512261f530db50c720acb0c4">max_sequence</a>) {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;SetLastSequence(<a class="code" href="../../de/d94/a02597.html#a52c1b794512261f530db50c720acb0c4">max_sequence</a>);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      }</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a9231fa7580b3932152d6f3bd39907320">SetTickerCount</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29da131963a69c58e95661753c7544e9b07f">SEQUENCE_NUMBER</a>,</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                     <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LastSequence());</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    }</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  }</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_afe079cf353957e6c79ed794cbc0bb9fc_cgraph.png" border="0" usemap="#dd/df5/a00386_afe079cf353957e6c79ed794cbc0bb9fc_cgraph" alt=""/></div>
<map name="dd/df5/a00386_afe079cf353957e6c79ed794cbc0bb9fc_cgraph" id="dd/df5/a00386_afe079cf353957e6c79ed794cbc0bb9fc_cgraph">
<area shape="rect" id="node3" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="759,2331,900,2377"/><area shape="rect" id="node5" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="481,375,663,405"/><area shape="rect" id="node9" href="../../db/db1/a00460.html#a52a10880d70d77d1dcad9f2fb20ce171" title="rocksdb::Env::CreateDirIf\lMissing" alt="" coords="236,1844,407,1891"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a112e8c44dec6475699006a7f68830b1a" title="rocksdb::CurrentFileName" alt="" coords="743,453,916,482"/><area shape="rect" id="node13" href="../../db/db1/a00460.html#a8b523020a36e640a4820edc5535a8808" title="rocksdb::Env::FileExists" alt="" coords="239,1914,404,1943"/><area shape="rect" id="node15" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="233,1967,409,1997"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ae569241bbac7237a7c1bdb1d2ebff31e" title="rocksdb::IdentityFileName" alt="" coords="485,322,659,351"/><area shape="rect" id="node19" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba" title="rocksdb::Status::Invalid\lArgument" alt="" coords="241,257,401,304"/><area shape="rect" id="node22" href="../../db/db1/a00460.html#a680d05d86580d65e4c1cfe16dd099385" title="rocksdb::Env::LockFile" alt="" coords="244,2021,399,2050"/><area shape="rect" id="node24" href="../../d4/d87/a03436.html#a820e85c65a3dad99ec67d4414c1b8ccb" title="rocksdb::LockFileName" alt="" coords="241,2074,401,2103"/><area shape="rect" id="node26" href="../../dd/df5/a00386.html#adca3cc37d179c0402363d4cae6529d72" title="rocksdb::DBImpl::NewDB" alt="" coords="235,985,408,1014"/><area shape="rect" id="node32" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="761,1301,897,1330"/><area shape="rect" id="node67" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="239,143,404,173"/><area shape="rect" id="node78" href="../../dd/df5/a00386.html#adb8cf2e0f98f8368db32bea16bcf3cb7" title="rocksdb::DBImpl::Recover\lLogFile" alt="" coords="233,1724,409,1771"/><area shape="rect" id="node128" href="../../d4/d87/a03436.html#a27807ffab7c639e7f7615cd5456efcb1" title="rocksdb::SetIdentityFile" alt="" coords="241,557,401,586"/><area shape="rect" id="node133" href="../../d4/d87/a03436.html#a9231fa7580b3932152d6f3bd39907320" title="rocksdb::SetTickerCount" alt="" coords="239,2127,404,2157"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="749,307,909,337"/><area shape="rect" id="node28" href="../../da/d18/a01850.html#a38f817406010aa11b3e9ece52425cae2" title="rocksdb::log::Writer\l::AddRecord" alt="" coords="504,1065,640,1112"/><area shape="rect" id="node34" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="747,531,912,561"/><area shape="rect" id="node36" href="../../d4/d87/a03436.html#addb687ba13b100fdc18a512b23ba195b" title="rocksdb::DescriptorFileName" alt="" coords="733,799,925,829"/><area shape="rect" id="node38" href="../../d2/d86/a01798.html#a6b9fe2d268b89b432b49827445798943" title="rocksdb::VersionEdit\l::EncodeTo" alt="" coords="501,684,643,731"/><area shape="rect" id="node40" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="471,754,673,783"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="467,1306,677,1335"/><area shape="rect" id="node45" href="../../d2/d86/a01798.html#a314e38c243876ccf58dac6c3b18180e6" title="rocksdb::VersionEdit\l::SetComparatorName" alt="" coords="496,807,648,853"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#a387951cc646ab45c3ef918e66797e0d6" title="rocksdb::SetCurrentFile" alt="" coords="492,479,652,509"/><area shape="rect" id="node58" href="../../d2/d86/a01798.html#a576049674a35517dc121fe6e1838b550" title="rocksdb::VersionEdit\l::SetLastSequence" alt="" coords="501,876,643,923"/><area shape="rect" id="node60" href="../../d2/d86/a01798.html#a8d557cf30bde88010eff4307cc3d385f" title="rocksdb::VersionEdit\l::SetLogNumber" alt="" coords="501,945,643,992"/><area shape="rect" id="node62" href="../../d2/d86/a01798.html#a5eca07307a1eb4123a2b4d3370495d02" title="rocksdb::VersionEdit\l::SetNextFile" alt="" coords="501,1185,643,1232"/><area shape="rect" id="node64" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0" title="rocksdb::DBImpl::user\l_comparator" alt="" coords="753,1441,905,1488"/><area shape="rect" id="node30" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="975,1555,1111,1585"/><area shape="rect" id="node53" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="752,181,907,228"/><area shape="rect" id="node56" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="741,379,917,409"/><area shape="rect" id="node69" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="459,117,685,146"/><area shape="rect" id="node71" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="755,95,904,125"/><area shape="rect" id="node80" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="781,1649,877,1678"/><area shape="rect" id="node82" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="744,1761,915,1790"/><area shape="rect" id="node85" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="496,1599,648,1629"/><area shape="rect" id="node87" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="464,1653,680,1682"/><area shape="rect" id="node90" href="../../dd/df5/a00386.html#a933c2a47a906fd7bcfdc3bfe77c9ea6e" title="rocksdb::DBImpl::MaybeIgnore\lError" alt="" coords="471,1460,673,1507"/><area shape="rect" id="node95" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="759,1971,900,2017"/><area shape="rect" id="node99" href="../../d6/d66/a00916.html#ac156dfd78ec3a8dd539224668defc12d" title="rocksdb::LogReporter\l::Corruption" alt="" coords="499,1809,645,1856"/><area shape="rect" id="node104" href="../../da/d8c/a01845.html#a49f498cf63e9c738c4d598398a6f8c9e" title="rocksdb::WriteBatchInternal\l::SetContents" alt="" coords="737,2040,921,2087"/><area shape="rect" id="node108" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="489,1706,655,1735"/><area shape="rect" id="node110" href="../../da/d8c/a01845.html#aa10e1abb5f141e75e184bf456a5d65a6" title="rocksdb::WriteBatchInternal\l::InsertInto" alt="" coords="480,2201,664,2248"/><area shape="rect" id="node112" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="737,2156,921,2203"/><area shape="rect" id="node115" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="480,2132,664,2179"/><area shape="rect" id="node117" href="../../d3/dcd/a00965.html#a3232b72cba2586f3d6dbd08d8b4be86d" title="rocksdb::MemTable::\lApproximateMemoryUsage" alt="" coords="483,2271,661,2317"/><area shape="rect" id="node119" href="../../dd/df5/a00386.html#a9408ef3bd3f2ad6fb684bc688737c70b" title="rocksdb::DBImpl::WriteLevel0\lTableForRecovery" alt="" coords="473,1529,671,1576"/><area shape="rect" id="node126" href="../../d3/dcd/a00965.html#a35a338dd8c1096c850b1bdd3969aeee4" title="rocksdb::MemTable::\lUnref" alt="" coords="500,2391,644,2437"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_afe079cf353957e6c79ed794cbc0bb9fc_icgraph.png" border="0" usemap="#dd/df5/a00386_afe079cf353957e6c79ed794cbc0bb9fc_icgraph" alt=""/></div>
<map name="dd/df5/a00386_afe079cf353957e6c79ed794cbc0bb9fc_icgraph" id="dd/df5/a00386_afe079cf353957e6c79ed794cbc0bb9fc_icgraph">
<area shape="rect" id="node3" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="233,645,367,675"/><area shape="rect" id="node5" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="443,21,605,67"/><area shape="rect" id="node11" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="453,121,595,167"/><area shape="rect" id="node17" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="424,205,624,235"/><area shape="rect" id="node19" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="428,259,620,288"/><area shape="rect" id="node31" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="469,323,579,352"/><area shape="rect" id="node33" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="435,376,613,405"/><area shape="rect" id="node37" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="444,429,604,475"/><area shape="rect" id="node41" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="463,499,585,528"/><area shape="rect" id="node53" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="456,602,592,649"/><area shape="rect" id="node55" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="428,671,620,718"/><area shape="rect" id="node57" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="428,741,620,787"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="416,811,632,840"/><area shape="rect" id="node69" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="443,863,605,910"/><area shape="rect" id="node75" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="499,933,549,963"/><area shape="rect" id="node77" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="455,986,593,1033"/><area shape="rect" id="node85" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="435,1055,613,1102"/><area shape="rect" id="node87" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="443,1125,605,1171"/><area shape="rect" id="node95" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="717,619,883,648"/><area shape="rect" id="node98" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="455,1194,593,1241"/><area shape="rect" id="node100" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="452,1263,596,1310"/><area shape="rect" id="node7" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="719,5,881,51"/><area shape="rect" id="node9" href="../../d9/d48/a00345.html#a08cff08de4bf7d2a6f51cb498a406f0f" title="rocksdb::CorruptionTest\l::CorruptionTest" alt="" coords="996,5,1159,51"/><area shape="rect" id="node13" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="713,75,887,104"/><area shape="rect" id="node15" href="../../d9/d66/a02562.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1052,75,1103,104"/><area shape="rect" id="node21" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="687,127,913,174"/><area shape="rect" id="node23" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="713,197,887,227"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="713,250,887,297"/><area shape="rect" id="node25" href="../../db/d95/a00391.html#a509351e18607a06285412f6654253643" title="rocksdb::DBTest::DBTest" alt="" coords="991,197,1164,227"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#a3761d111551d33530517a39f38f908d1" title="rocksdb::DBTest::ChangeOptions" alt="" coords="968,259,1187,288"/><area shape="rect" id="node35" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="775,320,825,349"/><area shape="rect" id="node39" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="720,373,880,419"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="697,443,903,472"/><area shape="rect" id="node47" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="699,495,901,542"/><area shape="rect" id="node51" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="745,565,855,595"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#a28f3fa7104cc330d8f573f98682e000b" title="rocksdb::TEST" alt="" coords="1023,443,1132,472"/><area shape="rect" id="node49" href="../../dc/d6a/a02779.html#a1fa3253ca11014c1b01923a1674ff19c" title="main" alt="" coords="1052,561,1103,591"/><area shape="rect" id="node59" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="704,671,896,718"/><area shape="rect" id="node63" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="704,741,896,787"/><area shape="rect" id="node61" href="../../d0/dc7/a01402.html#aa4769c7f42641f11d37d9d1a0b381bef" title="rocksdb::SimpleTableDBTest\l::SimpleTableDBTest" alt="" coords="981,671,1173,718"/><area shape="rect" id="node67" href="../../db/d84/a02686.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="775,811,825,840"/><area shape="rect" id="node71" href="../../da/dee/a00383.html#a8cdb390521098e2a5f737561e9eb1134" title="rocksdb::DBConstructor\l::DBConstructor" alt="" coords="719,863,881,910"/><area shape="rect" id="node73" href="../../da/dee/a00383.html#ae9772754567f1b3c0ca7d5285a56ac6d" title="rocksdb::DBConstructor\l::FinishImpl" alt="" coords="719,933,881,979"/><area shape="rect" id="node79" href="../../d3/daa/a01577.html#af7e726bf27e216787e7c331834ec6075" title="rocksdb::StressTest::Run" alt="" coords="715,1003,885,1032"/><area shape="rect" id="node83" href="../../d3/daa/a01577.html#aeac9f55bde5a11da0fcc2c88465de0c6" title="rocksdb::StressTest\l::Reopen" alt="" coords="731,1055,869,1102"/><area shape="rect" id="node81" href="../../d6/d50/a02694.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1052,1003,1103,1032"/><area shape="rect" id="node89" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="681,1125,919,1171"/><area shape="rect" id="node91" href="../../de/d9d/a00813.html#ab355fd20f7ef62b0cb2e673a6a2d9bec" title="rocksdb::LDBCommand::Run" alt="" coords="703,1195,897,1224"/><area shape="rect" id="node93" href="../../d0/d88/a01231.html#a66bef6f11f9e11d7ac84410cb5b8bf4a" title="rocksdb::ReduceLevelTest\l::ReduceLevels" alt="" coords="988,1186,1167,1233"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="adb8cf2e0f98f8368db32bea16bcf3cb7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::RecoverLogFile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td>
          <td class="paramname"><em>log_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d86/a01798.html">VersionEdit</a> *&#160;</td>
          <td class="paramname"><em>edit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> *&#160;</td>
          <td class="paramname"><em>max_sequence</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/dcd/a00965.html">MemTable</a> *&#160;</td>
          <td class="paramname"><em>external_table</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00874">874</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../df/d44/a02586_source.html#l00060">rocksdb::MemTable::ApproximateMemoryUsage()</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../db/d34/a02608_source.html#l00022">rocksdb::LogReporter::Corruption()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00042">rocksdb::Status::Corruption()</a>, <a class="el" href="../../d6/dca/a02616_source.html#l00126">rocksdb::WriteBatchInternal::Count()</a>, <a class="el" href="../../db/d34/a02608_source.html#l00020">rocksdb::LogReporter::env</a>, <a class="el" href="../../df/d5e/a02690_source.html#l00023">env</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../db/d34/a02608_source.html#l00021">rocksdb::LogReporter::info_log</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d6/dca/a02616_source.html#l00228">rocksdb::WriteBatchInternal::InsertInto()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00178">internal_comparator_</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../da/d03/a02577_source.html#l00060">rocksdb::LogFileName()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00392">MaybeIgnoreError()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02478">mem</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00310">mem_rep_factory_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3">rocksdb::Env::NewSequentialFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01279">NumberLevels()</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00125">rocksdb::Options::paranoid_checks</a>, <a class="el" href="../../d6/dae/a02581_source.html#l00064">rocksdb::log::Reader::ReadRecord()</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00043">rocksdb::MemTable::Ref()</a>, <a class="el" href="../../d6/dca/a02616_source.html#l00134">rocksdb::WriteBatchInternal::Sequence()</a>, <a class="el" href="../../d6/dca/a02616_source.html#l00236">rocksdb::WriteBatchInternal::SetContents()</a>, <a class="el" href="../../dd/d75/a02639_source.html#l00049">rocksdb::Slice::size()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00538">rocksdb::Options::skip_log_error_on_recovery</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00451">storage_options_</a>, <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00046">rocksdb::MemTable::Unref()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00384">rocksdb::Options::wal_dir</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00152">rocksdb::Options::write_buffer_size</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00975">WriteLevel0TableForRecovery()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00768">Recover()</a>.</p>
<div class="fragment"><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                                                        {</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="keyword">struct </span>LogReporter : <span class="keyword">public</span> log::Reader::Reporter {</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    Env* <a class="code" href="../../df/d5e/a02690.html#a5cd3f8825058fa594646d13638c40d6d">env</a>;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    Logger* info_log;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* fname;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a>* status;  <span class="comment">// nullptr if options_.paranoid_checks==false or</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                     <span class="comment">//            options_.skip_log_error_on_recovery==true</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> Corruption(<span class="keywordtype">size_t</span> bytes, <span class="keyword">const</span> <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a>&amp; s) {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(info_log, <span class="stringliteral">&quot;%s%s: dropping %d bytes; %s&quot;</span>,</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;          (this-&gt;status == <span class="keyword">nullptr</span> ? <span class="stringliteral">&quot;(ignoring error) &quot;</span> : <span class="stringliteral">&quot;&quot;</span>),</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;          fname, static_cast&lt;int&gt;(bytes), s.ToString().c_str());</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <span class="keywordflow">if</span> (this-&gt;status != <span class="keyword">nullptr</span> &amp;&amp; this-&gt;status-&gt;ok()) *this-&gt;status = s;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  };</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="comment">// Open the log file</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  std::string fname = <a class="code" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477">LogFileName</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a5007678736ab24fe48cc60d7254b4b0c">wal_dir</a>, log_number);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  unique_ptr&lt;SequentialFile&gt; file;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> status = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3">NewSequentialFile</a>(fname, &amp;file, <a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a933c2a47a906fd7bcfdc3bfe77c9ea6e">MaybeIgnoreError</a>(&amp;status);</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="comment">// Create the log reader.</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  LogReporter reporter;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  reporter.env = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  reporter.info_log = <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>.get();</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  reporter.fname = fname.c_str();</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  reporter.status = (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a3caefadde126ce359200ea7742e3dba7">paranoid_checks</a> &amp;&amp;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                     !<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6eb254cdf25cf4472ee7c3157d5801d5">skip_log_error_on_recovery</a> ? &amp;status : <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="comment">// We intentially make log::Reader do checksumming even if</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <span class="comment">// paranoid_checks==false so that corruptions cause entire commits</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="comment">// to be skipped instead of propagating bad information (like overly</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="comment">// large sequence numbers).</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  log::Reader reader(std::move(file), &amp;reporter, <span class="keyword">true</span><span class="comment">/*checksum*/</span>,</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                     0<span class="comment">/*initial_offset*/</span>);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Recovering log #%lu&quot;</span>,</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) log_number);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="comment">// Read all the records and add to a memtable</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  std::string scratch;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  Slice record;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  WriteBatch batch;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  MemTable* <a class="code" href="../../db/d44/a02564.html#a0d98018e8146e811f356fa860a9839a0">mem</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="keywordflow">if</span> (external_table) {</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    mem = external_table;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  }</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="keywordflow">while</span> (reader.ReadRecord(&amp;record, &amp;scratch) &amp;&amp; status.ok()) {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordflow">if</span> (record.size() &lt; 12) {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      reporter.Corruption(</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;          record.size(), <a class="code" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d">Status::Corruption</a>(<span class="stringliteral">&quot;log record too small&quot;</span>));</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <a class="code" href="../../da/d8c/a01845.html#a49f498cf63e9c738c4d598398a6f8c9e">WriteBatchInternal::SetContents</a>(&amp;batch, record);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">if</span> (mem == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      mem = <span class="keyword">new</span> MemTable(<a class="code" href="../../dd/df5/a00386.html#aa92d556db5d7f5bc58f2531cd124729d">internal_comparator_</a>, <a class="code" href="../../dd/df5/a00386.html#a6372d47ec4455946aa5754c002a4fbf0">mem_rep_factory_</a>,</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880">NumberLevels</a>(), <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      mem-&gt;Ref();</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    status = <a class="code" href="../../da/d8c/a01845.html#aa10e1abb5f141e75e184bf456a5d65a6">WriteBatchInternal::InsertInto</a>(&amp;batch, mem, &amp;<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>);</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a933c2a47a906fd7bcfdc3bfe77c9ea6e">MaybeIgnoreError</a>(&amp;status);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    }</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> last_seq =</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <a class="code" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44">WriteBatchInternal::Sequence</a>(&amp;batch) +</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <a class="code" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478">WriteBatchInternal::Count</a>(&amp;batch) - 1;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">if</span> (last_seq &gt; *<a class="code" href="../../de/d94/a02597.html#a52c1b794512261f530db50c720acb0c4">max_sequence</a>) {</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      *<a class="code" href="../../de/d94/a02597.html#a52c1b794512261f530db50c720acb0c4">max_sequence</a> = last_seq;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">if</span> (!external_table &amp;&amp;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        mem-&gt;ApproximateMemoryUsage() &gt; <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a48ec9672854e5fcd4bd33ad294c8d882">write_buffer_size</a>) {</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;      status = <a class="code" href="../../dd/df5/a00386.html#a9408ef3bd3f2ad6fb684bc688737c70b">WriteLevel0TableForRecovery</a>(mem, edit);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="comment">// Reflect errors immediately so that conditions like full</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="comment">// file-systems cause the DB::Open() to fail.</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      }</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      mem-&gt;Unref();</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      mem = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="keywordflow">if</span> (status.ok() &amp;&amp; mem != <span class="keyword">nullptr</span> &amp;&amp; !external_table) {</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    status = <a class="code" href="../../dd/df5/a00386.html#a9408ef3bd3f2ad6fb684bc688737c70b">WriteLevel0TableForRecovery</a>(mem, edit);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="comment">// Reflect errors immediately so that conditions like full</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="comment">// file-systems cause the DB::Open() to fail.</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  }</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordflow">if</span> (mem != <span class="keyword">nullptr</span> &amp;&amp; !external_table) mem-&gt;Unref();</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_adb8cf2e0f98f8368db32bea16bcf3cb7_cgraph.png" border="0" usemap="#dd/df5/a00386_adb8cf2e0f98f8368db32bea16bcf3cb7_cgraph" alt=""/></div>
<map name="dd/df5/a00386_adb8cf2e0f98f8368db32bea16bcf3cb7_cgraph" id="dd/df5/a00386_adb8cf2e0f98f8368db32bea16bcf3cb7_cgraph">
<area shape="rect" id="node3" href="../../d3/dcd/a00965.html#a3232b72cba2586f3d6dbd08d8b4be86d" title="rocksdb::MemTable::\lApproximateMemoryUsage" alt="" coords="251,5,429,51"/><area shape="rect" id="node7" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="520,635,661,682"/><area shape="rect" id="node9" href="../../d6/d66/a00916.html#ac156dfd78ec3a8dd539224668defc12d" title="rocksdb::LogReporter\l::Corruption" alt="" coords="267,125,413,171"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="543,135,639,164"/><area shape="rect" id="node13" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="505,191,676,220"/><area shape="rect" id="node17" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="967,311,1148,340"/><area shape="rect" id="node21" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="733,705,917,751"/><area shape="rect" id="node25" href="../../da/d8c/a01845.html#aa10e1abb5f141e75e184bf456a5d65a6" title="rocksdb::WriteBatchInternal\l::InsertInto" alt="" coords="248,365,432,411"/><area shape="rect" id="node27" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="499,515,683,562"/><area shape="rect" id="node34" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="989,1528,1125,1557"/><area shape="rect" id="node55" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="264,1519,416,1548"/><area shape="rect" id="node59" href="../../dd/df5/a00386.html#a933c2a47a906fd7bcfdc3bfe77c9ea6e" title="rocksdb::DBImpl::MaybeIgnore\lError" alt="" coords="239,245,441,291"/><area shape="rect" id="node63" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="757,1349,893,1379"/><area shape="rect" id="node66" href="../../db/db1/a00460.html#af2eb6650bd551549c4f6f66ce0e51de3" title="rocksdb::Env::NewSequentialFile" alt="" coords="232,1572,448,1601"/><area shape="rect" id="node68" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="235,1625,445,1655"/><area shape="rect" id="node71" href="../../d5/d54/a01213.html#a5a9fb535a03f7843b921dd95262ddb9c" title="rocksdb::log::Reader\l::ReadRecord" alt="" coords="269,1398,411,1445"/><area shape="rect" id="node93" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="257,1679,423,1708"/><area shape="rect" id="node96" href="../../da/d8c/a01845.html#a49f498cf63e9c738c4d598398a6f8c9e" title="rocksdb::WriteBatchInternal\l::SetContents" alt="" coords="499,1793,683,1839"/><area shape="rect" id="node102" href="../../d3/dcd/a00965.html#a35a338dd8c1096c850b1bdd3969aeee4" title="rocksdb::MemTable::\lUnref" alt="" coords="268,1731,412,1778"/><area shape="rect" id="node104" href="../../dd/df5/a00386.html#a9408ef3bd3f2ad6fb684bc688737c70b" title="rocksdb::DBImpl::WriteLevel0\lTableForRecovery" alt="" coords="241,897,439,943"/><area shape="rect" id="node5" href="../../d7/d70/a00106.html#a87df854c19bfd3a5843682b36ddae7b9" title="rocksdb::ArenaImpl\l::ApproximateMemoryUsage" alt="" coords="497,5,684,51"/><area shape="rect" id="node15" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="751,167,900,196"/><area shape="rect" id="node19" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1197,272,1357,301"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="975,775,1140,804"/><area shape="rect" id="node32" href="../../d2/dbd/a01844.html#ac5f77d59bf05e77679fc2ad832e1ccdf" title="rocksdb::WriteBatch\l::Iterate" alt="" coords="520,345,661,391"/><area shape="rect" id="node29" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="743,775,908,804"/><area shape="rect" id="node37" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="748,878,903,925"/><area shape="rect" id="node40" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="751,375,900,404"/><area shape="rect" id="node42" href="../../d4/d14/a00608.html#aa9e3230dee01550f20209e37e264de29" title="rocksdb::WriteBatch\l::Handler::Continue" alt="" coords="755,427,896,474"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#adeae0144b8eaea4c370172d4f6edaf48" title="rocksdb::GetLengthPrefixed\lSlice" alt="" coords="733,497,917,543"/><area shape="rect" id="node46" href="../../d4/d14/a00608.html#ae1e8e46791974e57a5cb8608cb6babc6" title="rocksdb::WriteBatch\l::Handler::Put" alt="" coords="755,566,896,613"/><area shape="rect" id="node48" href="../../d4/d14/a00608.html#ab015aa14fd07a0dab2ac126d625cefe5" title="rocksdb::WriteBatch\l::Handler::Delete" alt="" coords="755,635,896,682"/><area shape="rect" id="node51" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="755,220,896,249"/><area shape="rect" id="node57" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="509,1863,672,1892"/><area shape="rect" id="node73" href="../../d5/d54/a01213.html#acb5bb46275c505b8eab7bceac8affd36" title="rocksdb::log::Reader\l::SkipToInitialBlock" alt="" coords="520,1398,661,1445"/><area shape="rect" id="node76" href="../../de/daf/a01417.html#a8f740f146e792dc89409f8402a61ad04" title="rocksdb::Slice::clear" alt="" coords="755,1583,896,1612"/><area shape="rect" id="node79" href="../../d5/d54/a01213.html#a57eb93a86418bd4a2b32ee163aecea5d" title="rocksdb::log::Reader\l::ReadPhysicalRecord" alt="" coords="515,1518,667,1565"/><area shape="rect" id="node84" href="../../d5/d54/a01213.html#a7db406791cb13477c816733858ea1e51" title="rocksdb::log::Reader\l::ReportCorruption" alt="" coords="755,1409,896,1455"/><area shape="rect" id="node87" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="756,1689,895,1719"/><area shape="rect" id="node107" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="504,1036,677,1065"/><area shape="rect" id="node109" href="../../d3/dcd/a00965.html#a1bf0bce45391c71385c38e7ddc82b5ea" title="rocksdb::MemTable::\lNewIterator" alt="" coords="519,1089,663,1135"/><area shape="rect" id="node111" href="../../dc/de6/a01426.html#aab9c275d08ac06c7ca97116328298b9c" title="rocksdb::SnapshotList\l::GetNewest" alt="" coords="515,1158,667,1205"/><area shape="rect" id="node113" href="../../d3/dcd/a00965.html#aac4669a721ac40316118f847a3659b45" title="rocksdb::MemTable::\lGetFirstSequenceNumber" alt="" coords="504,1227,677,1274"/><area shape="rect" id="node116" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="520,705,661,751"/><area shape="rect" id="node118" href="../../d4/d87/a03436.html#a54b259d9ef3d218359bf85355d87aa8e" title="rocksdb::BuildTable" alt="" coords="523,1639,659,1668"/><area shape="rect" id="node123" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0" title="rocksdb::DBImpl::user\l_comparator" alt="" coords="515,774,667,821"/><area shape="rect" id="node125" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="527,844,655,873"/><area shape="rect" id="node127" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="520,897,661,943"/><area shape="rect" id="node131" href="../../d2/d86/a01798.html#a62a14d8606dbc1d557b6e3bb55c617dd" title="rocksdb::VersionEdit\l::AddFile" alt="" coords="520,966,661,1013"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_adb8cf2e0f98f8368db32bea16bcf3cb7_icgraph.png" border="0" usemap="#dd/df5/a00386_adb8cf2e0f98f8368db32bea16bcf3cb7_icgraph" alt=""/></div>
<map name="dd/df5/a00386_adb8cf2e0f98f8368db32bea16bcf3cb7_icgraph" id="dd/df5/a00386_adb8cf2e0f98f8368db32bea16bcf3cb7_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#afe079cf353957e6c79ed794cbc0bb9fc" title="rocksdb::DBImpl::Recover" alt="" coords="233,645,409,675"/><area shape="rect" id="node5" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="460,645,593,675"/><area shape="rect" id="node7" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="669,21,832,67"/><area shape="rect" id="node13" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="680,121,821,167"/><area shape="rect" id="node19" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="651,205,851,235"/><area shape="rect" id="node21" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="655,259,847,288"/><area shape="rect" id="node33" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="696,323,805,352"/><area shape="rect" id="node35" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="661,376,840,405"/><area shape="rect" id="node39" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="671,429,831,475"/><area shape="rect" id="node43" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="689,499,812,528"/><area shape="rect" id="node55" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="683,602,819,649"/><area shape="rect" id="node57" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="655,671,847,718"/><area shape="rect" id="node59" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="655,741,847,787"/><area shape="rect" id="node67" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="643,811,859,840"/><area shape="rect" id="node71" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="669,863,832,910"/><area shape="rect" id="node77" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="725,933,776,963"/><area shape="rect" id="node79" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="681,986,820,1033"/><area shape="rect" id="node87" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="661,1055,840,1102"/><area shape="rect" id="node89" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="669,1125,832,1171"/><area shape="rect" id="node95" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="944,619,1109,648"/><area shape="rect" id="node98" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="681,1194,820,1241"/><area shape="rect" id="node100" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="679,1263,823,1310"/><area shape="rect" id="node9" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="945,5,1108,51"/><area shape="rect" id="node11" href="../../d9/d48/a00345.html#a08cff08de4bf7d2a6f51cb498a406f0f" title="rocksdb::CorruptionTest\l::CorruptionTest" alt="" coords="1223,5,1385,51"/><area shape="rect" id="node15" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="940,75,1113,104"/><area shape="rect" id="node17" href="../../d9/d66/a02562.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1279,75,1329,104"/><area shape="rect" id="node23" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="913,127,1140,174"/><area shape="rect" id="node25" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="940,197,1113,227"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="940,250,1113,297"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#a509351e18607a06285412f6654253643" title="rocksdb::DBTest::DBTest" alt="" coords="1217,197,1391,227"/><area shape="rect" id="node31" href="../../db/d95/a00391.html#a3761d111551d33530517a39f38f908d1" title="rocksdb::DBTest::ChangeOptions" alt="" coords="1195,259,1413,288"/><area shape="rect" id="node37" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1001,320,1052,349"/><area shape="rect" id="node41" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="947,373,1107,419"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="924,443,1129,472"/><area shape="rect" id="node49" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="925,495,1128,542"/><area shape="rect" id="node53" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="972,565,1081,595"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#a28f3fa7104cc330d8f573f98682e000b" title="rocksdb::TEST" alt="" coords="1249,443,1359,472"/><area shape="rect" id="node51" href="../../dc/d6a/a02779.html#a1fa3253ca11014c1b01923a1674ff19c" title="main" alt="" coords="1279,561,1329,591"/><area shape="rect" id="node61" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="931,671,1123,718"/><area shape="rect" id="node65" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="931,741,1123,787"/><area shape="rect" id="node63" href="../../d0/dc7/a01402.html#aa4769c7f42641f11d37d9d1a0b381bef" title="rocksdb::SimpleTableDBTest\l::SimpleTableDBTest" alt="" coords="1208,671,1400,718"/><area shape="rect" id="node69" href="../../db/d84/a02686.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1001,811,1052,840"/><area shape="rect" id="node73" href="../../da/dee/a00383.html#a8cdb390521098e2a5f737561e9eb1134" title="rocksdb::DBConstructor\l::DBConstructor" alt="" coords="945,863,1108,910"/><area shape="rect" id="node75" href="../../da/dee/a00383.html#ae9772754567f1b3c0ca7d5285a56ac6d" title="rocksdb::DBConstructor\l::FinishImpl" alt="" coords="945,933,1108,979"/><area shape="rect" id="node81" href="../../d3/daa/a01577.html#af7e726bf27e216787e7c331834ec6075" title="rocksdb::StressTest::Run" alt="" coords="941,1003,1112,1032"/><area shape="rect" id="node85" href="../../d3/daa/a01577.html#aeac9f55bde5a11da0fcc2c88465de0c6" title="rocksdb::StressTest\l::Reopen" alt="" coords="957,1055,1096,1102"/><area shape="rect" id="node83" href="../../d6/d50/a02694.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1279,1003,1329,1032"/><area shape="rect" id="node91" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="908,1125,1145,1171"/><area shape="rect" id="node93" href="../../de/d9d/a00813.html#ab355fd20f7ef62b0cb2e673a6a2d9bec" title="rocksdb::LDBCommand::Run" alt="" coords="929,1195,1124,1224"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a889fc527654cd063029f570c18173834"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::ReFitLevel </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>target_level</em> = <code>-1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01223">1223</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00329">bg_compaction_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00309">bg_cv_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00332">bg_flush_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00454">bg_work_gate_closed_</a>, <a class="el" href="../../d8/dde/a03178_source.html#l00226">ripple::f</a>, <a class="el" href="../../db/d44/a02564_source.html#l01208">FindMinimumEmptyLevelFitting()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../db/d44/a02564_source.html#l01279">NumberLevels()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00457">refitting_level_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>, and <a class="el" href="../../de/d7b/a02660_source.html#l00059">rocksdb::port::CondVar::Wait()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01184">CompactRange()</a>.</p>
<div class="fragment"><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                                                   {</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  assert(level &lt; <a class="code" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880">NumberLevels</a>());</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="comment">// only allow one thread refitting</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#af9cf2e8b889d360238e31db0232d1595">refitting_level_</a>) {</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;ReFitLevel: another thread is refitting&quot;</span>);</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  }</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#af9cf2e8b889d360238e31db0232d1595">refitting_level_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="comment">// wait for all background threads to stop</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a64f1e254c5aaa8e73231273933cdeef6">bg_work_gate_closed_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> &gt; 0 || <a class="code" href="../../dd/df5/a00386.html#aca89b02f26787b31bba9a8690b4be42d">bg_flush_scheduled_</a>) {</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        <span class="stringliteral">&quot;RefitLevel: waiting for background threads to stop: %d %d&quot;</span>,</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a>, <a class="code" href="../../dd/df5/a00386.html#aca89b02f26787b31bba9a8690b4be42d">bg_flush_scheduled_</a>);</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36">Wait</a>();</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  }</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="comment">// move to a smaller level</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <span class="keywordtype">int</span> to_level = target_level;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="keywordflow">if</span> (target_level &lt; 0) {</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    to_level = <a class="code" href="../../dd/df5/a00386.html#ab7c2980d0da47c4557512b51231ca07c">FindMinimumEmptyLevelFitting</a>(level);</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  }</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  assert(to_level &lt;= level);</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  <span class="keywordflow">if</span> (to_level &lt; level) {</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Before refitting:\n%s&quot;</span>,</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current()-&gt;DebugString().data());</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    VersionEdit edit(<a class="code" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880">NumberLevels</a>());</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a> : <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current()-&gt;files_[level]) {</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      edit.DeleteFile(level, <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a>-&gt;number);</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      edit.AddFile(to_level, <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a>-&gt;number, <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a>-&gt;file_size, <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a>-&gt;smallest, <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a>-&gt;largest,</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                   <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a>-&gt;smallest_seqno, <a class="code" href="../../d9/d9d/a03417.html#aec7524f5afba4ac75d4fa5b9228c3bac">f</a>-&gt;largest_seqno);</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    }</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Apply version edit:\n%s&quot;</span>,</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        edit.DebugString().data());</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keyword">auto</span> status = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LogAndApply(&amp;edit, &amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;LogAndApply: %s\n&quot;</span>, status.ToString().data());</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordflow">if</span> (status.ok()) {</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;After refitting:\n%s&quot;</span>,</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;          <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current()-&gt;DebugString().data());</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    }</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  }</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#af9cf2e8b889d360238e31db0232d1595">refitting_level_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a64f1e254c5aaa8e73231273933cdeef6">bg_work_gate_closed_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a889fc527654cd063029f570c18173834_cgraph.png" border="0" usemap="#dd/df5/a00386_a889fc527654cd063029f570c18173834_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a889fc527654cd063029f570c18173834_cgraph" id="dd/df5/a00386_a889fc527654cd063029f570c18173834_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#ab7c2980d0da47c4557512b51231ca07c" title="rocksdb::DBImpl::FindMinimum\lEmptyLevelFitting" alt="" coords="249,5,455,51"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="304,75,400,104"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="247,128,457,157"/><area shape="rect" id="node11" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="273,181,431,227"/><area shape="rect" id="node5" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="524,5,665,51"/><area shape="rect" id="node13" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="508,189,681,219"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a889fc527654cd063029f570c18173834_icgraph.png" border="0" usemap="#dd/df5/a00386_a889fc527654cd063029f570c18173834_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a889fc527654cd063029f570c18173834_icgraph" id="dd/df5/a00386_a889fc527654cd063029f570c18173834_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="245,23,427,70"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="476,5,633,35"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="500,59,609,88"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="684,5,793,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab1a3a12c1f9b394536a0375966d4c65f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::ReleaseCompactionUnusedFileNumbers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/d95/a00299.html">CompactionState</a> *&#160;</td>
          <td class="paramname"><em>compact</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01900">1900</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l00091">rocksdb::DBImpl::CompactionState::allocated_file_numbers</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00326">pending_outputs_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>.</p>
<div class="fragment"><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                                                                        {</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> file_number : compact-&gt;allocated_file_numbers) {</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a1a62212922480c1ca92b25a555b3410e">pending_outputs_</a>.erase(file_number);</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="comment">// Log(options_.info_log, &quot;XXX releasing unused file num %d&quot;, file_number);</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;  }</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ab1a3a12c1f9b394536a0375966d4c65f_cgraph.png" border="0" usemap="#dd/df5/a00386_ab1a3a12c1f9b394536a0375966d4c65f_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ab1a3a12c1f9b394536a0375966d4c65f_cgraph" id="dd/df5/a00386_ab1a3a12c1f9b394536a0375966d4c65f_cgraph">
<area shape="rect" id="node3" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="265,5,407,51"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ab1a3a12c1f9b394536a0375966d4c65f_icgraph.png" border="0" usemap="#dd/df5/a00386_ab1a3a12c1f9b394536a0375966d4c65f_icgraph" alt=""/></div>
<map name="dd/df5/a00386_ab1a3a12c1f9b394536a0375966d4c65f_icgraph" id="dd/df5/a00386_ab1a3a12c1f9b394536a0375966d4c65f_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="265,799,511,828"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="560,790,757,837"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="805,759,1003,806"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1051,776,1299,805"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1347,767,1568,814"/><area shape="rect" id="node14" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1616,5,1813,51"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1628,125,1801,155"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1617,982,1812,1029"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1627,1332,1803,1361"/><area shape="rect" id="node48" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1648,776,1781,805"/><area shape="rect" id="node99" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1633,1538,1796,1585"/><area shape="rect" id="node16" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="1864,13,2075,43"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="1895,120,2044,149"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="1867,67,2072,96"/><area shape="rect" id="node24" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2156,147,2321,176"/><area shape="rect" id="node26" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2188,200,2289,229"/><area shape="rect" id="node28" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2136,392,2341,421"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2184,93,2293,123"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="2184,40,2293,69"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="1891,1432,2048,1461"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="2184,1463,2293,1492"/><area shape="rect" id="node42" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="2144,1393,2333,1439"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="1915,1485,2024,1515"/><area shape="rect" id="node50" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="1888,610,2051,657"/><area shape="rect" id="node54" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="1899,679,2040,726"/><area shape="rect" id="node58" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="1869,749,2069,779"/><area shape="rect" id="node60" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="1873,803,2065,832"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="1915,925,2024,955"/><area shape="rect" id="node68" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="1880,979,2059,1008"/><area shape="rect" id="node70" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="1889,1031,2049,1078"/><area shape="rect" id="node72" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="1908,557,2031,587"/><area shape="rect" id="node75" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="1901,1101,2037,1147"/><area shape="rect" id="node77" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="1873,1170,2065,1217"/><area shape="rect" id="node79" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="1873,1239,2065,1286"/><area shape="rect" id="node81" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="1861,1309,2077,1339"/><area shape="rect" id="node83" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="1888,1362,2051,1409"/><area shape="rect" id="node85" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="1944,173,1995,203"/><area shape="rect" id="node87" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="1900,226,2039,273"/><area shape="rect" id="node89" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="1880,295,2059,342"/><area shape="rect" id="node91" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="1888,365,2051,411"/><area shape="rect" id="node93" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1887,435,2052,464"/><area shape="rect" id="node95" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="1900,487,2039,534"/><area shape="rect" id="node97" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="1897,855,2041,902"/><area shape="rect" id="node52" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2157,610,2320,657"/><area shape="rect" id="node56" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2152,688,2325,717"/><area shape="rect" id="node62" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="2125,767,2352,814"/><area shape="rect" id="node64" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="2152,837,2325,867"/><area shape="rect" id="node101" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1915,1608,2024,1637"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1879,1538,2060,1585"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3e23ff6c3d681856e78c3d28514c5319"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::ReleaseSnapshot </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d5/da5/a01424.html">Snapshot</a> *&#160;</td>
          <td class="paramname"><em>snapshot</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#aedefaa4497eb584a45a818c0f05aff9b">rocksdb::DB</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02736">2736</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../dd/d05/a02601_source.html#l00056">rocksdb::SnapshotList::Delete()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00322">snapshots_</a>.</p>

<p>Referenced by <a class="el" href="../../d9/de7/a02572_source.html#l00850">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;                                              {</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a6bf69eb135ada49bd652b4421ccc14af">snapshots_</a>.<a class="code" href="../../dc/de6/a01426.html#aecd0bc5502ce78ee1c273468b33b0979">Delete</a>(reinterpret_cast&lt;const SnapshotImpl*&gt;(s));</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a3e23ff6c3d681856e78c3d28514c5319_cgraph.png" border="0" usemap="#dd/df5/a00386_a3e23ff6c3d681856e78c3d28514c5319_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a3e23ff6c3d681856e78c3d28514c5319_cgraph" id="dd/df5/a00386_a3e23ff6c3d681856e78c3d28514c5319_cgraph">
<area shape="rect" id="node3" href="../../dc/de6/a01426.html#aecd0bc5502ce78ee1c273468b33b0979" title="rocksdb::SnapshotList\l::Delete" alt="" coords="229,5,381,51"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a3e23ff6c3d681856e78c3d28514c5319_icgraph.png" border="0" usemap="#dd/df5/a00386_a3e23ff6c3d681856e78c3d28514c5319_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a3e23ff6c3d681856e78c3d28514c5319_icgraph" id="dd/df5/a00386_a3e23ff6c3d681856e78c3d28514c5319_icgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#acbdeb76b9516008a8f800772ac8d030e" title="rocksdb::TEST" alt="" coords="231,13,340,43"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acb375cca04c4521fd39126db3ffcf9e9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::RetainProbableWalFiles </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/d87/a03436.html#aaaf0d0ee1eb6c730ee241e600b26f980">VectorLogPtr</a> &amp;&#160;</td>
          <td class="paramname"><em>all_logs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a>&#160;</td>
          <td class="paramname"><em>target</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01330">1330</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d5/dd8/a03083_source.html#l00035">ripple::max()</a>, and <a class="el" href="../../d5/d96/a02642_source.html#l00036">rocksdb::Status::OK()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01300">GetUpdatesSince()</a>.</p>
<div class="fragment"><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                                                                   {</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  <span class="keywordtype">long</span> start = 0; <span class="comment">// signed to avoid overflow when target is &lt; first file.</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="keywordtype">long</span> end = <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span><span class="keyword">&gt;</span>(all_logs.size()) - 1;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <span class="comment">// Binary Search. avoid opening all files.</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <span class="keywordflow">while</span> (end &gt;= start) {</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <span class="keywordtype">long</span> mid = start + (end - start) / 2;  <span class="comment">// Avoid overflow.</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> current_seq_num = all_logs.at(mid)-&gt;StartSequence();</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <span class="keywordflow">if</span> (current_seq_num == target) {</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;      end = mid;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (current_seq_num &lt; target) {</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      start = mid + 1;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      end = mid - 1;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    }</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  }</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  <span class="keywordtype">size_t</span> start_index = <a class="code" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785">std::max</a>(0l, end); <span class="comment">// end could be -ve.</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  <span class="comment">// The last wal file is always included</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  all_logs.erase(all_logs.begin(), all_logs.begin() + start_index);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00">Status::OK</a>();</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_acb375cca04c4521fd39126db3ffcf9e9_cgraph.png" border="0" usemap="#dd/df5/a00386_acb375cca04c4521fd39126db3ffcf9e9_cgraph" alt=""/></div>
<map name="dd/df5/a00386_acb375cca04c4521fd39126db3ffcf9e9_cgraph" id="dd/df5/a00386_acb375cca04c4521fd39126db3ffcf9e9_cgraph">
<area shape="rect" id="node3" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="300,5,385,35"/><area shape="rect" id="node5" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="272,59,413,88"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="461,59,621,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_acb375cca04c4521fd39126db3ffcf9e9_icgraph.png" border="0" usemap="#dd/df5/a00386_acb375cca04c4521fd39126db3ffcf9e9_icgraph" alt=""/></div>
<map name="dd/df5/a00386_acb375cca04c4521fd39126db3ffcf9e9_icgraph" id="dd/df5/a00386_acb375cca04c4521fd39126db3ffcf9e9_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#aefb7a749f364c505a5a6b06d977cbc71" title="rocksdb::DBImpl::GetUpdates\lSince" alt="" coords="273,5,471,51"/><area shape="rect" id="node5" href="../../db/d95/a00391.html#aa7a0e63b4ab38f47f7e65f92961c6625" title="rocksdb::DBTest::OpenTransaction\lLogIter" alt="" coords="521,5,748,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4bd51a8c14d950ad017734df3a7b851c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::SlowdownAmount </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>top</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bottom</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02930">2930</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>.</p>
<div class="fragment"><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;                                                          {</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> delay;</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;  <span class="keywordflow">if</span> (n &gt;= top) {</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;    delay = 1000;</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;  }</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n &lt; bottom) {</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;    delay = 0;</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;  }</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;    <span class="comment">// If we are here, we know that:</span></div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    <span class="comment">//   level0_start_slowdown &lt;= n &lt; level0_slowdown</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    <span class="comment">// since the previous two conditions are false.</span></div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    <span class="keywordtype">float</span> how_much =</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;      (float) (n - bottom) /</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;              (top - bottom);</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;    delay = how_much * how_much * 1000;</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;  }</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;  assert(delay &lt;= 1000);</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;  <span class="keywordflow">return</span> delay;</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a4bd51a8c14d950ad017734df3a7b851c_icgraph.png" border="0" usemap="#dd/df5/a00386_a4bd51a8c14d950ad017734df3a7b851c_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a4bd51a8c14d950ad017734df3a7b851c_icgraph" id="dd/df5/a00386_a4bd51a8c14d950ad017734df3a7b851c_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="243,201,437,247"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="487,209,644,239"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="733,179,843,208"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="693,231,883,278"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#aaf39022d45b559b69933cfe719571c10" title="rocksdb::DBImpl::Flush" alt="" coords="941,75,1101,104"/><area shape="rect" id="node17" href="../../dd/df5/a00386.html#a789ea69cfa7ee4fccf934757a4641228" title="rocksdb::DBImpl::TEST\l_FlushMemTable" alt="" coords="940,231,1103,278"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a9bdda420ec5d44390a04215d8b1cbffd" title="rocksdb::DBImpl::~DBImpl" alt="" coords="932,301,1111,331"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#aaa4a148182ce98c83d363817e938ddd5" title="rocksdb::DBImpl::GetLive\lFiles" alt="" coords="1173,5,1347,51"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="1205,75,1315,104"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="1205,128,1315,157"/><area shape="rect" id="node21" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="1169,231,1351,278"/><area shape="rect" id="node23" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="1421,184,1579,213"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#a09218d973702b7be115bc4a65c0d97b9" title="rocksdb::DBTest::MakeTables" alt="" coords="1160,301,1360,331"/><area shape="rect" id="node34" href="../../de/de8/a00405.html#a49dbce26ebba1e0ac3f38a3af92b9757" title="rocksdb::DeleteFileTest\l::CreateTwoLevels" alt="" coords="1180,354,1340,401"/><area shape="rect" id="node36" href="../../d0/d88/a01231.html#a07eb4424cb2bef23ca200a806de76d9b" title="rocksdb::ReduceLevelTest\l::CompactMemTable" alt="" coords="1171,423,1349,470"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="1445,240,1555,269"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="1641,184,1751,213"/><area shape="rect" id="node31" href="../../db/d95/a00391.html#af32d610cb80f870ed942c9ec7a053675" title="rocksdb::DBTest::FillLevels" alt="" coords="1408,301,1592,331"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae97e90f1166836da10d3f5d48be25f1e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::TEST_CompactRange </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> *&#160;</td>
          <td class="paramname"><em>begin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/daf/a01417.html">Slice</a> *&#160;</td>
          <td class="paramname"><em>end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01485">1485</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00342">rocksdb::DBImpl::ManualCompaction::begin</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00329">bg_compaction_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00309">bg_cv_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00576">rocksdb::Options::compaction_style</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00340">rocksdb::DBImpl::ManualCompaction::done</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00343">rocksdb::DBImpl::ManualCompaction::end</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00341">rocksdb::DBImpl::ManualCompaction::in_progress</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00057">rocksdb::kCompactionStyleUniversal</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00044">rocksdb::kMaxSequenceNumber</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00040">rocksdb::kValueTypeForSeek</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00339">rocksdb::DBImpl::ManualCompaction::level</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00346">manual_compaction_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00401">rocksdb::Options::max_background_compactions</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, and <a class="el" href="../../de/d7b/a02660_source.html#l00059">rocksdb::port::CondVar::Wait()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01184">CompactRange()</a>, and <a class="el" href="../../d1/d67/a02561_source.html#l00240">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                                                                             {</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  assert(level &gt;= 0);</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  InternalKey begin_storage, end_storage;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  ManualCompaction manual;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  manual.level = level;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  manual.done = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;  manual.in_progress = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="comment">// For universal compaction, we enforce every manual compaction to compact</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  <span class="comment">// all files.</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  <span class="keywordflow">if</span> (begin == <span class="keyword">nullptr</span> ||</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> == <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a>) {</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    manual.begin = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    begin_storage = InternalKey(*begin, <a class="code" href="../../d4/d87/a03436.html#a7f8b5699104535577fb0ca15fa1ead65">kMaxSequenceNumber</a>, <a class="code" href="../../d4/d87/a03436.html#ab2eae1f77282af48d0fe375ed4ba1e0c">kValueTypeForSeek</a>);</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    manual.begin = &amp;begin_storage;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  }</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  <span class="keywordflow">if</span> (end == <span class="keyword">nullptr</span> ||</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> == <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a>) {</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    manual.end = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    end_storage = InternalKey(*end, 0, static_cast&lt;ValueType&gt;(0));</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    manual.end = &amp;end_storage;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  }</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  <span class="comment">// When a manual compaction arrives, temporarily throttle down</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="comment">// the number of background compaction threads to 1. This is</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  <span class="comment">// needed to ensure that this manual compaction can compact</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  <span class="comment">// any range of keys/files. We artificialy increase</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  <span class="comment">// bg_compaction_scheduled_ by a large number, this causes</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  <span class="comment">// the system to have a single background thread. Now,</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  <span class="comment">// this manual compaction can progress without stomping</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <span class="comment">// on any other concurrent compactions.</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> LargeNumber = 10000000;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> newvalue = <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acfc44c7252fbd8c8d98c42903014dbbc">max_background_compactions</a>-1;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> += LargeNumber;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> &gt; LargeNumber) {</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Manual compaction request waiting for background threads to fall below 1&quot;</span>);</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36">Wait</a>();</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  }</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Manual compaction starting&quot;</span>);</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <span class="keywordflow">while</span> (!manual.done) {</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="../../dd/df5/a00386.html#ab8d415c46a300bbfcaaa95e812a51179">manual_compaction_</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36">Wait</a>();</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    }</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#ab8d415c46a300bbfcaaa95e812a51179">manual_compaction_</a> = &amp;manual;</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> == LargeNumber) {</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> = newvalue;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    }</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a">MaybeScheduleFlushOrCompaction</a>();</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="../../dd/df5/a00386.html#ab8d415c46a300bbfcaaa95e812a51179">manual_compaction_</a> == &amp;manual) {</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36">Wait</a>();</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    }</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  }</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  assert(!manual.in_progress);</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="comment">// wait till there are no background threads scheduled</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> += LargeNumber;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> &gt; LargeNumber + newvalue) {</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Manual compaction resetting background threads&quot;</span>);</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36">Wait</a>();</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  }</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> = 0;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ae97e90f1166836da10d3f5d48be25f1e_cgraph.png" border="0" usemap="#dd/df5/a00386_ae97e90f1166836da10d3f5d48be25f1e_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ae97e90f1166836da10d3f5d48be25f1e_cgraph" id="dd/df5/a00386_ae97e90f1166836da10d3f5d48be25f1e_cgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1900,1337,1996,1367"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="216,1542,437,1589"/><area shape="rect" id="node170" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="531,2203,688,2250"/><area shape="rect" id="node7" href="../../de/d76/a00134.html#a3df03b47d7c561143fd1ac591207e2cf" title="rocksdb::port::AtomicPointer\l::Acquire_Load" alt="" coords="2128,409,2315,455"/><area shape="rect" id="node9" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1877,798,2019,845"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="485,1763,733,1792"/><area shape="rect" id="node43" href="../../d7/dd4/a00968.html#a95a7b2d65fbe38706615b07eafd3cb36" title="rocksdb::MemTableList\l::IsFlushPending" alt="" coords="1869,511,2027,558"/><area shape="rect" id="node56" href="../../db/db1/a00460.html#a4367e6868093755a80234295a1c21867" title="rocksdb::Env::Schedule" alt="" coords="2141,2659,2301,2688"/><area shape="rect" id="node145" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="504,1551,715,1580"/><area shape="rect" id="node13" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="781,1774,979,1821"/><area shape="rect" id="node16" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="1029,902,1227,949"/><area shape="rect" id="node23" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="2153,1365,2289,1395"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#a4ab5900a7770dcb2a687bfd41269f2df" title="rocksdb::DBImpl::MaybeSchedule\lLogDBDeployStats" alt="" coords="1837,2483,2059,2530"/><area shape="rect" id="node60" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="1611,1458,1752,1505"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="1617,2024,1745,2053"/><area shape="rect" id="node72" href="../../d0/d39/a00314.html#a460a79877665e0091d74502a41069db1" title="rocksdb::port::CondVar\l::SignalAll" alt="" coords="1603,1578,1760,1625"/><area shape="rect" id="node75" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1863,2789,2033,2819"/><area shape="rect" id="node79" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="1611,1389,1752,1435"/><area shape="rect" id="node88" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="1299,1885,1504,1931"/><area shape="rect" id="node93" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="1579,1698,1784,1745"/><area shape="rect" id="node100" href="../../dd/df5/a00386.html#a9ca9562b2a7a0a8e0645db22648a2ac5" title="rocksdb::DBImpl::MaybeDump\lStats" alt="" coords="1027,1995,1229,2042"/><area shape="rect" id="node113" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="1295,2314,1508,2361"/><area shape="rect" id="node141" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="1281,1731,1521,1760"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#a0d04c5afc2255f2160046afed2398cbd" title="rocksdb::DBImpl::Cleanup\lCompaction" alt="" coords="1593,725,1769,771"/><area shape="rect" id="node25" href="../../de/de6/a00723.html#a1f29087f48fd168fe431e4b884f5aed1" title="rocksdb::InternalKey\l::DebugString" alt="" coords="1331,434,1472,481"/><area shape="rect" id="node33" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="1279,1108,1524,1137"/><area shape="rect" id="node39" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="1587,914,1776,961"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2" title="rocksdb::ParseInternalKey" alt="" coords="1593,520,1769,549"/><area shape="rect" id="node29" href="../../d6/d80/a01076.html#a36870425cc00e160004d62bd6118a24d" title="rocksdb::ParsedInternalKey\l::DebugString" alt="" coords="1591,295,1772,342"/><area shape="rect" id="node31" href="../../d4/d87/a03436.html#a4bf89f1a48c96450ef0d88b5c9f0a1ec" title="rocksdb::EscapeString" alt="" coords="1604,365,1759,395"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#aa4a580611125396a6e0072010fced806" title="rocksdb::DBImpl::Allocate\lCompactionOutputFileNumbers" alt="" coords="1579,845,1784,891"/><area shape="rect" id="node45" href="../../de/d76/a00134.html#a8a98aeb31b43bb48637564f1b7c375dc" title="rocksdb::port::AtomicPointer\l::NoBarrier_Load" alt="" coords="2128,589,2315,635"/><area shape="rect" id="node68" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="1595,1920,1768,1949"/><area shape="rect" id="node51" href="../../dd/df5/a00386.html#a3b86ec3494acbb6dbb8f2fdace967183" title="rocksdb::DBImpl::BGLogDBDeploy\lStats" alt="" coords="2108,2482,2335,2529"/><area shape="rect" id="node53" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="2121,2552,2321,2581"/><area shape="rect" id="node62" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1861,1527,2035,1556"/><area shape="rect" id="node77" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="2147,2789,2296,2819"/><area shape="rect" id="node91" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="1860,1971,2036,2000"/><area shape="rect" id="node102" href="../../dd/df5/a00386.html#ae57d4ca72d8c220fe8a384531433e585" title="rocksdb::DBImpl::GetProperty" alt="" coords="1303,2056,1500,2085"/><area shape="rect" id="node107" href="../../dd/df5/a00386.html#aa52b644196bb47c051055a7a9a827fcd" title="rocksdb::DBImpl::PrintStatistics" alt="" coords="1296,2109,1507,2139"/><area shape="rect" id="node115" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="1580,2389,1783,2419"/><area shape="rect" id="node117" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="1865,2608,2031,2637"/><area shape="rect" id="node120" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1605,2229,1757,2259"/><area shape="rect" id="node124" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="1865,2689,2031,2719"/><area shape="rect" id="node126" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="1575,2543,1788,2590"/><area shape="rect" id="node135" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="1593,2283,1769,2312"/><area shape="rect" id="node137" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="1600,2336,1763,2365"/><area shape="rect" id="node147" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1029,1594,1227,1641"/><area shape="rect" id="node150" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="1303,1038,1500,1085"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ae97e90f1166836da10d3f5d48be25f1e_icgraph.png" border="0" usemap="#dd/df5/a00386_ae97e90f1166836da10d3f5d48be25f1e_icgraph" alt=""/></div>
<map name="dd/df5/a00386_ae97e90f1166836da10d3f5d48be25f1e_icgraph" id="dd/df5/a00386_ae97e90f1166836da10d3f5d48be25f1e_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="216,23,397,70"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="252,93,361,123"/><area shape="rect" id="node5" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="447,5,604,35"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="471,59,580,88"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="655,5,764,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae4c810b1b069d14c725b0a153669eb46"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::TEST_Current_Manifest_FileNo </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00359">359</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>
<div class="fragment"><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                                              {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;ManifestFileNumber();</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac2870077d89d80a121ad4c84797d5994"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::TEST_Destroy_DBImpl </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00329">329</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00329">bg_compaction_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00309">bg_cv_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00332">bg_flush_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00335">bg_logstats_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00454">bg_work_gate_closed_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00304">db_lock_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00384">flush_on_destroy_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00314">log_</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00301">table_cache_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, <a class="el" href="../../db/db1/a00460.html#a802631b298800f1ee47b75f3d8c9594d">rocksdb::Env::UnlockFile()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>, and <a class="el" href="../../de/d7b/a02660_source.html#l00059">rocksdb::port::CondVar::Wait()</a>.</p>
<div class="fragment"><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                                 {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">// ensure that no new memtable flushes can occur</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a917f2b90eead9ad2465a74dc1d9f52d6">flush_on_destroy_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">// wait till all background compactions are done.</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> ||</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;         <a class="code" href="../../dd/df5/a00386.html#aca89b02f26787b31bba9a8690b4be42d">bg_flush_scheduled_</a> ||</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;         <a class="code" href="../../dd/df5/a00386.html#ab308f5a73496bf663add416d38b1eb3b">bg_logstats_scheduled_</a>) {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36">Wait</a>();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">// Prevent new compactions from occuring.</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a64f1e254c5aaa8e73231273933cdeef6">bg_work_gate_closed_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> LargeNumber = 10000000;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> += LargeNumber;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="comment">// force release the lock file.</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a178d9c0a3dc95d6e5e1a0485bdeb8bc9">db_lock_</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a802631b298800f1ee47b75f3d8c9594d">UnlockFile</a>(<a class="code" href="../../dd/df5/a00386.html#a178d9c0a3dc95d6e5e1a0485bdeb8bc9">db_lock_</a>);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a0801eebdc654c9987f70ba512e9c45f4">log_</a>.reset();</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>.reset();</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a1b44e75ddaf3ea3befcd06b23ca9abb6">table_cache_</a>.reset();</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ac2870077d89d80a121ad4c84797d5994_cgraph.png" border="0" usemap="#dd/df5/a00386_ac2870077d89d80a121ad4c84797d5994_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ac2870077d89d80a121ad4c84797d5994_cgraph" id="dd/df5/a00386_ac2870077d89d80a121ad4c84797d5994_cgraph">
<area shape="rect" id="node3" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="231,5,372,51"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="237,75,365,104"/><area shape="rect" id="node9" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="231,127,372,174"/><area shape="rect" id="node12" href="../../db/db1/a00460.html#a802631b298800f1ee47b75f3d8c9594d" title="rocksdb::Env::UnlockFile" alt="" coords="217,197,385,227"/><area shape="rect" id="node14" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="223,250,380,297"/><area shape="rect" id="node5" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="436,136,609,165"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a789ea69cfa7ee4fccf934757a4641228"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::TEST_FlushMemTable </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01577">1577</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l01554">FlushMemTable()</a>.</p>

<p>Referenced by <a class="el" href="../../d5/dbe/a02697_source.html#l00043">rocksdb::ReduceLevelTest::CompactMemTable()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01184">CompactRange()</a>, <a class="el" href="../../d0/df5/a02576_source.html#l00112">rocksdb::DeleteFileTest::CreateTwoLevels()</a>, <a class="el" href="../../d9/de7/a02572_source.html#l00607">rocksdb::DBTest::MakeTables()</a>, <a class="el" href="../../d9/de7/a02572_source.html#l04720">rocksdb::PrefixScanInit()</a>, and <a class="el" href="../../d1/d67/a02561_source.html#l00240">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                                  {</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28">FlushMemTable</a>(FlushOptions());</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a789ea69cfa7ee4fccf934757a4641228_cgraph.png" border="0" usemap="#dd/df5/a00386_a789ea69cfa7ee4fccf934757a4641228_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a789ea69cfa7ee4fccf934757a4641228_cgraph" id="dd/df5/a00386_a789ea69cfa7ee4fccf934757a4641228_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="216,109,405,155"/><area shape="rect" id="node5" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="956,5,1092,35"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a1db8d713be426c044273b2fa01c75c08" title="rocksdb::DBImpl::WaitFor\lFlushMemTable" alt="" coords="672,109,845,155"/><area shape="rect" id="node16" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="455,859,612,888"/><area shape="rect" id="node9" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="945,109,1103,155"/><area shape="rect" id="node12" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="945,178,1103,225"/><area shape="rect" id="node14" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="1197,221,1371,251"/><area shape="rect" id="node19" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="661,850,856,897"/><area shape="rect" id="node35" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="953,247,1095,294"/><area shape="rect" id="node51" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="953,1485,1095,1515"/><area shape="rect" id="node66" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="953,317,1095,363"/><area shape="rect" id="node71" href="../../dd/df5/a00386.html#acbfdfdd72e490648da9f229fdcd06337" title="rocksdb::DBImpl::BuildBatch\lGroup" alt="" coords="664,1607,853,1654"/><area shape="rect" id="node75" href="../../da/d8c/a01845.html#a04c6bd515d35bda6ffa8ae21ab1e1478" title="rocksdb::WriteBatchInternal\l::ByteSize" alt="" coords="932,1538,1116,1585"/><area shape="rect" id="node77" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="1192,1771,1376,1818"/><area shape="rect" id="node84" href="../../da/d8c/a01845.html#a2c7f53a4c8d710fdbf229c917506f7ab" title="rocksdb::WriteBatchInternal\l::SetSequence" alt="" coords="667,1823,851,1870"/><area shape="rect" id="node91" href="../../d4/d87/a03436.html#a48457fd59325e708afa7fff617f87e05" title="rocksdb::StartPerfTimer" alt="" coords="679,2032,839,2061"/><area shape="rect" id="node95" href="../../da/d8c/a01845.html#af28dbb69a970e8ab218402339f0bb7ee" title="rocksdb::WriteBatchInternal\l::Contents" alt="" coords="667,1962,851,2009"/><area shape="rect" id="node97" href="../../d4/d87/a03436.html#af0bd42ecfc79c4765b60919d28702a29" title="rocksdb::BumpPerfTime" alt="" coords="677,2093,840,2123"/><area shape="rect" id="node101" href="../../da/d8c/a01845.html#aa10e1abb5f141e75e184bf456a5d65a6" title="rocksdb::WriteBatchInternal\l::InsertInto" alt="" coords="667,1893,851,1939"/><area shape="rect" id="node108" href="../../d4/d87/a03436.html#a9231fa7580b3932152d6f3bd39907320" title="rocksdb::SetTickerCount" alt="" coords="676,523,841,552"/><area shape="rect" id="node110" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="695,576,823,605"/><area shape="rect" id="node113" href="../../d2/dbd/a01844.html#a73502c77c1ebdf40417a34eb385e117e" title="rocksdb::WriteBatch\l::Clear" alt="" coords="688,629,829,675"/><area shape="rect" id="node115" href="../../d0/d39/a00314.html#a84d028d8d526b7ce592433ba836a1853" title="rocksdb::port::CondVar\l::Signal" alt="" coords="680,315,837,362"/><area shape="rect" id="node21" href="../../d7/dd4/a00968.html#a889613116ef509399ebb13a714e236d6" title="rocksdb::MemTableList::Add" alt="" coords="929,1243,1119,1272"/><area shape="rect" id="node23" href="../../d3/dcd/a00965.html#a3232b72cba2586f3d6dbd08d8b4be86d" title="rocksdb::MemTable::\lApproximateMemoryUsage" alt="" coords="935,1295,1113,1342"/><area shape="rect" id="node25" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1213,1386,1355,1433"/><area shape="rect" id="node27" href="../../dd/df5/a00386.html#a24b1211b5a5fbfccfe0818c32753ff5f" title="rocksdb::DBImpl::DelayLogging\lAndReset" alt="" coords="921,386,1127,433"/><area shape="rect" id="node29" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1236,548,1332,577"/><area shape="rect" id="node31" href="../../d8/d6c/a01563.html#a2265fb9a74a457ec56cc61f60ea5353e" title="rocksdb::StopWatch\l::ElapsedMicros" alt="" coords="953,455,1095,502"/><area shape="rect" id="node33" href="../../d7/dd4/a00968.html#acd9439e034e085a62a05850d9ba39c7a" title="rocksdb::MemTableList\l::FlushRequested" alt="" coords="945,525,1103,571"/><area shape="rect" id="node39" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="948,595,1100,624"/><area shape="rect" id="node41" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="981,648,1067,677"/><area shape="rect" id="node43" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="913,1415,1135,1462"/><area shape="rect" id="node46" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="923,752,1125,781"/><area shape="rect" id="node48" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="919,805,1129,835"/><area shape="rect" id="node53" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="941,859,1107,888"/><area shape="rect" id="node55" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="955,911,1093,958"/><area shape="rect" id="node57" href="../../d3/dcd/a00965.html#a81f80d2b6674d454e4b65f238281d716" title="rocksdb::MemTable::\lSetLogNumber" alt="" coords="952,981,1096,1027"/><area shape="rect" id="node59" href="../../d3/dcd/a00965.html#a08633ea1ccd8277c4bad90686e12e59d" title="rocksdb::MemTable::\lSetNextLogNumber" alt="" coords="952,1050,1096,1097"/><area shape="rect" id="node62" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="904,1120,1144,1149"/><area shape="rect" id="node64" href="../../dd/df5/a00386.html#a4bd51a8c14d950ad017734df3a7b851c" title="rocksdb::DBImpl::Slowdown\lAmount" alt="" coords="931,1173,1117,1219"/><area shape="rect" id="node73" href="../../da/d8c/a01845.html#a3e28aed1201077095cf66c5e242d1630" title="rocksdb::WriteBatchInternal\l::Append" alt="" coords="932,1607,1116,1654"/><area shape="rect" id="node81" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e" title="beast.util.Iter.first" alt="" coords="963,1677,1085,1707"/><area shape="rect" id="node79" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="1425,1780,1591,1809"/><area shape="rect" id="node86" href="../../d4/d87/a03436.html#a0a6b5f485f1b3d6f33ead2fc4d7c891c" title="rocksdb::EncodeFixed64" alt="" coords="941,1832,1107,1861"/><area shape="rect" id="node93" href="../../d6/d82/a01565.html#ab4ee8b0d656efc48fb33c09fe0c10646" title="rocksdb::StopWatchNano\l::Start" alt="" coords="939,2023,1109,2070"/><area shape="rect" id="node99" href="../../d6/d82/a01565.html#a7354735b3199a8e7ce3d1b7368460576" title="rocksdb::StopWatchNano\l::ElapsedNanos" alt="" coords="939,2093,1109,2139"/><area shape="rect" id="node103" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="932,1954,1116,2001"/><area shape="rect" id="node105" href="../../d2/dbd/a01844.html#ac5f77d59bf05e77679fc2ad832e1ccdf" title="rocksdb::WriteBatch\l::Iterate" alt="" coords="953,1885,1095,1931"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a789ea69cfa7ee4fccf934757a4641228_icgraph.png" border="0" usemap="#dd/df5/a00386_a789ea69cfa7ee4fccf934757a4641228_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a789ea69cfa7ee4fccf934757a4641228_icgraph" id="dd/df5/a00386_a789ea69cfa7ee4fccf934757a4641228_icgraph">
<area shape="rect" id="node3" href="../../d0/d88/a01231.html#a07eb4424cb2bef23ca200a806de76d9b" title="rocksdb::ReduceLevelTest\l::CompactMemTable" alt="" coords="227,5,405,51"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="225,125,407,171"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="477,77,635,107"/><area shape="rect" id="node13" href="../../de/de8/a00405.html#a49dbce26ebba1e0ac3f38a3af92b9757" title="rocksdb::DeleteFileTest\l::CreateTwoLevels" alt="" coords="236,194,396,241"/><area shape="rect" id="node15" href="../../db/d95/a00391.html#a09218d973702b7be115bc4a65c0d97b9" title="rocksdb::DBTest::MakeTables" alt="" coords="216,264,416,293"/><area shape="rect" id="node20" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="261,317,371,347"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="501,133,611,163"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="697,77,807,107"/><area shape="rect" id="node17" href="../../db/d95/a00391.html#af32d610cb80f870ed942c9ec7a053675" title="rocksdb::DBTest::FillLevels" alt="" coords="464,264,648,293"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0d23756d9a9255dbdd0dec5ccf760315"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::TEST_GetLevel0TotalSize </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00119">119</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>
<div class="fragment"><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NumLevelBytes(0);}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3d0bad830232c95a0ed926443e52d213"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> rocksdb::DBImpl::TEST_MaxNextLevelOverlappingBytes </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02543">2543</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>
<div class="fragment"><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;                                                  {</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;MaxNextLevelOverlappingBytes();</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae9769b218862adb599d44cd43b19cd3f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d2/d02/a00777.html">Iterator</a> * rocksdb::DBImpl::TEST_NewInternalIterator </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02538">2538</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l02499">NewInternalIterator()</a>.</p>

<p>Referenced by <a class="el" href="../../d9/de7/a02572_source.html#l00493">rocksdb::DBTest::AllEntriesFor()</a>, and <a class="el" href="../../d6/d0b/a02741_source.html#l00649">rocksdb::InternalDumpCommand::DoCommand()</a>.</p>
<div class="fragment"><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;                                           {</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> ignored;</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a4b410d980071bc0ca4fd10b0156c2442">NewInternalIterator</a>(ReadOptions(), &amp;ignored);</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ae9769b218862adb599d44cd43b19cd3f_cgraph.png" border="0" usemap="#dd/df5/a00386_ae9769b218862adb599d44cd43b19cd3f_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ae9769b218862adb599d44cd43b19cd3f_cgraph" id="dd/df5/a00386_ae9769b218862adb599d44cd43b19cd3f_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a4b410d980071bc0ca4fd10b0156c2442" title="rocksdb::DBImpl::NewInternal\lIterator" alt="" coords="217,231,415,278"/><area shape="rect" id="node5" href="../../d7/dd4/a00968.html#a8cb81a60498b73bf3044668780e63b75" title="rocksdb::MemTableList\l::GetMemTables" alt="" coords="481,5,639,51"/><area shape="rect" id="node7" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="489,74,631,121"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="496,144,624,173"/><area shape="rect" id="node13" href="../../d3/dcd/a00965.html#a1bf0bce45391c71385c38e7ddc82b5ea" title="rocksdb::MemTable::\lNewIterator" alt="" coords="488,197,632,243"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#a678cf0fa28a2449c444344ea1feef654" title="rocksdb::NewMergingIterator" alt="" coords="465,389,655,419"/><area shape="rect" id="node23" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="477,336,643,365"/><area shape="rect" id="node25" href="../../d2/d02/a00777.html#a668d7cfe0b950c1ee2806a3a3d21bb90" title="rocksdb::Iterator::\lRegisterCleanup" alt="" coords="497,447,623,494"/><area shape="rect" id="node39" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="489,266,631,313"/><area shape="rect" id="node9" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="709,179,883,208"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#abf92c452806fb54068f27e6034878f16" title="rocksdb::NewEmptyIterator" alt="" coords="705,388,887,417"/><area shape="rect" id="node19" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="936,367,1077,396"/><area shape="rect" id="node21" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1125,365,1285,395"/><area shape="rect" id="node27" href="../../da/d6b/a02352.html#ae3e0dbf7ac3255e91d16cd24fd2c2b1d" title="Cleanup" alt="" coords="761,467,831,496"/><area shape="rect" id="node29" href="../../da/d6b/a02352.html#ac70ab821a6607b4a1b909582dc37a069" title="sqlite3DbFree" alt="" coords="956,469,1057,499"/><area shape="rect" id="node31" href="../../da/d6b/a02352.html#a770fa05ff9717b75e16f4d968a77b897" title="isLookaside" alt="" coords="1356,509,1447,539"/><area shape="rect" id="node33" href="../../da/d6b/a02352.html#acf77da68932b6bc163c5e68547ecc3e7" title="sqlite3_mutex_held" alt="" coords="1335,431,1468,460"/><area shape="rect" id="node35" href="../../da/d6b/a02352.html#aa397e5a8a03495203a0767abf0a71f86" title="sqlite3DbMallocSize" alt="" coords="1135,469,1276,499"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ae9769b218862adb599d44cd43b19cd3f_icgraph.png" border="0" usemap="#dd/df5/a00386_ae9769b218862adb599d44cd43b19cd3f_icgraph" alt=""/></div>
<map name="dd/df5/a00386_ae9769b218862adb599d44cd43b19cd3f_icgraph" id="dd/df5/a00386_ae9769b218862adb599d44cd43b19cd3f_icgraph">
<area shape="rect" id="node3" href="../../db/d95/a00391.html#ac2a6ca9463f817fd6492f87083ff0562" title="rocksdb::DBTest::AllEntriesFor" alt="" coords="223,5,425,35"/><area shape="rect" id="node5" href="../../dd/dc1/a00721.html#af0961cfce37fc5a8b9d9a10e50073f92" title="rocksdb::InternalDumpCommand\l::DoCommand" alt="" coords="217,58,431,105"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad62af2cf23b7a2da72715051e719e5f1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::TEST_PurgeObsoleteteWAL </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01690">1690</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l00650">PurgeObsoleteWALFiles()</a>.</p>
<div class="fragment"><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                                     {</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46">PurgeObsoleteWALFiles</a>();</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ad62af2cf23b7a2da72715051e719e5f1_cgraph.png" border="0" usemap="#dd/df5/a00386_ad62af2cf23b7a2da72715051e719e5f1_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ad62af2cf23b7a2da72715051e719e5f1_cgraph" id="dd/df5/a00386_ad62af2cf23b7a2da72715051e719e5f1_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a7c148333899c4965e7f0c90bce0abd46" title="rocksdb::DBImpl::PurgeObsolete\lWALFiles" alt="" coords="217,1231,431,1278"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a663aa80742985c3054c1962a94be6267" title="rocksdb::DBImpl::AppendSorted\lWalsOfType" alt="" coords="499,458,709,505"/><area shape="rect" id="node13" href="../../db/db1/a00460.html#afe49e988676094b54312ada4f927a26d" title="rocksdb::Env::GetFileSize" alt="" coords="1073,355,1247,384"/><area shape="rect" id="node18" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="1373,469,1509,499"/><area shape="rect" id="node20" href="../../db/db1/a00460.html#aebd6a4aac30704da29fecf45a9da21d6" title="rocksdb::Env::GetChildren" alt="" coords="1072,720,1248,749"/><area shape="rect" id="node25" href="../../d4/d87/a03436.html#ad3fcb7354969b5ea357d56b2d02362fc" title="rocksdb::ParseFileName" alt="" coords="1077,1480,1243,1509"/><area shape="rect" id="node59" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="1640,1332,1736,1361"/><area shape="rect" id="node61" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="1603,85,1773,115"/><area shape="rect" id="node80" href="../../d4/d87/a03436.html#a546d3e2e5c3b4aa8ee9828c7b519d501" title="rocksdb::ArchivalDirectory" alt="" coords="516,1240,692,1269"/><area shape="rect" id="node82" href="../../dd/df5/a00386.html#a993778aa65fb4553d1c10eb4604bb0fb" title="rocksdb::DBImpl::DeleteFile" alt="" coords="511,1121,697,1151"/><area shape="rect" id="node86" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="1077,1533,1243,1563"/><area shape="rect" id="node127" href="../../db/db1/a00460.html#a70ed14df4e067de0f2a8a09010eaf31b" title="rocksdb::Env::GetCurrentTime" alt="" coords="504,1395,704,1424"/><area shape="rect" id="node129" href="../../db/db1/a00460.html#a0b7781facd40158245aabf25ce686448" title="rocksdb::Env::GetFileModificationTime" alt="" coords="480,1448,728,1477"/><area shape="rect" id="node132" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158" title="rocksdb::if" alt="" coords="563,1620,645,1649"/><area shape="rect" id="node139" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="561,1552,647,1581"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#a26b3cfbce68c226c861cfacd4a111fe1" title="rocksdb::DBImpl::CheckWal\lFileExistsAndEmpty" alt="" coords="789,458,979,505"/><area shape="rect" id="node15" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="1084,616,1236,645"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#a58d2431c9ec2de7473a8bc2f171c04b8" title="rocksdb::DBImpl::ReadFirst\lRecord" alt="" coords="792,237,976,283"/><area shape="rect" id="node76" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="792,105,976,151"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#ae2353d93f3d1d9aaff4f7373f738fdc6" title="rocksdb::ArchivedLogFileName" alt="" coords="1059,563,1261,592"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a645cac7eafed2fae5df45e8483f8fbaf" title="rocksdb::MakeFileName" alt="" coords="1360,616,1523,645"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#a7d0cd6e6e390a2d44d90571ec29cd8f5" title="rocksdb::ConsumeDecimalNumber" alt="" coords="1328,1640,1555,1669"/><area shape="rect" id="node29" href="../../de/daf/a01417.html#a39ca9716c2bcda2ba2261d9c5f108121" title="rocksdb::Slice::empty" alt="" coords="1613,1559,1763,1588"/><area shape="rect" id="node31" href="../../de/daf/a01417.html#ac03632091b9078ec551ffd58d3372f6b" title="rocksdb::Slice::remove\l_prefix" alt="" coords="1611,1631,1765,1678"/><area shape="rect" id="node33" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="1829,1487,1965,1516"/><area shape="rect" id="node38" href="../../de/daf/a01417.html#a5b27053d7804f8ba4a6430e001ce1c22" title="rocksdb::Slice::starts_with" alt="" coords="1353,1435,1529,1464"/><area shape="rect" id="node43" href="../../d0/db9/a01552.html#aebdc2d6b55f9d3145ea7add1551be0bc" title="rocksdb::Status::IOError" alt="" coords="1360,189,1523,219"/><area shape="rect" id="node48" href="../../d0/db9/a01552.html#affd56b266e377f34a3b2e3d525a9d8c8" title="rocksdb::Status::NotSupported" alt="" coords="1059,509,1261,539"/><area shape="rect" id="node51" href="../../d0/db9/a01552.html#aceb84d55ae3b6bccf2a925433ca1ae00" title="rocksdb::Status::OK" alt="" coords="1371,416,1512,445"/><area shape="rect" id="node55" href="../../dd/df5/a00386.html#a8a0816871126bc130e6e4f3ad8f81da8" title="rocksdb::DBImpl::ReadFirstLine" alt="" coords="1056,200,1264,229"/><area shape="rect" id="node74" href="../../d2/d7f/a03369.html#a4a51c292cb48681521db67f2b4848736" title="beast::IP::to_string" alt="" coords="1093,96,1227,125"/><area shape="rect" id="node45" href="../../d0/db9/a01552.html#afcc875b53756534a635212b3d8f43864" title="rocksdb::Status::Status" alt="" coords="1608,416,1768,445"/><area shape="rect" id="node57" href="../../d6/d66/a00916.html#ac156dfd78ec3a8dd539224668defc12d" title="rocksdb::LogReporter\l::Corruption" alt="" coords="1368,295,1515,342"/><area shape="rect" id="node65" href="../../d0/db9/a01552.html#a585d7fbcadd8858734f534519290035d" title="rocksdb::Status::Corruption" alt="" coords="1351,243,1532,272"/><area shape="rect" id="node63" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="1823,85,1972,115"/><area shape="rect" id="node78" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="1077,43,1243,72"/><area shape="rect" id="node84" href="../../d2/d86/a01798.html#a9808f90e0c3ec496be67fc62cac0bd8f" title="rocksdb::VersionEdit\l::DeleteFile" alt="" coords="813,1002,955,1049"/><area shape="rect" id="node88" href="../../dd/df5/a00386.html#a3683f24e767a6e83d03acab509c64ba8" title="rocksdb::DBImpl::FindObsolete\lFiles" alt="" coords="781,882,987,929"/><area shape="rect" id="node97" href="../../d0/db9/a01552.html#a5afec51a3f306b6f188a5af0c5d003ba" title="rocksdb::Status::Invalid\lArgument" alt="" coords="1361,862,1521,909"/><area shape="rect" id="node101" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="1096,1117,1224,1147"/><area shape="rect" id="node104" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="779,1173,989,1203"/><area shape="rect" id="node109" href="../../dd/df5/a00386.html#a9b3b0cce1e70a97d4d797ba7d5511dd5" title="rocksdb::DBImpl::PurgeObsolete\lFiles" alt="" coords="777,1226,991,1273"/><area shape="rect" id="node90" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="1089,997,1231,1043"/><area shape="rect" id="node93" href="../../dd/dea/a00408.html#aebc2e02a27eedb603b0455badcb0a1c7" title="rocksdb::DBImpl::Deletion\lState::HaveSomethingToDelete" alt="" coords="1057,874,1263,921"/><area shape="rect" id="node95" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="1073,944,1247,973"/><area shape="rect" id="node119" href="../../db/db1/a00460.html#a8dc0848695f4b55193ee01ffb9ad24b8" title="rocksdb::Env::RenameFile" alt="" coords="1072,1325,1248,1355"/><area shape="rect" id="node121" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="1079,1221,1241,1251"/><area shape="rect" id="node134" href="../../da/d71/a00814.html#ab25c6d03dbcd6168b3ae3762dc98fd51" title="rocksdb::LDBCommandExecute\lResult::FAILED" alt="" coords="779,1639,989,1686"/><area shape="rect" id="node136" href="../../da/d71/a00814.html#ae4210d600639c8c6ac04486ebc43c39b" title="rocksdb::LDBCommandExecute\lResult::LDBCommandExecuteResult" alt="" coords="1040,1639,1280,1686"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a38ba419b53ed952418f318f46eeba2d0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rocksdb::DBImpl::TEST_SetDefaultTimeToCheck </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td>
          <td class="paramname"><em>default_interval_to_delete_obsolete_WAL</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00121">121</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00369">default_interval_to_delete_obsolete_WAL_</a>.</p>
<div class="fragment"><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#ac49af7a9a13d9dc7a31f0d406e44f257">default_interval_to_delete_obsolete_WAL_</a> = default_interval_to_delete_obsolete_WAL;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae7fa2399305a1c85baebcd08845421b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::TEST_WaitForCompact </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01585">1585</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00329">bg_compaction_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00309">bg_cv_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00349">bg_error_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00332">bg_flush_scheduled_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, and <a class="el" href="../../de/d7b/a02660_source.html#l00059">rocksdb::port::CondVar::Wait()</a>.</p>

<p>Referenced by <a class="el" href="../../d1/d67/a02561_source.html#l00321">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                                   {</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  <span class="comment">// Wait until the compaction completes</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  <span class="comment">// TODO: a bug here. This function actually does not necessarily</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  <span class="comment">// wait for compact. It actually waits for scheduled compaction</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  <span class="comment">// OR flush to finish.</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  <span class="keywordflow">while</span> ((<a class="code" href="../../dd/df5/a00386.html#a9ab341ae7c6562bb9b1864963181c48a">bg_compaction_scheduled_</a> || <a class="code" href="../../dd/df5/a00386.html#aca89b02f26787b31bba9a8690b4be42d">bg_flush_scheduled_</a>) &amp;&amp;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;         <a class="code" href="../../dd/df5/a00386.html#a79aec493ad501d3e044e08f610591926">bg_error_</a>.<a class="code" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425">ok</a>()) {</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36">Wait</a>();</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  }</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a79aec493ad501d3e044e08f610591926">bg_error_</a>;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ae7fa2399305a1c85baebcd08845421b3_cgraph.png" border="0" usemap="#dd/df5/a00386_ae7fa2399305a1c85baebcd08845421b3_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ae7fa2399305a1c85baebcd08845421b3_cgraph" id="dd/df5/a00386_ae7fa2399305a1c85baebcd08845421b3_cgraph">
<area shape="rect" id="node3" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="227,5,363,35"/><area shape="rect" id="node5" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="216,58,373,105"/><area shape="rect" id="node7" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="423,67,596,96"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ae7fa2399305a1c85baebcd08845421b3_icgraph.png" border="0" usemap="#dd/df5/a00386_ae7fa2399305a1c85baebcd08845421b3_icgraph" alt=""/></div>
<map name="dd/df5/a00386_ae7fa2399305a1c85baebcd08845421b3_icgraph" id="dd/df5/a00386_ae7fa2399305a1c85baebcd08845421b3_icgraph">
<area shape="rect" id="node3" href="../../d4/d87/a03436.html#a0e71e2ebffd8a4841a05d0f8c1d770c1" title="rocksdb::TEST" alt="" coords="217,13,327,43"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1a686cee90690cb59d1342551db012df"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::TEST_WaitForFlushMemTable </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01581">1581</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l01564">WaitForFlushMemTable()</a>.</p>

<p>Referenced by <a class="el" href="../../d0/df5/a02576_source.html#l00112">rocksdb::DeleteFileTest::CreateTwoLevels()</a>.</p>
<div class="fragment"><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                                         {</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#a1db8d713be426c044273b2fa01c75c08">WaitForFlushMemTable</a>();</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a1a686cee90690cb59d1342551db012df_cgraph.png" border="0" usemap="#dd/df5/a00386_a1a686cee90690cb59d1342551db012df_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a1a686cee90690cb59d1342551db012df_cgraph" id="dd/df5/a00386_a1a686cee90690cb59d1342551db012df_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a1db8d713be426c044273b2fa01c75c08" title="rocksdb::DBImpl::WaitFor\lFlushMemTable" alt="" coords="223,66,396,113"/><area shape="rect" id="node5" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="447,5,604,51"/><area shape="rect" id="node7" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="457,75,593,104"/><area shape="rect" id="node9" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="447,127,604,174"/><area shape="rect" id="node11" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="655,136,828,165"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a1a686cee90690cb59d1342551db012df_icgraph.png" border="0" usemap="#dd/df5/a00386_a1a686cee90690cb59d1342551db012df_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a1a686cee90690cb59d1342551db012df_icgraph" id="dd/df5/a00386_a1a686cee90690cb59d1342551db012df_icgraph">
<area shape="rect" id="node3" href="../../de/de8/a00405.html#a49dbce26ebba1e0ac3f38a3af92b9757" title="rocksdb::DeleteFileTest\l::CreateTwoLevels" alt="" coords="223,5,383,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa6cba6e97343be3409f1ccaabfaa00c0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../d0/d61/a00302.html">Comparator</a>* rocksdb::DBImpl::user_comparator </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00181">181</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00178">internal_comparator_</a>, and <a class="el" href="../../dc/db2/a02574_source.html#l00107">rocksdb::InternalKeyComparator::user_comparator()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00363">NewDB()</a>, <a class="el" href="../../db/d0b/a02566_source.html#l00070">rocksdb::DBImplReadOnly::NewIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02714">NewIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00975">WriteLevel0TableForRecovery()</a>.</p>
<div class="fragment"><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                            {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dd/df5/a00386.html#aa92d556db5d7f5bc58f2531cd124729d">internal_comparator_</a>.<a class="code" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a">user_comparator</a>();</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aa6cba6e97343be3409f1ccaabfaa00c0_cgraph.png" border="0" usemap="#dd/df5/a00386_aa6cba6e97343be3409f1ccaabfaa00c0_cgraph" alt=""/></div>
<map name="dd/df5/a00386_aa6cba6e97343be3409f1ccaabfaa00c0_cgraph" id="dd/df5/a00386_aa6cba6e97343be3409f1ccaabfaa00c0_cgraph">
<area shape="rect" id="node3" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="208,5,419,51"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_aa6cba6e97343be3409f1ccaabfaa00c0_icgraph.png" border="0" usemap="#dd/df5/a00386_aa6cba6e97343be3409f1ccaabfaa00c0_icgraph" alt=""/></div>
<map name="dd/df5/a00386_aa6cba6e97343be3409f1ccaabfaa00c0_icgraph" id="dd/df5/a00386_aa6cba6e97343be3409f1ccaabfaa00c0_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="692,543,937,572"/><area shape="rect" id="node83" href="../../dd/df5/a00386.html#adca3cc37d179c0402363d4cae6529d72" title="rocksdb::DBImpl::NewDB" alt="" coords="461,668,635,697"/><area shape="rect" id="node88" href="../../db/db9/a00387.html#a11b9bff7fc00d9f55b58d65d07ca7548" title="rocksdb::DBImplReadOnly\l::NewIterator" alt="" coords="217,718,396,765"/><area shape="rect" id="node90" href="../../dd/df5/a00386.html#abca482230e9c3c9bab5276e8b932dae5" title="rocksdb::DBImpl::NewIterator" alt="" coords="209,788,404,817"/><area shape="rect" id="node94" href="../../dd/df5/a00386.html#ac3d320a145d5d36cb2bbf9e57b39ae8a" title="rocksdb::DBImpl::WriteLevel0\lTable" alt="" coords="208,478,405,525"/><area shape="rect" id="node103" href="../../dd/df5/a00386.html#a9408ef3bd3f2ad6fb684bc688737c70b" title="rocksdb::DBImpl::WriteLevel0\lTableForRecovery" alt="" coords="208,598,405,645"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="987,518,1184,565"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1232,542,1429,589"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1477,593,1725,623"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1773,533,1995,579"/><area shape="rect" id="node14" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="2043,502,2240,549"/><area shape="rect" id="node17" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="2075,608,2208,637"/><area shape="rect" id="node19" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2315,9,2477,55"/><area shape="rect" id="node23" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2325,86,2467,133"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2296,160,2496,189"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2300,213,2492,243"/><area shape="rect" id="node37" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2341,267,2451,296"/><area shape="rect" id="node39" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2307,320,2485,349"/><area shape="rect" id="node43" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2316,373,2476,419"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2335,443,2457,472"/><area shape="rect" id="node55" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2328,495,2464,542"/><area shape="rect" id="node57" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2300,565,2492,611"/><area shape="rect" id="node59" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2300,634,2492,681"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2288,704,2504,733"/><area shape="rect" id="node67" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2315,757,2477,803"/><area shape="rect" id="node69" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2371,827,2421,856"/><area shape="rect" id="node71" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2327,879,2465,926"/><area shape="rect" id="node73" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2307,949,2485,995"/><area shape="rect" id="node75" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2315,1018,2477,1065"/><area shape="rect" id="node77" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2313,1088,2479,1117"/><area shape="rect" id="node79" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2327,1141,2465,1187"/><area shape="rect" id="node81" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2324,1210,2468,1257"/><area shape="rect" id="node21" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2584,5,2747,51"/><area shape="rect" id="node25" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2579,75,2752,104"/><area shape="rect" id="node31" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="2552,127,2779,174"/><area shape="rect" id="node33" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="2579,197,2752,227"/><area shape="rect" id="node35" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="2579,250,2752,297"/><area shape="rect" id="node41" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="2640,320,2691,349"/><area shape="rect" id="node45" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="2585,373,2745,419"/><area shape="rect" id="node49" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2563,443,2768,472"/><area shape="rect" id="node51" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="2564,495,2767,542"/><area shape="rect" id="node53" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="2611,565,2720,595"/><area shape="rect" id="node61" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="2569,626,2761,673"/><area shape="rect" id="node63" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="2569,695,2761,742"/><area shape="rect" id="node85" href="../../dd/df5/a00386.html#afe079cf353957e6c79ed794cbc0bb9fc" title="rocksdb::DBImpl::Recover" alt="" coords="727,645,903,675"/><area shape="rect" id="node92" href="../../d4/d87/a03436.html#a9bb7866c7c33bc353a4568a149194033" title="rocksdb::TEST" alt="" coords="493,788,603,817"/><area shape="rect" id="node96" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="453,478,643,525"/><area shape="rect" id="node99" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="987,431,1184,478"/><area shape="rect" id="node105" href="../../dd/df5/a00386.html#adb8cf2e0f98f8368db32bea16bcf3cb7" title="rocksdb::DBImpl::Recover\lLogFile" alt="" coords="460,598,636,645"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1db8d713be426c044273b2fa01c75c08"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::WaitForFlushMemTable </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01564">1564</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../d3/dff/a02565_source.html#l00309">bg_cv_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00349">bg_error_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00312">imm_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d4/d61/a02588_source.html#l00039">rocksdb::MemTableList::size()</a>, and <a class="el" href="../../de/d7b/a02660_source.html#l00059">rocksdb::port::CondVar::Wait()</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01554">FlushMemTable()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l01581">TEST_WaitForFlushMemTable()</a>.</p>
<div class="fragment"><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                                    {</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  <span class="comment">// Wait until the compaction completes</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717">size</a>() &gt; 0 &amp;&amp; <a class="code" href="../../dd/df5/a00386.html#a79aec493ad501d3e044e08f610591926">bg_error_</a>.<a class="code" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425">ok</a>()) {</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4f7627f46f001610ad9241e9741cd00a">bg_cv_</a>.<a class="code" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36">Wait</a>();</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  }</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a57a62c80616f5fa0f568a36367c85466">imm_</a>.<a class="code" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717">size</a>() != 0) {</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    s = <a class="code" href="../../dd/df5/a00386.html#a79aec493ad501d3e044e08f610591926">bg_error_</a>;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  }</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a1db8d713be426c044273b2fa01c75c08_cgraph.png" border="0" usemap="#dd/df5/a00386_a1db8d713be426c044273b2fa01c75c08_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a1db8d713be426c044273b2fa01c75c08_cgraph" id="dd/df5/a00386_a1db8d713be426c044273b2fa01c75c08_cgraph">
<area shape="rect" id="node3" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="241,5,377,35"/><area shape="rect" id="node5" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="231,58,388,105"/><area shape="rect" id="node7" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="231,127,388,174"/><area shape="rect" id="node9" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="439,136,612,165"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a1db8d713be426c044273b2fa01c75c08_icgraph.png" border="0" usemap="#dd/df5/a00386_a1db8d713be426c044273b2fa01c75c08_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a1db8d713be426c044273b2fa01c75c08_icgraph" id="dd/df5/a00386_a1db8d713be426c044273b2fa01c75c08_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="229,290,419,337"/><area shape="rect" id="node34" href="../../dd/df5/a00386.html#a1a686cee90690cb59d1342551db012df" title="rocksdb::DBImpl::TEST\l_WaitForFlushMemTable" alt="" coords="240,370,408,417"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#aaf39022d45b559b69933cfe719571c10" title="rocksdb::DBImpl::Flush" alt="" coords="477,75,637,104"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a789ea69cfa7ee4fccf934757a4641228" title="rocksdb::DBImpl::TEST\l_FlushMemTable" alt="" coords="476,278,639,325"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#a9bdda420ec5d44390a04215d8b1cbffd" title="rocksdb::DBImpl::~DBImpl" alt="" coords="468,348,647,377"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#aaa4a148182ce98c83d363817e938ddd5" title="rocksdb::DBImpl::GetLive\lFiles" alt="" coords="709,5,883,51"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="741,75,851,104"/><area shape="rect" id="node13" href="../../d0/d88/a01231.html#a07eb4424cb2bef23ca200a806de76d9b" title="rocksdb::ReduceLevelTest\l::CompactMemTable" alt="" coords="707,127,885,174"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="705,247,887,294"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="957,200,1115,229"/><area shape="rect" id="node23" href="../../de/de8/a00405.html#a49dbce26ebba1e0ac3f38a3af92b9757" title="rocksdb::DeleteFileTest\l::CreateTwoLevels" alt="" coords="716,423,876,470"/><area shape="rect" id="node25" href="../../db/d95/a00391.html#a09218d973702b7be115bc4a65c0d97b9" title="rocksdb::DBTest::MakeTables" alt="" coords="696,317,896,347"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="741,371,851,400"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="981,256,1091,285"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="1177,200,1287,229"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#af32d610cb80f870ed942c9ec7a053675" title="rocksdb::DBTest::FillLevels" alt="" coords="944,317,1128,347"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a036d197e1bf77abea19c23696305cf34"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::Write </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../da/d4b/a01848.html">WriteOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/dbd/a01844.html">WriteBatch</a> *&#160;</td>
          <td class="paramname"><em>updates</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/ddd/a00380.html#ad5d37a09e90d0c22c9a0adca87267ebc">rocksdb::DB</a>.</p>

<p>Reimplemented in <a class="el" href="../../db/db9/a00387.html#af25a77ae6eaf59a72bfdf94394861685">rocksdb::DBImplReadOnly</a>.</p>

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l02759">2759</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../db/d44/a02564_source.html#l00065">rocksdb::DBImpl::Writer::batch</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00349">bg_error_</a>, <a class="el" href="../../db/d44/a02564_source.html#l02866">BuildBatchGroup()</a>, <a class="el" href="../../d9/d93/a02753_source.html#l00026">rocksdb::BumpPerfTime()</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00069">rocksdb::BYTES_WRITTEN</a>, <a class="el" href="../../d0/dce/a02617_source.html#l00041">rocksdb::WriteBatchInternal::ByteSize()</a>, <a class="el" href="../../d6/dca/a02616_source.html#l00060">rocksdb::WriteBatch::Clear()</a>, <a class="el" href="../../d0/dce/a02617_source.html#l00037">rocksdb::WriteBatchInternal::Contents()</a>, <a class="el" href="../../d6/dca/a02616_source.html#l00126">rocksdb::WriteBatchInternal::Count()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00069">rocksdb::DBImpl::Writer::cv</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00167">rocksdb::DB_WRITE</a>, <a class="el" href="../../db/d44/a02564_source.html#l00067">rocksdb::DBImpl::Writer::disableWAL</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00721">rocksdb::WriteOptions::disableWAL</a>, <a class="el" href="../../db/d44/a02564_source.html#l00068">rocksdb::DBImpl::Writer::done</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00586">rocksdb::Options::filter_deletes</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00384">flush_on_destroy_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d6/dca/a02616_source.html#l00228">rocksdb::WriteBatchInternal::InsertInto()</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00314">log_</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00311">mem_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00063">rocksdb::NUMBER_KEYS_WRITTEN</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00125">rocksdb::Options::paranoid_checks</a>, <a class="el" href="../../dc/d3d/a02752_source.html#l00028">rocksdb::perf_context</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00280">rocksdb::RecordTick()</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00093">rocksdb::SEQUENCE_NUMBER</a>, <a class="el" href="../../d6/dca/a02616_source.html#l00138">rocksdb::WriteBatchInternal::SetSequence()</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00290">rocksdb::SetTickerCount()</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00063">rocksdb::port::CondVar::Signal()</a>, <a class="el" href="../../d9/d93/a02753_source.html#l00014">rocksdb::StartPerfTimer()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00348">rocksdb::Options::statistics</a>, <a class="el" href="../../db/d44/a02564_source.html#l00064">rocksdb::DBImpl::Writer::status</a>, <a class="el" href="../../db/d44/a02564_source.html#l00066">rocksdb::DBImpl::Writer::sync</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00717">rocksdb::WriteOptions::sync</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00320">tmp_batch_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00363">rocksdb::Options::use_fsync</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00059">rocksdb::port::CondVar::Wait()</a>, <a class="el" href="../../de/d4c/a02641_source.html#l00171">rocksdb::WAL_FILE_SYNC_MICROS</a>, <a class="el" href="../../d8/dab/a02638_source.html#l00041">rocksdb::PerfContext::wal_write_time</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00319">writers_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01554">FlushMemTable()</a>, and <a class="el" href="../../d1/d67/a02561_source.html#l00218">rocksdb::TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                                                                      {</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;  Writer w(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;  w.batch = my_batch;</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;  w.sync = options.sync;</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;  w.disableWAL = options.disableWAL;</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;  w.done = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;  StopWatch sw(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aea039054a83466e88e68fb2562599325bd">DB_WRITE</a>);</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;  MutexLock l(&amp;<a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>);</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a2d3abc2f19390f60d4a922b98dd23450">writers_</a>.push_back(&amp;w);</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;  <span class="keywordflow">while</span> (!w.done &amp;&amp; &amp;w != <a class="code" href="../../dd/df5/a00386.html#a2d3abc2f19390f60d4a922b98dd23450">writers_</a>.front()) {</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;    w.cv.Wait();</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;  }</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;  <span class="keywordflow">if</span> (w.done) {</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;    <span class="keywordflow">return</span> w.status;</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;  }</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;  <span class="comment">// May temporarily unlock and wait.</span></div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> status = <a class="code" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f">MakeRoomForWrite</a>(my_batch == <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> last_sequence = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;LastSequence();</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;  Writer* last_writer = &amp;w;</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;  <span class="keywordflow">if</span> (status.ok() &amp;&amp; my_batch != <span class="keyword">nullptr</span>) {  <span class="comment">// nullptr batch is for compactions</span></div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;    <span class="comment">// TODO: BuildBatchGroup physically concatenate/copy all write batches into</span></div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    <span class="comment">// a new one. Mem copy is done with the lock held. Ideally, we only need</span></div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    <span class="comment">// the lock to obtain the last_writer and the references to all batches.</span></div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;    <span class="comment">// Creation (copy) of the merged batch could have been done outside of the</span></div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    <span class="comment">// lock protected region.</span></div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;    WriteBatch* updates = <a class="code" href="../../dd/df5/a00386.html#acbfdfdd72e490648da9f229fdcd06337">BuildBatchGroup</a>(&amp;last_writer);</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;    <span class="comment">// Add to log and apply to memtable.  We can release the lock</span></div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;    <span class="comment">// during this phase since &amp;w is currently responsible for logging</span></div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;    <span class="comment">// and protects against concurrent loggers and concurrent writes</span></div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;    <span class="comment">// into mem_.</span></div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    {</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> current_sequence = last_sequence + 1;</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;      <a class="code" href="../../da/d8c/a01845.html#a2c7f53a4c8d710fdbf229c917506f7ab">WriteBatchInternal::SetSequence</a>(updates, current_sequence);</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;      <span class="keywordtype">int</span> my_batch_count = <a class="code" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478">WriteBatchInternal::Count</a>(updates);</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;      last_sequence += my_batch_count;</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;      <span class="comment">// Record statistics</span></div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29daa2f95cefe020b4e606d4cdb9498df5d4">NUMBER_KEYS_WRITTEN</a>, my_batch_count);</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f">RecordTick</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>,</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;                 <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29da696cefae26a5c258d6ff4cf014fb6420">BYTES_WRITTEN</a>,</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;                 <a class="code" href="../../da/d8c/a01845.html#a04c6bd515d35bda6ffa8ae21ab1e1478">WriteBatchInternal::ByteSize</a>(updates));</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;      <span class="keywordflow">if</span> (options.disableWAL) {</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a917f2b90eead9ad2465a74dc1d9f52d6">flush_on_destroy_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;      }</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;      <span class="keywordflow">if</span> (!options.disableWAL) {</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;        StopWatchNano timer(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>);</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#a48457fd59325e708afa7fff617f87e05">StartPerfTimer</a>(&amp;timer);</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;        status = <a class="code" href="../../dd/df5/a00386.html#a0801eebdc654c9987f70ba512e9c45f4">log_</a>-&gt;AddRecord(<a class="code" href="../../da/d8c/a01845.html#af28dbb69a970e8ab218402339f0bb7ee">WriteBatchInternal::Contents</a>(updates));</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#af0bd42ecfc79c4765b60919d28702a29">BumpPerfTime</a>(&amp;<a class="code" href="../../d4/d87/a03436.html#a0e081cdede5773a875f5f8c546665d14">perf_context</a>.<a class="code" href="../../d6/d40/a01114.html#ab8c15a92eea93e49e8b9754c3adc672b">wal_write_time</a>, &amp;timer);</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;        <span class="keywordflow">if</span> (status.ok() &amp;&amp; options.sync) {</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6244d1e80d67ab065f2f7262ee2d8135">use_fsync</a>) {</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;            StopWatch(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aea5b5ab048ed312032ba853433bec72ef8">WAL_FILE_SYNC_MICROS</a>);</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;            status = <a class="code" href="../../dd/df5/a00386.html#a0801eebdc654c9987f70ba512e9c45f4">log_</a>-&gt;file()-&gt;Fsync();</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;            StopWatch(<a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#aed81c17e6efeb53fc166f997bc7f46aea5b5ab048ed312032ba853433bec72ef8">WAL_FILE_SYNC_MICROS</a>);</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;            status = <a class="code" href="../../dd/df5/a00386.html#a0801eebdc654c9987f70ba512e9c45f4">log_</a>-&gt;file()-&gt;Sync();</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;          }</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;        }</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;      }</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;      <span class="keywordflow">if</span> (status.ok()) {</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;        status = <a class="code" href="../../da/d8c/a01845.html#aa10e1abb5f141e75e184bf456a5d65a6">WriteBatchInternal::InsertInto</a>(updates, <a class="code" href="../../dd/df5/a00386.html#aa363f82be90e7c8172d31ba1209e6574">mem_</a>, &amp;<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>, <span class="keyword">this</span>,</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;                                                <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a4b52d691488b6160cfef6958213a3a87">filter_deletes</a>);</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;        <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;          <span class="comment">// Panic for in-memory corruptions</span></div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;          <span class="comment">// Note that existing logic was not sound. Any partial failure writing</span></div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;          <span class="comment">// into the memtable would result in a state that some write ops might</span></div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;          <span class="comment">// have succeeded in memtable but Status reports error for all writes.</span></div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;          <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;In memory WriteBatch corruption!&quot;</span>);</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;        }</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#a9231fa7580b3932152d6f3bd39907320">SetTickerCount</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a6697eb6f30b8f77ef7e65269426cccea">statistics</a>, <a class="code" href="../../d4/d87/a03436.html#ab8dee63c631c7f43603253477f34a29da131963a69c58e95661753c7544e9b07f">SEQUENCE_NUMBER</a>, last_sequence);</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;      }</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;      <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;      <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;      <span class="keywordflow">if</span> (status.ok()) {</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;SetLastSequence(last_sequence);</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;      }</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;    }</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    <span class="keywordflow">if</span> (updates == &amp;<a class="code" href="../../dd/df5/a00386.html#adac005f654a15bf772dbd40a06ea2762">tmp_batch_</a>) <a class="code" href="../../dd/df5/a00386.html#adac005f654a15bf772dbd40a06ea2762">tmp_batch_</a>.<a class="code" href="../../d2/dbd/a01844.html#a73502c77c1ebdf40417a34eb385e117e">Clear</a>();</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;  }</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a3caefadde126ce359200ea7742e3dba7">paranoid_checks</a> &amp;&amp; !status.ok() &amp;&amp; <a class="code" href="../../dd/df5/a00386.html#a79aec493ad501d3e044e08f610591926">bg_error_</a>.<a class="code" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425">ok</a>()) {</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a79aec493ad501d3e044e08f610591926">bg_error_</a> = status; <span class="comment">// stop compaction &amp; fail any further writes</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;  }</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    Writer* ready = <a class="code" href="../../dd/df5/a00386.html#a2d3abc2f19390f60d4a922b98dd23450">writers_</a>.front();</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a2d3abc2f19390f60d4a922b98dd23450">writers_</a>.pop_front();</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;    <span class="keywordflow">if</span> (ready != &amp;w) {</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;      ready-&gt;status = status;</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;      ready-&gt;done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;      ready-&gt;cv.Signal();</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;    }</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;    <span class="keywordflow">if</span> (ready == last_writer) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;  }</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;  <span class="comment">// Notify new head of write queue</span></div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../dd/df5/a00386.html#a2d3abc2f19390f60d4a922b98dd23450">writers_</a>.empty()) {</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a2d3abc2f19390f60d4a922b98dd23450">writers_</a>.front()-&gt;cv.Signal();</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;  }</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;  <span class="keywordflow">return</span> status;</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a036d197e1bf77abea19c23696305cf34_cgraph.png" border="0" usemap="#dd/df5/a00386_a036d197e1bf77abea19c23696305cf34_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a036d197e1bf77abea19c23696305cf34_cgraph" id="dd/df5/a00386_a036d197e1bf77abea19c23696305cf34_cgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#acbfdfdd72e490648da9f229fdcd06337" title="rocksdb::DBImpl::BuildBatch\lGroup" alt="" coords="216,179,405,226"/><area shape="rect" id="node9" href="../../da/d8c/a01845.html#a3a404e8b1f29c53fc2d3b2a70dfb8478" title="rocksdb::WriteBatchInternal\l::Count" alt="" coords="976,118,1160,165"/><area shape="rect" id="node13" href="../../da/d8c/a01845.html#a04c6bd515d35bda6ffa8ae21ab1e1478" title="rocksdb::WriteBatchInternal\l::ByteSize" alt="" coords="484,241,668,287"/><area shape="rect" id="node18" href="../../d4/d87/a03436.html#af0bd42ecfc79c4765b60919d28702a29" title="rocksdb::BumpPerfTime" alt="" coords="229,384,392,413"/><area shape="rect" id="node25" href="../../d2/dbd/a01844.html#a73502c77c1ebdf40417a34eb385e117e" title="rocksdb::WriteBatch\l::Clear" alt="" coords="240,490,381,537"/><area shape="rect" id="node27" href="../../da/d8c/a01845.html#af28dbb69a970e8ab218402339f0bb7ee" title="rocksdb::WriteBatchInternal\l::Contents" alt="" coords="219,559,403,606"/><area shape="rect" id="node30" href="../../da/d8c/a01845.html#aa10e1abb5f141e75e184bf456a5d65a6" title="rocksdb::WriteBatchInternal\l::InsertInto" alt="" coords="484,310,668,357"/><area shape="rect" id="node40" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="505,569,647,615"/><area shape="rect" id="node44" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="247,1393,375,1423"/><area shape="rect" id="node46" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="213,1222,408,1269"/><area shape="rect" id="node75" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="508,1945,644,1975"/><area shape="rect" id="node77" href="../../d4/d87/a03436.html#a833e685de1acb680b321c566cadffc9f" title="rocksdb::RecordTick" alt="" coords="505,1999,647,2028"/><area shape="rect" id="node93" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="505,638,647,685"/><area shape="rect" id="node96" href="../../d0/d39/a00314.html#a9a27f5d121a10761fdd380e5677c7d36" title="rocksdb::port::CondVar\l::Wait" alt="" coords="497,707,655,754"/><area shape="rect" id="node101" href="../../da/d8c/a01845.html#a2c7f53a4c8d710fdbf229c917506f7ab" title="rocksdb::WriteBatchInternal\l::SetSequence" alt="" coords="219,1446,403,1493"/><area shape="rect" id="node105" href="../../d4/d87/a03436.html#a9231fa7580b3932152d6f3bd39907320" title="rocksdb::SetTickerCount" alt="" coords="228,1516,393,1545"/><area shape="rect" id="node107" href="../../d0/d39/a00314.html#a84d028d8d526b7ce592433ba836a1853" title="rocksdb::port::CondVar\l::Signal" alt="" coords="232,629,389,675"/><area shape="rect" id="node110" href="../../d4/d87/a03436.html#a48457fd59325e708afa7fff617f87e05" title="rocksdb::StartPerfTimer" alt="" coords="231,437,391,467"/><area shape="rect" id="node5" href="../../da/d8c/a01845.html#a3e28aed1201077095cf66c5e242d1630" title="rocksdb::WriteBatchInternal\l::Append" alt="" coords="484,118,668,165"/><area shape="rect" id="node16" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e" title="beast.util.Iter.first" alt="" coords="515,188,637,217"/><area shape="rect" id="node7" href="../../d2/dbd/a01844.html#aab1bed53a5b803c151374a4a0788257a" title="rocksdb::WriteBatch\l::Count" alt="" coords="765,118,907,165"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a5eb46c01bbc65cc301b2648e655dbe15" title="rocksdb::DecodeFixed32" alt="" coords="1209,187,1375,216"/><area shape="rect" id="node20" href="../../d6/d82/a01565.html#a7354735b3199a8e7ce3d1b7368460576" title="rocksdb::StopWatchNano\l::ElapsedNanos" alt="" coords="491,379,661,426"/><area shape="rect" id="node22" href="../../db/db1/a00460.html#ae5122204652862ba303b904aa4f4cdd6" title="rocksdb::Env::NowNanos" alt="" coords="751,423,921,452"/><area shape="rect" id="node32" href="../../da/d8c/a01845.html#a46b10bbe30119a1a8669a0bf82f9fd44" title="rocksdb::WriteBatchInternal\l::Sequence" alt="" coords="744,297,928,343"/><area shape="rect" id="node37" href="../../d2/dbd/a01844.html#ac5f77d59bf05e77679fc2ad832e1ccdf" title="rocksdb::WriteBatch\l::Iterate" alt="" coords="765,201,907,247"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="985,247,1151,276"/><area shape="rect" id="node42" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="749,612,923,641"/><area shape="rect" id="node48" href="../../d7/dd4/a00968.html#a889613116ef509399ebb13a714e236d6" title="rocksdb::MemTableList::Add" alt="" coords="481,1231,671,1260"/><area shape="rect" id="node50" href="../../d3/dcd/a00965.html#a3232b72cba2586f3d6dbd08d8b4be86d" title="rocksdb::MemTable::\lApproximateMemoryUsage" alt="" coords="487,1283,665,1330"/><area shape="rect" id="node52" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="765,1389,907,1435"/><area shape="rect" id="node54" href="../../dd/df5/a00386.html#a24b1211b5a5fbfccfe0818c32753ff5f" title="rocksdb::DBImpl::DelayLogging\lAndReset" alt="" coords="473,1523,679,1570"/><area shape="rect" id="node56" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="788,1488,884,1517"/><area shape="rect" id="node58" href="../../d8/d6c/a01563.html#a2265fb9a74a457ec56cc61f60ea5353e" title="rocksdb::StopWatch\l::ElapsedMicros" alt="" coords="505,1593,647,1639"/><area shape="rect" id="node60" href="../../d7/dd4/a00968.html#acd9439e034e085a62a05850d9ba39c7a" title="rocksdb::MemTableList\l::FlushRequested" alt="" coords="497,1662,655,1709"/><area shape="rect" id="node64" href="../../d4/d87/a03436.html#ad2e1157820fce4ccbfc1846e12be2477" title="rocksdb::LogFileName" alt="" coords="500,1732,652,1761"/><area shape="rect" id="node66" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="533,1785,619,1815"/><area shape="rect" id="node68" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="465,1403,687,1450"/><area shape="rect" id="node71" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="475,1839,677,1868"/><area shape="rect" id="node73" href="../../dd/df5/a00386.html#aaecfe0733c5634343143bf3e9f705880" title="rocksdb::DBImpl::NumberLevels" alt="" coords="471,1892,681,1921"/><area shape="rect" id="node79" href="../../d3/dcd/a00965.html#a8b0d6e039cbe5358af87227ff8b12eb5" title="rocksdb::MemTable::Ref" alt="" coords="493,777,659,807"/><area shape="rect" id="node81" href="../../d0/dbf/a03363.html#a5187fa615e47f5c845d5f1b4fc0cb527" title="beast::hash_metrics\l::detail::score" alt="" coords="507,830,645,877"/><area shape="rect" id="node83" href="../../d3/dcd/a00965.html#a81f80d2b6674d454e4b65f238281d716" title="rocksdb::MemTable::\lSetLogNumber" alt="" coords="504,899,648,946"/><area shape="rect" id="node85" href="../../d3/dcd/a00965.html#a08633ea1ccd8277c4bad90686e12e59d" title="rocksdb::MemTable::\lSetNextLogNumber" alt="" coords="504,969,648,1015"/><area shape="rect" id="node87" href="../../d7/dd4/a00968.html#ae112ddcadd6bfd1a87648683a4189717" title="rocksdb::MemTableList\l::size" alt="" coords="497,1038,655,1085"/><area shape="rect" id="node89" href="../../db/db1/a00460.html#a93416572ace483f9a64c6a531ccc016b" title="rocksdb::Env::SleepForMicroseconds" alt="" coords="456,1108,696,1137"/><area shape="rect" id="node91" href="../../dd/df5/a00386.html#a4bd51a8c14d950ad017734df3a7b851c" title="rocksdb::DBImpl::Slowdown\lAmount" alt="" coords="483,1161,669,1207"/><area shape="rect" id="node103" href="../../d4/d87/a03436.html#a0a6b5f485f1b3d6f33ead2fc4d7c891c" title="rocksdb::EncodeFixed64" alt="" coords="493,2052,659,2081"/><area shape="rect" id="node112" href="../../d6/d82/a01565.html#ab4ee8b0d656efc48fb33c09fe0c10646" title="rocksdb::StopWatchNano\l::Start" alt="" coords="491,449,661,495"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a036d197e1bf77abea19c23696305cf34_icgraph.png" border="0" usemap="#dd/df5/a00386_a036d197e1bf77abea19c23696305cf34_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a036d197e1bf77abea19c23696305cf34_icgraph" id="dd/df5/a00386_a036d197e1bf77abea19c23696305cf34_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="213,247,403,294"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="253,317,363,347"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#aaf39022d45b559b69933cfe719571c10" title="rocksdb::DBImpl::Flush" alt="" coords="461,75,621,104"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a789ea69cfa7ee4fccf934757a4641228" title="rocksdb::DBImpl::TEST\l_FlushMemTable" alt="" coords="460,247,623,294"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#a9bdda420ec5d44390a04215d8b1cbffd" title="rocksdb::DBImpl::~DBImpl" alt="" coords="452,317,631,347"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#aaa4a148182ce98c83d363817e938ddd5" title="rocksdb::DBImpl::GetLive\lFiles" alt="" coords="693,5,867,51"/><area shape="rect" id="node9" href="../../d4/d87/a03436.html#ae83d9e0143c5cb2f28a47460a91fe73e" title="rocksdb::TEST" alt="" coords="725,75,835,104"/><area shape="rect" id="node13" href="../../d0/d88/a01231.html#a07eb4424cb2bef23ca200a806de76d9b" title="rocksdb::ReduceLevelTest\l::CompactMemTable" alt="" coords="691,127,869,174"/><area shape="rect" id="node15" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="689,247,871,294"/><area shape="rect" id="node17" href="../../d4/d87/a03436.html#ac01378f7c8c05426b6dfdeda9546473b" title="rocksdb::PrefixScanInit" alt="" coords="941,200,1099,229"/><area shape="rect" id="node23" href="../../de/de8/a00405.html#a49dbce26ebba1e0ac3f38a3af92b9757" title="rocksdb::DeleteFileTest\l::CreateTwoLevels" alt="" coords="700,317,860,363"/><area shape="rect" id="node25" href="../../db/d95/a00391.html#a09218d973702b7be115bc4a65c0d97b9" title="rocksdb::DBTest::MakeTables" alt="" coords="680,387,880,416"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="725,440,835,469"/><area shape="rect" id="node21" href="../../d4/d87/a03436.html#a80e6c2a14ed6de6ef8f6aeeac1ba4bd2" title="rocksdb::TEST" alt="" coords="965,256,1075,285"/><area shape="rect" id="node19" href="../../d4/d87/a03436.html#aee7713706576484996cbcefb0317f874" title="rocksdb::TEST" alt="" coords="1161,200,1271,229"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#af32d610cb80f870ed942c9ec7a053675" title="rocksdb::DBTest::FillLevels" alt="" coords="928,387,1112,416"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac3d320a145d5d36cb2bbf9e57b39ae8a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::WriteLevel0Table </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d3/dcd/a00965.html">MemTable</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>mems</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d86/a01798.html">VersionEdit</a> *&#160;</td>
          <td class="paramname"><em>edit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> *&#160;</td>
          <td class="paramname"><em>filenumber</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l01025">1025</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d3b/a02610_source.html#l00072">rocksdb::VersionEdit::AddFile()</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../dc/d40/a02767_source.html#l00022">base</a>, <a class="el" href="../../dd/d98/a02557_source.html#l00035">rocksdb::BuildTable()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00398">rocksdb::DBImpl::CompactionStats::bytes_written</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00579">rocksdb::Options::compaction_options_universal</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00576">rocksdb::Options::compaction_style</a>, <a class="el" href="../../d2/d11/a02647_source.html#l00070">rocksdb::CompactionOptionsUniversal::compression_size_percent</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00176">dbname_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00024">rocksdb::FileMetaData::file_size</a>, <a class="el" href="../../dd/d05/a02601_source.html#l00074">rocksdb::SnapshotList::GetNewest()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00178">internal_comparator_</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00056">rocksdb::kCompactionStyleLevel</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00057">rocksdb::kCompactionStyleUniversal</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00026">rocksdb::FileMetaData::largest</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00029">rocksdb::FileMetaData::largest_seqno</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00401">rocksdb::Options::max_background_compactions</a>, <a class="el" href="../../de/d94/a02597_source.html#l00095">meta</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00389">rocksdb::DBImpl::CompactionStats::micros</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../de/db4/a02684_source.html#l00217">rocksdb::NewMergingIterator()</a>, <a class="el" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">rocksdb::Env::NowMicros()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00023">rocksdb::FileMetaData::number</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00326">pending_outputs_</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00611">rocksdb::Version::PickLevelForMemTableOutput()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00591">rocksdb::Version::Ref()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00025">rocksdb::FileMetaData::smallest</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00028">rocksdb::FileMetaData::smallest_seqno</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00322">snapshots_</a>, <a class="el" href="../../d6/d50/a02694_source.html#l00667">stats</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00429">stats_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00451">storage_options_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00301">table_cache_</a>, <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, <a class="el" href="../../d6/dfc/a02612_source.html#l00595">rocksdb::Version::Unref()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00181">user_comparator()</a>, <a class="el" href="../../dc/db2/a02574_source.html#l00141">rocksdb::InternalKey::user_key()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01113">FlushMemTableToOutputFile()</a>.</p>
<div class="fragment"><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                                                      {</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> start_micros = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">NowMicros</a>();</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  FileMetaData <a class="code" href="../../de/d94/a02597.html#a6b8f1f5fc8f36aa1678fff8fa5aecd0b">meta</a>;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  meta.number = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NewFileNumber();</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  *filenumber = meta.number;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a1a62212922480c1ca92b25a555b3410e">pending_outputs_</a>.insert(meta.number);</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  std::vector&lt;Iterator*&gt; list;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="keywordflow">for</span> (MemTable* m : mems) {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <span class="stringliteral">&quot;Flushing memtable with log file: %lu\n&quot;</span>,</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)m-&gt;GetLogNumber());</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    list.push_back(m-&gt;NewIterator());</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  Iterator* iter = <a class="code" href="../../d4/d87/a03436.html#a678cf0fa28a2449c444344ea1feef654">NewMergingIterator</a>(&amp;<a class="code" href="../../dd/df5/a00386.html#aa92d556db5d7f5bc58f2531cd124729d">internal_comparator_</a>, &amp;list[0],</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                                      list.size());</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> newest_snapshot = <a class="code" href="../../dd/df5/a00386.html#a6bf69eb135ada49bd652b4421ccc14af">snapshots_</a>.<a class="code" href="../../dc/de6/a01426.html#aab9c275d08ac06c7ca97116328298b9c">GetNewest</a>();</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> earliest_seqno_in_memtable =</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    mems[0]-&gt;GetFirstSequenceNumber();</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>,</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      <span class="stringliteral">&quot;Level-0 flush table #%lu: started&quot;</span>,</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)meta.number);</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  Version* <a class="code" href="../../dc/d40/a02767.html#a70ff0f6c026c3dd1ef6aaf504e7fddc3">base</a> = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current();</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  base-&gt;Ref();          <span class="comment">// it is likely that we do not need this reference</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  {</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="comment">// We skip compression if universal compression is used and the size</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="comment">// threshold is set for compression.</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="keywordtype">bool</span> enable_compression = (<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        != <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3aefaf1f8ff48624bfa415c461ba0bf88e">kCompactionStyleUniversal</a> ||</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a2b4cedd34a649927cb4232c9f05cd5aa">compaction_options_universal</a>.<a class="code" href="../../d9/d0d/a00298.html#afcd15128bac78da1023eff339c63d015">compression_size_percent</a> &lt; 0);</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    s = <a class="code" href="../../d4/d87/a03436.html#a54b259d9ef3d218359bf85355d87aa8e">BuildTable</a>(<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>, <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>, <a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>,</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                   <a class="code" href="../../dd/df5/a00386.html#a1b44e75ddaf3ea3befcd06b23ca9abb6">table_cache_</a>.get(), iter, &amp;<a class="code" href="../../de/d94/a02597.html#a6b8f1f5fc8f36aa1678fff8fa5aecd0b">meta</a>,</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                   <a class="code" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0">user_comparator</a>(), newest_snapshot,</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                   earliest_seqno_in_memtable, enable_compression);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  }</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  base-&gt;Unref();</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Level-0 flush table #%lu: %lu bytes %s&quot;</span>,</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) meta.number,</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) meta.file_size,</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      s.ToString().c_str());</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="keyword">delete</span> iter;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="comment">// re-acquire the most current version</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  base = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;current();</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="comment">// There could be multiple threads writing to its own level-0 file.</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="comment">// The pending_outputs cannot be cleared here, otherwise this newly</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="comment">// created file might not be considered as a live-file by another</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="comment">// compaction thread that is concurrently deleting obselete files.</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  <span class="comment">// The pending_outputs can be cleared only after the new version is</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="comment">// committed so that other threads can recognize this file as a</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <span class="comment">// valid one.</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <span class="comment">// pending_outputs_.erase(meta.number);</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <span class="comment">// Note that if file_size is zero, the file has been deleted and</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <span class="comment">// should not be added to the manifest.</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="keywordtype">int</span> level = 0;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="keywordflow">if</span> (s.ok() &amp;&amp; meta.file_size &gt; 0) {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="keyword">const</span> Slice min_user_key = meta.smallest.user_key();</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="keyword">const</span> Slice max_user_key = meta.largest.user_key();</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="comment">// if we have more than 1 background thread, then we cannot</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="comment">// insert files directly into higher levels because some other</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="comment">// threads could be concurrently producing compacted files for</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="comment">// that key range.</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="keywordflow">if</span> (base != <span class="keyword">nullptr</span> &amp;&amp; <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acfc44c7252fbd8c8d98c42903014dbbc">max_background_compactions</a> &lt;= 1 &amp;&amp;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#a93ac3afe284f10d980260885d162e0dd">compaction_style</a> == <a class="code" href="../../d4/d87/a03436.html#a5f567c14ba4b080c175765f51c9e63c3a88cfee1400580317ff05c5e3fddc2796">kCompactionStyleLevel</a>) {</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      level = base-&gt;PickLevelForMemTableOutput(min_user_key, max_user_key);</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    }</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    edit-&gt;AddFile(level, meta.number, meta.file_size,</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                  meta.smallest, meta.largest,</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                  meta.smallest_seqno, meta.largest_seqno);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  }</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  CompactionStats <a class="code" href="../../d6/d50/a02694.html#a5925d216740c89f43482df806fd14e8c">stats</a>;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  stats.micros = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">NowMicros</a>() - start_micros;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  stats.bytes_written = meta.file_size;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].Add(stats);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ac3d320a145d5d36cb2bbf9e57b39ae8a_cgraph.png" border="0" usemap="#dd/df5/a00386_ac3d320a145d5d36cb2bbf9e57b39ae8a_cgraph" alt=""/></div>
<map name="dd/df5/a00386_ac3d320a145d5d36cb2bbf9e57b39ae8a_cgraph" id="dd/df5/a00386_ac3d320a145d5d36cb2bbf9e57b39ae8a_cgraph">
<area shape="rect" id="node3" href="../../d2/d86/a01798.html#a62a14d8606dbc1d557b6e3bb55c617dd" title="rocksdb::VersionEdit\l::AddFile" alt="" coords="276,698,417,745"/><area shape="rect" id="node5" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="276,767,417,814"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a54b259d9ef3d218359bf85355d87aa8e" title="rocksdb::BuildTable" alt="" coords="279,837,415,867"/><area shape="rect" id="node48" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="749,1568,885,1597"/><area shape="rect" id="node71" href="../../dc/de6/a01426.html#aab9c275d08ac06c7ca97116328298b9c" title="rocksdb::SnapshotList\l::GetNewest" alt="" coords="271,1679,423,1726"/><area shape="rect" id="node78" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="276,1818,417,1865"/><area shape="rect" id="node82" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="299,1888,395,1917"/><area shape="rect" id="node84" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="283,1941,411,1971"/><area shape="rect" id="node86" href="../../d4/d87/a03436.html#a678cf0fa28a2449c444344ea1feef654" title="rocksdb::NewMergingIterator" alt="" coords="252,1995,441,2024"/><area shape="rect" id="node90" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="260,2048,433,2077"/><area shape="rect" id="node93" href="../../d4/dd1/a01797.html#a8cd69a62e51d319948e7e85cdc5686c3" title="rocksdb::Version::PickLevel\lForMemTableOutput" alt="" coords="255,2101,439,2147"/><area shape="rect" id="node99" href="../../d4/dd1/a01797.html#af720448137d10341732ca283eefe0bd2" title="rocksdb::Version::Ref" alt="" coords="272,2171,421,2200"/><area shape="rect" id="node101" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="261,2224,432,2253"/><area shape="rect" id="node103" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="276,1749,417,1795"/><area shape="rect" id="node106" href="../../d4/dd1/a01797.html#a54bd122a7534f61aeddf599ddf2dd45d" title="rocksdb::Version::Unref" alt="" coords="267,2277,427,2307"/><area shape="rect" id="node108" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0" title="rocksdb::DBImpl::user\l_comparator" alt="" coords="271,2330,423,2377"/><area shape="rect" id="node110" href="../../de/de6/a00723.html#acca0686883e32fd3876bfacc844f4f3a" title="rocksdb::InternalKey\l::user_key" alt="" coords="276,2399,417,2446"/><area shape="rect" id="node9" href="../../d2/dcc/a01623.html#ad007bf262f2bd82e6a88d994c0d94e95" title="rocksdb::TableBuilder\l::Abandon" alt="" coords="519,1247,665,1294"/><area shape="rect" id="node11" href="../../d2/dcc/a01623.html#a771e9853403a3ee66a66929e75d63f81" title="rocksdb::TableBuilder::Add" alt="" coords="503,1317,681,1347"/><area shape="rect" id="node13" href="../../d9/d75/a01843.html#ade502f1bafbb7db1b916d28ca16cc752" title="rocksdb::WritableFile\l::Close" alt="" coords="520,1370,664,1417"/><area shape="rect" id="node15" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="520,1439,664,1486"/><area shape="rect" id="node17" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="748,355,887,384"/><area shape="rect" id="node19" href="../../de/de6/a00723.html#a87df954d098adf219ebd79ae6f5b75f3" title="rocksdb::InternalKey\l::DecodeFrom" alt="" coords="521,303,663,350"/><area shape="rect" id="node22" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="749,281,885,311"/><area shape="rect" id="node24" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="509,59,675,88"/><area shape="rect" id="node26" href="../../d2/dcc/a01623.html#af4660489a6b24d42577ca3e4709c5d4d" title="rocksdb::TableBuilder\l::FileSize" alt="" coords="519,111,665,158"/><area shape="rect" id="node28" href="../../d2/dcc/a01623.html#a704e26305a747bc055c883cd35e18e8d" title="rocksdb::TableBuilder\l::Finish" alt="" coords="519,181,665,227"/><area shape="rect" id="node30" href="../../d9/d75/a01843.html#aaec9388e46e89e6b6706691e72b1430a" title="rocksdb::WritableFile\l::Fsync" alt="" coords="520,741,664,787"/><area shape="rect" id="node32" href="../../d9/d75/a01843.html#a739dc13d33b6716dce73e44a472ba1dd" title="rocksdb::WritableFile\l::Sync" alt="" coords="745,711,889,758"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#a79e23f5792d55281c43f7a8ea8588fea" title="rocksdb::GetInternalKeySeqno" alt="" coords="492,373,692,403"/><area shape="rect" id="node38" href="../../d4/d87/a03436.html#ae570859de3fcc573a6f3d6f42bbd6627" title="rocksdb::GetTableBuilder" alt="" coords="508,477,676,507"/><area shape="rect" id="node40" href="../../d2/d02/a00777.html#a34cfd17f7b64652774de76cbc0e5b202" title="rocksdb::Iterator::key" alt="" coords="519,531,665,560"/><area shape="rect" id="node42" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="549,584,635,613"/><area shape="rect" id="node44" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="551,637,633,667"/><area shape="rect" id="node46" href="../../de/df9/a01624.html#a59b62bf2644f7cf62feb7275085a9185" title="rocksdb::TableCache\l::NewIterator" alt="" coords="519,1559,665,1606"/><area shape="rect" id="node50" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="491,811,693,840"/><area shape="rect" id="node52" href="../../d2/d02/a00777.html#a06da095e0c88cc65ac23e4ec88d0a390" title="rocksdb::Iterator::Next" alt="" coords="516,864,668,893"/><area shape="rect" id="node55" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2" title="rocksdb::ParseInternalKey" alt="" coords="504,251,680,280"/><area shape="rect" id="node59" href="../../d2/d02/a00777.html#a99d2e05c952cecb0f4a0fa60412bafc2" title="rocksdb::Iterator::\lSeekToFirst" alt="" coords="529,917,655,963"/><area shape="rect" id="node62" href="../../d2/d02/a00777.html#a5435c832490b19d4c3aebf7c4877098d" title="rocksdb::Iterator::\lstatus" alt="" coords="529,986,655,1033"/><area shape="rect" id="node65" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="511,1056,673,1085"/><area shape="rect" id="node67" href="../../d2/d02/a00777.html#a866c8627787b3a768273ae4893f27f8f" title="rocksdb::Iterator::\lValid" alt="" coords="529,1109,655,1155"/><area shape="rect" id="node69" href="../../d2/d02/a00777.html#a1a503134af26025486d5c640e49cdf54" title="rocksdb::Iterator::\lvalue" alt="" coords="529,1178,655,1225"/><area shape="rect" id="node73" href="../../dc/de6/a01426.html#acc40bb270942cc53168b9c718288b283" title="rocksdb::SnapshotList\l::empty" alt="" coords="741,1705,893,1751"/><area shape="rect" id="node75" href="../../dc/de6/a01426.html#afa2592669bdf476838c672623a519728" title="rocksdb::SnapshotList\l::newest" alt="" coords="516,1735,668,1782"/><area shape="rect" id="node80" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="505,1816,679,1845"/><area shape="rect" id="node88" href="../../d4/d87/a03436.html#abf92c452806fb54068f27e6034878f16" title="rocksdb::NewEmptyIterator" alt="" coords="501,1995,683,2024"/><area shape="rect" id="node95" href="../../d4/dd1/a01797.html#a7b284e57a9d16bddbbc8e22f6ab97e83" title="rocksdb::Version::Overlap\lInLevel" alt="" coords="505,2074,679,2121"/><area shape="rect" id="node97" href="../../d1/d42/a01800.html#a6ae62b8394f58801a6340323b2c37185" title="rocksdb::VersionSet\l::NumberLevels" alt="" coords="523,2143,661,2190"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_ac3d320a145d5d36cb2bbf9e57b39ae8a_icgraph.png" border="0" usemap="#dd/df5/a00386_ac3d320a145d5d36cb2bbf9e57b39ae8a_icgraph" alt=""/></div>
<map name="dd/df5/a00386_ac3d320a145d5d36cb2bbf9e57b39ae8a_icgraph" id="dd/df5/a00386_ac3d320a145d5d36cb2bbf9e57b39ae8a_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#a3f1443d5437c4f0e98d7b0eb2839ef2e" title="rocksdb::DBImpl::FlushMem\lTableToOutputFile" alt="" coords="251,1527,440,1574"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#a5c7b18fec45d2a89a72902476d846566" title="rocksdb::DBImpl::Background\lCompaction" alt="" coords="784,1475,981,1522"/><area shape="rect" id="node101" href="../../dd/df5/a00386.html#a497121b80918b7283fae65d8bfe01fc4" title="rocksdb::DBImpl::Background\lFlush" alt="" coords="784,1579,981,1626"/><area shape="rect" id="node104" href="../../dd/df5/a00386.html#a118052cb7b51c90604865d226452918b" title="rocksdb::DBImpl::DoCompactionWork" alt="" coords="489,1484,735,1513"/><area shape="rect" id="node7" href="../../dd/df5/a00386.html#af25ba1d8b183fb12968ebb12ae28de91" title="rocksdb::DBImpl::Background\lCallCompaction" alt="" coords="1029,1415,1227,1462"/><area shape="rect" id="node9" href="../../dd/df5/a00386.html#a0f92fd02fffbe404bbdffc1bd24195d7" title="rocksdb::DBImpl::BGWorkCompaction" alt="" coords="1275,1377,1523,1407"/><area shape="rect" id="node11" href="../../dd/df5/a00386.html#a6f3ccd58266e8fd7a1b513ebef01928a" title="rocksdb::DBImpl::MaybeSchedule\lFlushOrCompaction" alt="" coords="1571,1419,1792,1466"/><area shape="rect" id="node14" href="../../dd/df5/a00386.html#af70abfde15bcbcb869e36a51460def59" title="rocksdb::DBImpl::Background\lCallFlush" alt="" coords="1840,1591,2037,1638"/><area shape="rect" id="node20" href="../../dd/df5/a00386.html#afcef1eaa87f194ee6689e465e15801ed" title="rocksdb::DBImpl::GetImpl" alt="" coords="1852,181,2025,211"/><area shape="rect" id="node36" href="../../dd/df5/a00386.html#aa86eaccec6e3d9e5146c13ca31b2918f" title="rocksdb::DBImpl::MakeRoom\lForWrite" alt="" coords="1841,1418,2036,1465"/><area shape="rect" id="node44" href="../../dd/df5/a00386.html#a19d8fbac12db943503c6a28d35c44e44" title="rocksdb::DBImpl::MultiGet" alt="" coords="1851,1488,2027,1517"/><area shape="rect" id="node48" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="1872,864,2005,893"/><area shape="rect" id="node95" href="../../dd/df5/a00386.html#ae97e90f1166836da10d3f5d48be25f1e" title="rocksdb::DBImpl::TEST\l_CompactRange" alt="" coords="1857,58,2020,105"/><area shape="rect" id="node16" href="../../dd/df5/a00386.html#a7f35702e61b4f7ec3eb12e91432dca47" title="rocksdb::DBImpl::BGWorkFlush" alt="" coords="2088,1600,2299,1629"/><area shape="rect" id="node22" href="../../dd/df5/a00386.html#aa86e47e55cc16361ca8bfb166c659f9a" title="rocksdb::DBImpl::Get" alt="" coords="2119,181,2268,211"/><area shape="rect" id="node32" href="../../dd/df5/a00386.html#a15fbc3b2d454e4ace04cf01a4ed30124" title="rocksdb::DBImpl::KeyMayExist" alt="" coords="2091,128,2296,157"/><area shape="rect" id="node24" href="../../de/d40/a01592.html#a2d7e57e2df089536759724d56e6f93d9" title="rocksdb::StringLists::Get" alt="" coords="2371,261,2536,291"/><area shape="rect" id="node26" href="../../d3/dc9/a00355.html#a3f81884b0378d9d6f544ac33a47762df" title="Counters::get" alt="" coords="2403,155,2504,184"/><area shape="rect" id="node28" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="2351,392,2556,421"/><area shape="rect" id="node30" href="../../d4/d87/a03436.html#aa0251d79d119f4fd670fdb3f4b2e210e" title="rocksdb::TEST" alt="" coords="2399,208,2508,237"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#a56bef285ee9472ef0c15aca22e5a42b2" title="rocksdb::TEST" alt="" coords="2399,101,2508,131"/><area shape="rect" id="node38" href="../../dd/df5/a00386.html#a036d197e1bf77abea19c23696305cf34" title="rocksdb::DBImpl::Write" alt="" coords="2115,1493,2272,1523"/><area shape="rect" id="node40" href="../../dd/df5/a00386.html#ad14868938ccf999100f441fcd9aa7c28" title="rocksdb::DBImpl::FlushMem\lTable" alt="" coords="2359,1515,2548,1562"/><area shape="rect" id="node42" href="../../d4/d87/a03436.html#a515f169292cd669c1692ba5d3b3f566c" title="rocksdb::TEST" alt="" coords="2399,1463,2508,1492"/><area shape="rect" id="node46" href="../../d4/d87/a03436.html#a7a06ad892e18be5b16dfd7843487c151" title="rocksdb::TEST" alt="" coords="2139,1547,2248,1576"/><area shape="rect" id="node50" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="2112,549,2275,595"/><area shape="rect" id="node54" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="2123,618,2264,665"/><area shape="rect" id="node58" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="2093,757,2293,787"/><area shape="rect" id="node60" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="2097,811,2289,840"/><area shape="rect" id="node62" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="2139,864,2248,893"/><area shape="rect" id="node64" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="2104,917,2283,947"/><area shape="rect" id="node66" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="2113,970,2273,1017"/><area shape="rect" id="node68" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="2132,496,2255,525"/><area shape="rect" id="node71" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="2125,1039,2261,1086"/><area shape="rect" id="node73" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="2097,1109,2289,1155"/><area shape="rect" id="node75" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="2097,1178,2289,1225"/><area shape="rect" id="node77" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="2085,1248,2301,1277"/><area shape="rect" id="node79" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="2112,1301,2275,1347"/><area shape="rect" id="node81" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="2168,1371,2219,1400"/><area shape="rect" id="node83" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="2124,1423,2263,1470"/><area shape="rect" id="node85" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="2104,234,2283,281"/><area shape="rect" id="node87" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="2112,303,2275,350"/><area shape="rect" id="node89" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="2111,373,2276,403"/><area shape="rect" id="node91" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="2124,426,2263,473"/><area shape="rect" id="node93" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="2121,687,2265,734"/><area shape="rect" id="node52" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="2372,549,2535,595"/><area shape="rect" id="node56" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="2367,627,2540,656"/><area shape="rect" id="node97" href="../../dd/df5/a00386.html#aafef42f7b99bd9afdd50369bc5d37476" title="rocksdb::DBImpl::Compact\lRange" alt="" coords="2103,58,2284,105"/><area shape="rect" id="node99" href="../../d4/d87/a03436.html#a5ee0a2f05cc4953d8361455bcc51b827" title="rocksdb::TEST" alt="" coords="2139,5,2248,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9408ef3bd3f2ad6fb684bc688737c70b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::WriteLevel0TableForRecovery </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d3/dcd/a00965.html">MemTable</a> *&#160;</td>
          <td class="paramname"><em>mem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d86/a01798.html">VersionEdit</a> *&#160;</td>
          <td class="paramname"><em>edit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../db/d44/a02564_source.html#l00975">975</a> of file <a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a>.</p>

<p>References <a class="el" href="../../de/d3b/a02610_source.html#l00072">rocksdb::VersionEdit::AddFile()</a>, <a class="el" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">rocksdb::port::Mutex::AssertHeld()</a>, <a class="el" href="../../dd/d98/a02557_source.html#l00035">rocksdb::BuildTable()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00398">rocksdb::DBImpl::CompactionStats::bytes_written</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00176">dbname_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00175">env_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00024">rocksdb::FileMetaData::file_size</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00407">rocksdb::DBImpl::CompactionStats::files_out_levelnp1</a>, <a class="el" href="../../d4/d9e/a02587_source.html#l00110">rocksdb::MemTable::GetFirstSequenceNumber()</a>, <a class="el" href="../../dd/d05/a02601_source.html#l00074">rocksdb::SnapshotList::GetNewest()</a>, <a class="el" href="../../d2/de3/a02637_source.html#l00136">rocksdb::Options::info_log</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00026">rocksdb::FileMetaData::largest</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00029">rocksdb::FileMetaData::largest_seqno</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00048">rocksdb::port::Mutex::Lock()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00054">rocksdb::Log()</a>, <a class="el" href="../../dd/d01/a02729_source.html#l00048">rocksdb::LogFlush()</a>, <a class="el" href="../../de/d94/a02597_source.html#l00095">meta</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00389">rocksdb::DBImpl::CompactionStats::micros</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00307">mutex_</a>, <a class="el" href="../../df/d44/a02586_source.html#l00126">rocksdb::MemTable::NewIterator()</a>, <a class="el" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">rocksdb::Env::NowMicros()</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00023">rocksdb::FileMetaData::number</a>, <a class="el" href="../../d5/d96/a02642_source.html#l00062">rocksdb::Status::ok()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00179">options_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00326">pending_outputs_</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00025">rocksdb::FileMetaData::smallest</a>, <a class="el" href="../../de/d3b/a02610_source.html#l00028">rocksdb::FileMetaData::smallest_seqno</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00322">snapshots_</a>, <a class="el" href="../../d6/d50/a02694_source.html#l00667">stats</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00429">stats_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00451">storage_options_</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00301">table_cache_</a>, <a class="el" href="../../de/d8e/a02762_source.html#l00041">rocksdb::Status::ToString()</a>, <a class="el" href="../../de/d7b/a02660_source.html#l00050">rocksdb::port::Mutex::Unlock()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00181">user_comparator()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00177">versions_</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00874">RecoverLogFile()</a>.</p>
<div class="fragment"><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                                                                           {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6">AssertHeld</a>();</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> start_micros = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">NowMicros</a>();</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  FileMetaData <a class="code" href="../../de/d94/a02597.html#a6b8f1f5fc8f36aa1678fff8fa5aecd0b">meta</a>;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  meta.number = <a class="code" href="../../dd/df5/a00386.html#a75a26fad56e9d17743842ef2573eb6ef">versions_</a>-&gt;NewFileNumber();</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a1a62212922480c1ca92b25a555b3410e">pending_outputs_</a>.insert(meta.number);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  Iterator* iter = <a class="code" href="../../db/d44/a02564.html#a0d98018e8146e811f356fa860a9839a0">mem</a>-&gt;NewIterator();</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> newest_snapshot = <a class="code" href="../../dd/df5/a00386.html#a6bf69eb135ada49bd652b4421ccc14af">snapshots_</a>.<a class="code" href="../../dc/de6/a01426.html#aab9c275d08ac06c7ca97116328298b9c">GetNewest</a>();</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d4/d87/a03436.html#ae6ff020665aac065a669576db9d53762">SequenceNumber</a> earliest_seqno_in_memtable =</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <a class="code" href="../../db/d44/a02564.html#a0d98018e8146e811f356fa860a9839a0">mem</a>-&gt;GetFirstSequenceNumber();</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Level-0 table #%lu: started&quot;</span>,</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) meta.number);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <a class="code" href="../../d9/d2c/a03421.html#af127c2e4fc73b5d35647147ef45b350c">Status</a> s;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1">Unlock</a>();</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    s = <a class="code" href="../../d4/d87/a03436.html#a54b259d9ef3d218359bf85355d87aa8e">BuildTable</a>(<a class="code" href="../../dd/df5/a00386.html#a6aa55902220295b54840086d16d3db4b">dbname_</a>, <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>, <a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>, <a class="code" href="../../dd/df5/a00386.html#ab30f83ba6f1f9323bbe1c12ba03840e8">storage_options_</a>,</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                   <a class="code" href="../../dd/df5/a00386.html#a1b44e75ddaf3ea3befcd06b23ca9abb6">table_cache_</a>.get(), iter, &amp;<a class="code" href="../../de/d94/a02597.html#a6b8f1f5fc8f36aa1678fff8fa5aecd0b">meta</a>,</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                   <a class="code" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0">user_comparator</a>(), newest_snapshot,</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                   earliest_seqno_in_memtable, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <a class="code" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4">LogFlush</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <a class="code" href="../../dd/df5/a00386.html#a4cb19b8bd2dd10018827bfdc4094505e">mutex_</a>.<a class="code" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596">Lock</a>();</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <a class="code" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb">Log</a>(<a class="code" href="../../dd/df5/a00386.html#a0d41b9e4cd6689ab16cc69a26a98c3bb">options_</a>.<a class="code" href="../../dd/d57/a01054.html#acb9395851e7a9b604f840740821c0826">info_log</a>, <span class="stringliteral">&quot;Level-0 table #%lu: %lu bytes %s&quot;</span>,</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) meta.number,</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) meta.file_size,</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      s.ToString().c_str());</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keyword">delete</span> iter;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a1a62212922480c1ca92b25a555b3410e">pending_outputs_</a>.erase(meta.number);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">// Note that if file_size is zero, the file has been deleted and</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="comment">// should not be added to the manifest.</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keywordtype">int</span> level = 0;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="keywordflow">if</span> (s.ok() &amp;&amp; meta.file_size &gt; 0) {</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    edit-&gt;AddFile(level, meta.number, meta.file_size,</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                  meta.smallest, meta.largest,</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                  meta.smallest_seqno, meta.largest_seqno);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  }</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  CompactionStats <a class="code" href="../../d6/d50/a02694.html#a5925d216740c89f43482df806fd14e8c">stats</a>;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  stats.micros = <a class="code" href="../../dd/df5/a00386.html#a421429fed52c239fa98fd79a7c0d0a1e">env_</a>-&gt;<a class="code" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7">NowMicros</a>() - start_micros;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  stats.bytes_written = meta.file_size;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  stats.files_out_levelnp1 = 1;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <a class="code" href="../../dd/df5/a00386.html#a13c28a94505e5bd8600e110755429192">stats_</a>[level].Add(stats);</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a9408ef3bd3f2ad6fb684bc688737c70b_cgraph.png" border="0" usemap="#dd/df5/a00386_a9408ef3bd3f2ad6fb684bc688737c70b_cgraph" alt=""/></div>
<map name="dd/df5/a00386_a9408ef3bd3f2ad6fb684bc688737c70b_cgraph" id="dd/df5/a00386_a9408ef3bd3f2ad6fb684bc688737c70b_cgraph">
<area shape="rect" id="node3" href="../../d2/d86/a01798.html#a62a14d8606dbc1d557b6e3bb55c617dd" title="rocksdb::VersionEdit\l::AddFile" alt="" coords="267,777,408,823"/><area shape="rect" id="node5" href="../../d9/d9a/a00998.html#adc55e4555301d02ced0ec883bc6cd4f6" title="rocksdb::port::Mutex\l::AssertHeld" alt="" coords="267,846,408,893"/><area shape="rect" id="node7" href="../../d4/d87/a03436.html#a54b259d9ef3d218359bf85355d87aa8e" title="rocksdb::BuildTable" alt="" coords="269,916,405,945"/><area shape="rect" id="node54" href="../../d0/db9/a01552.html#a63cba37f62403ccc2f3e8b0b8ee04425" title="rocksdb::Status::ok" alt="" coords="967,341,1103,371"/><area shape="rect" id="node82" href="../../d3/dcd/a00965.html#aac4669a721ac40316118f847a3659b45" title="rocksdb::MemTable::\lGetFirstSequenceNumber" alt="" coords="251,1705,424,1751"/><area shape="rect" id="node84" href="../../dc/de6/a01426.html#aab9c275d08ac06c7ca97116328298b9c" title="rocksdb::SnapshotList\l::GetNewest" alt="" coords="261,1774,413,1821"/><area shape="rect" id="node91" href="../../d9/d9a/a00998.html#a5d2f9be842f9982681ca8ff36f935596" title="rocksdb::port::Mutex\l::Lock" alt="" coords="267,1843,408,1890"/><area shape="rect" id="node95" href="../../d4/d87/a03436.html#a437c68f3299fa632d4a1694059fd6ddb" title="rocksdb::Log" alt="" coords="289,1983,385,2012"/><area shape="rect" id="node97" href="../../d4/d87/a03436.html#adec21fd92ba2a390bb412648c9f81ab4" title="rocksdb::LogFlush" alt="" coords="273,2036,401,2065"/><area shape="rect" id="node99" href="../../d3/dcd/a00965.html#a1bf0bce45391c71385c38e7ddc82b5ea" title="rocksdb::MemTable::\lNewIterator" alt="" coords="265,2089,409,2135"/><area shape="rect" id="node101" href="../../db/db1/a00460.html#a20e69bbefe7d92b92a2f33100cf251b7" title="rocksdb::Env::NowMicros" alt="" coords="251,2159,424,2188"/><area shape="rect" id="node104" href="../../d0/db9/a01552.html#ac02bdc6723705072a10111a99b4ca17c" title="rocksdb::Status::ToString" alt="" coords="252,2212,423,2241"/><area shape="rect" id="node108" href="../../d9/d9a/a00998.html#a73a5db74971add43b1762259a8e171f1" title="rocksdb::port::Mutex\l::Unlock" alt="" coords="267,1913,408,1959"/><area shape="rect" id="node111" href="../../dd/df5/a00386.html#aa6cba6e97343be3409f1ccaabfaa00c0" title="rocksdb::DBImpl::user\l_comparator" alt="" coords="261,2265,413,2311"/><area shape="rect" id="node9" href="../../d2/dcc/a01623.html#ad007bf262f2bd82e6a88d994c0d94e95" title="rocksdb::TableBuilder\l::Abandon" alt="" coords="504,750,651,797"/><area shape="rect" id="node11" href="../../d2/dcc/a01623.html#a771e9853403a3ee66a66929e75d63f81" title="rocksdb::TableBuilder::Add" alt="" coords="488,820,667,849"/><area shape="rect" id="node13" href="../../d9/d75/a01843.html#ade502f1bafbb7db1b916d28ca16cc752" title="rocksdb::WritableFile\l::Close" alt="" coords="505,873,649,919"/><area shape="rect" id="node15" href="../../d0/d61/a00302.html#a9fe800fa52b86a61b626a58f46a38f81" title="rocksdb::Comparator\l::Compare" alt="" coords="505,942,649,989"/><area shape="rect" id="node17" href="../../de/daf/a01417.html#abed770f35075076510897c3fbbc10923" title="rocksdb::Slice::data" alt="" coords="748,1071,887,1100"/><area shape="rect" id="node19" href="../../de/de6/a00723.html#a87df954d098adf219ebd79ae6f5b75f3" title="rocksdb::InternalKey\l::DecodeFrom" alt="" coords="507,1115,648,1162"/><area shape="rect" id="node22" href="../../de/daf/a01417.html#aeb3a4a3ede98a163cc3796ef0d4a759d" title="rocksdb::Slice::size" alt="" coords="749,1184,885,1213"/><area shape="rect" id="node24" href="../../db/db1/a00460.html#a0d75747a2a64c041d106b85202848fe8" title="rocksdb::Env::DeleteFile" alt="" coords="495,1289,660,1319"/><area shape="rect" id="node26" href="../../d2/dcc/a01623.html#af4660489a6b24d42577ca3e4709c5d4d" title="rocksdb::TableBuilder\l::FileSize" alt="" coords="504,1342,651,1389"/><area shape="rect" id="node28" href="../../d2/dcc/a01623.html#a704e26305a747bc055c883cd35e18e8d" title="rocksdb::TableBuilder\l::Finish" alt="" coords="504,1411,651,1458"/><area shape="rect" id="node30" href="../../d9/d75/a01843.html#aaec9388e46e89e6b6706691e72b1430a" title="rocksdb::WritableFile\l::Fsync" alt="" coords="505,1531,649,1578"/><area shape="rect" id="node32" href="../../d9/d75/a01843.html#a739dc13d33b6716dce73e44a472ba1dd" title="rocksdb::WritableFile\l::Sync" alt="" coords="745,1501,889,1547"/><area shape="rect" id="node34" href="../../d4/d87/a03436.html#a79e23f5792d55281c43f7a8ea8588fea" title="rocksdb::GetInternalKeySeqno" alt="" coords="477,1185,677,1215"/><area shape="rect" id="node40" href="../../d4/d87/a03436.html#ae570859de3fcc573a6f3d6f42bbd6627" title="rocksdb::GetTableBuilder" alt="" coords="493,1601,661,1631"/><area shape="rect" id="node42" href="../../d2/d02/a00777.html#a34cfd17f7b64652774de76cbc0e5b202" title="rocksdb::Iterator::key" alt="" coords="504,5,651,35"/><area shape="rect" id="node44" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="535,59,620,88"/><area shape="rect" id="node46" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="536,112,619,141"/><area shape="rect" id="node48" href="../../de/df9/a01624.html#a59b62bf2644f7cf62feb7275085a9185" title="rocksdb::TableCache\l::NewIterator" alt="" coords="504,246,651,293"/><area shape="rect" id="node52" href="../../d4/d87/a03436.html#ac542e5154705959dfccc0adac5c3af3a" title="rocksdb::TableFileName" alt="" coords="953,165,1116,195"/><area shape="rect" id="node61" href="../../db/db1/a00460.html#a2415186e0a399d70edabef9f477e4c47" title="rocksdb::Env::NewWritableFile" alt="" coords="476,367,679,396"/><area shape="rect" id="node63" href="../../d2/d02/a00777.html#a06da095e0c88cc65ac23e4ec88d0a390" title="rocksdb::Iterator::Next" alt="" coords="501,420,653,449"/><area shape="rect" id="node66" href="../../d4/d87/a03436.html#add1d5b59fe1243a2201201ab3a3fbdb2" title="rocksdb::ParseInternalKey" alt="" coords="489,1063,665,1092"/><area shape="rect" id="node71" href="../../d2/d02/a00777.html#a99d2e05c952cecb0f4a0fa60412bafc2" title="rocksdb::Iterator::\lSeekToFirst" alt="" coords="515,473,640,519"/><area shape="rect" id="node74" href="../../d2/d02/a00777.html#a5435c832490b19d4c3aebf7c4877098d" title="rocksdb::Iterator::\lstatus" alt="" coords="515,542,640,589"/><area shape="rect" id="node78" href="../../d2/d02/a00777.html#a866c8627787b3a768273ae4893f27f8f" title="rocksdb::Iterator::\lValid" alt="" coords="515,611,640,658"/><area shape="rect" id="node80" href="../../d2/d02/a00777.html#a1a503134af26025486d5c640e49cdf54" title="rocksdb::Iterator::\lvalue" alt="" coords="515,681,640,727"/><area shape="rect" id="node37" href="../../d4/d87/a03436.html#a0bb1082c7c473bb0c6614963a14fed62" title="rocksdb::DecodeFixed64" alt="" coords="735,1128,900,1157"/><area shape="rect" id="node50" href="../../de/df9/a01624.html#aed7ec4f6ca046cd127813d39e75dee0c" title="rocksdb::TableCache\l::FindTable" alt="" coords="744,186,891,233"/><area shape="rect" id="node57" href="../../d4/d87/a03436.html#a7b03495439285fb3fb42a3208b01a3d7" title="rocksdb::NewErrorIterator" alt="" coords="732,307,903,336"/><area shape="rect" id="node59" href="../../d0/da4/a01631.html#ab457fa9a28a505dcd52222b12e331a6c" title="rocksdb::TableReader\l::NewIterator" alt="" coords="743,359,892,406"/><area shape="rect" id="node86" href="../../dc/de6/a01426.html#acc40bb270942cc53168b9c718288b283" title="rocksdb::SnapshotList\l::empty" alt="" coords="741,1773,893,1819"/><area shape="rect" id="node88" href="../../dc/de6/a01426.html#afa2592669bdf476838c672623a519728" title="rocksdb::SnapshotList\l::newest" alt="" coords="501,1803,653,1850"/><area shape="rect" id="node93" href="../../d8/df7/a03469.html#aceefae455e28f4218993e00e08321dff" title="rocksdb::port::PthreadCall" alt="" coords="491,1897,664,1927"/><area shape="rect" id="node106" href="../../d0/db9/a01552.html#a6679d2e36279094844a67acbb3cc3e5c" title="rocksdb::Status::code" alt="" coords="503,2212,652,2241"/><area shape="rect" id="node113" href="../../d0/d72/a00724.html#a028af61c0f06130fbd5336aef277e94a" title="rocksdb::InternalKeyComparator\l::user_comparator" alt="" coords="472,2265,683,2311"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/df5/a00386_a9408ef3bd3f2ad6fb684bc688737c70b_icgraph.png" border="0" usemap="#dd/df5/a00386_a9408ef3bd3f2ad6fb684bc688737c70b_icgraph" alt=""/></div>
<map name="dd/df5/a00386_a9408ef3bd3f2ad6fb684bc688737c70b_icgraph" id="dd/df5/a00386_a9408ef3bd3f2ad6fb684bc688737c70b_icgraph">
<area shape="rect" id="node3" href="../../dd/df5/a00386.html#adb8cf2e0f98f8368db32bea16bcf3cb7" title="rocksdb::DBImpl::Recover\lLogFile" alt="" coords="252,637,428,683"/><area shape="rect" id="node5" href="../../dd/df5/a00386.html#afe079cf353957e6c79ed794cbc0bb9fc" title="rocksdb::DBImpl::Recover" alt="" coords="479,645,655,675"/><area shape="rect" id="node7" href="../../d8/ddd/a00380.html#a898ece06bdc8a5ec59e5996a01f2650d" title="rocksdb::DB::Open" alt="" coords="705,645,839,675"/><area shape="rect" id="node9" href="../../d9/d48/a00345.html#ad31d70372891633ef7d3ccafe5540d63" title="rocksdb::CorruptionTest\l::TryReopen" alt="" coords="915,21,1077,67"/><area shape="rect" id="node15" href="../../d8/d64/a00181.html#ab8387daed213810058d1fc9541bdaacc" title="rocksdb::Benchmark\l::Open" alt="" coords="925,121,1067,167"/><area shape="rect" id="node21" href="../../db/d95/a00391.html#a9f9969a19cf328935234d867f6f17b0b" title="rocksdb::DBTest::PureReopen" alt="" coords="896,205,1096,235"/><area shape="rect" id="node23" href="../../db/d95/a00391.html#aec8d2ea7e19d5417cf47fa3565d3bd67" title="rocksdb::DBTest::TryReopen" alt="" coords="900,259,1092,288"/><area shape="rect" id="node35" href="../../d4/d87/a03436.html#a8ba93bfa1ae44c10535930930b4e30b6" title="rocksdb::TEST" alt="" coords="941,323,1051,352"/><area shape="rect" id="node37" href="../../d4/d87/a03436.html#a397a8fe5f365d028536a4f82449726b9" title="rocksdb::BM_LogAndApply" alt="" coords="907,376,1085,405"/><area shape="rect" id="node41" href="../../de/de8/a00405.html#a7edc59b996abfcb8ca20815e17079e44" title="rocksdb::DeleteFileTest\l::ReopenDB" alt="" coords="916,429,1076,475"/><area shape="rect" id="node45" href="../../d4/d87/a03436.html#ae1d0f9b5886776b75ab26edd57c52741" title="rocksdb::OpenDb" alt="" coords="935,499,1057,528"/><area shape="rect" id="node57" href="../../d0/d61/a01130.html#af98a7496147d77913015c51780f766bc" title="rocksdb::PrefixTest\l::OpenDb" alt="" coords="928,602,1064,649"/><area shape="rect" id="node59" href="../../d0/dc7/a01402.html#a8f0e4e467e3e1df811a9583150902c9f" title="rocksdb::SimpleTableDBTest\l::PureReopen" alt="" coords="900,671,1092,718"/><area shape="rect" id="node61" href="../../d0/dc7/a01402.html#a4b0084a45075e30aca7dca07fc7c5ab4" title="rocksdb::SimpleTableDBTest\l::TryReopen" alt="" coords="900,741,1092,787"/><area shape="rect" id="node69" href="../../d4/d87/a03436.html#a0b1de5b83de45a9d933c398b7cde23a7" title="rocksdb::TableReaderBenchmark" alt="" coords="888,811,1104,840"/><area shape="rect" id="node73" href="../../da/dee/a00383.html#aa25b54342133aea90459685d5f58ee2d" title="rocksdb::DBConstructor\l::NewDB" alt="" coords="915,863,1077,910"/><area shape="rect" id="node79" href="../../d6/da8/a02693.html#a217dbf8b442f20279ea00b898af96f52" title="main" alt="" coords="971,933,1021,963"/><area shape="rect" id="node81" href="../../d3/daa/a01577.html#abd8a7f61f0b14b85acd87a4d77a6e394" title="rocksdb::StressTest\l::Open" alt="" coords="927,986,1065,1033"/><area shape="rect" id="node87" href="../../d0/d88/a01231.html#a1cf658812203ec463aa4bd1a688434cb" title="rocksdb::ReduceLevelTest\l::OpenDB" alt="" coords="907,1055,1085,1102"/><area shape="rect" id="node89" href="../../de/d9d/a00813.html#a1e30a763620671ecdcdb1abc079b0167" title="rocksdb::LDBCommand\l::OpenDB" alt="" coords="915,1125,1077,1171"/><area shape="rect" id="node95" href="../../d4/d87/a03436.html#a6cef9e517390b068bbabfa5267621060" title="rocksdb::OpenNormalDb" alt="" coords="1189,619,1355,648"/><area shape="rect" id="node98" href="../../de/d16/a01228.html#a4602503c6a2659926aaa2dcf47e789df" title="Constructors. " alt="" coords="927,1194,1065,1241"/><area shape="rect" id="node100" href="../../d4/d27/a00392.html#ac1f3d9d21c81bd7381627456ed8f06b4" title="rocksdb::DBWithTTL\l::DBWithTTL" alt="" coords="924,1263,1068,1310"/><area shape="rect" id="node11" href="../../d9/d48/a00345.html#a2a4568d536e0fb60278635f6f27078df" title="rocksdb::CorruptionTest\l::Reopen" alt="" coords="1191,5,1353,51"/><area shape="rect" id="node13" href="../../d9/d48/a00345.html#a08cff08de4bf7d2a6f51cb498a406f0f" title="rocksdb::CorruptionTest\l::CorruptionTest" alt="" coords="1468,5,1631,51"/><area shape="rect" id="node17" href="../../d8/d64/a00181.html#a03997e3f4e60726e27f582cf684aa33a" title="rocksdb::Benchmark::Run" alt="" coords="1185,75,1359,104"/><area shape="rect" id="node19" href="../../d9/d66/a02562.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1524,75,1575,104"/><area shape="rect" id="node25" href="../../db/d95/a00391.html#a21ea2025701f28a3c295db6a7e9bb881" title="rocksdb::DBTest::ChangeCompact\lOptions" alt="" coords="1159,127,1385,174"/><area shape="rect" id="node27" href="../../db/d95/a00391.html#a4a0d18ad59d3d7d52993aad0e0bc99a0" title="rocksdb::DBTest::Reopen" alt="" coords="1185,197,1359,227"/><area shape="rect" id="node31" href="../../db/d95/a00391.html#ada9d4dceac67de38a2d6b39b1f4b42ba" title="rocksdb::DBTest::Destroy\lAndReopen" alt="" coords="1185,250,1359,297"/><area shape="rect" id="node29" href="../../db/d95/a00391.html#a509351e18607a06285412f6654253643" title="rocksdb::DBTest::DBTest" alt="" coords="1463,197,1636,227"/><area shape="rect" id="node33" href="../../db/d95/a00391.html#a3761d111551d33530517a39f38f908d1" title="rocksdb::DBTest::ChangeOptions" alt="" coords="1440,259,1659,288"/><area shape="rect" id="node39" href="../../d9/de7/a02572.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1247,320,1297,349"/><area shape="rect" id="node43" href="../../de/de8/a00405.html#a933dd568c54ab3647b4d3abd944f4db6" title="rocksdb::DeleteFileTest\l::DeleteFileTest" alt="" coords="1192,373,1352,419"/><area shape="rect" id="node47" href="../../d4/d87/a03436.html#af1858c0090bf0030df9887905454e091" title="rocksdb::ProfileKeyComparison" alt="" coords="1169,443,1375,472"/><area shape="rect" id="node51" href="../../da/df3/a01581.html#af0dad875d53811db3382d7ab0ad93b01" title="rocksdb::StringAppendOperator\lTest::SetOpenDbFunction" alt="" coords="1171,495,1373,542"/><area shape="rect" id="node55" href="../../d4/d87/a03436.html#aafdfbf71b796b87dd60a624b2de3938c" title="rocksdb::TEST" alt="" coords="1217,565,1327,595"/><area shape="rect" id="node49" href="../../d4/d87/a03436.html#a28f3fa7104cc330d8f573f98682e000b" title="rocksdb::TEST" alt="" coords="1495,443,1604,472"/><area shape="rect" id="node53" href="../../dc/d6a/a02779.html#a1fa3253ca11014c1b01923a1674ff19c" title="main" alt="" coords="1524,561,1575,591"/><area shape="rect" id="node63" href="../../d0/dc7/a01402.html#ab3b64eb433f91a3061b5e8a3a97fcc0b" title="rocksdb::SimpleTableDBTest\l::Reopen" alt="" coords="1176,671,1368,718"/><area shape="rect" id="node67" href="../../d0/dc7/a01402.html#ae65a64867da560c255e38fb5bcc7ced4" title="rocksdb::SimpleTableDBTest\l::DestroyAndReopen" alt="" coords="1176,741,1368,787"/><area shape="rect" id="node65" href="../../d0/dc7/a01402.html#aa4769c7f42641f11d37d9d1a0b381bef" title="rocksdb::SimpleTableDBTest\l::SimpleTableDBTest" alt="" coords="1453,671,1645,718"/><area shape="rect" id="node71" href="../../db/d84/a02686.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1247,811,1297,840"/><area shape="rect" id="node75" href="../../da/dee/a00383.html#a8cdb390521098e2a5f737561e9eb1134" title="rocksdb::DBConstructor\l::DBConstructor" alt="" coords="1191,863,1353,910"/><area shape="rect" id="node77" href="../../da/dee/a00383.html#ae9772754567f1b3c0ca7d5285a56ac6d" title="rocksdb::DBConstructor\l::FinishImpl" alt="" coords="1191,933,1353,979"/><area shape="rect" id="node83" href="../../d3/daa/a01577.html#af7e726bf27e216787e7c331834ec6075" title="rocksdb::StressTest::Run" alt="" coords="1187,1003,1357,1032"/><area shape="rect" id="node85" href="../../d3/daa/a01577.html#aeac9f55bde5a11da0fcc2c88465de0c6" title="rocksdb::StressTest\l::Reopen" alt="" coords="1203,1055,1341,1102"/><area shape="rect" id="node91" href="../../d0/d58/a01230.html#af2eb900c9cab82e8dffb16d90d070ae1" title="rocksdb::ReduceDBLevelsCommand\l::DoCommand" alt="" coords="1153,1125,1391,1171"/><area shape="rect" id="node93" href="../../de/d9d/a00813.html#ab355fd20f7ef62b0cb2e673a6a2d9bec" title="rocksdb::LDBCommand::Run" alt="" coords="1175,1195,1369,1224"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Friends And Related Function Documentation</h2>
<a class="anchor" id="ad22eb7a23cbf34de526efa966c578d4a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="../../d8/ddd/a00380.html">DB</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00193">193</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a9ab341ae7c6562bb9b1864963181c48a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rocksdb::DBImpl::bg_compaction_scheduled_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00329">329</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01223">ReFitLevel()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01485">TEST_CompactRange()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01585">TEST_WaitForCompact()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="a4f7627f46f001610ad9241e9741cd00a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d39/a00314.html">port::CondVar</a> rocksdb::DBImpl::bg_cv_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00309">309</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01648">BackgroundCallFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00052">LogDBDeployStats()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01223">ReFitLevel()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01485">TEST_CompactRange()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01585">TEST_WaitForCompact()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01564">WaitForFlushMemTable()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="a79aec493ad501d3e044e08f610591926"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/db9/a01552.html">Status</a> rocksdb::DBImpl::bg_error_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00349">349</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01585">TEST_WaitForCompact()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01564">WaitForFlushMemTable()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>.</p>

</div>
</div>
<a class="anchor" id="aca89b02f26787b31bba9a8690b4be42d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rocksdb::DBImpl::bg_flush_scheduled_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00332">332</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01648">BackgroundCallFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01635">BackgroundFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01223">ReFitLevel()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01585">TEST_WaitForCompact()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="ab308f5a73496bf663add416d38b1eb3b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::DBImpl::bg_logstats_scheduled_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00335">335</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../d7/d12/a02571_source.html#l00052">LogDBDeployStats()</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00022">MaybeScheduleLogDBDeployStats()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="a64f1e254c5aaa8e73231273933cdeef6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::DBImpl::bg_work_gate_closed_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00454">454</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01223">ReFitLevel()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="ac70f13459b5221663e10f148dc876f42"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string rocksdb::DBImpl::db_absolute_path_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00445">445</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, and <a class="el" href="../../d7/d12/a02571_source.html#l00052">LogDBDeployStats()</a>.</p>

</div>
</div>
<a class="anchor" id="a178d9c0a3dc95d6e5e1a0485bdeb8bc9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d72/a00541.html">FileLock</a>* rocksdb::DBImpl::db_lock_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00304">304</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00768">Recover()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="a6aa55902220295b54840086d16d3db4b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const std::string rocksdb::DBImpl::dbname_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00176">176</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00363">NewDB()</a>, <a class="el" href="../../db/d0b/a02566_source.html#l00070">rocksdb::DBImplReadOnly::NewIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02714">NewIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01908">OpenCompactionOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00511">PurgeObsoleteFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00768">Recover()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00975">WriteLevel0TableForRecovery()</a>.</p>

</div>
</div>
<a class="anchor" id="ac49af7a9a13d9dc7a31f0d406e44f257"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::default_interval_to_delete_obsolete_WAL_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00369">369</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00650">PurgeObsoleteWALFiles()</a>, and <a class="el" href="../../d3/dff/a02565_source.html#l00121">TEST_SetDefaultTimeToCheck()</a>.</p>

</div>
</div>
<a class="anchor" id="a7ac5de89c53f110bb27112295ea2314d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rocksdb::DBImpl::delayed_writes_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00448">448</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l03348">DelayLoggingAndReset()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>.</p>

</div>
</div>
<a class="anchor" id="a1c7bbb1d0ce162afbd075c1dcd4fa74f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::delete_obsolete_files_last_run_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00359">359</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>.</p>

</div>
</div>
<a class="anchor" id="a3573b1eae3665c2cc757b8c396622b17"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::DBImpl::disable_delete_obsolete_files_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00356">356</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../dd/db2/a02563_source.html#l00023">DisableFileDeletions()</a>, <a class="el" href="../../dd/db2/a02563_source.html#l00030">EnableFileDeletions()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l01113">FlushMemTableToOutputFile()</a>.</p>

</div>
</div>
<a class="anchor" id="a421429fed52c239fa98fd79a7c0d0a1e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/db1/a00460.html">Env</a>* const rocksdb::DBImpl::env_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00175">175</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01442">AppendSortedWalsOfType()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01648">BackgroundCallFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01353">CheckWalFileExistsAndEmpty()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00401">CreateArchivalDirectory()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03355">DeleteFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01952">FinishCompactionOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02554">GetImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, <a class="el" href="../../dd/db2/a02563_source.html#l00083">GetSortedWalFiles()</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00052">LogDBDeployStats()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00418">MaybeDumpStats()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00022">MaybeScheduleLogDBDeployStats()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02616">MultiGet()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00363">NewDB()</a>, <a class="el" href="../../db/d0b/a02566_source.html#l00070">rocksdb::DBImplReadOnly::NewIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02714">NewIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01908">OpenCompactionOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00511">PurgeObsoleteFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00650">PurgeObsoleteWALFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01387">ReadFirstLine()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00768">Recover()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00874">RecoverLogFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00975">WriteLevel0TableForRecovery()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="a917f2b90eead9ad2465a74dc1d9f52d6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::DBImpl::flush_on_destroy_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00384">384</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="a851172acb183ae096ea0a767407d421c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string rocksdb::DBImpl::host_name_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00316">316</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00052">LogDBDeployStats()</a>, and <a class="el" href="../../d7/d12/a02571_source.html#l00022">MaybeScheduleLogDBDeployStats()</a>.</p>

</div>
</div>
<a class="anchor" id="a57a62c80616f5fa0f568a36367c85466"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d7/dd4/a00968.html">MemTableList</a> rocksdb::DBImpl::imm_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00312">312</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01635">BackgroundFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01113">FlushMemTableToOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02554">GetImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02616">MultiGet()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02499">NewInternalIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01564">WaitForFlushMemTable()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="aa92d556db5d7f5bc58f2531cd124729d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../d0/d72/a00724.html">InternalKeyComparator</a> rocksdb::DBImpl::internal_comparator_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00178">178</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02499">NewInternalIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00874">RecoverLogFile()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00181">user_comparator()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>.</p>

</div>
</div>
<a class="anchor" id="af40cab146546ef65dfc86414e3f3ec1e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../db/d7c/a00722.html">InternalFilterPolicy</a> rocksdb::DBImpl::internal_filter_policy_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00297">297</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab82cb85ced089ba044749b72f13054f3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int rocksdb::DBImpl::KEEP_LOG_FILE_NUM = 1000</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00444">444</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

</div>
</div>
<a class="anchor" id="a44c1ebfd047bdb17d99296bb152bac93"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a> volatile rocksdb::DBImpl::last_log_ts</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00353">353</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, and <a class="el" href="../../d7/d12/a02571_source.html#l00022">MaybeScheduleLogDBDeployStats()</a>.</p>

</div>
</div>
<a class="anchor" id="aef63a9eac507c09f6105dfc1ca85a25d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d5/df4/a01551.html">StatsSnapshot</a> rocksdb::DBImpl::last_stats_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00442">442</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>.</p>

</div>
</div>
<a class="anchor" id="a07c615f6afce7171a2d78fe7d9813f31"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;<a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&gt; rocksdb::DBImpl::last_stats_dump_time_microsec_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00365">365</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00418">MaybeDumpStats()</a>.</p>

</div>
</div>
<a class="anchor" id="a0801eebdc654c9987f70ba512e9c45f4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unique_ptr&lt;<a class="el" href="../../da/d18/a01850.html">log::Writer</a>&gt; rocksdb::DBImpl::log_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00314">314</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>.</p>

</div>
</div>
<a class="anchor" id="a39586d8f5ff2cd8c0d99d96763b8ccc6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::logfile_number_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00313">313</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>.</p>

</div>
</div>
<a class="anchor" id="a8170a5a4d3a3f498851720b843b48f9f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt;<a class="el" href="../../d8/daf/a01550.html">StatsLogger</a>&gt; rocksdb::DBImpl::logger_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00351">351</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../d7/d12/a02571_source.html#l00052">LogDBDeployStats()</a>, and <a class="el" href="../../d7/d12/a02571_source.html#l00022">MaybeScheduleLogDBDeployStats()</a>.</p>

</div>
</div>
<a class="anchor" id="ab8d415c46a300bbfcaaa95e812a51179"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/d12/a00942.html">ManualCompaction</a>* rocksdb::DBImpl::manual_compaction_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00346">346</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l01485">TEST_CompactRange()</a>.</p>

</div>
</div>
<a class="anchor" id="aa363f82be90e7c8172d31ba1209e6574"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/dcd/a00965.html">MemTable</a>* rocksdb::DBImpl::mem_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00311">311</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02554">GetImpl()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00185">GetMemTable()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02616">MultiGet()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02499">NewInternalIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="a6372d47ec4455946aa5754c002a4fbf0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="../../d0/daf/a00970.html">MemTableRepFactory</a>&gt; rocksdb::DBImpl::mem_rep_factory_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00310">310</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00874">RecoverLogFile()</a>.</p>

</div>
</div>
<a class="anchor" id="a4cb19b8bd2dd10018827bfdc4094505e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d9a/a00998.html">port::Mutex</a> rocksdb::DBImpl::mutex_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00307">307</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01887">AllocateCompactionOutputFileNumbers()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01648">BackgroundCallFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01862">CleanupCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01184">CompactRange()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03355">DeleteFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00635">DeleteObsoleteFiles()</a>, <a class="el" href="../../dd/db2/a02563_source.html#l00023">DisableFileDeletions()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>, <a class="el" href="../../dd/db2/a02563_source.html#l00030">EnableFileDeletions()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01208">FindMinimumEmptyLevelFitting()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01113">FlushMemTableToOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03322">GetApproximateSizes()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02554">GetImpl()</a>, <a class="el" href="../../dd/db2/a02563_source.html#l00043">GetLiveFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03424">GetLiveFilesMetaData()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02731">GetSnapshot()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02009">InstallCompactionResults()</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00052">LogDBDeployStats()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02616">MultiGet()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02499">NewInternalIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01908">OpenCompactionOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00768">Recover()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00874">RecoverLogFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01223">ReFitLevel()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01900">ReleaseCompactionUnusedFileNumbers()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02736">ReleaseSnapshot()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01485">TEST_CompactRange()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02543">TEST_MaxNextLevelOverlappingBytes()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01585">TEST_WaitForCompact()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01564">WaitForFlushMemTable()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00975">WriteLevel0TableForRecovery()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="a0d41b9e4cd6689ab16cc69a26a98c3bb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../dd/d57/a01054.html">Options</a> rocksdb::DBImpl::options_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00179">179</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01648">BackgroundCallFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01635">BackgroundFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01353">CheckWalFileExistsAndEmpty()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01184">CompactRange()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00401">CreateArchivalDirectory()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, <a class="el" href="../../db/d0b/a02566_source.html#l00043">rocksdb::DBImplReadOnly::DBImplReadOnly()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03348">DelayLoggingAndReset()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03355">DeleteFile()</a>, <a class="el" href="../../dd/db2/a02563_source.html#l00023">DisableFileDeletions()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>, <a class="el" href="../../dd/db2/a02563_source.html#l00030">EnableFileDeletions()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02053">findEarliestVisibleSnapshot()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01952">FinishCompactionOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01113">FlushMemTableToOutputFile()</a>, <a class="el" href="../../db/d0b/a02566_source.html#l00053">rocksdb::DBImplReadOnly::Get()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02554">GetImpl()</a>, <a class="el" href="../../dd/db2/a02563_source.html#l00043">GetLiveFiles()</a>, <a class="el" href="../../dd/db2/a02563_source.html#l00083">GetSortedWalFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01300">GetUpdatesSince()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02009">InstallCompactionResults()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01287">Level0StopWriteTrigger()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01283">MaxMemCompactionLevel()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00418">MaybeDumpStats()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00392">MaybeIgnoreError()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00022">MaybeScheduleLogDBDeployStats()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02746">Merge()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02616">MultiGet()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00363">NewDB()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02499">NewInternalIterator()</a>, <a class="el" href="../../db/d0b/a02566_source.html#l00070">rocksdb::DBImplReadOnly::NewIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02714">NewIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01279">NumberLevels()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01908">OpenCompactionOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00409">PrintStatistics()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00511">PurgeObsoleteFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00650">PurgeObsoleteWALFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01387">ReadFirstLine()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01363">ReadFirstRecord()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00768">Recover()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00874">RecoverLogFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01223">ReFitLevel()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01485">TEST_CompactRange()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00975">WriteLevel0TableForRecovery()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="a77159fede5375d22613591e9b724e3eb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::DBImpl::owns_info_log_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00298">298</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1a62212922480c1ca92b25a555b3410e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::set&lt;<a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&gt; rocksdb::DBImpl::pending_outputs_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00326">326</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01887">AllocateCompactionOutputFileNumbers()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01862">CleanupCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01113">FlushMemTableToOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01908">OpenCompactionOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01900">ReleaseCompactionUnusedFileNumbers()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00975">WriteLevel0TableForRecovery()</a>.</p>

</div>
</div>
<a class="anchor" id="aa753be868ff8a4028802e24903106836"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::purge_wal_files_last_run_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00362">362</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00650">PurgeObsoleteWALFiles()</a>.</p>

</div>
</div>
<a class="anchor" id="af9cf2e8b889d360238e31db0232d1595"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool rocksdb::DBImpl::refitting_level_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00457">457</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01223">ReFitLevel()</a>.</p>

</div>
</div>
<a class="anchor" id="aa30ff424691deb3432441334d3adb3cf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/d76/a00134.html">port::AtomicPointer</a> rocksdb::DBImpl::shutting_down_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00308">308</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01694">BackgroundCallCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01648">BackgroundCallFlush()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01113">FlushMemTableToOutputFile()</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00052">LogDBDeployStats()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00022">MaybeScheduleLogDBDeployStats()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00305">~DBImpl()</a>.</p>

</div>
</div>
<a class="anchor" id="a6bf69eb135ada49bd652b4421ccc14af"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dc/de6/a01426.html">SnapshotList</a> rocksdb::DBImpl::snapshots_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00322">322</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02731">GetSnapshot()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02736">ReleaseSnapshot()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00975">WriteLevel0TableForRecovery()</a>.</p>

</div>
</div>
<a class="anchor" id="a182e2795f3be1489a771f3ddedce61b5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::stall_level0_num_files_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00374">374</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>.</p>

</div>
</div>
<a class="anchor" id="a50104c0514607e212a634b2992deee15"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::stall_level0_num_files_count_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00378">378</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>.</p>

</div>
</div>
<a class="anchor" id="a9b4aea06a6f9f09239f48143743bbdd8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::stall_level0_slowdown_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00372">372</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>.</p>

</div>
</div>
<a class="anchor" id="a1bb02fe37022bebc791fedd92c78ed9b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::stall_level0_slowdown_count_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00376">376</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>.</p>

</div>
</div>
<a class="anchor" id="ad16938a69629762e5dc6be3578fba857"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&gt; rocksdb::DBImpl::stall_leveln_slowdown_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00375">375</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>.</p>

</div>
</div>
<a class="anchor" id="a35f210903f860d88d3ec82ae93e043c3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&gt; rocksdb::DBImpl::stall_leveln_slowdown_count_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00379">379</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>.</p>

</div>
</div>
<a class="anchor" id="a8a3ca004233cdbcb55f6f30069dbfcf9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::stall_memtable_compaction_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00373">373</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>.</p>

</div>
</div>
<a class="anchor" id="a44d8fc4443a936952c054b78675d5f1a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::stall_memtable_compaction_count_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00377">377</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>.</p>

</div>
</div>
<a class="anchor" id="a25b665f7651c915e7f8f0404dd9dc0d4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> rocksdb::DBImpl::started_at_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00382">382</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>.</p>

</div>
</div>
<a class="anchor" id="a13c28a94505e5bd8600e110755429192"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="../../db/da2/a00300.html">CompactionStats</a>&gt; rocksdb::DBImpl::stats_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00429">429</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00975">WriteLevel0TableForRecovery()</a>.</p>

</div>
</div>
<a class="anchor" id="ab30f83ba6f1f9323bbe1c12ba03840e8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../d5/d5f/a00461.html">EnvOptions</a> rocksdb::DBImpl::storage_options_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00451">451</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01952">FinishCompactionOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01300">GetUpdatesSince()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00363">NewDB()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02499">NewInternalIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01908">OpenCompactionOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01387">ReadFirstLine()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00874">RecoverLogFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00975">WriteLevel0TableForRecovery()</a>.</p>

</div>
</div>
<a class="anchor" id="a1b44e75ddaf3ea3befcd06b23ca9abb6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unique_ptr&lt;<a class="el" href="../../de/df9/a01624.html">TableCache</a>&gt; rocksdb::DBImpl::table_cache_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00301">301</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01862">CleanupCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01952">FinishCompactionOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00511">PurgeObsoleteFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00975">WriteLevel0TableForRecovery()</a>.</p>

</div>
</div>
<a class="anchor" id="adac005f654a15bf772dbd40a06ea2762"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d2/dbd/a01844.html">WriteBatch</a> rocksdb::DBImpl::tmp_batch_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00320">320</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02866">BuildBatchGroup()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>.</p>

</div>
</div>
<a class="anchor" id="a75a26fad56e9d17743842ef2573eb6ef"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unique_ptr&lt;<a class="el" href="../../d1/d42/a01800.html">VersionSet</a>&gt; rocksdb::DBImpl::versions_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00177">177</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l01887">AllocateCompactionOutputFileNumbers()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01747">BackgroundCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01184">CompactRange()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00226">DBImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03355">DeleteFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02074">DoCompactionWork()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01208">FindMinimumEmptyLevelFitting()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00444">FindObsoleteFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01113">FlushMemTableToOutputFile()</a>, <a class="el" href="../../db/d0b/a02566_source.html#l00053">rocksdb::DBImplReadOnly::Get()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03322">GetApproximateSizes()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02554">GetImpl()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01296">GetLatestSequenceNumber()</a>, <a class="el" href="../../dd/db2/a02563_source.html#l00043">GetLiveFiles()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03424">GetLiveFilesMetaData()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03116">GetProperty()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02731">GetSnapshot()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01300">GetUpdatesSince()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02009">InstallCompactionResults()</a>, <a class="el" href="../../d7/d12/a02571_source.html#l00052">LogDBDeployStats()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01600">MaybeScheduleFlushOrCompaction()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02616">MultiGet()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02499">NewInternalIterator()</a>, <a class="el" href="../../db/d44/a02564_source.html#l03452">rocksdb::DB::Open()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01908">OpenCompactionOutputFile()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00768">Recover()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01223">ReFitLevel()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00359">TEST_Current_Manifest_FileNo()</a>, <a class="el" href="../../db/d44/a02564_source.html#l00329">TEST_Destroy_DBImpl()</a>, <a class="el" href="../../d3/dff/a02565_source.html#l00119">TEST_GetLevel0TotalSize()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02543">TEST_MaxNextLevelOverlappingBytes()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>, <a class="el" href="../../db/d44/a02564_source.html#l01025">WriteLevel0Table()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l00975">WriteLevel0TableForRecovery()</a>.</p>

</div>
</div>
<a class="anchor" id="a2d3abc2f19390f60d4a922b98dd23450"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::deque&lt;<a class="el" href="../../db/dd4/a01849.html">Writer</a>*&gt; rocksdb::DBImpl::writers_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/dff/a02565_source.html#l00319">319</a> of file <a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d44/a02564_source.html#l02866">BuildBatchGroup()</a>, <a class="el" href="../../db/d44/a02564_source.html#l02953">MakeRoomForWrite()</a>, and <a class="el" href="../../db/d44/a02564_source.html#l02759">Write()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>rippled/src/ripple/rocksdb/rocksdb/db/<a class="el" href="../../d3/dff/a02565_source.html">db_impl.h</a></li>
<li>rippled/src/ripple/rocksdb/rocksdb/db/<a class="el" href="../../dd/db2/a02563_source.html">db_filesnapshot.cc</a></li>
<li>rippled/src/ripple/rocksdb/rocksdb/db/<a class="el" href="../../db/d44/a02564_source.html">db_impl.cc</a></li>
<li>rippled/src/ripple/rocksdb/rocksdb/db/<a class="el" href="../../d7/d12/a02571_source.html">db_stats_logger.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d4/d87/a03436.html">rocksdb</a></li><li class="navelem"><a class="el" href="../../dd/df5/a00386.html">DBImpl</a></li>
    <li class="footer">Generated on Fri May 2 2014 05:29:21 for rippled by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
