<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>rippled: ripple::LedgerConsensusImp Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">rippled
   &#160;<span id="projectnumber">0.24.0-rc1</span>
   </div>
   <div id="projectbrief">Reference implementation of the Ripple Protocol</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="../../classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="../../inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d7/d5f/a00831.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="../../d7/de7/a07305.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ripple::LedgerConsensusImp Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for ripple::LedgerConsensusImp:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/d35/a07306.png" border="0" usemap="#ripple_1_1_ledger_consensus_imp_inherit__map" alt="Inheritance graph"/></div>
<map name="ripple_1_1_ledger_consensus_imp_inherit__map" id="ripple_1_1_ledger_consensus_imp_inherit__map">
<area shape="rect" id="node2" href="../../d9/daf/a00830.html" title="ripple::LedgerConsensus" alt="" coords="311,5,476,35"/><area shape="rect" id="node6" href="../../d7/dfc/a00349.html" title="ripple::CountedObject\l\&lt; LedgerConsensusImp \&gt;" alt="" coords="307,146,480,193"/></map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for ripple::LedgerConsensusImp:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/d9c/a07307.png" border="0" usemap="#ripple_1_1_ledger_consensus_imp_coll__map" alt="Collaboration graph"/></div>
<map name="ripple_1_1_ledger_consensus_imp_coll__map" id="ripple_1_1_ledger_consensus_imp_coll__map">
<area shape="rect" id="node2" href="../../d9/daf/a00830.html" title="ripple::LedgerConsensus" alt="" coords="564,5,729,35"/><area shape="rect" id="node6" href="../../d7/dfc/a00349.html" title="ripple::CountedObject\l\&lt; LedgerConsensusImp \&gt;" alt="" coords="560,146,733,193"/><area shape="rect" id="node10" href="../../d4/d0e/a01272.html" title="ripple::RippleAddress" alt="" coords="573,216,720,245"/><area shape="rect" id="node12" href="../../d9/d39/a00257.html" title="ripple::CBase58Data" alt="" coords="305,221,447,251"/><area shape="rect" id="node18" href="../../d7/d41/a00532.html" title="ripple::FeeVote" alt="" coords="592,339,701,368"/><area shape="rect" id="node20" href="../../da/dd6/a00896.html" title="ripple::LocalTxs" alt="" coords="589,392,704,421"/><area shape="rect" id="node22" href="../../d0/d4e/a01741.html" title="ripple::uint256" alt="" coords="596,472,697,501"/><area shape="rect" id="node24" href="../../d7/d9a/a00152.html" title="base_uint256" alt="" coords="327,472,425,501"/></map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a2de817de326657253b4fa07c8716adb4"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4abcb9cee55078628b94e101fb6ad079a2">resultSuccess</a>, 
<a class="el" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4ae4896e788c63073d2c133ab050eb9c3f">resultFail</a>, 
<a class="el" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4ae9dc89e635658a568ff77c5cadad41b3">resultRetry</a>
 }</td></tr>
<tr class="separator:a2de817de326657253b4fa07c8716adb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_types_a00830"><td colspan="2" onclick="javascript:toggleInherit('pub_types_a00830')"><img src="../../closed.png" alt="-"/>&#160;Public Types inherited from <a class="el" href="../../d9/daf/a00830.html">ripple::LedgerConsensus</a></td></tr>
<tr class="memitem:acb1700386f9fc9ebb9ec58260a3b400b inherit pub_types_a00830"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="../../d2/dee/a00049.html">beast::abstract_clock</a><br class="typebreak"/>
&lt; std::chrono::seconds &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/daf/a00830.html#acb1700386f9fc9ebb9ec58260a3b400b">clock_type</a></td></tr>
<tr class="separator:acb1700386f9fc9ebb9ec58260a3b400b inherit pub_types_a00830"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab15c4197a4facdfbd8600ecee491e0ff"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#ab15c4197a4facdfbd8600ecee491e0ff">LedgerConsensusImp</a> (<a class="el" href="../../d9/daf/a00830.html#acb1700386f9fc9ebb9ec58260a3b400b">clock_type</a> &amp;clock, <a class="el" href="../../da/dd6/a00896.html">LocalTxs</a> &amp;localtx, <a class="el" href="../../d9/d9d/a03417.html#a077afaa330c14078c1f60b740ffc7f73">LedgerHash</a> const &amp;prevLCLHash, <a class="el" href="../../dd/d5f/a00825.html#a5e872c651337cffea1617f84474efea9">Ledger::ref</a> previousLedger, <a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> closeTime, <a class="el" href="../../d7/d41/a00532.html">FeeVote</a> &amp;feeVote)</td></tr>
<tr class="separator:ab15c4197a4facdfbd8600ecee491e0ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f0bd041f578d6f2848d555ebb3fe738"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a0f0bd041f578d6f2848d555ebb3fe738">startup</a> ()</td></tr>
<tr class="separator:a0f0bd041f578d6f2848d555ebb3fe738"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8906e6a448e1847de97b7ba4fc064c37"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d6/d27/a01781.html">Json::Value</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a8906e6a448e1847de97b7ba4fc064c37">getJson</a> (bool full)</td></tr>
<tr class="separator:a8906e6a448e1847de97b7ba4fc064c37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06d1625c7499507ef21b60ed6b3004f1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d5f/a00825.html#a5e872c651337cffea1617f84474efea9">Ledger::ref</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a06d1625c7499507ef21b60ed6b3004f1">peekPreviousLedger</a> ()</td></tr>
<tr class="separator:a06d1625c7499507ef21b60ed6b3004f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0457596ed2c6f984d1511b6d15b2f4aa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d4e/a01741.html">uint256</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a0457596ed2c6f984d1511b6d15b2f4aa">getLCL</a> ()</td></tr>
<tr class="separator:a0457596ed2c6f984d1511b6d15b2f4aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a975e08a1cf6859752a9d4129ea9a57b3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a975e08a1cf6859752a9d4129ea9a57b3">getTransactionTree</a> (<a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;<a class="el" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>, bool doAcquire)</td></tr>
<tr class="separator:a975e08a1cf6859752a9d4129ea9a57b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37cda218246008eae547bb7b70d3277b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a37cda218246008eae547bb7b70d3277b">mapComplete</a> (<a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;<a class="el" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>, <a class="el" href="../../d6/dfe/a01366.html#a585bf78e9ec9fa02084eb73db874939c">SHAMap::ref</a> map, bool acquired)</td></tr>
<tr class="separator:a37cda218246008eae547bb7b70d3277b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0765d2d6ea4dfb7efc19addd85ac92b8"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a0765d2d6ea4dfb7efc19addd85ac92b8">stillNeedTXSet</a> (<a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;<a class="el" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>)</td></tr>
<tr class="separator:a0765d2d6ea4dfb7efc19addd85ac92b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69ec0de2646aae917b8c87b6768abc65"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a69ec0de2646aae917b8c87b6768abc65">checkLCL</a> ()</td></tr>
<tr class="separator:a69ec0de2646aae917b8c87b6768abc65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2d2dcc3578c8476fd1256092dd4a2ca"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#aa2d2dcc3578c8476fd1256092dd4a2ca">handleLCL</a> (<a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;lclHash)</td></tr>
<tr class="separator:aa2d2dcc3578c8476fd1256092dd4a2ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0afc9333292f3b27cd07f657ff7355fd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a0afc9333292f3b27cd07f657ff7355fd">timerEntry</a> ()</td></tr>
<tr class="separator:a0afc9333292f3b27cd07f657ff7355fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad90ce0b98c645274d2e595afdca51262"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#ad90ce0b98c645274d2e595afdca51262">statePreClose</a> ()</td></tr>
<tr class="separator:ad90ce0b98c645274d2e595afdca51262"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a923c7480e7bb17014e96cadabecb18fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a923c7480e7bb17014e96cadabecb18fc">stateEstablish</a> ()</td></tr>
<tr class="separator:a923c7480e7bb17014e96cadabecb18fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1083994d379de4e3bed8ade0221bcd94"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a1083994d379de4e3bed8ade0221bcd94">stateFinished</a> ()</td></tr>
<tr class="separator:a1083994d379de4e3bed8ade0221bcd94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51704da03e9707c6fbd37a7c6167b7a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a51704da03e9707c6fbd37a7c6167b7a4">stateAccepted</a> ()</td></tr>
<tr class="separator:a51704da03e9707c6fbd37a7c6167b7a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57c11b80ae8f601629ad05df912e54ce"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a57c11b80ae8f601629ad05df912e54ce">haveConsensus</a> (bool forReal)</td></tr>
<tr class="separator:a57c11b80ae8f601629ad05df912e54ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15fdcb5c33231ee498ae37bbcb9474cd"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a15fdcb5c33231ee498ae37bbcb9474cd">peerPosition</a> (<a class="el" href="../../df/de8/a00839.html#add6440940c08aea0de0a90ce4f5c701e">LedgerProposal::ref</a> newPosition)</td></tr>
<tr class="separator:a15fdcb5c33231ee498ae37bbcb9474cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9e50e66c75d3156818c981d45d41aea"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#ad9e50e66c75d3156818c981d45d41aea">peerHasSet</a> (<a class="el" href="../../d5/d17/a01098.html#a74554bf78a38b1c2c190b5b47c1955d4">Peer::ptr</a> const &amp;peer, <a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;hashSet, protocol::TxSetStatus status)</td></tr>
<tr class="separator:ad9e50e66c75d3156818c981d45d41aea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdc56ac065d0b4e545240d55ef813586"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d0c/a01368.html">SHAMapAddNode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#abdc56ac065d0b4e545240d55ef813586">peerGaveNodes</a> (<a class="el" href="../../d5/d17/a01098.html#a74554bf78a38b1c2c190b5b47c1955d4">Peer::ptr</a> const &amp;peer, <a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;setHash, const std::list&lt; <a class="el" href="../../df/d0b/a01372.html">SHAMapNode</a> &gt; &amp;nodeIDs, const std::list&lt; <a class="el" href="../../d9/d9d/a03417.html#a1b87ba4732cf1725393e8dd60bf73b0c">Blob</a> &gt; &amp;nodeData)</td></tr>
<tr class="separator:abdc56ac065d0b4e545240d55ef813586"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac34c71a3eab768bb6c5305bc488b0b0f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#ac34c71a3eab768bb6c5305bc488b0b0f">isOurPubKey</a> (const <a class="el" href="../../d4/d0e/a01272.html">RippleAddress</a> &amp;k)</td></tr>
<tr class="separator:ac34c71a3eab768bb6c5305bc488b0b0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b6d711af415bbfc1f1333396dff29a9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a0b6d711af415bbfc1f1333396dff29a9">simulate</a> ()</td></tr>
<tr class="separator:a0b6d711af415bbfc1f1333396dff29a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_a00830"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_a00830')"><img src="../../closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="../../d9/daf/a00830.html">ripple::LedgerConsensus</a></td></tr>
<tr class="memitem:a0e0a3c122b00d3d24d678abe394fae40 inherit pub_methods_a00830"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/daf/a00830.html#a0e0a3c122b00d3d24d678abe394fae40">~LedgerConsensus</a> ()=0</td></tr>
<tr class="separator:a0e0a3c122b00d3d24d678abe394fae40 inherit pub_methods_a00830"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_a00349"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_a00349')"><img src="../../closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="../../d7/dfc/a00349.html">ripple::CountedObject&lt; LedgerConsensusImp &gt;</a></td></tr>
<tr class="memitem:a3ffb842b3de733b87a0e7fa3b5b576d9 inherit pub_methods_a00349"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfc/a00349.html#a3ffb842b3de733b87a0e7fa3b5b576d9">CountedObject</a> ()</td></tr>
<tr class="separator:a3ffb842b3de733b87a0e7fa3b5b576d9 inherit pub_methods_a00349"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6e628043690cdc8ab735cf9cac02ddd inherit pub_methods_a00349"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfc/a00349.html#aa6e628043690cdc8ab735cf9cac02ddd">CountedObject</a> (<a class="el" href="../../d7/dfc/a00349.html">CountedObject</a> const &amp;)</td></tr>
<tr class="separator:aa6e628043690cdc8ab735cf9cac02ddd inherit pub_methods_a00349"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab157393b396d6ff4da9afcf364f3beaf inherit pub_methods_a00349"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfc/a00349.html#ab157393b396d6ff4da9afcf364f3beaf">~CountedObject</a> ()</td></tr>
<tr class="separator:ab157393b396d6ff4da9afcf364f3beaf inherit pub_methods_a00349"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a0a68d819bc9480bb955af7fd0fcdc18b"><td class="memItemLeft" align="right" valign="top">static char const *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a0a68d819bc9480bb955af7fd0fcdc18b">getCountedObjectName</a> ()</td></tr>
<tr class="separator:a0a68d819bc9480bb955af7fd0fcdc18b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:aad0feafd25c23e1c225e78134513e166"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166">LCState</a> { <a class="el" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166ad098380ac568dac7811bc4842c55a896">lcsPRE_CLOSE</a>, 
<a class="el" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a5c398eb7456da3c082741dbd1154495a">lcsESTABLISH</a>, 
<a class="el" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a3282a0f8d20e057099b9ea73f50673f7">lcsFINISHED</a>, 
<a class="el" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166aba862e0e4adc5b73d786f70a759118a8">lcsACCEPTED</a>
 }</td></tr>
<tr class="separator:aad0feafd25c23e1c225e78134513e166"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a6ba19bf5453dc0ae0faf92362a4d18b9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a6ba19bf5453dc0ae0faf92362a4d18b9">accept</a> (<a class="el" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a> set)</td></tr>
<tr class="separator:a6ba19bf5453dc0ae0faf92362a4d18b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd7f6e1b2ce2e7bb4888fa2fb5906f81"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#acd7f6e1b2ce2e7bb4888fa2fb5906f81">startAcquiring</a> (<a class="el" href="../../d0/dbc/a01704.html#aec96b8b1497a6c2c54780028a0d52b64">TransactionAcquire::pointer</a> acquire)</td></tr>
<tr class="separator:acd7f6e1b2ce2e7bb4888fa2fb5906f81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08e58afa2d64bcb3179711c1826fa1ee"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a08e58afa2d64bcb3179711c1826fa1ee">find</a> (<a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;<a class="el" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>)</td></tr>
<tr class="separator:a08e58afa2d64bcb3179711c1826fa1ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a45f1791a8d01d9272e4de85b350ab9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a6a45f1791a8d01d9272e4de85b350ab9">createDisputes</a> (<a class="el" href="../../d6/dfe/a01366.html#a585bf78e9ec9fa02084eb73db874939c">SHAMap::ref</a> m1, <a class="el" href="../../d6/dfe/a01366.html#a585bf78e9ec9fa02084eb73db874939c">SHAMap::ref</a> m2)</td></tr>
<tr class="separator:a6a45f1791a8d01d9272e4de85b350ab9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a6007028d429f431438981205d7a41d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a7a6007028d429f431438981205d7a41d">addDisputedTransaction</a> (<a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;txID, <a class="el" href="../../d9/d9d/a03417.html#a1b87ba4732cf1725393e8dd60bf73b0c">Blob</a> const &amp;tx)</td></tr>
<tr class="separator:a7a6007028d429f431438981205d7a41d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1663be0996a9e4b00b79ed6012704e1f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a1663be0996a9e4b00b79ed6012704e1f">adjustCount</a> (<a class="el" href="../../d6/dfe/a01366.html#a585bf78e9ec9fa02084eb73db874939c">SHAMap::ref</a> map, const std::vector&lt; <a class="el" href="../../df/d2e/a01737.html">uint160</a> &gt; &amp;peers)</td></tr>
<tr class="separator:a1663be0996a9e4b00b79ed6012704e1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68b90bb0cadfa356f2377b5c075749aa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a68b90bb0cadfa356f2377b5c075749aa">propose</a> ()</td></tr>
<tr class="separator:a68b90bb0cadfa356f2377b5c075749aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a314fbb83a253a22dd2c1267529d4801c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a314fbb83a253a22dd2c1267529d4801c">sendHaveTxSet</a> (<a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;<a class="el" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>, bool direct)</td></tr>
<tr class="separator:a314fbb83a253a22dd2c1267529d4801c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5df5087db343f09c7ceed2758e77647"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#ac5df5087db343f09c7ceed2758e77647">applyTransactions</a> (<a class="el" href="../../d6/dfe/a01366.html#a585bf78e9ec9fa02084eb73db874939c">SHAMap::ref</a> set, <a class="el" href="../../dd/d5f/a00825.html#a5e872c651337cffea1617f84474efea9">Ledger::ref</a> applyLedger, <a class="el" href="../../dd/d5f/a00825.html#a5e872c651337cffea1617f84474efea9">Ledger::ref</a> checkLedger, <a class="el" href="../../d0/d3e/a00253.html">CanonicalTXSet</a> &amp;failedTransactions, bool openLgr)</td></tr>
<tr class="separator:ac5df5087db343f09c7ceed2758e77647"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7e28c2e989b04348c4e3f3c1ee67748"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#ab7e28c2e989b04348c4e3f3c1ee67748">applyTransaction</a> (<a class="el" href="../../d9/dc5/a01705.html">TransactionEngine</a> &amp;engine, <a class="el" href="../../d9/de4/a01346.html#a24c9aa93fed382b9abfa1ed699ff26d6">SerializedTransaction::ref</a> txn, <a class="el" href="../../dd/d5f/a00825.html#a5e872c651337cffea1617f84474efea9">Ledger::ref</a> ledger, bool openLedger, bool retryAssured)</td></tr>
<tr class="separator:ab7e28c2e989b04348c4e3f3c1ee67748"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4292911c54b0bcf21a3754a47832b5a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#ae4292911c54b0bcf21a3754a47832b5a">roundCloseTime</a> (<a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> closeTime)</td></tr>
<tr class="separator:ae4292911c54b0bcf21a3754a47832b5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69dfdffade06301acafc3220fb358037"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a69dfdffade06301acafc3220fb358037">statusChange</a> (protocol::NodeEvent event, <a class="el" href="../../dd/d5f/a00825.html">Ledger</a> &amp;ledger)</td></tr>
<tr class="separator:a69dfdffade06301acafc3220fb358037"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f3404f928cc499601e0a7cdf02d016a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a4f3404f928cc499601e0a7cdf02d016a">takeInitialPosition</a> (<a class="el" href="../../dd/d5f/a00825.html">Ledger</a> &amp;initialLedger)</td></tr>
<tr class="separator:a4f3404f928cc499601e0a7cdf02d016a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bf0661799d346e0952ae2a5a0ab5c50"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a1bf0661799d346e0952ae2a5a0ab5c50">updateOurPositions</a> ()</td></tr>
<tr class="separator:a1bf0661799d346e0952ae2a5a0ab5c50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0123939fd0cb34122699b454acae8331"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a0123939fd0cb34122699b454acae8331">playbackProposals</a> ()</td></tr>
<tr class="separator:a0123939fd0cb34122699b454acae8331"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac460b24a695acd5d7cf57205ad7ab731"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#ac460b24a695acd5d7cf57205ad7ab731">closeLedger</a> ()</td></tr>
<tr class="separator:ac460b24a695acd5d7cf57205ad7ab731"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e82d48ecf0f4851a528ad4a9770d475"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a7e82d48ecf0f4851a528ad4a9770d475">checkOurValidation</a> ()</td></tr>
<tr class="separator:a7e82d48ecf0f4851a528ad4a9770d475"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d2d8edb361ed4c7d18a944cf03a9b18"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a5d2d8edb361ed4c7d18a944cf03a9b18">beginAccept</a> (bool synchronous)</td></tr>
<tr class="separator:a5d2d8edb361ed4c7d18a944cf03a9b18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9ac9fe78120048c1c77eddde73e6066"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#ae9ac9fe78120048c1c77eddde73e6066">endConsensus</a> ()</td></tr>
<tr class="separator:ae9ac9fe78120048c1c77eddde73e6066"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1b451c0a08d9d1c3fb00b2b3761c0d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#af1b451c0a08d9d1c3fb00b2b3761c0d7">addLoad</a> (<a class="el" href="../../de/d6c/a01349.html#a7e0a3cc2f01beeb07e2852ad4eb7b9dc">SerializedValidation::ref</a> val)</td></tr>
<tr class="separator:af1b451c0a08d9d1c3fb00b2b3761c0d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a98a93e0c0cf39778ab8aabcb1e62bec9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/daf/a00830.html#acb1700386f9fc9ebb9ec58260a3b400b">clock_type</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a98a93e0c0cf39778ab8aabcb1e62bec9">m_clock</a></td></tr>
<tr class="separator:a98a93e0c0cf39778ab8aabcb1e62bec9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af11ff7f7aeca802caeb76ca45974c0d6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/dd6/a00896.html">LocalTxs</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#af11ff7f7aeca802caeb76ca45974c0d6">m_localTX</a></td></tr>
<tr class="separator:af11ff7f7aeca802caeb76ca45974c0d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad2345c604e445ae15f1b594d1c9c030"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d7/d41/a00532.html">FeeVote</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#aad2345c604e445ae15f1b594d1c9c030">m_feeVote</a></td></tr>
<tr class="separator:aad2345c604e445ae15f1b594d1c9c030"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfdd93db957a9e8181362d22c7375b10"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166">LCState</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a></td></tr>
<tr class="separator:abfdd93db957a9e8181362d22c7375b10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69465d9a39fe6f4e501271b59e6613e5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a69465d9a39fe6f4e501271b59e6613e5">mCloseTime</a></td></tr>
<tr class="separator:a69465d9a39fe6f4e501271b59e6613e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8bd458103616b9f4a861b75f42413ed"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d4e/a01741.html">uint256</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a></td></tr>
<tr class="separator:ac8bd458103616b9f4a861b75f42413ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9d1b88625c504bd67fa7b85a4755fde"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d4e/a01741.html">uint256</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#ac9d1b88625c504bd67fa7b85a4755fde">mNewLedgerHash</a></td></tr>
<tr class="separator:ac9d1b88625c504bd67fa7b85a4755fde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8dcd0c00b5c03a4502c771ed0afbec73"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d4e/a01741.html">uint256</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a8dcd0c00b5c03a4502c771ed0afbec73">mAcquiringLedger</a></td></tr>
<tr class="separator:a8dcd0c00b5c03a4502c771ed0afbec73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67bcb0f7badeac0c170a110109830d46"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d5f/a00825.html#a373b6b80e365f42477db12be3ce899ba">Ledger::pointer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a></td></tr>
<tr class="separator:a67bcb0f7badeac0c170a110109830d46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab67645601b59454835041a4f64351e35"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/de8/a00839.html#a0ec96481e000fcb8d977f684d600b86b">LedgerProposal::pointer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a></td></tr>
<tr class="separator:ab67645601b59454835041a4f64351e35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c5ce846eef0f0e1bebaf8ced18b9bb6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/d0e/a01272.html">RippleAddress</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a8c5ce846eef0f0e1bebaf8ced18b9bb6">mValPublic</a></td></tr>
<tr class="separator:a8c5ce846eef0f0e1bebaf8ced18b9bb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6bf71a4a3f765224f108598544e2efe"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/d0e/a01272.html">RippleAddress</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#af6bf71a4a3f765224f108598544e2efe">mValPrivate</a></td></tr>
<tr class="separator:af6bf71a4a3f765224f108598544e2efe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe8becec1e0d33e3e31081f588891d20"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a></td></tr>
<tr class="separator:abe8becec1e0d33e3e31081f588891d20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a779e52882cd0d007dd8c3d7b53962233"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a779e52882cd0d007dd8c3d7b53962233">mValidating</a></td></tr>
<tr class="separator:a779e52882cd0d007dd8c3d7b53962233"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a305d1dbd83526551156742e4d210089f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a></td></tr>
<tr class="separator:a305d1dbd83526551156742e4d210089f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b8a207fbaed3c087f7088211e33a679"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a3b8a207fbaed3c087f7088211e33a679">mConsensusFail</a></td></tr>
<tr class="separator:a3b8a207fbaed3c087f7088211e33a679"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a980f1be83cec80bdd429cc8797f713dd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a980f1be83cec80bdd429cc8797f713dd">mCurrentMSeconds</a></td></tr>
<tr class="separator:a980f1be83cec80bdd429cc8797f713dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa09946e6c5c3c0e47a61f5c32d809b74"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#aa09946e6c5c3c0e47a61f5c32d809b74">mClosePercent</a></td></tr>
<tr class="separator:aa09946e6c5c3c0e47a61f5c32d809b74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42f8299df43917879af29265ad84a229"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a42f8299df43917879af29265ad84a229">mCloseResolution</a></td></tr>
<tr class="separator:a42f8299df43917879af29265ad84a229"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d2a5574253bae4842079acdcb4fc0ff"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a6d2a5574253bae4842079acdcb4fc0ff">mHaveCloseTimeConsensus</a></td></tr>
<tr class="separator:a6d2a5574253bae4842079acdcb4fc0ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f4ef09e1a39629c53236367f4fbc361"><td class="memItemLeft" align="right" valign="top">boost::posix_time::ptime&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a9f4ef09e1a39629c53236367f4fbc361">mConsensusStartTime</a></td></tr>
<tr class="separator:a9f4ef09e1a39629c53236367f4fbc361"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0616700feacae724b8e4a7d47cc4f9f6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a0616700feacae724b8e4a7d47cc4f9f6">mPreviousProposers</a></td></tr>
<tr class="separator:a0616700feacae724b8e4a7d47cc4f9f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7322d3c6bf824d5f5ff3d050aea3b9a4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a7322d3c6bf824d5f5ff3d050aea3b9a4">mPreviousMSeconds</a></td></tr>
<tr class="separator:a7322d3c6bf824d5f5ff3d050aea3b9a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed5b7c8b2022ecf0730ab4d0f9a8fefa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt; <a class="el" href="../../df/d2e/a01737.html">uint160</a>, <br class="typebreak"/>
<a class="el" href="../../df/de8/a00839.html#a0ec96481e000fcb8d977f684d600b86b">LedgerProposal::pointer</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a></td></tr>
<tr class="separator:aed5b7c8b2022ecf0730ab4d0f9a8fefa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6246a8d1f88dd0b9e80afc6abaf831f2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt; <a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <br class="typebreak"/>
<a class="el" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a></td></tr>
<tr class="separator:a6246a8d1f88dd0b9e80afc6abaf831f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cf65b0f94846ec7f6dc84db61766258"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt; <a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <br class="typebreak"/>
<a class="el" href="../../d0/dbc/a01704.html#aec96b8b1497a6c2c54780028a0d52b64">TransactionAcquire::pointer</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a6cf65b0f94846ec7f6dc84db61766258">mAcquiring</a></td></tr>
<tr class="separator:a6cf65b0f94846ec7f6dc84db61766258"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b5fb525962ec0bc4480e23f86c8e641"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt; <a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <br class="typebreak"/>
std::vector&lt; boost::weak_ptr<br class="typebreak"/>
&lt; <a class="el" href="../../d5/d17/a01098.html">Peer</a> &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a5b5fb525962ec0bc4480e23f86c8e641">mPeerData</a></td></tr>
<tr class="separator:a5b5fb525962ec0bc4480e23f86c8e641"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37227802a3d7139679874a5193b22722"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt; <a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <br class="typebreak"/>
<a class="el" href="../../d8/de7/a00417.html#a53bf8a87a60c0b020cdf2c8e63022065">DisputedTx::pointer</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a></td></tr>
<tr class="separator:a37227802a3d7139679874a5193b22722"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb0067cc3a21d698e60ce43a072018fa"><td class="memItemLeft" align="right" valign="top">boost::unordered_set&lt; <a class="el" href="../../d0/d4e/a01741.html">uint256</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#aeb0067cc3a21d698e60ce43a072018fa">mCompares</a></td></tr>
<tr class="separator:aeb0067cc3a21d698e60ce43a072018fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2519b3393c3aa0c48baad0bd7aa49d45"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a>, int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#a2519b3393c3aa0c48baad0bd7aa49d45">mCloseTimes</a></td></tr>
<tr class="separator:a2519b3393c3aa0c48baad0bd7aa49d45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa880479ea79d1fe40de04227870409bf"><td class="memItemLeft" align="right" valign="top">boost::unordered_set&lt; <a class="el" href="../../df/d2e/a01737.html">uint160</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d5f/a00831.html#aa880479ea79d1fe40de04227870409bf">mDeadNodes</a></td></tr>
<tr class="separator:aa880479ea79d1fe40de04227870409bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00028">28</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="a2de817de326657253b4fa07c8716adb4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><em><a class="anchor" id="a2de817de326657253b4fa07c8716adb4abcb9cee55078628b94e101fb6ad079a2"></a>resultSuccess</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a2de817de326657253b4fa07c8716adb4ae4896e788c63073d2c133ab050eb9c3f"></a>resultFail</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a2de817de326657253b4fa07c8716adb4ae9dc89e635658a568ff77c5cadad41b3"></a>resultRetry</em>&nbsp;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00034">34</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{<a class="code" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4abcb9cee55078628b94e101fb6ad079a2">resultSuccess</a>, <a class="code" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4ae4896e788c63073d2c133ab050eb9c3f">resultFail</a>, <a class="code" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4ae9dc89e635658a568ff77c5cadad41b3">resultRetry</a>};</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aad0feafd25c23e1c225e78134513e166"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166">ripple::LedgerConsensusImp::LCState</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><em><a class="anchor" id="aad0feafd25c23e1c225e78134513e166ad098380ac568dac7811bc4842c55a896"></a>lcsPRE_CLOSE</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="aad0feafd25c23e1c225e78134513e166a5c398eb7456da3c082741dbd1154495a"></a>lcsESTABLISH</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="aad0feafd25c23e1c225e78134513e166a3282a0f8d20e057099b9ea73f50673f7"></a>lcsFINISHED</em>&nbsp;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="aad0feafd25c23e1c225e78134513e166aba862e0e4adc5b73d786f70a759118a8"></a>lcsACCEPTED</em>&nbsp;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01895">1895</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    {</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166ad098380ac568dac7811bc4842c55a896">lcsPRE_CLOSE</a>,       <span class="comment">// We haven&#39;t closed our ledger yet, </span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                            <span class="comment">//  but others might have</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a5c398eb7456da3c082741dbd1154495a">lcsESTABLISH</a>,       <span class="comment">// Establishing consensus</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a3282a0f8d20e057099b9ea73f50673f7">lcsFINISHED</a>,        <span class="comment">// We have closed on a transaction set</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166aba862e0e4adc5b73d786f70a759118a8">lcsACCEPTED</a>,        <span class="comment">// We have accepted/validated </span></div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;                            <span class="comment">//  a new last closed ledger</span></div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    };</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ab15c4197a4facdfbd8600ecee491e0ff"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ripple::LedgerConsensusImp::LedgerConsensusImp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/daf/a00830.html#acb1700386f9fc9ebb9ec58260a3b400b">clock_type</a> &amp;&#160;</td>
          <td class="paramname"><em>clock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../da/dd6/a00896.html">LocalTxs</a> &amp;&#160;</td>
          <td class="paramname"><em>localtx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/d9d/a03417.html#a077afaa330c14078c1f60b740ffc7f73">LedgerHash</a> const &amp;&#160;</td>
          <td class="paramname"><em>prevLCLHash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d5f/a00825.html#a5e872c651337cffea1617f84474efea9">Ledger::ref</a>&#160;</td>
          <td class="paramname"><em>previousLedger</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a>&#160;</td>
          <td class="paramname"><em>closeTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/d41/a00532.html">FeeVote</a> &amp;&#160;</td>
          <td class="paramname"><em>feeVote</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00038">38</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../d5/dea/a02927_source.html#l00152">ripple::ContinuousLedgerTiming::getNextLedgerTimeResolution()</a>, <a class="el" href="../../dd/dac/a01008.html#af1066b526f400f571c4985950ef97aa4">ripple::NetworkOPs::getOperatingMode()</a>, <a class="el" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">ripple::Application::getOPs()</a>, <a class="el" href="../../dd/dac/a01008.html#a7235210c8455553bc11764b0ccbfc4b8">ripple::NetworkOPs::getPreviousConvergeTime()</a>, <a class="el" href="../../dd/dac/a01008.html#a6311e4617a8bcc390e3a6ddd6ab9d8a1">ripple::NetworkOPs::getPreviousProposers()</a>, <a class="el" href="../../dd/dac/a01008.html#ad501185ed756e643261f7079e5ea2eb8">ripple::NetworkOPs::isNeedNetworkLedger()</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00030">ripple::lsINFO</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00028">ripple::lsTRACE</a>, <a class="el" href="../../dd/d8f/a02970_source.html#l00079">ripple::NetworkOPs::omFULL</a>, <a class="el" href="../../dd/dac/a01008.html#a0dd6e7866a60f7d7b252c304cb2f0a32">ripple::NetworkOPs::setProposing()</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        : <a class="code" href="../../d7/d5f/a00831.html#a98a93e0c0cf39778ab8aabcb1e62bec9">m_clock</a> (clock)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#af11ff7f7aeca802caeb76ca45974c0d6">m_localTX</a> (localtx)</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#aad2345c604e445ae15f1b594d1c9c030">m_feeVote</a> (feeVote)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a> (<a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166ad098380ac568dac7811bc4842c55a896">lcsPRE_CLOSE</a>)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#a69465d9a39fe6f4e501271b59e6613e5">mCloseTime</a> (closeTime)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a> (prevLCLHash)</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a> (previousLedger)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#a8c5ce846eef0f0e1bebaf8ced18b9bb6">mValPublic</a> (<a class="code" href="../../d9/d9d/a03417.html#a3025f0e6e155cf9b7f4b6315f682423d">getConfig</a> ().VALIDATION_PUB)</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#af6bf71a4a3f765224f108598544e2efe">mValPrivate</a> (<a class="code" href="../../d9/d9d/a03417.html#a3025f0e6e155cf9b7f4b6315f682423d">getConfig</a> ().VALIDATION_PRIV)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#a3b8a207fbaed3c087f7088211e33a679">mConsensusFail</a> (<span class="keyword">false</span>)</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#a980f1be83cec80bdd429cc8797f713dd">mCurrentMSeconds</a> (0)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#aa09946e6c5c3c0e47a61f5c32d809b74">mClosePercent</a> (0)</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#a6d2a5574253bae4842079acdcb4fc0ff">mHaveCloseTimeConsensus</a> (<span class="keyword">false</span>)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        , <a class="code" href="../../d7/d5f/a00831.html#a9f4ef09e1a39629c53236367f4fbc361">mConsensusStartTime</a> </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            (boost::posix_time::microsec_clock::universal_time ())</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Creating consensus object&quot;</span>;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a994075b2b57b391e5ba833769ac13487">lsTRACE</a>, LedgerConsensus) </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;LCL:&quot;</span> &lt;&lt; previousLedger-&gt;getHash () &lt;&lt; <span class="stringliteral">&quot;, ct=&quot;</span> &lt;&lt; closeTime;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a0616700feacae724b8e4a7d47cc4f9f6">mPreviousProposers</a> = <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#a6311e4617a8bcc390e3a6ddd6ab9d8a1">getPreviousProposers</a> ();</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a7322d3c6bf824d5f5ff3d050aea3b9a4">mPreviousMSeconds</a> = <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#a7235210c8455553bc11764b0ccbfc4b8">getPreviousConvergeTime</a> ();</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        assert (<a class="code" href="../../d7/d5f/a00831.html#a7322d3c6bf824d5f5ff3d050aea3b9a4">mPreviousMSeconds</a>);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a42f8299df43917879af29265ad84a229">mCloseResolution</a> = <a class="code" href="../../d4/dce/a00337.html#aff26b393c8d36603fcb263b370b9026f">ContinuousLedgerTiming::getNextLedgerTimeResolution</a> (</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getCloseResolution (), </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getCloseAgree (), </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            previousLedger-&gt;getLedgerSeq () + 1);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a8c5ce846eef0f0e1bebaf8ced18b9bb6">mValPublic</a>.<a class="code" href="../../d4/d0e/a01272.html#aab006397e39f2ba08feb37f9b4bd3114">isSet</a> () &amp;&amp; <a class="code" href="../../d7/d5f/a00831.html#af6bf71a4a3f765224f108598544e2efe">mValPrivate</a>.<a class="code" href="../../d4/d0e/a01272.html#aab006397e39f2ba08feb37f9b4bd3114">isSet</a> () </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            &amp;&amp; !<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#ad501185ed756e643261f7079e5ea2eb8">isNeedNetworkLedger</a> ())</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Entering consensus process, validating&quot;</span>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a779e52882cd0d007dd8c3d7b53962233">mValidating</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a> = </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#af1066b526f400f571c4985950ef97aa4">getOperatingMode</a> () == <a class="code" href="../../dd/dac/a01008.html#ad4d535e9319927b90f0da38cd67940aaafaf756912385746855189063c6bd422d">NetworkOPs::omFULL</a>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Entering consensus process, watching&quot;</span>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a> = <a class="code" href="../../d7/d5f/a00831.html#a779e52882cd0d007dd8c3d7b53962233">mValidating</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a> = (<a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getHash () == <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a>)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#a0dd6e7866a60f7d7b252c304cb2f0a32">setProposing</a> (<span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#aa2d2dcc3578c8476fd1256092dd4a2ca">handleLCL</a> (<a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a>)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                <span class="comment">//          mProposing = mValidating = false;</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Entering consensus with: &quot;</span> </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                    &lt;&lt; previousLedger-&gt;getHash ();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Correct LCL is: &quot;</span> &lt;&lt; prevLCLHash;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#a0dd6e7866a60f7d7b252c304cb2f0a32">setProposing</a> (<a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a>, <a class="code" href="../../d7/d5f/a00831.html#a779e52882cd0d007dd8c3d7b53962233">mValidating</a>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_ab15c4197a4facdfbd8600ecee491e0ff_cgraph.png" border="0" usemap="#d7/d5f/a00831_ab15c4197a4facdfbd8600ecee491e0ff_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_ab15c4197a4facdfbd8600ecee491e0ff_cgraph" id="d7/d5f/a00831_ab15c4197a4facdfbd8600ecee491e0ff_cgraph">
<area shape="rect" id="node3" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="315,13,416,43"/><area shape="rect" id="node7" href="../../d4/dce/a00337.html#aff26b393c8d36603fcb263b370b9026f" title="ripple::ContinuousLedger\lTiming::getNextLedgerTimeResolution" alt="" coords="243,66,488,113"/><area shape="rect" id="node9" href="../../dd/dac/a01008.html#af1066b526f400f571c4985950ef97aa4" title="ripple::NetworkOPs\l::getOperatingMode" alt="" coords="297,135,433,182"/><area shape="rect" id="node11" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc" title="ripple::Application\l::getOPs" alt="" coords="303,205,428,251"/><area shape="rect" id="node13" href="../../dd/dac/a01008.html#a7235210c8455553bc11764b0ccbfc4b8" title="ripple::NetworkOPs\l::getPreviousConvergeTime" alt="" coords="273,274,457,321"/><area shape="rect" id="node15" href="../../dd/dac/a01008.html#a6311e4617a8bcc390e3a6ddd6ab9d8a1" title="ripple::NetworkOPs\l::getPreviousProposers" alt="" coords="287,343,444,390"/><area shape="rect" id="node17" href="../../dd/dac/a01008.html#ad501185ed756e643261f7079e5ea2eb8" title="ripple::NetworkOPs\l::isNeedNetworkLedger" alt="" coords="287,413,444,459"/><area shape="rect" id="node19" href="../../dd/dac/a01008.html#a0dd6e7866a60f7d7b252c304cb2f0a32" title="ripple::NetworkOPs\l::setProposing" alt="" coords="297,482,433,529"/><area shape="rect" id="node5" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="537,5,713,51"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a6ba19bf5453dc0ae0faf92362a4d18b9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::accept </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a>&#160;</td>
          <td class="paramname"><em>set</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>We have a new last closed ledger, process it. Final accept logic </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00855">855</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d0/d15/a00700.html#aca3fb09daacc7e2cf751f3f0747c9c72">ripple::IHashRouter::addSuppression()</a>, <a class="el" href="../../d3/dac/a01777.html#ad1f3fe2655abbbb3dcd43c4d6ed1b739">ripple::Validations::addValidation()</a>, <a class="el" href="../../dd/dac/a01008.html#a78fe27eff8baba42055b84818aca27b2">ripple::NetworkOPs::closeTimeOffset()</a>, <a class="el" href="../../d1/de6/a00837.html#afb1bee3a8be355c893d6eec64ea041cf">ripple::LedgerMaster::consensusBuilt()</a>, <a class="el" href="../../d0/d2a/a00531.html#aaf2e29f9326eb2b11c0db2ab4bcfc884">ripple::FeatureTable::doValidation()</a>, <a class="el" href="../../dd/da3/a03026_source.html#l01103">ripple::SHAMap::flushDirty()</a>, <a class="el" href="../../dd/d87/a03235_source.html#l00096">ripple::Overlay::foreach()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../da/d74/a00099.html#a58504b1cd16de88b0f8ac0b3428cbe5f">ripple::Application::getFeatureTable()</a>, <a class="el" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4">ripple::Application::getHashRouter()</a>, <a class="el" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">ripple::Application::getLedgerMaster()</a>, <a class="el" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">ripple::Application::getOPs()</a>, <a class="el" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4">ripple::Application::getValidations()</a>, <a class="el" href="../../dd/dac/a01008.html#ac37c8b8c8650a7a0d4c8dec6114fc70b">ripple::NetworkOPs::getValidationTimeNC()</a>, <a class="el" href="../../df/dbf/a03132_source.html#l00033">ripple::hotACCOUNT_NODE</a>, <a class="el" href="../../df/dbf/a03132_source.html#l00034">ripple::hotTRANSACTION_NODE</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00030">ripple::lsINFO</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00028">ripple::lsTRACE</a>, <a class="el" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">ripple::Application::overlay()</a>, <a class="el" href="../../dd/dac/a01008.html#ab4580c4d01c4abbe747d28f766112a6a">ripple::NetworkOPs::peekStoredProposals()</a>, <a class="el" href="../../d1/de6/a00837.html#a1ee50c8b4c240bdaafd6955f9d67454a">ripple::LedgerMaster::pushLedger()</a>, <a class="el" href="../../dd/dac/a01008.html#a56950f16ba23fef4918d8f6f03fb56d2">ripple::NetworkOPs::setLastValidation()</a>, <a class="el" href="../../dd/dac/a01008.html#acf90d8f88e99ff03b409ed30e2d25ac0">ripple::NetworkOPs::takePosition()</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d57/a02882_source.html#l01848">beginAccept()</a>.</p>
<div class="fragment"><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    {</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        {</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            <a class="code" href="../../da/d74/a00099.html#af8a80d2747ba486d431294e36acd449a">Application::ScopedLockType</a> lock </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                (<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a> ().getMasterLock ());</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            <span class="comment">// put our set where others can get it later</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <span class="keywordflow">if</span> (set-&gt;getHash ().isNonZero ())</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;               <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#acf90d8f88e99ff03b409ed30e2d25ac0">takePosition</a> (</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                   <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getLedgerSeq (), set);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            assert (set-&gt;getHash () == <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCurrentHash ());</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <span class="comment">// these are now obsolete</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#ab4580c4d01c4abbe747d28f766112a6a">peekStoredProposals</a> ().clear (); </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            <a class="code" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> closeTime = <a class="code" href="../../d7/d5f/a00831.html#ae4292911c54b0bcf21a3754a47832b5a">roundCloseTime</a> (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCloseTime ());</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            <span class="keywordtype">bool</span> closeTimeCorrect = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            <span class="keywordflow">if</span> (closeTime == 0)</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            {</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                <span class="comment">// we agreed to disagree</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                closeTimeCorrect = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                closeTime = <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getCloseTimeNC () + 1;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            }</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Report: Prop=&quot;</span> &lt;&lt; (<a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>) </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; val=&quot;</span> &lt;&lt; (<a class="code" href="../../d7/d5f/a00831.html#a779e52882cd0d007dd8c3d7b53962233">mValidating</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>) </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; corLCL=&quot;</span> &lt;&lt; (<a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>) </div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; fail=&quot;</span> &lt;&lt; (<a class="code" href="../../d7/d5f/a00831.html#a3b8a207fbaed3c087f7088211e33a679">mConsensusFail</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Report: Prev = &quot;</span> &lt;&lt; <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a> </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getLedgerSeq ();</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Report: TxSt = &quot;</span> &lt;&lt; set-&gt;getHash () </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;, close &quot;</span> &lt;&lt; closeTime &lt;&lt; (closeTimeCorrect ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;X&quot;</span>);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            CanonicalTXSet failedTransactions (set-&gt;getHash ());</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            <a class="code" href="../../dd/d5f/a00825.html#a373b6b80e365f42477db12be3ce899ba">Ledger::pointer</a> newLCL </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                = boost::make_shared&lt;Ledger&gt; (false</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                , boost::ref (*<a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>));</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            <span class="comment">// Set up to write SHAMap changes to our database, </span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            <span class="comment">//   perform updates, extract changes</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            newLCL-&gt;peekTransactionMap ()-&gt;armDirty ();</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            newLCL-&gt;peekAccountStateMap ()-&gt;armDirty ();</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Applying consensus set transactions to the&quot;</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; last closed ledger&quot;</span>;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#ac5df5087db343f09c7ceed2758e77647">applyTransactions</a> (set, newLCL, newLCL, failedTransactions, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            newLCL-&gt;updateSkipList ();</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            newLCL-&gt;setClosed ();</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            boost::shared_ptr&lt;SHAMap::NodeMap&gt; acctNodes </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                = newLCL-&gt;peekAccountStateMap ()-&gt;disarmDirty ();</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            boost::shared_ptr&lt;SHAMap::NodeMap&gt; txnNodes </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                = newLCL-&gt;peekTransactionMap ()-&gt;disarmDirty ();</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            <span class="comment">// write out dirty nodes (temporarily done here)</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <span class="keywordtype">int</span> fc;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            <span class="keywordflow">while</span> ((fc = <a class="code" href="../../d6/dfe/a01366.html#ac6cf96fcb609794800a98a1a683409b8">SHAMap::flushDirty</a> (*acctNodes, 256</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                , <a class="code" href="../../d9/d9d/a03417.html#ad80549ab348d15a7256fe4182bed139fa65cfe147458030070724c8b3795e508f">hotACCOUNT_NODE</a>, newLCL-&gt;getLedgerSeq ())) &gt; 0)</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            {</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a994075b2b57b391e5ba833769ac13487">lsTRACE</a>, LedgerConsensus) </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Flushed &quot;</span> &lt;&lt; fc &lt;&lt; <span class="stringliteral">&quot; dirty state nodes&quot;</span>;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            <span class="keywordflow">while</span> ((fc = <a class="code" href="../../d6/dfe/a01366.html#ac6cf96fcb609794800a98a1a683409b8">SHAMap::flushDirty</a> (*txnNodes, 256</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                , <a class="code" href="../../d9/d9d/a03417.html#ad80549ab348d15a7256fe4182bed139faad6a443f1fefba026adfb0c5a2d9a671">hotTRANSACTION_NODE</a>, newLCL-&gt;getLedgerSeq ())) &gt; 0)</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a994075b2b57b391e5ba833769ac13487">lsTRACE</a>, LedgerConsensus) </div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Flushed &quot;</span> &lt;&lt; fc &lt;&lt; <span class="stringliteral">&quot; dirty transaction nodes&quot;</span>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            }</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            newLCL-&gt;setAccepted (closeTime, <a class="code" href="../../d7/d5f/a00831.html#a42f8299df43917879af29265ad84a229">mCloseResolution</a>, closeTimeCorrect);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getLedgerMaster().storeLedger (newLCL))</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus)</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Consensus built ledger we already had&quot;</span>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getInboundLedgers().<a class="code" href="../../d7/d5f/a00831.html#a08e58afa2d64bcb3179711c1826fa1ee">find</a> (newLCL-&gt;getHash()))</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus)</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Consensus built ledger we were acquiring&quot;</span>;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus)</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Consensus built new ledger&quot;</span>;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Report: NewL  = &quot;</span> &lt;&lt; newLCL-&gt;getHash () </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; newLCL-&gt;getLedgerSeq ();</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            uint256 newLCLHash = newLCL-&gt;getHash ();</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a69dfdffade06301acafc3220fb358037">statusChange</a> (protocol::neACCEPTED_LEDGER, *newLCL);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a779e52882cd0d007dd8c3d7b53962233">mValidating</a> &amp;&amp; !<a class="code" href="../../d7/d5f/a00831.html#a3b8a207fbaed3c087f7088211e33a679">mConsensusFail</a>)</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            {</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                uint256 signingHash;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                <a class="code" href="../../de/d6c/a01349.html#a2e641fe3da3300cc7172c04c3a54d977">SerializedValidation::pointer</a> v = </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                    boost::make_shared&lt;SerializedValidation&gt;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                    (newLCLHash, <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#ac37c8b8c8650a7a0d4c8dec6114fc70b">getValidationTimeNC</a> ()</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                    , <a class="code" href="../../d7/d5f/a00831.html#a8c5ce846eef0f0e1bebaf8ced18b9bb6">mValPublic</a>, <a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a>);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                v-&gt;setFieldU32 (sfLedgerSequence, newLCL-&gt;getLedgerSeq ());</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#af1b451c0a08d9d1c3fb00b2b3761c0d7">addLoad</a>(v);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                <span class="keywordflow">if</span> (((newLCL-&gt;getLedgerSeq () + 1) % 256) == 0)</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                <span class="comment">// next ledger is flag ledger   </span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                    <a class="code" href="../../d7/d5f/a00831.html#aad2345c604e445ae15f1b594d1c9c030">m_feeVote</a>.<a class="code" href="../../d7/d41/a00532.html#a27e2954d294e927f4893b5e4eab75186">doValidation</a> (newLCL, *v);</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                    <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a58504b1cd16de88b0f8ac0b3428cbe5f">getFeatureTable</a> ().<a class="code" href="../../d0/d2a/a00531.html#aaf2e29f9326eb2b11c0db2ab4bcfc884">doValidation</a> (newLCL, *v);</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                }</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                v-&gt;sign (signingHash, <a class="code" href="../../d7/d5f/a00831.html#af6bf71a4a3f765224f108598544e2efe">mValPrivate</a>);</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                v-&gt;setTrusted ();</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                <span class="comment">// suppress it if we receive it - FIXME: wrong suppression</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4">getHashRouter</a> ().<a class="code" href="../../d0/d15/a00700.html#aca3fb09daacc7e2cf751f3f0747c9c72">addSuppression</a> (signingHash);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4">getValidations</a> ().<a class="code" href="../../d3/dac/a01777.html#ad1f3fe2655abbbb3dcd43c4d6ed1b739">addValidation</a> (v, <span class="stringliteral">&quot;local&quot;</span>);</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#a56950f16ba23fef4918d8f6f03fb56d2">setLastValidation</a> (v);</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                <a class="code" href="../../d9/d9d/a03417.html#a1b87ba4732cf1725393e8dd60bf73b0c">Blob</a> validation = v-&gt;getSigned ();</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                protocol::TMValidation val;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                val.set_validation (&amp;validation[0], validation.size ());</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a> ().<a class="code" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">overlay</a> ().<a class="code" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c">foreach</a> (send_always (</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                    boost::make_shared &lt;Message&gt; (</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                        val, protocol::mtVALIDATION)));</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;CNF Val &quot;</span> &lt;&lt; newLCLHash;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            }</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;CNF newLCL &quot;</span> &lt;&lt; newLCLHash;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <span class="comment">// See if we can accept a ledger as fully-validated</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">getLedgerMaster</a>().<a class="code" href="../../d1/de6/a00837.html#afb1bee3a8be355c893d6eec64ea041cf">consensusBuilt</a> (newLCL);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            <a class="code" href="../../dd/d5f/a00825.html#a373b6b80e365f42477db12be3ce899ba">Ledger::pointer</a> newOL = boost::make_shared&lt;Ledger&gt; </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                (<span class="keyword">true</span>, boost::ref (*newLCL));</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            <a class="code" href="../../d1/de6/a00837.html#a732b418eecabfc65b00077787a3ce958">LedgerMaster::ScopedLockType</a> sl </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                (<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getLedgerMaster ().peekMutex ());</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            <span class="comment">// Apply disputed transactions that didn&#39;t get in</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            TransactionEngine engine (newOL);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            BOOST_FOREACH (<a class="code" href="../../d9/d9d/a03417.html#ab40f03d8b2d67f746e939aa2065499e3">u256_lct_pair</a> &amp; it, <a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>)</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                <span class="keywordflow">if</span> (!it.second-&gt;getOurVote ())</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                    <span class="comment">// we voted NO</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                    <span class="keywordflow">try</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                    {</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot;Test applying disputed transaction that did&quot;</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot; not get in&quot;</span>;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                        SerializerIterator sit (it.second-&gt;peekTransaction ());</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                        <a class="code" href="../../d9/de4/a01346.html#a19013480d962d1dd24d7fd022fea003e">SerializedTransaction::pointer</a> txn </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                            = boost::make_shared&lt;SerializedTransaction&gt; </div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                            (boost::ref (sit));</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#ab7e28c2e989b04348c4e3f3c1ee67748">applyTransaction</a> (engine, txn, newOL, <span class="keyword">true</span>, <span class="keyword">false</span>))</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                        {</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                            failedTransactions.push_back (txn);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                        }</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                    }</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                    <span class="keywordflow">catch</span> (...)</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                    {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot;Failed to apply transaction we voted NO on&quot;</span>;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                    }</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            }</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Applying transactions from current open ledger&quot;</span>;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#ac5df5087db343f09c7ceed2758e77647">applyTransactions</a> (<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getLedgerMaster ().getCurrentLedger</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                ()-&gt;peekTransactionMap (), newOL, newLCL,</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                failedTransactions, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                TransactionEngine engine (newOL);</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#af11ff7f7aeca802caeb76ca45974c0d6">m_localTX</a>.<a class="code" href="../../da/dd6/a00896.html#a149e82c25946a014f39b2a1471f5701b">apply</a> (engine);</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;            }</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">getLedgerMaster</a> ().<a class="code" href="../../d1/de6/a00837.html#a1ee50c8b4c240bdaafd6955f9d67454a">pushLedger</a> (newLCL, newOL);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#ac9d1b88625c504bd67fa7b85a4755fde">mNewLedgerHash</a> = newLCL-&gt;getHash ();</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a> = <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166aba862e0e4adc5b73d786f70a759118a8">lcsACCEPTED</a>;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            sl.unlock ();</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a779e52882cd0d007dd8c3d7b53962233">mValidating</a>)</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            {</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                <span class="comment">// see how close our close time is to other node&#39;s</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                <span class="comment">//  close time reports</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;We closed at &quot;</span> </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                    &lt;&lt; beast::lexicalCastThrow &lt;std::string&gt; (<a class="code" href="../../d7/d5f/a00831.html#a69465d9a39fe6f4e501271b59e6613e5">mCloseTime</a>);</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">std::uint64_t</a> closeTotal = <a class="code" href="../../d7/d5f/a00831.html#a69465d9a39fe6f4e501271b59e6613e5">mCloseTime</a>;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                <span class="keywordtype">int</span> closeCount = 1;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                <span class="keywordflow">for</span> (std::map&lt;std::uint32_t, int&gt;::iterator it = <a class="code" href="../../d7/d5f/a00831.html#a2519b3393c3aa0c48baad0bd7aa49d45">mCloseTimes</a>.begin ()</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                    , end = <a class="code" href="../../d7/d5f/a00831.html#a2519b3393c3aa0c48baad0bd7aa49d45">mCloseTimes</a>.end (); it != end; ++it)</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                {</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                    <span class="comment">// FIXME: Use median, not average</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                        &lt;&lt; beast::lexicalCastThrow &lt;std::string&gt; (it-&gt;second) </div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; time votes for &quot;</span> </div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                        &lt;&lt; beast::lexicalCastThrow &lt;std::string&gt; (it-&gt;first);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                    closeCount += it-&gt;second;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                    closeTotal += <span class="keyword">static_cast&lt;</span><a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">std::uint64_t</a><span class="keyword">&gt;</span> </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                        (it-&gt;first) * static_cast&lt;std::uint64_t&gt; (it-&gt;second);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                }</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                closeTotal += (closeCount / 2);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                closeTotal /= closeCount;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                <span class="keywordtype">int</span> offset = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span> (closeTotal) </div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                    - static_cast&lt;int&gt; (<a class="code" href="../../d7/d5f/a00831.html#a69465d9a39fe6f4e501271b59e6613e5">mCloseTime</a>);</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Our close offset is estimated at &quot;</span> </div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                    &lt;&lt; offset &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; closeCount &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#a78fe27eff8baba42055b84818aca27b2">closeTimeOffset</a> (offset);</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            }</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a6ba19bf5453dc0ae0faf92362a4d18b9_cgraph.png" border="0" usemap="#d7/d5f/a00831_a6ba19bf5453dc0ae0faf92362a4d18b9_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a6ba19bf5453dc0ae0faf92362a4d18b9_cgraph" id="d7/d5f/a00831_a6ba19bf5453dc0ae0faf92362a4d18b9_cgraph">
<area shape="rect" id="node3" href="../../d0/d15/a00700.html#aca3fb09daacc7e2cf751f3f0747c9c72" title="ripple::IHashRouter\l::addSuppression" alt="" coords="265,5,399,51"/><area shape="rect" id="node5" href="../../d3/dac/a01777.html#ad1f3fe2655abbbb3dcd43c4d6ed1b739" title="ripple::Validations\l::addValidation" alt="" coords="269,74,395,121"/><area shape="rect" id="node7" href="../../dd/dac/a01008.html#a78fe27eff8baba42055b84818aca27b2" title="ripple::NetworkOPs\l::closeTimeOffset" alt="" coords="264,143,400,190"/><area shape="rect" id="node9" href="../../d1/de6/a00837.html#afb1bee3a8be355c893d6eec64ea041cf" title="ripple::LedgerMaster\l::consensusBuilt" alt="" coords="263,213,401,259"/><area shape="rect" id="node11" href="../../d0/d2a/a00531.html#aaf2e29f9326eb2b11c0db2ab4bcfc884" title="ripple::FeatureTable\l::doValidation" alt="" coords="264,282,400,329"/><area shape="rect" id="node13" href="../../d6/dfe/a01366.html#ac6cf96fcb609794800a98a1a683409b8" title="ripple::SHAMap::flushDirty" alt="" coords="243,352,421,381"/><area shape="rect" id="node23" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="504,483,605,512"/><area shape="rect" id="node33" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c" title="ripple::Overlay::foreach" alt="" coords="253,456,411,485"/><area shape="rect" id="node38" href="../../da/d74/a00099.html#a58504b1cd16de88b0f8ac0b3428cbe5f" title="ripple::Application\l::getFeatureTable" alt="" coords="269,509,395,555"/><area shape="rect" id="node40" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4" title="ripple::Application\l::getHashRouter" alt="" coords="269,578,395,625"/><area shape="rect" id="node42" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104" title="ripple::Application\l::getLedgerMaster" alt="" coords="269,647,395,694"/><area shape="rect" id="node44" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc" title="ripple::Application\l::getOPs" alt="" coords="269,717,395,763"/><area shape="rect" id="node46" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4" title="ripple::Application\l::getValidations" alt="" coords="269,786,395,833"/><area shape="rect" id="node48" href="../../dd/dac/a01008.html#ac37c8b8c8650a7a0d4c8dec6114fc70b" title="ripple::NetworkOPs\l::getValidationTimeNC" alt="" coords="255,855,409,902"/><area shape="rect" id="node50" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee" title="ripple::Application\l::overlay" alt="" coords="269,925,395,971"/><area shape="rect" id="node52" href="../../dd/dac/a01008.html#ab4580c4d01c4abbe747d28f766112a6a" title="ripple::NetworkOPs\l::peekStoredProposals" alt="" coords="255,994,409,1041"/><area shape="rect" id="node54" href="../../d1/de6/a00837.html#a1ee50c8b4c240bdaafd6955f9d67454a" title="ripple::LedgerMaster\l::pushLedger" alt="" coords="263,1063,401,1110"/><area shape="rect" id="node56" href="../../dd/dac/a01008.html#a56950f16ba23fef4918d8f6f03fb56d2" title="ripple::NetworkOPs\l::setLastValidation" alt="" coords="264,1133,400,1179"/><area shape="rect" id="node58" href="../../dd/dac/a01008.html#acf90d8f88e99ff03b409ed30e2d25ac0" title="ripple::NetworkOPs\l::takePosition" alt="" coords="264,1202,400,1249"/><area shape="rect" id="node15" href="../../da/d61/a01350.html#a0b9f56cab2021e47d45e4cd287f4b425" title="ripple::Serializer\l::erase" alt="" coords="497,66,612,113"/><area shape="rect" id="node17" href="../../da/d61/a01350.html#afc7187fd3c9e185d29a0ecf5500d0cdf" title="ripple::Serializer\l::getSHA512Half" alt="" coords="495,135,615,182"/><area shape="rect" id="node21" href="../../da/d61/a01350.html#a39e3319f1b024688b1433c91af285b9e" title="ripple::Serializer\l::getDataLength" alt="" coords="497,205,612,251"/><area shape="rect" id="node27" href="../../da/d74/a00099.html#a25c5851322f6cb3762563fd1278c6143" title="ripple::Application\l::getNodeStore" alt="" coords="492,274,617,321"/><area shape="rect" id="node29" href="../../dd/dcb/a00375.html#aeec6606bd5748584f4d36efe9134999f" title="ripple::NodeStore::\lDatabase::store" alt="" coords="489,343,620,390"/><area shape="rect" id="node31" href="../../da/d61/a01350.html#a6d7436e5990cb278bd924cef9396df3c" title="ripple::Serializer\l::modData" alt="" coords="497,413,612,459"/><area shape="rect" id="node19" href="../../da/d61/a01350.html#ac7bf5cce451c952933b2750d902d848c" title="ripple::Serializer\l::size" alt="" coords="720,135,835,182"/><area shape="rect" id="node25" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="689,474,865,521"/><area shape="rect" id="node35" href="../../de/de6/a01063.html#a5b8ee783b77679fb2fad2543ab521a90" title="ripple::Overlay::getActive\lPeers" alt="" coords="471,535,639,582"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a6ba19bf5453dc0ae0faf92362a4d18b9_icgraph.png" border="0" usemap="#d7/d5f/a00831_a6ba19bf5453dc0ae0faf92362a4d18b9_icgraph" alt=""/></div>
<map name="d7/d5f/a00831_a6ba19bf5453dc0ae0faf92362a4d18b9_icgraph" id="d7/d5f/a00831_a6ba19bf5453dc0ae0faf92362a4d18b9_icgraph">
<area shape="rect" id="node3" href="../../d7/d5f/a00831.html#a5d2d8edb361ed4c7d18a944cf03a9b18" title="ripple::LedgerConsensusImp\l::beginAccept" alt="" coords="244,5,431,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7a6007028d429f431438981205d7a41d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::addDisputedTransaction </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;&#160;</td>
          <td class="paramname"><em>txID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/d9d/a03417.html#a1b87ba4732cf1725393e8dd60bf73b0c">Blob</a> const &amp;&#160;</td>
          <td class="paramname"><em>tx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Add a disputed transaction (one that at least one node wants 
</pre><p> in the consensus set and at least one node does not) to our tracking </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01174">1174</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dd/d87/a03235_source.html#l00096">ripple::Overlay::foreach()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4">ripple::Application::getHashRouter()</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, <a class="el" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">ripple::Application::overlay()</a>, <a class="el" href="../../d0/d15/a00700.html#a00825d59e3a11401f2abad8b879f6602">ripple::IHashRouter::setFlag()</a>, <a class="el" href="../../d0/d7b/a02968_source.html#l00027">SF_RELAYED</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    {</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>.find (txID) != <a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>.end ())</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Transaction &quot;</span> </div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            &lt;&lt; txID &lt;&lt; <span class="stringliteral">&quot; is disputed&quot;</span>;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <span class="keywordtype">bool</span> ourVote = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>)</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        {</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map&lt;uint256, SHAMap::pointer&gt;::iterator</a> mit </div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                = <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.find (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCurrentHash ());</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;            <span class="keywordflow">if</span> (mit != <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.end ())</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                ourVote = mit-&gt;second-&gt;hasItem (txID);</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                assert (<span class="keyword">false</span>); <span class="comment">// We don&#39;t have our own position?</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <a class="code" href="../../d8/de7/a00417.html#a53bf8a87a60c0b020cdf2c8e63022065">DisputedTx::pointer</a> txn = boost::make_shared&lt;DisputedTx&gt; </div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;            (txID, tx, ourVote);</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>[txID] = txn;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        BOOST_FOREACH (<a class="code" href="../../d9/d9d/a03417.html#a47337812e8a4d433820ceac3f9ca3047">u160_prop_pair</a> &amp; pit, <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>)</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        {</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map&lt;uint256, SHAMap::pointer&gt;::const_iterator</a> cit</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                = <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.find (pit.second-&gt;getCurrentHash ());</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;            <span class="keywordflow">if</span> ((cit != <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.end ()) &amp;&amp; cit-&gt;second)</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            {</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                txn-&gt;setVote (pit.first, cit-&gt;second-&gt;hasItem (txID));</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;            }</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        }</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <span class="comment">// If we didn&#39;t relay this transaction recently, relay it</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4">getHashRouter</a> ().<a class="code" href="../../d0/d15/a00700.html#a00825d59e3a11401f2abad8b879f6602">setFlag</a> (txID, <a class="code" href="../../d0/d7b/a02968.html#af9be45afdb73db8b7ac79729af6a72da">SF_RELAYED</a>))</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        {</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;            protocol::TMTransaction msg;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;            msg.set_rawtransaction (&amp; (tx.front ()), tx.size ());</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;            msg.set_status (protocol::tsNEW);</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;            msg.set_receivetimestamp (<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getOPs ().getNetworkTimeNC ());</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a> ().<a class="code" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">overlay</a> ().<a class="code" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c">foreach</a> (send_always (</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                boost::make_shared&lt;Message&gt; (</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                    msg, protocol::mtTRANSACTION)));</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a7a6007028d429f431438981205d7a41d_cgraph.png" border="0" usemap="#d7/d5f/a00831_a7a6007028d429f431438981205d7a41d_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a7a6007028d429f431438981205d7a41d_cgraph" id="d7/d5f/a00831_a7a6007028d429f431438981205d7a41d_cgraph">
<area shape="rect" id="node3" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c" title="ripple::Overlay::foreach" alt="" coords="243,21,400,51"/><area shape="rect" id="node7" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="271,79,372,108"/><area shape="rect" id="node11" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4" title="ripple::Application\l::getHashRouter" alt="" coords="259,131,384,178"/><area shape="rect" id="node13" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee" title="ripple::Application\l::overlay" alt="" coords="259,201,384,247"/><area shape="rect" id="node15" href="../../d0/d15/a00700.html#a00825d59e3a11401f2abad8b879f6602" title="ripple::IHashRouter\l::setFlag" alt="" coords="255,270,388,317"/><area shape="rect" id="node5" href="../../de/de6/a01063.html#a5b8ee783b77679fb2fad2543ab521a90" title="ripple::Overlay::getActive\lPeers" alt="" coords="453,5,621,51"/><area shape="rect" id="node9" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="449,74,625,121"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af1b451c0a08d9d1c3fb00b2b3761c0d7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::addLoad </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d6c/a01349.html#a7e0a3cc2f01beeb07e2852ad4eb7b9dc">SerializedValidation::ref</a>&#160;</td>
          <td class="paramname"><em>val</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Add our load fee to our validation </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01880">1880</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../da/d74/a00099.html#a426bdbb87f6dc2082cf6f418526901cb">ripple::Application::getFeeTrack()</a>, <a class="el" href="../../dd/d94/a00888.html#a9dc0eefbc4ef848a1d8cb3e58aebcab0">ripple::LoadFeeTrack::getLoadBase()</a>, and <a class="el" href="../../d5/dd8/a03083_source.html#l00035">ripple::max()</a>.</p>
<div class="fragment"><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    {</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        <a class="code" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> fee = <a class="code" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785">std::max</a>(</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getFeeTrack().getLocalFee(),</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getFeeTrack().getClusterFee());</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;        <a class="code" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> ref = <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a426bdbb87f6dc2082cf6f418526901cb">getFeeTrack</a>().<a class="code" href="../../dd/d94/a00888.html#a9dc0eefbc4ef848a1d8cb3e58aebcab0">getLoadBase</a>();</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        <span class="keywordflow">if</span> (fee &gt; ref)</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;            val-&gt;setFieldU32(sfLoadFee, fee);</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_af1b451c0a08d9d1c3fb00b2b3761c0d7_cgraph.png" border="0" usemap="#d7/d5f/a00831_af1b451c0a08d9d1c3fb00b2b3761c0d7_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_af1b451c0a08d9d1c3fb00b2b3761c0d7_cgraph" id="d7/d5f/a00831_af1b451c0a08d9d1c3fb00b2b3761c0d7_cgraph">
<area shape="rect" id="node3" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="264,13,365,43"/><area shape="rect" id="node7" href="../../da/d74/a00099.html#a426bdbb87f6dc2082cf6f418526901cb" title="ripple::Application\l::getFeeTrack" alt="" coords="252,66,377,113"/><area shape="rect" id="node9" href="../../dd/d94/a00888.html#a9dc0eefbc4ef848a1d8cb3e58aebcab0" title="ripple::LoadFeeTrack\l::getLoadBase" alt="" coords="243,135,387,182"/><area shape="rect" id="node11" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="272,205,357,235"/><area shape="rect" id="node5" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="436,5,612,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1663be0996a9e4b00b79ed6012704e1f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::adjustCount </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/dfe/a01366.html#a585bf78e9ec9fa02084eb73db874939c">SHAMap::ref</a>&#160;</td>
          <td class="paramname"><em>map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../df/d2e/a01737.html">uint160</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>peers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Adjust the counts on all disputed transactions based on the set of peers taking this position </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01226">1226</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    {</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        BOOST_FOREACH (<a class="code" href="../../d9/d9d/a03417.html#ab40f03d8b2d67f746e939aa2065499e3">u256_lct_pair</a> &amp; it, <a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>)</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        {</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            <span class="keywordtype">bool</span> setHas = map-&gt;hasItem (it.second-&gt;getTransactionID ());</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;            BOOST_FOREACH (<span class="keyword">const</span> uint160 &amp; pit, peers)</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;                it.second-&gt;setVote (pit, setHas);</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        }</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab7e28c2e989b04348c4e3f3c1ee67748"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ripple::LedgerConsensusImp::applyTransaction </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/dc5/a01705.html">TransactionEngine</a> &amp;&#160;</td>
          <td class="paramname"><em>engine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/de4/a01346.html#a24c9aa93fed382b9abfa1ed699ff26d6">SerializedTransaction::ref</a>&#160;</td>
          <td class="paramname"><em>txn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d5f/a00825.html#a5e872c651337cffea1617f84474efea9">Ledger::ref</a>&#160;</td>
          <td class="paramname"><em>ledger</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>openLedger</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>retryAssured</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Apply a transaction to a ledger </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01369">1369</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../da/de2/a03067_source.html#l00075">ripple::TransactionEngine::applyTransaction()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4">ripple::Application::getHashRouter()</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00179">isTefFailure</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00177">isTelLocal</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00178">isTemMalformed</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00028">ripple::lsTRACE</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00031">ripple::lsWARNING</a>, <a class="el" href="../../d0/d15/a00700.html#a00825d59e3a11401f2abad8b879f6602">ripple::IHashRouter::setFlag()</a>, <a class="el" href="../../d0/d7b/a02968_source.html#l00030">SF_SIGGOOD</a>, <a class="el" href="../../db/da5/a02919_source.html#l00029">ripple::tapNO_CHECK_SIGN</a>, <a class="el" href="../../db/da5/a02919_source.html#l00027">ripple::tapNONE</a>, <a class="el" href="../../db/da5/a02919_source.html#l00031">ripple::tapOPEN_LEDGER</a>, <a class="el" href="../../db/da5/a02919_source.html#l00035">ripple::tapRETRY</a>, <a class="el" href="../../d6/d9b/a03202_source.html#l00148">ripple::transHuman()</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    {</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <span class="comment">// Returns false if the transaction has need not be retried.</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09">TransactionEngineParams</a> parms = openLedger ? <a class="code" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09ab3ffb3bd2975db520632d6f5f42606e1">tapOPEN_LEDGER</a> : <a class="code" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09af77cbea9706ce2ee7fdf5a85efbf70c5">tapNONE</a>;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        <span class="keywordflow">if</span> (retryAssured)</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        {</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;            parms = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09">TransactionEngineParams</a><span class="keyword">&gt;</span> (parms | <a class="code" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09ad993a03ae0b72db5c62a616b69eaccff">tapRETRY</a>);</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        }</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4">getHashRouter</a> ().<a class="code" href="../../d0/d15/a00700.html#a00825d59e3a11401f2abad8b879f6602">setFlag</a> (txn-&gt;getTransactionID ()</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            , <a class="code" href="../../d0/d7b/a02968.html#ac4c1ab5f431528c3ea66a575b47247b6">SF_SIGGOOD</a>))</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        {</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;            parms = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09">TransactionEngineParams</a><span class="keyword">&gt;</span> </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;                (parms | <a class="code" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09ab6877d4b605c5749356755d7915cfab6">tapNO_CHECK_SIGN</a>);</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        }</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;TXN &quot;</span> </div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            &lt;&lt; txn-&gt;getTransactionID ()</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;            &lt;&lt; (openLedger ? <span class="stringliteral">&quot; open&quot;</span> : <span class="stringliteral">&quot; closed&quot;</span>)</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;            &lt;&lt; (retryAssured ? <span class="stringliteral">&quot;/retry&quot;</span> : <span class="stringliteral">&quot;/final&quot;</span>);</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a994075b2b57b391e5ba833769ac13487">lsTRACE</a>, LedgerConsensus) &lt;&lt; txn-&gt;getJson (0);</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        <span class="comment">// VFALCO TODO figure out what this &quot;trust network&quot;</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        <span class="comment">//  is all about and why it needs exceptions.</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="preprocessor">#ifndef TRUST_NETWORK</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <span class="keywordflow">try</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        {</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;            <span class="keywordtype">bool</span> didApply;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a> result = engine.applyTransaction (*txn, parms, didApply);</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;            <span class="keywordflow">if</span> (didApply)</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;            {</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Transaction success: &quot;</span> &lt;&lt; <a class="code" href="../../d9/d9d/a03417.html#af67d027ed1da5fcdbb6f7675d0151d0b">transHuman</a> (result);</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4abcb9cee55078628b94e101fb6ad079a2">resultSuccess</a>;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;            }</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d5/d73/a03203.html#ae38d32e016bc68ec62069ff4dd23c98c">isTefFailure</a> (result) || <a class="code" href="../../d5/d73/a03203.html#a23f17339aac8b4605014699e9437cf44">isTemMalformed</a> </div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                (result) || <a class="code" href="../../d5/d73/a03203.html#af2855d51729ef8b0b19caecaff1cb491">isTelLocal</a> (result))</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;            {</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;                <span class="comment">// failure</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Transaction failure: &quot;</span> &lt;&lt; <a class="code" href="../../d9/d9d/a03417.html#af67d027ed1da5fcdbb6f7675d0151d0b">transHuman</a> (result);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4ae4896e788c63073d2c133ab050eb9c3f">resultFail</a>;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;            }</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Transaction retry: &quot;</span> &lt;&lt; <a class="code" href="../../d9/d9d/a03417.html#af67d027ed1da5fcdbb6f7675d0151d0b">transHuman</a> (result);</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;            assert (!ledger-&gt;hasTransaction (txn-&gt;getTransactionID ()));</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4ae9dc89e635658a568ff77c5cadad41b3">resultRetry</a>;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="preprocessor">#ifndef TRUST_NETWORK</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="preprocessor"></span>        }</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        <span class="keywordflow">catch</span> (...)</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        {</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a4f9eb9b54b9bf0586ad6249697d4adde">lsWARNING</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Throws&quot;</span>;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        }</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="preprocessor"></span>    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_ab7e28c2e989b04348c4e3f3c1ee67748_cgraph.png" border="0" usemap="#d7/d5f/a00831_ab7e28c2e989b04348c4e3f3c1ee67748_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_ab7e28c2e989b04348c4e3f3c1ee67748_cgraph" id="d7/d5f/a00831_ab7e28c2e989b04348c4e3f3c1ee67748_cgraph">
<area shape="rect" id="node3" href="../../d9/dc5/a01705.html#ab9fec10cf88fcd1212cff4c5b4c29d60" title="ripple::TransactionEngine\l::applyTransaction" alt="" coords="244,733,412,779"/><area shape="rect" id="node92" href="../../d9/d9d/a03417.html#af67d027ed1da5fcdbb6f7675d0151d0b" title="ripple::transHuman" alt="" coords="493,1447,624,1476"/><area shape="rect" id="node103" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="277,1499,379,1528"/><area shape="rect" id="node107" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4" title="ripple::Application\l::getHashRouter" alt="" coords="265,1551,391,1598"/><area shape="rect" id="node109" href="../../d0/d15/a00700.html#a00825d59e3a11401f2abad8b879f6602" title="ripple::IHashRouter\l::setFlag" alt="" coords="261,1621,395,1667"/><area shape="rect" id="node5" href="../../d0/d08/a00832.html#af8d66b30b3965d9288c5d8eb4e520871" title="ripple::LedgerEntrySet\l::init" alt="" coords="484,74,633,121"/><area shape="rect" id="node9" href="../../d9/de4/a01346.html#a501700305bfe6b71f1b8de263bdde43e" title="ripple::SerializedTransaction\l::getTransactionID" alt="" coords="708,317,895,363"/><area shape="rect" id="node13" href="../../de/d1a/a01559.html#a85c374b955de23e00242029cb0bd4f74" title="ripple::STObject::add" alt="" coords="1169,269,1313,299"/><area shape="rect" id="node18" href="../../de/d1a/a01559.html#ad363d403a5067a41b38f4aab0b2b8fc8" title="ripple::STObject::isEquivalent" alt="" coords="461,387,656,416"/><area shape="rect" id="node22" href="../../d9/de4/a01346.html#a436d1b0b2d422540cd39c117f5f6816d" title="ripple::SerializedTransaction\l::getJson" alt="" coords="465,490,652,537"/><area shape="rect" id="node29" href="../../d8/df7/a01711.html#a520fdd34ff865b5de78aac3c40d78630" title="ripple::Transactor\l::makeTransactor" alt="" coords="497,559,620,606"/><area shape="rect" id="node33" href="../../d9/d9d/a03417.html#a8ebf8214ccd67d515e6dd26b832854a9" title="ripple::transResultInfo" alt="" coords="727,1467,876,1496"/><area shape="rect" id="node35" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c" title="ripple::is_bit_set" alt="" coords="500,837,617,867"/><area shape="rect" id="node37" href="../../d0/d08/a00832.html#a95c6ccf68549ef1d88dc47cf3e71a7ea" title="ripple::LedgerEntrySet\l::clear" alt="" coords="484,629,633,675"/><area shape="rect" id="node41" href="../../d9/dc5/a01705.html#a5766d606e55b9ede4b004ff170f967cc" title="ripple::TransactionEngine\l::entryCache" alt="" coords="475,698,643,745"/><area shape="rect" id="node45" href="../../dd/d5f/a00825.html#ab0ca75e1c5fa67568377f9962687cf90" title="ripple::Ledger::getAccount\lRootIndex" alt="" coords="472,767,645,814"/><area shape="rect" id="node52" href="../../d9/de4/a01346.html#ac1425afebd8e387f017bdf9cb0204498" title="ripple::SerializedTransaction\l::getSourceAccount" alt="" coords="465,890,652,937"/><area shape="rect" id="node56" href="../../d9/de4/a01346.html#aaff9c0480235e2b982777311a9e5f7fd" title="ripple::SerializedTransaction\l::getSequence" alt="" coords="465,959,652,1006"/><area shape="rect" id="node60" href="../../d9/de4/a01346.html#a5dba24ce8a82d0513d25b3843bae8c43" title="ripple::SerializedTransaction\l::getTransactionFee" alt="" coords="465,1029,652,1075"/><area shape="rect" id="node64" href="../../da/d6b/a02352.html#a173f7c872fb68ccd3a20440d640b66c7" title="balance" alt="" coords="525,1151,592,1180"/><area shape="rect" id="node85" href="../../d9/dc5/a01705.html#a6a68406aec8713a4b3543b5c1a299d4b" title="ripple::TransactionEngine\l::entryModify" alt="" coords="475,1203,643,1250"/><area shape="rect" id="node87" href="../../d9/dc5/a01705.html#a8ecd39e5899f292d284405ec57eb4dbc" title="ripple::TransactionEngine\l::checkInvariants" alt="" coords="475,1273,643,1319"/><area shape="rect" id="node89" href="../../d9/d9d/a03417.html#a14963d35eeab76c974e033beb7fdddb0" title="ripple::transToken" alt="" coords="496,1343,621,1372"/><area shape="rect" id="node95" href="../../d0/d08/a00832.html#a9a4e268d98bb70b5d8a41035164c890e" title="ripple::LedgerEntrySet\l::getJson" alt="" coords="484,5,633,51"/><area shape="rect" id="node97" href="../../d0/d08/a00832.html#a1c980eea2da42b3f99d55d303c02db63" title="ripple::LedgerEntrySet\l::calcRawMeta" alt="" coords="484,143,633,190"/><area shape="rect" id="node99" href="../../d9/dc5/a01705.html#a73282ab8c8ce2a070ee756cc9c336416" title="ripple::TransactionEngine\l::txnWrite" alt="" coords="475,263,643,310"/><area shape="rect" id="node101" href="../../d2/d41/a01493.html#ae3870bf43687a085235279f483e0e731" title="ripple::STAmount::getNValue" alt="" coords="463,333,655,363"/><area shape="rect" id="node7" href="../../d1/da7/a01709.html#a3d1af2f9f921832bb2ce89c7f5afea91" title="ripple::TransactionMetaSet\l::init" alt="" coords="712,74,891,121"/><area shape="rect" id="node11" href="../../de/d1a/a01559.html#a7a9cbb8d5e1266c782de1bb94998289e" title="ripple::STObject::getHash" alt="" coords="947,325,1120,355"/><area shape="rect" id="node15" href="../../da/d61/a01350.html#afc7187fd3c9e185d29a0ecf5500d0cdf" title="ripple::Serializer\l::getSHA512Half" alt="" coords="1181,515,1301,562"/><area shape="rect" id="node20" href="../../de/d1a/a01559.html#ab150c202aa51c574869599a2a3d475ff" title="ripple::STObject::getFullText" alt="" coords="707,264,896,293"/><area shape="rect" id="node24" href="../../de/d1a/a01559.html#a20e386b11943fda5fe9c67542e8f0e50" title="ripple::STObject::getJson" alt="" coords="716,456,887,485"/><area shape="rect" id="node27" href="../../d7/d9a/a00152.html#a348c4019943a8b3a05f39f1efcb589c9" title="ripple::base_uint::\lGetHex" alt="" coords="739,386,864,433"/><area shape="rect" id="node31" href="../../d9/de4/a01346.html#ad22d8a774bf0fdcac7aeb08fece39c17" title="ripple::SerializedTransaction\l::getTxnType" alt="" coords="708,509,895,555"/><area shape="rect" id="node39" href="../../d1/da7/a01709.html#afcac71040a014d74bf063ce83ca95bb2" title="ripple::TransactionMetaSet\l::clear" alt="" coords="712,578,891,625"/><area shape="rect" id="node43" href="../../d0/d08/a00832.html#ad13594cf847a6c56ef479ee44ae3c329" title="ripple::LedgerEntrySet\l::entryCache" alt="" coords="727,647,876,694"/><area shape="rect" id="node47" href="../../da/d61/a01350.html#a10b908daaabf22ae052bfc7fd221157c" title="ripple::Serializer\l::add16" alt="" coords="744,767,859,814"/><area shape="rect" id="node49" href="../../da/d61/a01350.html#a509771bf1109949d4bee7b71aecc3757" title="ripple::Serializer\l::add160" alt="" coords="744,837,859,883"/><area shape="rect" id="node54" href="../../de/d1a/a01559.html#ac853c6963065dd80fa4a58543ab4ac39" title="ripple::STObject::getField\lAccount" alt="" coords="716,906,887,953"/><area shape="rect" id="node58" href="../../de/d1a/a01559.html#ab3e8074cfab6e1c525b2d9a474c60f23" title="ripple::STObject::getFieldU32" alt="" coords="704,976,899,1005"/><area shape="rect" id="node62" href="../../de/d1a/a01559.html#aad5f49acb4c7b95cabee5d8463d4ce4a" title="ripple::STObject::getField\lAmount" alt="" coords="716,1029,887,1075"/><area shape="rect" id="node66" href="../../da/d6b/a02352.html#af8eafba12a6ebc987cf6ae89f4cce1a8" title="balance_deeper" alt="" coords="745,1203,857,1232"/><area shape="rect" id="node68" href="../../da/d6b/a02352.html#a92c6fb14f9bcf117440c35116c26d6c4" title="releasePage" alt="" coords="987,1177,1080,1207"/><area shape="rect" id="node70" href="../../da/d6b/a02352.html#ad4b8aee028ee99575b0748b299e04ed0" title="sqlite3PagerWrite" alt="" coords="971,1256,1096,1285"/><area shape="rect" id="node72" href="../../da/d6b/a02352.html#a513ba5c0beb3462a4b60064469f1539d" title="balance_nonroot" alt="" coords="743,1256,860,1285"/><area shape="rect" id="node76" href="../../da/d6b/a02352.html#a92f1869a02b8b9196e5ea7ed2e61c328" title="balance_quick" alt="" coords="749,1099,853,1128"/><area shape="rect" id="node80" href="../../da/d6b/a02352.html#a7c85b1d9d633386e0ecb5d56594fe03f" title="sqlite3PageFree" alt="" coords="744,1309,859,1339"/><area shape="rect" id="node82" href="../../da/d6b/a02352.html#af05f296695d164316d4666a76d07f1f0" title="sqlite3PageMalloc" alt="" coords="737,1363,865,1392"/><area shape="rect" id="node105" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="471,1499,647,1546"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac5df5087db343f09c7ceed2758e77647"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::applyTransactions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/dfe/a01366.html#a585bf78e9ec9fa02084eb73db874939c">SHAMap::ref</a>&#160;</td>
          <td class="paramname"><em>set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d5f/a00825.html#a5e872c651337cffea1617f84474efea9">Ledger::ref</a>&#160;</td>
          <td class="paramname"><em>applyLedger</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d5f/a00825.html#a5e872c651337cffea1617f84474efea9">Ledger::ref</a>&#160;</td>
          <td class="paramname"><em>checkLedger</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d3e/a00253.html">CanonicalTXSet</a> &amp;&#160;</td>
          <td class="paramname"><em>failedTransactions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>openLgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Apply a set of transactions to a ledger </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01276">1276</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d6/d0c/a02962_source.html#l00092">ripple::CanonicalTXSet::begin()</a>, <a class="el" href="../../da/d6b/a02352_source.html#l90852">changes()</a>, <a class="el" href="../../d6/d0c/a02962_source.html#l00096">ripple::CanonicalTXSet::end()</a>, <a class="el" href="../../da/df1/a02961_source.html#l00085">ripple::CanonicalTXSet::erase()</a>, <a class="el" href="../../da/d3c/a02881_source.html#l00088">LEDGER_RETRY_PASSES</a>, <a class="el" href="../../da/d3c/a02881_source.html#l00087">LEDGER_TOTAL_PASSES</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00030">ripple::lsINFO</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00031">ripple::lsWARNING</a>, <a class="el" href="../../da/df1/a02961_source.html#l00074">ripple::CanonicalTXSet::push_back()</a>, <a class="el" href="../../d6/d0c/a02962_source.html#l00108">ripple::CanonicalTXSet::size()</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    {</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        TransactionEngine engine (applyLedger);</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="../../d8/dbe/a01370.html#a1005ad7946f0ee9bd4a1d932d80a4863">SHAMapItem::pointer</a> item = set-&gt;peekFirstItem (); !!item; </div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;            item = set-&gt;peekNextItem (item-&gt;getTag ()))</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;            <span class="keywordflow">if</span> (!checkLedger-&gt;hasTransaction (item-&gt;getTag ()))</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;            {</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Processing candidate transaction: &quot;</span> &lt;&lt; item-&gt;getTag ();</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="preprocessor">#ifndef TRUST_NETWORK</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                <span class="keywordflow">try</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                {</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="preprocessor"></span>                    SerializerIterator sit (item-&gt;peekSerializer ());</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                    <a class="code" href="../../d9/de4/a01346.html#a19013480d962d1dd24d7fd022fea003e">SerializedTransaction::pointer</a> txn </div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                        = boost::make_shared&lt;SerializedTransaction&gt; </div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                        (boost::ref (sit));</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#ab7e28c2e989b04348c4e3f3c1ee67748">applyTransaction</a> (engine, txn, </div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                        applyLedger, openLgr, <span class="keyword">true</span>) == <a class="code" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4ae9dc89e635658a568ff77c5cadad41b3">resultRetry</a>)</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;                    {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                        failedTransactions.push_back (txn);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;                    }</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="preprocessor">#ifndef TRUST_NETWORK</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="preprocessor"></span>                }</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                <span class="keywordflow">catch</span> (...)</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                {</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a4f9eb9b54b9bf0586ad6249697d4adde">lsWARNING</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;  Throws&quot;</span>;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                }</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="preprocessor"></span>            }</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="../../da/d6b/a02352.html#a098b9c6a88d2ab91cdcbd5ee0b4bfe7f">changes</a>;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="keywordtype">bool</span> certainRetry = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pass = 0; pass &lt; <a class="code" href="../../da/d3c/a02881.html#a39d4a320e82cd008de9e053ae1f6b0c1">LEDGER_TOTAL_PASSES</a>; ++pass)</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        {</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Pass: &quot;</span> &lt;&lt; pass &lt;&lt; <span class="stringliteral">&quot; Txns: &quot;</span> </div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                &lt;&lt; failedTransactions.size () </div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                &lt;&lt; (certainRetry ? <span class="stringliteral">&quot; retriable&quot;</span> : <span class="stringliteral">&quot; final&quot;</span>);</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            changes = 0;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            <a class="code" href="../../d0/d3e/a00253.html#a6167550e6d9c3094b0c4d89c92dafc64">CanonicalTXSet::iterator</a> it = failedTransactions.begin ();</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;            <span class="keywordflow">while</span> (it != failedTransactions.end ())</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;            {</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                <span class="keywordflow">try</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                {</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;                    <span class="keywordflow">switch</span> (<a class="code" href="../../d7/d5f/a00831.html#ab7e28c2e989b04348c4e3f3c1ee67748">applyTransaction</a> (engine, it-&gt;second, </div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                        applyLedger, openLgr, certainRetry))</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                    {</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4abcb9cee55078628b94e101fb6ad079a2">resultSuccess</a>:</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                        it = failedTransactions.erase (it);</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                        ++<a class="code" href="../../da/d6b/a02352.html#a098b9c6a88d2ab91cdcbd5ee0b4bfe7f">changes</a>;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4ae4896e788c63073d2c133ab050eb9c3f">resultFail</a>:</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                        it = failedTransactions.erase (it);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#a2de817de326657253b4fa07c8716adb4ae9dc89e635658a568ff77c5cadad41b3">resultRetry</a>:</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                        ++it;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                    }</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                }</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                <span class="keywordflow">catch</span> (...)</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                {</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a4f9eb9b54b9bf0586ad6249697d4adde">lsWARNING</a>, LedgerConsensus) </div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;Transaction throws&quot;</span>;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                    it = failedTransactions.erase (it);</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                }</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;            }</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Pass: &quot;</span> </div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                &lt;&lt; pass &lt;&lt; <span class="stringliteral">&quot; finished &quot;</span> &lt;&lt; changes &lt;&lt; <span class="stringliteral">&quot; changes&quot;</span>;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;            <span class="comment">// A non-retry pass made no changes</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            <span class="keywordflow">if</span> (!changes &amp;&amp; !certainRetry)</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;            <span class="comment">// Stop retriable passes</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            <span class="keywordflow">if</span> ((!changes) || (pass &gt;= <a class="code" href="../../da/d3c/a02881.html#af8d16b6cc5b04dcebd50b8a41263c1e9">LEDGER_RETRY_PASSES</a>))</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                certainRetry = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        }</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_ac5df5087db343f09c7ceed2758e77647_cgraph.png" border="0" usemap="#d7/d5f/a00831_ac5df5087db343f09c7ceed2758e77647_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_ac5df5087db343f09c7ceed2758e77647_cgraph" id="d7/d5f/a00831_ac5df5087db343f09c7ceed2758e77647_cgraph">
<area shape="rect" id="node3" href="../../d0/d3e/a00253.html#ad713adc58ead09106403894c7e10e444" title="ripple::CanonicalTXSet\l::begin" alt="" coords="259,5,413,51"/><area shape="rect" id="node5" href="../../da/d6b/a02352.html#a098b9c6a88d2ab91cdcbd5ee0b4bfe7f" title="changes" alt="" coords="301,75,371,104"/><area shape="rect" id="node7" href="../../d0/d3e/a00253.html#a11fb64e7bfc50c26c19ed9cc243ea33c" title="ripple::CanonicalTXSet::end" alt="" coords="244,128,428,157"/><area shape="rect" id="node9" href="../../d0/d3e/a00253.html#ad75b6085a73e8f14a8288bf9386d9e12" title="ripple::CanonicalTXSet\l::erase" alt="" coords="259,181,413,227"/><area shape="rect" id="node11" href="../../d0/d3e/a00253.html#a3822f691438100a89c20b5ab308bfbb9" title="ripple::CanonicalTXSet\l::push_back" alt="" coords="259,250,413,297"/><area shape="rect" id="node13" href="../../d0/d3e/a00253.html#ae59da7c88706ee4506d662165429fa4e" title="ripple::CanonicalTXSet\l::size" alt="" coords="259,319,413,366"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5d2d8edb361ed4c7d18a944cf03a9b18"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::beginAccept </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>synchronous</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>We have a new LCL and must accept it </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01848">1848</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d4/d57/a02882_source.html#l00855">accept()</a>, <a class="el" href="../../dc/d0c/a00783.html#a0e6d017b056c57465c9d72f928e3271e">ripple::JobQueue::addJob()</a>, <a class="el" href="../../d0/d75/a03105_source.html#l00028">BIND_TYPE</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../da/d74/a00099.html#a860be08979e27d8c6f37f722f996ba6c">ripple::Application::getJobQueue()</a>, <a class="el" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">ripple::Application::getOPs()</a>, <a class="el" href="../../d8/d96/a03116_source.html#l00055">ripple::jtACCEPT</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00033">ripple::lsFATAL</a>, <a class="el" href="../../dd/dac/a01008.html#a831cda17f4597d392f6a87ba85f76f3b">ripple::NetworkOPs::newLCL()</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    {</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        <a class="code" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a> consensusSet </div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;            = <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>[<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCurrentHash ()];</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;        <span class="keywordflow">if</span> (!consensusSet)</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        {</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244acb980b97f93585b5b1f20725a2256c23">lsFATAL</a>, LedgerConsensus) </div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;We don&#39;t have a consensus set&quot;</span>;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;            abort ();</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;        }</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#a831cda17f4597d392f6a87ba85f76f3b">newLCL</a> </div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;            (<a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.size (), <a class="code" href="../../d7/d5f/a00831.html#a980f1be83cec80bdd429cc8797f713dd">mCurrentMSeconds</a>, <a class="code" href="../../d7/d5f/a00831.html#ac9d1b88625c504bd67fa7b85a4755fde">mNewLedgerHash</a>);</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        <span class="keywordflow">if</span> (synchronous)</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a6ba19bf5453dc0ae0faf92362a4d18b9">accept</a> (consensusSet);</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        {</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a860be08979e27d8c6f37f722f996ba6c">getJobQueue</a>().<a class="code" href="../../dc/d0c/a00783.html#a0e6d017b056c57465c9d72f928e3271e">addJob</a> (<a class="code" href="../../d9/d9d/a03417.html#ae0f54f8ce649d639bf3e2b295347e17aa6cb3ab75be280799814794706cb2e4c1">jtACCEPT</a>, <span class="stringliteral">&quot;acceptLedger&quot;</span>,</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                <a class="code" href="../../d0/d75/a03105.html#a6c0c867ff5909fab21adb4d253d4bcc5">BIND_TYPE</a> (&amp;<a class="code" href="../../d7/d5f/a00831.html#a6ba19bf5453dc0ae0faf92362a4d18b9">LedgerConsensusImp::accept</a>, shared_from_this (), consensusSet));</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        }</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a5d2d8edb361ed4c7d18a944cf03a9b18_cgraph.png" border="0" usemap="#d7/d5f/a00831_a5d2d8edb361ed4c7d18a944cf03a9b18_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a5d2d8edb361ed4c7d18a944cf03a9b18_cgraph" id="d7/d5f/a00831_a5d2d8edb361ed4c7d18a944cf03a9b18_cgraph">
<area shape="rect" id="node3" href="../../d7/d5f/a00831.html#a6ba19bf5453dc0ae0faf92362a4d18b9" title="ripple::LedgerConsensusImp\l::accept" alt="" coords="244,648,431,694"/><area shape="rect" id="node25" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="741,111,843,140"/><area shape="rect" id="node46" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc" title="ripple::Application\l::getOPs" alt="" coords="507,1240,632,1286"/><area shape="rect" id="node62" href="../../dc/d0c/a00783.html#a0e6d017b056c57465c9d72f928e3271e" title="ripple::JobQueue::addJob" alt="" coords="252,768,423,798"/><area shape="rect" id="node65" href="../../da/d74/a00099.html#a860be08979e27d8c6f37f722f996ba6c" title="ripple::Application\l::getJobQueue" alt="" coords="275,821,400,868"/><area shape="rect" id="node68" href="../../dd/dac/a01008.html#a831cda17f4597d392f6a87ba85f76f3b" title="ripple::NetworkOPs\l::newLCL" alt="" coords="269,890,405,937"/><area shape="rect" id="node5" href="../../d0/d15/a00700.html#aca3fb09daacc7e2cf751f3f0747c9c72" title="ripple::IHashRouter\l::addSuppression" alt="" coords="503,370,636,417"/><area shape="rect" id="node7" href="../../d3/dac/a01777.html#ad1f3fe2655abbbb3dcd43c4d6ed1b739" title="ripple::Validations\l::addValidation" alt="" coords="507,440,632,486"/><area shape="rect" id="node9" href="../../dd/dac/a01008.html#a78fe27eff8baba42055b84818aca27b2" title="ripple::NetworkOPs\l::closeTimeOffset" alt="" coords="501,509,637,556"/><area shape="rect" id="node11" href="../../d1/de6/a00837.html#afb1bee3a8be355c893d6eec64ea041cf" title="ripple::LedgerMaster\l::consensusBuilt" alt="" coords="500,578,639,625"/><area shape="rect" id="node13" href="../../d0/d2a/a00531.html#aaf2e29f9326eb2b11c0db2ab4bcfc884" title="ripple::FeatureTable\l::doValidation" alt="" coords="501,648,637,694"/><area shape="rect" id="node15" href="../../d6/dfe/a01366.html#ac6cf96fcb609794800a98a1a683409b8" title="ripple::SHAMap::flushDirty" alt="" coords="480,718,659,747"/><area shape="rect" id="node35" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c" title="ripple::Overlay::foreach" alt="" coords="491,771,648,800"/><area shape="rect" id="node40" href="../../da/d74/a00099.html#a58504b1cd16de88b0f8ac0b3428cbe5f" title="ripple::Application\l::getFeatureTable" alt="" coords="507,824,632,870"/><area shape="rect" id="node42" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4" title="ripple::Application\l::getHashRouter" alt="" coords="507,893,632,940"/><area shape="rect" id="node44" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104" title="ripple::Application\l::getLedgerMaster" alt="" coords="507,962,632,1009"/><area shape="rect" id="node48" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4" title="ripple::Application\l::getValidations" alt="" coords="507,1032,632,1078"/><area shape="rect" id="node50" href="../../dd/dac/a01008.html#ac37c8b8c8650a7a0d4c8dec6114fc70b" title="ripple::NetworkOPs\l::getValidationTimeNC" alt="" coords="492,1101,647,1148"/><area shape="rect" id="node52" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee" title="ripple::Application\l::overlay" alt="" coords="507,1170,632,1217"/><area shape="rect" id="node54" href="../../dd/dac/a01008.html#ab4580c4d01c4abbe747d28f766112a6a" title="ripple::NetworkOPs\l::peekStoredProposals" alt="" coords="492,42,647,89"/><area shape="rect" id="node56" href="../../d1/de6/a00837.html#a1ee50c8b4c240bdaafd6955f9d67454a" title="ripple::LedgerMaster\l::pushLedger" alt="" coords="500,162,639,209"/><area shape="rect" id="node58" href="../../dd/dac/a01008.html#a56950f16ba23fef4918d8f6f03fb56d2" title="ripple::NetworkOPs\l::setLastValidation" alt="" coords="501,232,637,278"/><area shape="rect" id="node60" href="../../dd/dac/a01008.html#acf90d8f88e99ff03b409ed30e2d25ac0" title="ripple::NetworkOPs\l::takePosition" alt="" coords="501,301,637,348"/><area shape="rect" id="node17" href="../../da/d61/a01350.html#a0b9f56cab2021e47d45e4cd287f4b425" title="ripple::Serializer\l::erase" alt="" coords="735,570,849,617"/><area shape="rect" id="node19" href="../../da/d61/a01350.html#afc7187fd3c9e185d29a0ecf5500d0cdf" title="ripple::Serializer\l::getSHA512Half" alt="" coords="732,640,852,686"/><area shape="rect" id="node23" href="../../da/d61/a01350.html#a39e3319f1b024688b1433c91af285b9e" title="ripple::Serializer\l::getDataLength" alt="" coords="735,709,849,756"/><area shape="rect" id="node29" href="../../da/d74/a00099.html#a25c5851322f6cb3762563fd1278c6143" title="ripple::Application\l::getNodeStore" alt="" coords="729,778,855,825"/><area shape="rect" id="node31" href="../../dd/dcb/a00375.html#aeec6606bd5748584f4d36efe9134999f" title="ripple::NodeStore::\lDatabase::store" alt="" coords="727,848,857,894"/><area shape="rect" id="node33" href="../../da/d61/a01350.html#a6d7436e5990cb278bd924cef9396df3c" title="ripple::Serializer\l::modData" alt="" coords="735,501,849,548"/><area shape="rect" id="node21" href="../../da/d61/a01350.html#ac7bf5cce451c952933b2750d902d848c" title="ripple::Serializer\l::size" alt="" coords="957,640,1072,686"/><area shape="rect" id="node27" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="927,102,1103,149"/><area shape="rect" id="node37" href="../../de/de6/a01063.html#a5b8ee783b77679fb2fad2543ab521a90" title="ripple::Overlay::getActive\lPeers" alt="" coords="708,917,876,964"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a69ec0de2646aae917b8c87b6768abc65"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::checkLCL </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Check if our last closed ledger matches the network's </p>

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a213791cf6d03e670931c9cff7706fef4">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00399">399</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dd/dac/a01008.html#a7223446b10496bd50e12272588996ab0">ripple::NetworkOPs::consensusViewChange()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../d3/dac/a01777.html#abc7c7eb0126fa15e409f282c515dae85">ripple::Validations::getCurrentValidations()</a>, <a class="el" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">ripple::Application::getOPs()</a>, <a class="el" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4">ripple::Application::getValidations()</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00031">ripple::lsWARNING</a>, <a class="el" href="../../dc/dc0/a03087_source.html#l00071">ShouldLog</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        uint256 netLgr = <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordtype">int</span> netLgrCount = 0;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        uint256 favoredLedger = <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>; <span class="comment">// Don&#39;t jump forward</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        uint256 priorLedger;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a>)</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            priorLedger = <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getParentHash (); <span class="comment">// don&#39;t jump back</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map&lt;uint256, currentValidationCount&gt;</a> vals =</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4">getValidations</a> ().<a class="code" href="../../d3/dac/a01777.html#abc7c7eb0126fa15e409f282c515dae85">getCurrentValidations</a> </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            (favoredLedger, priorLedger);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keyword">typedef</span> std::map&lt;uint256, </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a8cea163599ecc17bf26c2a0aa4b7055d">currentValidationCount</a>&gt;::value_type u256_cvc_pair;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        BOOST_FOREACH (u256_cvc_pair &amp; it, vals)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordflow">if</span> ((it.second.first &gt; netLgrCount) ||</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                ((it.second.first == netLgrCount) &amp;&amp; (it.first == <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>)))</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;               netLgr = it.first;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;               netLgrCount = it.second.first;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordflow">if</span> (netLgr != <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>)</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="comment">// LCL change</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span>* status;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            <span class="keywordflow">switch</span> (<a class="code" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a>)</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166ad098380ac568dac7811bc4842c55a896">lcsPRE_CLOSE</a>:</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                status = <span class="stringliteral">&quot;PreClose&quot;</span>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a5c398eb7456da3c082741dbd1154495a">lcsESTABLISH</a>:</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                status = <span class="stringliteral">&quot;Establish&quot;</span>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a3282a0f8d20e057099b9ea73f50673f7">lcsFINISHED</a>:</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                status = <span class="stringliteral">&quot;Finished&quot;</span>;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166aba862e0e4adc5b73d786f70a759118a8">lcsACCEPTED</a>:</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                status = <span class="stringliteral">&quot;Accepted&quot;</span>;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                status = <span class="stringliteral">&quot;unknown&quot;</span>;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a4f9eb9b54b9bf0586ad6249697d4adde">lsWARNING</a>, LedgerConsensus) </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;View of consensus changed during &quot;</span> &lt;&lt; status </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; netLgrCount &lt;&lt; <span class="stringliteral">&quot;) status=&quot;</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                &lt;&lt; status &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                &lt;&lt; (<a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a> ? <span class="stringliteral">&quot;CorrectLCL&quot;</span> : <span class="stringliteral">&quot;IncorrectLCL&quot;</span>);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a4f9eb9b54b9bf0586ad6249697d4adde">lsWARNING</a>, LedgerConsensus) &lt;&lt; <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a> </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; netLgr;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a4f9eb9b54b9bf0586ad6249697d4adde">lsWARNING</a>, LedgerConsensus) </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                &lt;&lt; <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getJson (0);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc0/a03087.html#ab80dc049dfc759da2a7ad2a9dc51c330">ShouldLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus))</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                BOOST_FOREACH (u256_cvc_pair &amp; it, vals)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                    &lt;&lt; &quot;V: &quot; &lt;&lt; it.<a class="code" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e">first</a> &lt;&lt; &quot;, &quot; &lt;&lt; it.second.first;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <a class="code" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158">if</a> (<a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a>)</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getOPs ().consensusViewChange ();</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#aa2d2dcc3578c8476fd1256092dd4a2ca">handleLCL</a> (netLgr);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        }</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#afc04d0d2aaea0945960c9fbe27fa19de">else</a> <a class="code" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158">if</a> (<a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getHash () != <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#aa2d2dcc3578c8476fd1256092dd4a2ca">handleLCL</a> (netLgr);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a69ec0de2646aae917b8c87b6768abc65_cgraph.png" border="0" usemap="#d7/d5f/a00831_a69ec0de2646aae917b8c87b6768abc65_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a69ec0de2646aae917b8c87b6768abc65_cgraph" id="d7/d5f/a00831_a69ec0de2646aae917b8c87b6768abc65_cgraph">
<area shape="rect" id="node3" href="../../dd/dac/a01008.html#a7223446b10496bd50e12272588996ab0" title="ripple::NetworkOPs\l::consensusViewChange" alt="" coords="244,5,409,51"/><area shape="rect" id="node5" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="276,75,377,104"/><area shape="rect" id="node9" href="../../d3/dac/a01777.html#abc7c7eb0126fa15e409f282c515dae85" title="ripple::Validations\l::getCurrentValidations" alt="" coords="249,127,404,174"/><area shape="rect" id="node11" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc" title="ripple::Application\l::getOPs" alt="" coords="264,197,389,243"/><area shape="rect" id="node13" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4" title="ripple::Application\l::getValidations" alt="" coords="264,266,389,313"/><area shape="rect" id="node7" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="460,66,636,113"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7e82d48ecf0f4851a528ad4a9770d475"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::checkOurValidation </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01799">1799</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d0/d15/a00700.html#aca3fb09daacc7e2cf751f3f0747c9c72">ripple::IHashRouter::addSuppression()</a>, <a class="el" href="../../d3/dac/a01777.html#ad1f3fe2655abbbb3dcd43c4d6ed1b739">ripple::Validations::addValidation()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4">ripple::Application::getHashRouter()</a>, <a class="el" href="../../dd/dac/a01008.html#a85ec5ce8783d70985fab4c2963c1425a">ripple::NetworkOPs::getLastValidation()</a>, <a class="el" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">ripple::Application::getOPs()</a>, <a class="el" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4">ripple::Application::getValidations()</a>, <a class="el" href="../../dd/dac/a01008.html#ac37c8b8c8650a7a0d4c8dec6114fc70b">ripple::NetworkOPs::getValidationTimeNC()</a>, <a class="el" href="../../dd/dac/a01008.html#ad501185ed756e643261f7079e5ea2eb8">ripple::NetworkOPs::isNeedNetworkLedger()</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00031">ripple::lsWARNING</a>, <a class="el" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">ripple::Application::overlay()</a>, <a class="el" href="../../dd/dac/a01008.html#a56950f16ba23fef4918d8f6f03fb56d2">ripple::NetworkOPs::setLastValidation()</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    {</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;        <span class="comment">// This only covers some cases - Fix for the case where we can&#39;t ever acquire the consensus ledger</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a> || !<a class="code" href="../../d7/d5f/a00831.html#a8c5ce846eef0f0e1bebaf8ced18b9bb6">mValPublic</a>.<a class="code" href="../../d4/d0e/a01272.html#aab006397e39f2ba08feb37f9b4bd3114">isSet</a> () </div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;            || !<a class="code" href="../../d7/d5f/a00831.html#af6bf71a4a3f765224f108598544e2efe">mValPrivate</a>.<a class="code" href="../../d4/d0e/a01272.html#aab006397e39f2ba08feb37f9b4bd3114">isSet</a> () </div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;            || <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#ad501185ed756e643261f7079e5ea2eb8">isNeedNetworkLedger</a> ())</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        {</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        }</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        <a class="code" href="../../de/d6c/a01349.html#a2e641fe3da3300cc7172c04c3a54d977">SerializedValidation::pointer</a> lastVal </div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;            = <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#a85ec5ce8783d70985fab4c2963c1425a">getLastValidation</a> ();</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;        <span class="keywordflow">if</span> (lastVal)</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        {</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;            <span class="keywordflow">if</span> (lastVal-&gt;getFieldU32 (sfLedgerSequence) </div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                == <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getLedgerSeq ())</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;            {</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;            }</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;            <span class="keywordflow">if</span> (lastVal-&gt;getLedgerHash () == <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>)</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        }</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        uint256 signingHash;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        <a class="code" href="../../de/d6c/a01349.html#a2e641fe3da3300cc7172c04c3a54d977">SerializedValidation::pointer</a> v </div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;            = boost::make_shared&lt;SerializedValidation&gt;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;            (<a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getHash ()</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;            , <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#ac37c8b8c8650a7a0d4c8dec6114fc70b">getValidationTimeNC</a> (), <a class="code" href="../../d7/d5f/a00831.html#a8c5ce846eef0f0e1bebaf8ced18b9bb6">mValPublic</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#af1b451c0a08d9d1c3fb00b2b3761c0d7">addLoad</a>(v);</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;        v-&gt;setTrusted ();</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        v-&gt;sign (signingHash, <a class="code" href="../../d7/d5f/a00831.html#af6bf71a4a3f765224f108598544e2efe">mValPrivate</a>);</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;            <span class="comment">// FIXME: wrong supression     </span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4">getHashRouter</a> ().<a class="code" href="../../d0/d15/a00700.html#aca3fb09daacc7e2cf751f3f0747c9c72">addSuppression</a> (signingHash); </div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4">getValidations</a> ().<a class="code" href="../../d3/dac/a01777.html#ad1f3fe2655abbbb3dcd43c4d6ed1b739">addValidation</a> (v, <span class="stringliteral">&quot;localMissing&quot;</span>);</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a1b87ba4732cf1725393e8dd60bf73b0c">Blob</a> validation = v-&gt;getSigned ();</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        protocol::TMValidation val;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        val.set_validation (&amp;validation[0], validation.size ());</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="preprocessor">    #if 0</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;<span class="preprocessor"></span>        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a> ().<a class="code" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">overlay</a> ().visit (RelayMessage (</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;            boost::make_shared &lt;Message&gt; (</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;                val, protocol::mtVALIDATION)));</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="preprocessor"></span>        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#a56950f16ba23fef4918d8f6f03fb56d2">setLastValidation</a> (v);</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a4f9eb9b54b9bf0586ad6249697d4adde">lsWARNING</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Sending partial validation&quot;</span>;</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a7e82d48ecf0f4851a528ad4a9770d475_cgraph.png" border="0" usemap="#d7/d5f/a00831_a7e82d48ecf0f4851a528ad4a9770d475_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a7e82d48ecf0f4851a528ad4a9770d475_cgraph" id="d7/d5f/a00831_a7e82d48ecf0f4851a528ad4a9770d475_cgraph">
<area shape="rect" id="node3" href="../../d0/d15/a00700.html#aca3fb09daacc7e2cf751f3f0747c9c72" title="ripple::IHashRouter\l::addSuppression" alt="" coords="256,5,389,51"/><area shape="rect" id="node5" href="../../d3/dac/a01777.html#ad1f3fe2655abbbb3dcd43c4d6ed1b739" title="ripple::Validations\l::addValidation" alt="" coords="260,74,385,121"/><area shape="rect" id="node7" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="272,144,373,173"/><area shape="rect" id="node11" href="../../da/d74/a00099.html#abc0db550376596fa61a678f5d9ce82f4" title="ripple::Application\l::getHashRouter" alt="" coords="260,197,385,243"/><area shape="rect" id="node13" href="../../dd/dac/a01008.html#a85ec5ce8783d70985fab4c2963c1425a" title="ripple::NetworkOPs\l::getLastValidation" alt="" coords="255,266,391,313"/><area shape="rect" id="node15" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc" title="ripple::Application\l::getOPs" alt="" coords="260,335,385,382"/><area shape="rect" id="node17" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4" title="ripple::Application\l::getValidations" alt="" coords="260,405,385,451"/><area shape="rect" id="node19" href="../../dd/dac/a01008.html#ac37c8b8c8650a7a0d4c8dec6114fc70b" title="ripple::NetworkOPs\l::getValidationTimeNC" alt="" coords="245,474,400,521"/><area shape="rect" id="node21" href="../../dd/dac/a01008.html#ad501185ed756e643261f7079e5ea2eb8" title="ripple::NetworkOPs\l::isNeedNetworkLedger" alt="" coords="244,543,401,590"/><area shape="rect" id="node23" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee" title="ripple::Application\l::overlay" alt="" coords="260,613,385,659"/><area shape="rect" id="node25" href="../../dd/dac/a01008.html#a56950f16ba23fef4918d8f6f03fb56d2" title="ripple::NetworkOPs\l::setLastValidation" alt="" coords="255,682,391,729"/><area shape="rect" id="node9" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="452,135,628,182"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac460b24a695acd5d7cf57205ad7ab731"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::closeLedger </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>We have just decided to close the ledger. Start the consensus timer, stash the close time, inform peers, and take a position </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01786">1786</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d1/de6/a00837.html#a719c8f28d77bb4f314b4527e90299f85">ripple::LedgerMaster::closeLedger()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../dd/dac/a01008.html#aeeadbf915d62f00319ce782da0990567">ripple::NetworkOPs::getCloseTimeNC()</a>, <a class="el" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">ripple::Application::getLedgerMaster()</a>, <a class="el" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">ripple::Application::getOPs()</a>, and <a class="el" href="../../dd/dac/a01008.html#a939df1934a5e67c2fee0583676e0cf24">ripple::NetworkOPs::setLastCloseTime()</a>.</p>
<div class="fragment"><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    {</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a7e82d48ecf0f4851a528ad4a9770d475">checkOurValidation</a> ();</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a> = <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a5c398eb7456da3c082741dbd1154495a">lcsESTABLISH</a>;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a9f4ef09e1a39629c53236367f4fbc361">mConsensusStartTime</a> </div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;            = boost::posix_time::microsec_clock::universal_time ();</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a69465d9a39fe6f4e501271b59e6613e5">mCloseTime</a> = <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#aeeadbf915d62f00319ce782da0990567">getCloseTimeNC</a> ();</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#a939df1934a5e67c2fee0583676e0cf24">setLastCloseTime</a> (<a class="code" href="../../d7/d5f/a00831.html#a69465d9a39fe6f4e501271b59e6613e5">mCloseTime</a>);</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a69dfdffade06301acafc3220fb358037">statusChange</a> (protocol::neCLOSING_LEDGER, *<a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>);</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">getLedgerMaster</a>().<a class="code" href="../../d1/de6/a00837.html#a719c8f28d77bb4f314b4527e90299f85">closeLedger</a> (<span class="keyword">true</span>);</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a4f3404f928cc499601e0a7cdf02d016a">takeInitialPosition</a> (*<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getLedgerMaster ().getCurrentLedger ());</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_ac460b24a695acd5d7cf57205ad7ab731_cgraph.png" border="0" usemap="#d7/d5f/a00831_ac460b24a695acd5d7cf57205ad7ab731_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_ac460b24a695acd5d7cf57205ad7ab731_cgraph" id="d7/d5f/a00831_ac460b24a695acd5d7cf57205ad7ab731_cgraph">
<area shape="rect" id="node3" href="../../d1/de6/a00837.html#a719c8f28d77bb4f314b4527e90299f85" title="ripple::LedgerMaster\l::closeLedger" alt="" coords="244,5,383,51"/><area shape="rect" id="node5" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="263,75,364,104"/><area shape="rect" id="node9" href="../../dd/dac/a01008.html#aeeadbf915d62f00319ce782da0990567" title="ripple::NetworkOPs\l::getCloseTimeNC" alt="" coords="245,127,381,174"/><area shape="rect" id="node11" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104" title="ripple::Application\l::getLedgerMaster" alt="" coords="251,197,376,243"/><area shape="rect" id="node13" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc" title="ripple::Application\l::getOPs" alt="" coords="251,266,376,313"/><area shape="rect" id="node15" href="../../dd/dac/a01008.html#a939df1934a5e67c2fee0583676e0cf24" title="ripple::NetworkOPs\l::setLastCloseTime" alt="" coords="245,335,381,382"/><area shape="rect" id="node7" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="433,66,609,113"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6a45f1791a8d01d9272e4de85b350ab9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::createDisputes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/dfe/a01366.html#a585bf78e9ec9fa02084eb73db874939c">SHAMap::ref</a>&#160;</td>
          <td class="paramname"><em>m1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/dfe/a01366.html#a585bf78e9ec9fa02084eb73db874939c">SHAMap::ref</a>&#160;</td>
          <td class="paramname"><em>m2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Compare two proposed transaction sets and create disputed transctions structures for any mismatches </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01134">1134</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    {</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <span class="keywordflow">if</span> (m1-&gt;getHash() == m2-&gt;getHash())</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;createDisputes &quot;</span> </div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            &lt;&lt; m1-&gt;getHash() &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; m2-&gt;getHash();</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <a class="code" href="../../d6/dfe/a01366.html#af180bca329ba4a8011dd02313d3f98d9">SHAMap::Delta</a> differences;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        m1-&gt;compare (m2, differences, 16384);</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <span class="keywordtype">int</span> dc = 0;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        <span class="keyword">typedef</span> std::map&lt;uint256, </div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            <a class="code" href="../../d6/dfe/a01366.html#a79773b1678fb448236044103e79bd2f5">SHAMap::DeltaItem</a>&gt;::value_type u256_diff_pair;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        BOOST_FOREACH (u256_diff_pair &amp; pos, differences)</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        {</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;            ++dc;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;            <span class="comment">// create disputed transactions (from the ledger that has them)</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;            <span class="keywordflow">if</span> (pos.second.first)</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;            {</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                <span class="comment">// transaction is in first map</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                assert (!pos.second.second);</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#a7a6007028d429f431438981205d7a41d">addDisputedTransaction</a> (pos.first</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                    , pos.second.first-&gt;peekData ());</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pos.second.second)</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            {</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                <span class="comment">// transaction is in second map</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                assert (!pos.second.first);</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#a7a6007028d429f431438981205d7a41d">addDisputedTransaction</a> (pos.first</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;                    , pos.second.second-&gt;peekData ());</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;            }</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            <span class="keywordflow">else</span> <span class="comment">// No other disagreement over a transaction should be possible</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;                assert (<span class="keyword">false</span>);</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        }</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) &lt;&lt; dc &lt;&lt; <span class="stringliteral">&quot; differences found&quot;</span>;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae9ac9fe78120048c1c77eddde73e6066"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::endConsensus </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01873">1873</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dd/dac/a01008.html#a749bde2bf13ffaebc6475fd0d6b93576">ripple::NetworkOPs::endConsensus()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, and <a class="el" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">ripple::Application::getOPs()</a>.</p>
<div class="fragment"><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    {</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#a749bde2bf13ffaebc6475fd0d6b93576">endConsensus</a> (<a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a>);</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_ae9ac9fe78120048c1c77eddde73e6066_cgraph.png" border="0" usemap="#d7/d5f/a00831_ae9ac9fe78120048c1c77eddde73e6066_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_ae9ac9fe78120048c1c77eddde73e6066_cgraph" id="d7/d5f/a00831_ae9ac9fe78120048c1c77eddde73e6066_cgraph">
<area shape="rect" id="node3" href="../../dd/dac/a01008.html#a749bde2bf13ffaebc6475fd0d6b93576" title="ripple::NetworkOPs\l::endConsensus" alt="" coords="243,5,379,51"/><area shape="rect" id="node5" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="260,75,361,104"/><area shape="rect" id="node9" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc" title="ripple::Application\l::getOPs" alt="" coords="248,127,373,174"/><area shape="rect" id="node7" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="428,66,604,113"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a08e58afa2d64bcb3179711c1826fa1ee"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a> ripple::LedgerConsensusImp::find </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;&#160;</td>
          <td class="paramname"><em>hash</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a0a68d819bc9480bb955af7fd0fcdc18b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char const* ripple::LedgerConsensusImp::getCountedObjectName </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00036">36</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;LedgerConsensus&quot;</span>; }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8906e6a448e1847de97b7ba4fc064c37"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d6/d27/a01781.html">Json::Value</a> ripple::LedgerConsensusImp::getJson </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>full</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d9/daf/a00830.html#abeb2e34035f2b7b21a18eb36f540ee74">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00110">110</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../da/d23/a02452_source.html#l01298">Json::Value::append()</a>, <a class="el" href="../../d4/da8/a02444_source.html#l00038">Json::arrayValue</a>, <a class="el" href="../../dd/dfa/a02824_source.html#l00316">ripple::base_uint&lt; BITS &gt;::GetHex()</a>, <a class="el" href="../../d4/da8/a02444_source.html#l00039">Json::objectValue</a>, and <a class="el" href="../../da/d23/a02452_source.html#l01023">Json::Value::size()</a>.</p>
<div class="fragment"><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <a class="code" href="../../d6/d27/a01781.html" title="Represents a JSON value. ">Json::Value</a> ret (<a class="code" href="../../d2/dd6/a03414.html#a7d654b75c16a57007925868e38212b4eae8386dcfc36d1ae897745f7b4f77a1f6" title="object value (collection of name/value pairs). ">Json::objectValue</a>);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        ret[<span class="stringliteral">&quot;proposing&quot;</span>] = <a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        ret[<span class="stringliteral">&quot;validating&quot;</span>] = <a class="code" href="../../d7/d5f/a00831.html#a779e52882cd0d007dd8c3d7b53962233">mValidating</a>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        ret[<span class="stringliteral">&quot;proposers&quot;</span>] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span> (<a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.size ());</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a>)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            ret[<span class="stringliteral">&quot;synched&quot;</span>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            ret[<span class="stringliteral">&quot;ledger_seq&quot;</span>] = <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getLedgerSeq () + 1;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            ret[<span class="stringliteral">&quot;close_granularity&quot;</span>] = <a class="code" href="../../d7/d5f/a00831.html#a42f8299df43917879af29265ad84a229">mCloseResolution</a>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            ret[<span class="stringliteral">&quot;synched&quot;</span>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a>)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166ad098380ac568dac7811bc4842c55a896">lcsPRE_CLOSE</a>:</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            ret[<span class="stringliteral">&quot;state&quot;</span>] = <span class="stringliteral">&quot;open&quot;</span>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a5c398eb7456da3c082741dbd1154495a">lcsESTABLISH</a>:</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            ret[<span class="stringliteral">&quot;state&quot;</span>] = <span class="stringliteral">&quot;consensus&quot;</span>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a3282a0f8d20e057099b9ea73f50673f7">lcsFINISHED</a>:</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            ret[<span class="stringliteral">&quot;state&quot;</span>] = <span class="stringliteral">&quot;finished&quot;</span>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166aba862e0e4adc5b73d786f70a759118a8">lcsACCEPTED</a>:</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            ret[<span class="stringliteral">&quot;state&quot;</span>] = <span class="stringliteral">&quot;accepted&quot;</span>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordtype">int</span> v = <a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>.size ();</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">if</span> ((v != 0) &amp;&amp; !full)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            ret[<span class="stringliteral">&quot;disputes&quot;</span>] = v;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>)</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            ret[<span class="stringliteral">&quot;our_position&quot;</span>] = <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getJson ();</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">if</span> (full)</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            ret[<span class="stringliteral">&quot;current_ms&quot;</span>] = <a class="code" href="../../d7/d5f/a00831.html#a980f1be83cec80bdd429cc8797f713dd">mCurrentMSeconds</a>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            ret[<span class="stringliteral">&quot;close_percent&quot;</span>] = <a class="code" href="../../d7/d5f/a00831.html#aa09946e6c5c3c0e47a61f5c32d809b74">mClosePercent</a>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            ret[<span class="stringliteral">&quot;close_resolution&quot;</span>] = <a class="code" href="../../d7/d5f/a00831.html#a42f8299df43917879af29265ad84a229">mCloseResolution</a>;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            ret[<span class="stringliteral">&quot;have_time_consensus&quot;</span>] = <a class="code" href="../../d7/d5f/a00831.html#a6d2a5574253bae4842079acdcb4fc0ff">mHaveCloseTimeConsensus</a>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            ret[<span class="stringliteral">&quot;previous_proposers&quot;</span>] = <a class="code" href="../../d7/d5f/a00831.html#a0616700feacae724b8e4a7d47cc4f9f6">mPreviousProposers</a>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            ret[<span class="stringliteral">&quot;previous_mseconds&quot;</span>] = <a class="code" href="../../d7/d5f/a00831.html#a7322d3c6bf824d5f5ff3d050aea3b9a4">mPreviousMSeconds</a>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.empty ())</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                <span class="keyword">typedef</span> <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt;uint160, </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                    <a class="code" href="../../df/de8/a00839.html#a0ec96481e000fcb8d977f684d600b86b">LedgerProposal::pointer</a>&gt;::value_type pp_t;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                <a class="code" href="../../d6/d27/a01781.html" title="Represents a JSON value. ">Json::Value</a> ppj (<a class="code" href="../../d2/dd6/a03414.html#a7d654b75c16a57007925868e38212b4eae8386dcfc36d1ae897745f7b4f77a1f6" title="object value (collection of name/value pairs). ">Json::objectValue</a>);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                BOOST_FOREACH (pp_t &amp; pp, <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                {</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                    ppj[pp.first.GetHex ()] = pp.second-&gt;getJson ();</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                ret[<span class="stringliteral">&quot;peer_positions&quot;</span>] = ppj;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.empty ())</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                <span class="comment">// acquired</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="keyword">typedef</span> <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt;uint256, </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                    <a class="code" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a>&gt;::value_type ac_t;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                <a class="code" href="../../d6/d27/a01781.html" title="Represents a JSON value. ">Json::Value</a> acq (<a class="code" href="../../d2/dd6/a03414.html#a7d654b75c16a57007925868e38212b4eae8386dcfc36d1ae897745f7b4f77a1f6" title="object value (collection of name/value pairs). ">Json::objectValue</a>);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                BOOST_FOREACH (ac_t &amp; at, <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>)</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                    <span class="keywordflow">if</span> (at.second)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                        acq[at.first.GetHex ()] = <span class="stringliteral">&quot;acquired&quot;</span>;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                        acq[at.first.GetHex ()] = <span class="stringliteral">&quot;failed&quot;</span>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                ret[<span class="stringliteral">&quot;acquired&quot;</span>] = acq;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5f/a00831.html#a6cf65b0f94846ec7f6dc84db61766258">mAcquiring</a>.empty ())</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                <span class="keyword">typedef</span> <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt;uint256, </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                    <a class="code" href="../../d0/dbc/a01704.html#aec96b8b1497a6c2c54780028a0d52b64">TransactionAcquire::pointer</a>&gt;::value_type ac_t;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                <a class="code" href="../../d6/d27/a01781.html" title="Represents a JSON value. ">Json::Value</a> acq (<a class="code" href="../../d2/dd6/a03414.html#a7d654b75c16a57007925868e38212b4eadc8f264f36b55b063c78126b335415f4" title="array value (ordered list) ">Json::arrayValue</a>);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                BOOST_FOREACH (ac_t &amp; at, <a class="code" href="../../d7/d5f/a00831.html#a6cf65b0f94846ec7f6dc84db61766258">mAcquiring</a>)</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                    acq.append (at.first.GetHex ());</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                ret[<span class="stringliteral">&quot;acquiring&quot;</span>] = acq;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>.empty ())</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                <span class="keyword">typedef</span> <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt;uint256, </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                    <a class="code" href="../../d8/de7/a00417.html#a53bf8a87a60c0b020cdf2c8e63022065">DisputedTx::pointer</a>&gt;::value_type d_t;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                <a class="code" href="../../d6/d27/a01781.html" title="Represents a JSON value. ">Json::Value</a> dsj (<a class="code" href="../../d2/dd6/a03414.html#a7d654b75c16a57007925868e38212b4eae8386dcfc36d1ae897745f7b4f77a1f6" title="object value (collection of name/value pairs). ">Json::objectValue</a>);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                BOOST_FOREACH (d_t &amp; dt, <a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>)</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    dsj[dt.first.GetHex ()] = dt.second-&gt;getJson ();</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                ret[<span class="stringliteral">&quot;disputes&quot;</span>] = dsj;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5f/a00831.html#a2519b3393c3aa0c48baad0bd7aa49d45">mCloseTimes</a>.empty ())</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                <span class="keyword">typedef</span> std::map&lt;std::uint32_t, int&gt;::value_type ct_t;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                <a class="code" href="../../d6/d27/a01781.html" title="Represents a JSON value. ">Json::Value</a> ctj (<a class="code" href="../../d2/dd6/a03414.html#a7d654b75c16a57007925868e38212b4eae8386dcfc36d1ae897745f7b4f77a1f6" title="object value (collection of name/value pairs). ">Json::objectValue</a>);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                BOOST_FOREACH (ct_t &amp; ct, <a class="code" href="../../d7/d5f/a00831.html#a2519b3393c3aa0c48baad0bd7aa49d45">mCloseTimes</a>)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                    ctj[beast::lexicalCastThrow &lt;std::string&gt; (ct.first)] = ct.second;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                ret[<span class="stringliteral">&quot;close_times&quot;</span>] = ctj;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5f/a00831.html#aa880479ea79d1fe40de04227870409bf">mDeadNodes</a>.empty ())</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <a class="code" href="../../d6/d27/a01781.html" title="Represents a JSON value. ">Json::Value</a> dnj (<a class="code" href="../../d2/dd6/a03414.html#a7d654b75c16a57007925868e38212b4eadc8f264f36b55b063c78126b335415f4" title="array value (ordered list) ">Json::arrayValue</a>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                BOOST_FOREACH (<span class="keyword">const</span> uint160 &amp; dn, <a class="code" href="../../d7/d5f/a00831.html#aa880479ea79d1fe40de04227870409bf">mDeadNodes</a>)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                    dnj.append (dn.GetHex ());</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                ret[<span class="stringliteral">&quot;dead_nodes&quot;</span>] = dnj;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a8906e6a448e1847de97b7ba4fc064c37_cgraph.png" border="0" usemap="#d7/d5f/a00831_a8906e6a448e1847de97b7ba4fc064c37_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a8906e6a448e1847de97b7ba4fc064c37_cgraph" id="d7/d5f/a00831_a8906e6a448e1847de97b7ba4fc064c37_cgraph">
<area shape="rect" id="node3" href="../../d6/d27/a01781.html#a7e49ac977e4bcf59745a09d426669f75" title="Append value to array at the end. " alt="" coords="243,5,384,35"/><area shape="rect" id="node5" href="../../d6/d27/a01781.html#ab3425a081214e9740a658fc953e8ab8e" title="Number of values in array or object. " alt="" coords="445,5,568,35"/><area shape="rect" id="node7" href="../../d7/d9a/a00152.html#a348c4019943a8b3a05f39f1efcb589c9" title="ripple::base_uint::\lGetHex" alt="" coords="251,114,376,161"/><area shape="rect" id="node9" href="../../d7/d9a/a00152.html#a05af5cdcc33627cb359debe028ab675d" title="ripple::base_uint::\lbegin" alt="" coords="444,58,569,105"/><area shape="rect" id="node13" href="../../d7/d9a/a00152.html#a463054abe1fe73a6f2d2dd9ecc9fb544" title="ripple::base_uint::size" alt="" coords="432,128,581,157"/><area shape="rect" id="node15" href="../../d9/d9d/a03417.html#a138db8803faea25db74891325f6b0073" title="ripple::strHex" alt="" coords="457,181,556,211"/><area shape="rect" id="node11" href="../../d7/d9a/a00152.html#af39117db8d26ecef7a570cd3448822a6" title="ripple::base_uint::data" alt="" coords="631,67,780,96"/><area shape="rect" id="node17" href="../../d9/d9d/a03417.html#aca6318bcfeb25f74477566a7ddc06a63" title="ripple::charHex" alt="" coords="651,181,760,211"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0457596ed2c6f984d1511b6d15b2f4aa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> ripple::LedgerConsensusImp::getLCL </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a407dec070e1fef3b680b9748885f19a3">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00245">245</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a975e08a1cf6859752a9d4129ea9a57b3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a> ripple::LedgerConsensusImp::getTransactionTree </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;&#160;</td>
          <td class="paramname"><em>hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>doAcquire</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get a transaction tree, fetching it from the network is required and requested </p>

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a088e69084e511ae2a966ab201212f66d">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00253">253</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../d1/de6/a00837.html#ace5931ca5ba70ad783563663790a5cf8">ripple::LedgerMaster::getCurrentLedger()</a>, <a class="el" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">ripple::Application::getLedgerMaster()</a>, <a class="el" href="../../d5/d95/a02720_source.html#l00040">hash</a>, <a class="el" href="../../d6/d0b/a02741_source.html#l01359">rocksdb::if()</a>, <a class="el" href="../../dd/dfa/a02824_source.html#l00138">ripple::base_uint&lt; BITS &gt;::isZero()</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, <a class="el" href="../../d6/def/a03033_source.html#l00027">ripple::smtTRANSACTION</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map&lt;uint256, SHAMap::pointer&gt;::iterator</a> it </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            = <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.find (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordflow">if</span> (it != <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.end ())</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="keywordflow">return</span> it-&gt;second;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158">if</a> (<a class="code" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a> == <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166ad098380ac568dac7811bc4842c55a896">lcsPRE_CLOSE</a>)</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <a class="code" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a> currentMap </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                = <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">getLedgerMaster</a> ().<a class="code" href="../../d1/de6/a00837.html#ace5931ca5ba70ad783563663790a5cf8">getCurrentLedger</a> ()</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                    -&gt;peekTransactionMap ();</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keywordflow">if</span> (currentMap-&gt;getHash () == <a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Map &quot;</span> &lt;&lt; <a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a> &lt;&lt; <span class="stringliteral">&quot; is our current&quot;</span>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                currentMap = currentMap-&gt;snapShot (<span class="keyword">false</span>);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#a37cda218246008eae547bb7b70d3277b">mapComplete</a> (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>, currentMap, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                <span class="keywordflow">return</span> currentMap;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            }</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keywordflow">if</span> (doAcquire)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <a class="code" href="../../d0/dbc/a01704.html#aec96b8b1497a6c2c54780028a0d52b64">TransactionAcquire::pointer</a>&amp; acquiring = <a class="code" href="../../d7/d5f/a00831.html#a6cf65b0f94846ec7f6dc84db61766258">mAcquiring</a>[<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>];</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            <span class="keywordflow">if</span> (!acquiring)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>.isZero ())</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    <a class="code" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a> empty = boost::make_shared&lt;SHAMap&gt; (</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                        <a class="code" href="../../d9/d9d/a03417.html#a5d9fe757c37a7602a883d30b14e1bf3caba7dd2006afa674ae6aea4d1b42ec9b4">smtTRANSACTION</a>, std::ref (<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getFullBelowCache()));</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                    <a class="code" href="../../d7/d5f/a00831.html#a37cda218246008eae547bb7b70d3277b">mapComplete</a> (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>, empty, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                    <span class="keywordflow">return</span> empty;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                acquiring = boost::make_shared&lt;TransactionAcquire&gt; (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>, std::ref (<a class="code" href="../../d7/d5f/a00831.html#a98a93e0c0cf39778ab8aabcb1e62bec9">m_clock</a>));</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#acd7f6e1b2ce2e7bb4888fa2fb5906f81">startAcquiring</a> (acquiring);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a> ();</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a975e08a1cf6859752a9d4129ea9a57b3_cgraph.png" border="0" usemap="#d7/d5f/a00831_a975e08a1cf6859752a9d4129ea9a57b3_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a975e08a1cf6859752a9d4129ea9a57b3_cgraph" id="d7/d5f/a00831_a975e08a1cf6859752a9d4129ea9a57b3_cgraph">
<area shape="rect" id="node3" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="263,13,364,43"/><area shape="rect" id="node7" href="../../d1/de6/a00837.html#ace5931ca5ba70ad783563663790a5cf8" title="ripple::LedgerMaster\l::getCurrentLedger" alt="" coords="244,66,383,113"/><area shape="rect" id="node9" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104" title="ripple::Application\l::getLedgerMaster" alt="" coords="251,135,376,182"/><area shape="rect" id="node11" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158" title="rocksdb::if" alt="" coords="272,205,355,235"/><area shape="rect" id="node17" href="../../d7/d9a/a00152.html#a25e873c7d069c6c2d44655736f2b6c21" title="ripple::base_uint::\lisZero" alt="" coords="251,258,376,305"/><area shape="rect" id="node5" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="449,5,625,51"/><area shape="rect" id="node13" href="../../da/d71/a00814.html#ab25c6d03dbcd6168b3ae3762dc98fd51" title="rocksdb::LDBCommandExecute\lResult::FAILED" alt="" coords="432,197,643,243"/><area shape="rect" id="node15" href="../../da/d71/a00814.html#ae4210d600639c8c6ac04486ebc43c39b" title="rocksdb::LDBCommandExecute\lResult::LDBCommandExecuteResult" alt="" coords="691,197,931,243"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa2d2dcc3578c8476fd1256092dd4a2ca"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::handleLCL </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;&#160;</td>
          <td class="paramname"><em>lclHash</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Change our view of the last closed ledger </p>

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a782d16a3b830ff70e59a6c375b01be2d">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00482">482</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dc/d0c/a00783.html#a0e6d017b056c57465c9d72f928e3271e">ripple::JobQueue::addJob()</a>, <a class="el" href="../../dc/d86/a02909_source.html#l00045">ripple::InboundLedger::fcCONSENSUS</a>, <a class="el" href="../../d8/d86/a00703.html#a6f59efd378b35314541b4d5c76cd905a">ripple::InboundLedgers::findCreate()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../da/d74/a00099.html#a860be08979e27d8c6f37f722f996ba6c">ripple::Application::getJobQueue()</a>, <a class="el" href="../../d1/de6/a00837.html#a71a21a539d63be51cada4d3c4e4c4030">ripple::LedgerMaster::getLedgerByHash()</a>, <a class="el" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">ripple::Application::getLedgerMaster()</a>, <a class="el" href="../../d5/dea/a02927_source.html#l00152">ripple::ContinuousLedgerTiming::getNextLedgerTimeResolution()</a>, <a class="el" href="../../d8/d96/a03116_source.html#l00049">ripple::jtADVANCE</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00030">ripple::lsINFO</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00031">ripple::lsWARNING</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        assert ((lclHash != <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>) || (<a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getHash () != lclHash));</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a> != lclHash)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="comment">// first time switching to this ledger</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a> = lclHash;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a> &amp;&amp; <a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a> &amp;&amp; <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>)</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Bowing out of consensus&quot;</span>;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;bowOut ();</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#a68b90bb0cadfa356f2377b5c075749aa">propose</a> ();</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            <span class="comment">//      mValidating = false;</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.clear ();</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>.clear ();</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a2519b3393c3aa0c48baad0bd7aa49d45">mCloseTimes</a>.clear ();</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#aa880479ea79d1fe40de04227870409bf">mDeadNodes</a>.clear ();</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a0123939fd0cb34122699b454acae8331">playbackProposals</a> ();</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getHash () == <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="comment">// we need to switch the ledger we&#39;re working from</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <a class="code" href="../../dd/d5f/a00825.html#a373b6b80e365f42477db12be3ce899ba">Ledger::pointer</a> newLCL = <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">getLedgerMaster</a> ().<a class="code" href="../../d1/de6/a00837.html#a71a21a539d63be51cada4d3c4e4c4030">getLedgerByHash</a> (<a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">if</span> (!newLCL)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a8dcd0c00b5c03a4502c771ed0afbec73">mAcquiringLedger</a> != lclHash)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                <span class="comment">// need to start acquiring the correct consensus LCL</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a4f9eb9b54b9bf0586ad6249697d4adde">lsWARNING</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Need consensus ledger &quot;</span> &lt;&lt; <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#a8dcd0c00b5c03a4502c771ed0afbec73">mAcquiringLedger</a> = <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a860be08979e27d8c6f37f722f996ba6c">getJobQueue</a>().<a class="code" href="../../dc/d0c/a00783.html#a0e6d017b056c57465c9d72f928e3271e">addJob</a> (<a class="code" href="../../d9/d9d/a03417.html#ae0f54f8ce649d639bf3e2b295347e17aac6876ad6800d8cd0a4c9a306baf35204">jtADVANCE</a>, <span class="stringliteral">&quot;getConsensusLedger&quot;</span>,</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                    std::bind (</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                        &amp;<a class="code" href="../../d8/d86/a00703.html#a6f59efd378b35314541b4d5c76cd905a">InboundLedgers::findCreate</a>,</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                        &amp;<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getInboundLedgers(),</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                        <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>, 0, <a class="code" href="../../dd/d85/a00702.html#a97d9eaf73e624a2b60dc5692bba9fc54ad60e5080ff3821bbb157013ebae7ac17">InboundLedger::fcCONSENSUS</a>));</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        assert (newLCL-&gt;isClosed () &amp;&amp; newLCL-&gt;isImmutable ());</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        assert (newLCL-&gt;getHash () == lclHash);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a> = newLCL;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a> = lclHash;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Have the consensus ledger &quot;</span> &lt;&lt; <a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a42f8299df43917879af29265ad84a229">mCloseResolution</a> = <a class="code" href="../../d4/dce/a00337.html#aff26b393c8d36603fcb263b370b9026f">ContinuousLedgerTiming::getNextLedgerTimeResolution</a> (</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                               mPreviousLedger-&gt;getCloseResolution (), mPreviousLedger-&gt;getCloseAgree (),</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                               mPreviousLedger-&gt;getLedgerSeq () + 1);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_aa2d2dcc3578c8476fd1256092dd4a2ca_cgraph.png" border="0" usemap="#d7/d5f/a00831_aa2d2dcc3578c8476fd1256092dd4a2ca_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_aa2d2dcc3578c8476fd1256092dd4a2ca_cgraph" id="d7/d5f/a00831_aa2d2dcc3578c8476fd1256092dd4a2ca_cgraph">
<area shape="rect" id="node3" href="../../dc/d0c/a00783.html#a0e6d017b056c57465c9d72f928e3271e" title="ripple::JobQueue::addJob" alt="" coords="280,5,451,35"/><area shape="rect" id="node5" href="../../d8/d86/a00703.html#a6f59efd378b35314541b4d5c76cd905a" title="ripple::InboundLedgers\l::findCreate" alt="" coords="289,58,441,105"/><area shape="rect" id="node7" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="315,128,416,157"/><area shape="rect" id="node11" href="../../da/d74/a00099.html#a860be08979e27d8c6f37f722f996ba6c" title="ripple::Application\l::getJobQueue" alt="" coords="303,181,428,227"/><area shape="rect" id="node13" href="../../d1/de6/a00837.html#a71a21a539d63be51cada4d3c4e4c4030" title="ripple::LedgerMaster\l::getLedgerByHash" alt="" coords="296,250,435,297"/><area shape="rect" id="node15" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104" title="ripple::Application\l::getLedgerMaster" alt="" coords="303,319,428,366"/><area shape="rect" id="node17" href="../../d4/dce/a00337.html#aff26b393c8d36603fcb263b370b9026f" title="ripple::ContinuousLedger\lTiming::getNextLedgerTimeResolution" alt="" coords="243,389,488,435"/><area shape="rect" id="node9" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="537,119,713,166"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a57c11b80ae8f601629ad05df912e54ce"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::LedgerConsensusImp::haveConsensus </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>forReal</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Check if we've reached consensus </p>

<p>Implements <a class="el" href="../../d9/daf/a00830.html#ae3020351e77c2fde1609c577ce5a445b">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00668">668</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../d3/dac/a01777.html#ac1442c650aa45ff9d7912a906a8fd30c">ripple::Validations::getNodesAfter()</a>, <a class="el" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4">ripple::Application::getValidations()</a>, <a class="el" href="../../d5/d95/a02720_source.html#l00040">hash</a>, <a class="el" href="../../d5/dea/a02927_source.html#l00099">ripple::ContinuousLedgerTiming::haveConsensus()</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="comment">// CHECKME: should possibly count unacquired TX sets as disagreeing</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordtype">int</span> agree = 0, disagree = 0;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        uint256 ourPosition = <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCurrentHash ();</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        BOOST_FOREACH (<a class="code" href="../../d9/d9d/a03417.html#a47337812e8a4d433820ceac3f9ca3047">u160_prop_pair</a> &amp; it, <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>)</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            <span class="keywordflow">if</span> (!it.second-&gt;isBowOut ())</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            {</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                <span class="keywordflow">if</span> (it.second-&gt;getCurrentHash () == ourPosition)</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                    ++agree;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) &lt;&lt; it.first.GetHex () </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; has &quot;</span> &lt;&lt; it.second-&gt;getCurrentHash ().GetHex ();</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                    ++disagree;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#aeb0067cc3a21d698e60ce43a072018fa">mCompares</a>.count(it.second-&gt;getCurrentHash()) == 0)</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                    { <span class="comment">// Make sure we have generated disputes</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                        uint256 <a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a> = it.second-&gt;getCurrentHash();</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot;We have not compared to &quot;</span> &lt;&lt; <a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                        <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map&lt;uint256, SHAMap::pointer&gt;::iterator</a></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                            it1 = <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.find (hash);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                        <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map&lt;uint256, SHAMap::pointer&gt;::iterator</a></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                            it2 = <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.find </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                            (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCurrentHash ());</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                        <span class="keywordflow">if</span> ((it1 != <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.end()) &amp;&amp; (it2 != <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.end())</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                            &amp;&amp; (it1-&gt;second) &amp;&amp; (it2-&gt;second))</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                        {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                            <a class="code" href="../../d7/d5f/a00831.html#aeb0067cc3a21d698e60ce43a072018fa">mCompares</a>.insert(hash);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                            <a class="code" href="../../d7/d5f/a00831.html#a6a45f1791a8d01d9272e4de85b350ab9">createDisputes</a>(it2-&gt;second, it1-&gt;second);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                        }</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                    }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            }</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        }</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordtype">int</span> currentValidations = <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4">getValidations</a> ()</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            .<a class="code" href="../../d3/dac/a01777.html#ac1442c650aa45ff9d7912a906a8fd30c">getNodesAfter</a> (<a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Checking for TX consensus: agree=&quot;</span> &lt;&lt; agree </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, disagree=&quot;</span> &lt;&lt; disagree;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d4/dce/a00337.html#a8fcd3db8309c4d565722ff61daf71dfa">ContinuousLedgerTiming::haveConsensus</a> (<a class="code" href="../../d7/d5f/a00831.html#a0616700feacae724b8e4a7d47cc4f9f6">mPreviousProposers</a>, </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            agree + disagree, agree, currentValidations</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            , <a class="code" href="../../d7/d5f/a00831.html#a7322d3c6bf824d5f5ff3d050aea3b9a4">mPreviousMSeconds</a>, <a class="code" href="../../d7/d5f/a00831.html#a980f1be83cec80bdd429cc8797f713dd">mCurrentMSeconds</a>, forReal, <a class="code" href="../../d7/d5f/a00831.html#a3b8a207fbaed3c087f7088211e33a679">mConsensusFail</a>);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a57c11b80ae8f601629ad05df912e54ce_cgraph.png" border="0" usemap="#d7/d5f/a00831_a57c11b80ae8f601629ad05df912e54ce_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a57c11b80ae8f601629ad05df912e54ce_cgraph" id="d7/d5f/a00831_a57c11b80ae8f601629ad05df912e54ce_cgraph">
<area shape="rect" id="node3" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="276,13,377,43"/><area shape="rect" id="node7" href="../../d3/dac/a01777.html#ac1442c650aa45ff9d7912a906a8fd30c" title="ripple::Validations\l::getNodesAfter" alt="" coords="264,66,389,113"/><area shape="rect" id="node9" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4" title="ripple::Application\l::getValidations" alt="" coords="264,135,389,182"/><area shape="rect" id="node11" href="../../d4/dce/a00337.html#a8fcd3db8309c4d565722ff61daf71dfa" title="ripple::ContinuousLedger\lTiming::haveConsensus" alt="" coords="244,205,409,251"/><area shape="rect" id="node5" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="460,5,636,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac34c71a3eab768bb6c5305bc488b0b0f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::LedgerConsensusImp::isOurPubKey </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/d0e/a01272.html">RippleAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>k</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d9/daf/a00830.html#addb8212fc29a8e2fb7e21fa69fa51fb3">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00836">836</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    {</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <span class="keywordflow">return</span> k == <a class="code" href="../../d7/d5f/a00831.html#a8c5ce846eef0f0e1bebaf8ced18b9bb6">mValPublic</a>;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a37cda218246008eae547bb7b70d3277b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::mapComplete </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;&#160;</td>
          <td class="paramname"><em>hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/dfe/a01366.html#a585bf78e9ec9fa02084eb73db874939c">SHAMap::ref</a>&#160;</td>
          <td class="paramname"><em>map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>acquired</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>We have a complete transaction set, typically acquired from the network </p>

<p>Implements <a class="el" href="../../d9/daf/a00830.html#abe0a071541a08e2b345de854d73a8156">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00301">301</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dc/dc0/a03087_source.html#l00079">CondLog</a>, <a class="el" href="../../d5/d95/a02720_source.html#l00040">hash</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00030">ripple::lsINFO</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00031">ripple::lsWARNING</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a22f88ba407917e2f7d6353efcb3e5920">CondLog</a> (acquired, <a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;We have acquired TXS &quot;</span> &lt;&lt; <a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordflow">if</span> (!map)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="comment">// this is an invalid/corrupt map</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>[<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>] = map;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a6cf65b0f94846ec7f6dc84db61766258">mAcquiring</a>.erase (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a4f9eb9b54b9bf0586ad6249697d4adde">lsWARNING</a>, LedgerConsensus) </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;A trusted node directed us to acquire an invalid TXN map&quot;</span>;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        assert (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a> == map-&gt;getHash ());</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map&lt;uint256, SHAMap::pointer&gt;::iterator</a> it </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            = <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.find (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.find (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>) != <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.end ())</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="keywordflow">if</span> (it-&gt;second)</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#a6cf65b0f94846ec7f6dc84db61766258">mAcquiring</a>.erase (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <span class="keywordflow">return</span>; <span class="comment">// we already have this map</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="comment">// We previously failed to acquire this map, now we have it</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.erase (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a> &amp;&amp; (!<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;isBowOut ()) </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            &amp;&amp; (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a> != <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCurrentHash ()))</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="comment">// this could create disputed transactions</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map&lt;uint256, SHAMap::pointer&gt;::iterator</a> it2 </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                = <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.find (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCurrentHash ());</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <span class="keywordflow">if</span> (it2 != <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.end ())</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                assert ((it2-&gt;first == <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCurrentHash ()) </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                    &amp;&amp; it2-&gt;second);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#aeb0067cc3a21d698e60ce43a072018fa">mCompares</a>.insert(<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#a6a45f1791a8d01d9272e4de85b350ab9">createDisputes</a> (it2-&gt;second, map);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                assert (<span class="keyword">false</span>); <span class="comment">// We don&#39;t have our own position?!</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Not ready to create disputes&quot;</span>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>[<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>] = map;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a6cf65b0f94846ec7f6dc84db61766258">mAcquiring</a>.erase (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="comment">// Adjust tracking for each peer that takes this position</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        std::vector&lt;uint160&gt; peers;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        BOOST_FOREACH (<a class="code" href="../../d9/d9d/a03417.html#a47337812e8a4d433820ceac3f9ca3047">u160_prop_pair</a> &amp; it, <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            <span class="keywordflow">if</span> (it.second-&gt;getCurrentHash () == map-&gt;getHash ())</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                peers.push_back (it.second-&gt;getPeerID ());</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordflow">if</span> (!peers.empty ())</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a1663be0996a9e4b00b79ed6012704e1f">adjustCount</a> (map, peers);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a22f88ba407917e2f7d6353efcb3e5920">CondLog</a> (acquired, <a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a4f9eb9b54b9bf0586ad6249697d4adde">lsWARNING</a>, LedgerConsensus) </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;By the time we got the map &quot;</span> </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                &lt;&lt; <a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a> &lt;&lt; <span class="stringliteral">&quot; no peers were proposing it&quot;</span>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a314fbb83a253a22dd2c1267529d4801c">sendHaveTxSet</a> (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a06d1625c7499507ef21b60ed6b3004f1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d5f/a00825.html#a5e872c651337cffea1617f84474efea9">Ledger::ref</a> ripple::LedgerConsensusImp::peekPreviousLedger </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a88824ef20c533e1442dd87064f0edaf2">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00240">240</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abdc56ac065d0b4e545240d55ef813586"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d0c/a01368.html">SHAMapAddNode</a> ripple::LedgerConsensusImp::peerGaveNodes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d5/d17/a01098.html#a74554bf78a38b1c2c190b5b47c1955d4">Peer::ptr</a> const &amp;&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;&#160;</td>
          <td class="paramname"><em>setHash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::list&lt; <a class="el" href="../../df/d0b/a01372.html">SHAMapNode</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>nodeIDs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::list&lt; <a class="el" href="../../d9/d9d/a03417.html#a1b87ba4732cf1725393e8dd60bf73b0c">Blob</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>nodeData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>A peer has sent us some nodes from a transaction set </p>

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a849bda5a07622cff55ff5d6dda65568b">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00817">817</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt;uint256</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            , <a class="code" href="../../d0/dbc/a01704.html#aec96b8b1497a6c2c54780028a0d52b64">TransactionAcquire::pointer</a>&gt;::iterator acq </div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            = <a class="code" href="../../d7/d5f/a00831.html#a6cf65b0f94846ec7f6dc84db61766258">mAcquiring</a>.find (setHash);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keywordflow">if</span> (acq == <a class="code" href="../../d7/d5f/a00831.html#a6cf65b0f94846ec7f6dc84db61766258">mAcquiring</a>.end ())</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        {</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Got TX data for set no longer acquiring: &quot;</span> &lt;&lt; setHash;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            <span class="keywordflow">return</span> SHAMapAddNode ();</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        }</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="comment">// We must keep the set around during the function</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <a class="code" href="../../d0/dbc/a01704.html#aec96b8b1497a6c2c54780028a0d52b64">TransactionAcquire::pointer</a> set = acq-&gt;second; </div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">return</span> set-&gt;takeNodes (nodeIDs, nodeData, peer);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad9e50e66c75d3156818c981d45d41aea"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::LedgerConsensusImp::peerHasSet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d5/d17/a01098.html#a74554bf78a38b1c2c190b5b47c1955d4">Peer::ptr</a> const &amp;&#160;</td>
          <td class="paramname"><em>peer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;&#160;</td>
          <td class="paramname"><em>hashSet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">protocol::TxSetStatus&#160;</td>
          <td class="paramname"><em>status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>A peer has informed us that it can give us a transaction set </p>

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a8312ba6a000ef45e63aa1ed6c6e5e184">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00792">792</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dc/d0c/a00783.html#a0e6d017b056c57465c9d72f928e3271e">ripple::JobQueue::addJob()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../da/d74/a00099.html#a860be08979e27d8c6f37f722f996ba6c">ripple::Application::getJobQueue()</a>, <a class="el" href="../../d8/d96/a03116_source.html#l00051">ripple::jtTXN_DATA</a>, and <a class="el" href="../../de/da4/a03005_source.html#l00089">ripple::PeerSet::peerHasVoid()</a>.</p>
<div class="fragment"><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">if</span> (status != protocol::tsHAVE) <span class="comment">// Indirect requests for future support</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        std::vector&lt; boost::weak_ptr&lt;Peer&gt; &gt;&amp; set = <a class="code" href="../../d7/d5f/a00831.html#a5b5fb525962ec0bc4480e23f86c8e641">mPeerData</a>[hashSet];</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        BOOST_FOREACH (boost::weak_ptr&lt;Peer&gt;&amp; iit, set)</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            <a class="code" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158">if</a> (iit.lock () == peer)</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                return false;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        set.push_back (peer);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        ripple::<a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">unordered_map</a>&lt;uint256</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            , TransactionAcquire::pointer&gt;::iterator acq </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            = <a class="code" href="../../d7/d5f/a00831.html#a6cf65b0f94846ec7f6dc84db61766258">mAcquiring</a>.<a class="code" href="../../d7/d5f/a00831.html#a08e58afa2d64bcb3179711c1826fa1ee">find</a> (hashSet);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158">if</a> (acq != <a class="code" href="../../d7/d5f/a00831.html#a6cf65b0f94846ec7f6dc84db61766258">mAcquiring</a>.end ())</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getJobQueue().addJob(<a class="code" href="../../d9/d9d/a03417.html#ae0f54f8ce649d639bf3e2b295347e17aac04ecc4122a37cf832f12c0dd02a27d2">jtTXN_DATA</a>, &quot;peerHasTxnData&quot;,</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                std::bind(&amp;TransactionAcquire::peerHasVoid, acq-&gt;second, peer));</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        return true;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_ad9e50e66c75d3156818c981d45d41aea_cgraph.png" border="0" usemap="#d7/d5f/a00831_ad9e50e66c75d3156818c981d45d41aea_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_ad9e50e66c75d3156818c981d45d41aea_cgraph" id="d7/d5f/a00831_ad9e50e66c75d3156818c981d45d41aea_cgraph">
<area shape="rect" id="node3" href="../../dc/d0c/a00783.html#a0e6d017b056c57465c9d72f928e3271e" title="ripple::JobQueue::addJob" alt="" coords="253,5,424,35"/><area shape="rect" id="node5" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="288,59,389,88"/><area shape="rect" id="node9" href="../../da/d74/a00099.html#a860be08979e27d8c6f37f722f996ba6c" title="ripple::Application\l::getJobQueue" alt="" coords="276,111,401,158"/><area shape="rect" id="node11" href="../../d1/d3d/a01110.html#a92b545557843aac8eef76993db6f62bd" title="ripple::PeerSet::peerHasVoid" alt="" coords="244,181,433,211"/><area shape="rect" id="node7" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="484,50,660,97"/><area shape="rect" id="node13" href="../../d1/d3d/a01110.html#a8b4b615fe7df1614e209da5ef5e94d2a" title="ripple::PeerSet::peerHas" alt="" coords="489,181,655,211"/><area shape="rect" id="node15" href="../../d1/d3d/a01110.html#a89b36ce44b243850b2ef063a470700d9" title="ripple::PeerSet::newPeer" alt="" coords="711,181,876,211"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a15fdcb5c33231ee498ae37bbcb9474cd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::LedgerConsensusImp::peerPosition </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/de8/a00839.html#add6440940c08aea0de0a90ce4f5c701e">LedgerProposal::ref</a>&#160;</td>
          <td class="paramname"><em>newPosition</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>A server has taken a new position, adjust our tracking </p>

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a626379075fc2188ff0d404b6467fa82f">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00721">721</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dd/dfa/a02824_source.html#l00316">ripple::base_uint&lt; BITS &gt;::GetHex()</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00030">ripple::lsINFO</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00028">ripple::lsTRACE</a>, <a class="el" href="../../d1/d75/a02926_source.html#l00031">ripple::LedgerProposal::seqLeave</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        uint160 peerID = newPosition-&gt;getPeerID ();</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#aa880479ea79d1fe40de04227870409bf">mDeadNodes</a>.find (peerID) != <a class="code" href="../../d7/d5f/a00831.html#aa880479ea79d1fe40de04227870409bf">mDeadNodes</a>.end ())</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Position from dead node: &quot;</span> &lt;&lt; peerID.GetHex ();</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <a class="code" href="../../df/de8/a00839.html#a0ec96481e000fcb8d977f684d600b86b">LedgerProposal::pointer</a>&amp; currentPosition = <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>[peerID];</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="keywordflow">if</span> (currentPosition)</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            assert (peerID == currentPosition-&gt;getPeerID ());</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            <span class="keywordflow">if</span> (newPosition-&gt;getProposeSeq () </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                &lt;= currentPosition-&gt;getProposeSeq ())</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="keywordflow">if</span> (newPosition-&gt;getProposeSeq () == 0)</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="comment">// new initial close time estimate</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a994075b2b57b391e5ba833769ac13487">lsTRACE</a>, LedgerConsensus) </div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Peer reports close time as &quot;</span> </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                &lt;&lt; newPosition-&gt;getCloseTime ();</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            ++<a class="code" href="../../d7/d5f/a00831.html#a2519b3393c3aa0c48baad0bd7aa49d45">mCloseTimes</a>[newPosition-&gt;getCloseTime ()];</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newPosition-&gt;getProposeSeq () == <a class="code" href="../../df/de8/a00839.html#ab1c9b68353c582425415cc234376664e">LedgerProposal::seqLeave</a>)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        {</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            <span class="comment">// peer bows out</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Peer bows out: &quot;</span> &lt;&lt; peerID.GetHex ();</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            BOOST_FOREACH (<a class="code" href="../../d9/d9d/a03417.html#ab40f03d8b2d67f746e939aa2065499e3">u256_lct_pair</a> &amp; it, <a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>)</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            it.second-&gt;unVote (peerID);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.erase (peerID);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#aa880479ea79d1fe40de04227870409bf">mDeadNodes</a>.insert (peerID);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            return true;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        }</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a994075b2b57b391e5ba833769ac13487">lsTRACE</a>, LedgerConsensus) &lt;&lt; &quot;Processing peer proposal &quot;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            &lt;&lt; newPosition-&gt;getProposeSeq () &lt;&lt; &quot;/&quot; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            &lt;&lt; newPosition-&gt;getCurrentHash ();</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        currentPosition = newPosition;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        SHAMap::pointer set </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            = <a class="code" href="../../d7/d5f/a00831.html#a975e08a1cf6859752a9d4129ea9a57b3">getTransactionTree</a> (newPosition-&gt;getCurrentHash (), true);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158">if</a> (set)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            BOOST_FOREACH (<a class="code" href="../../d9/d9d/a03417.html#ab40f03d8b2d67f746e939aa2065499e3">u256_lct_pair</a> &amp; it, <a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>)</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            it.second-&gt;setVote (peerID, set-&gt;hasItem (it.<a class="code" href="../../d0/d87/a03399.html#addb402f22cc191c3dc7f4325bb6f684e">first</a>));</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <a class="code" href="../../d4/d87/a03436.html#afc04d0d2aaea0945960c9fbe27fa19de">else</a></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Don&#39;t have tx set for peer&quot;</span>;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="comment">//      BOOST_FOREACH(u256_lct_pair&amp; it, mDisputes)</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            <span class="comment">//          it.second-&gt;unVote(peerID);</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        }</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a15fdcb5c33231ee498ae37bbcb9474cd_cgraph.png" border="0" usemap="#d7/d5f/a00831_a15fdcb5c33231ee498ae37bbcb9474cd_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a15fdcb5c33231ee498ae37bbcb9474cd_cgraph" id="d7/d5f/a00831_a15fdcb5c33231ee498ae37bbcb9474cd_cgraph">
<area shape="rect" id="node3" href="../../d7/d9a/a00152.html#a348c4019943a8b3a05f39f1efcb589c9" title="ripple::base_uint::\lGetHex" alt="" coords="243,66,368,113"/><area shape="rect" id="node5" href="../../d7/d9a/a00152.html#a05af5cdcc33627cb359debe028ab675d" title="ripple::base_uint::\lbegin" alt="" coords="428,5,553,51"/><area shape="rect" id="node9" href="../../d7/d9a/a00152.html#a463054abe1fe73a6f2d2dd9ecc9fb544" title="ripple::base_uint::size" alt="" coords="416,75,565,104"/><area shape="rect" id="node11" href="../../d9/d9d/a03417.html#a138db8803faea25db74891325f6b0073" title="ripple::strHex" alt="" coords="441,128,540,157"/><area shape="rect" id="node7" href="../../d7/d9a/a00152.html#af39117db8d26ecef7a570cd3448822a6" title="ripple::base_uint::data" alt="" coords="615,13,764,43"/><area shape="rect" id="node13" href="../../d9/d9d/a03417.html#aca6318bcfeb25f74477566a7ddc06a63" title="ripple::charHex" alt="" coords="635,128,744,157"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0123939fd0cb34122699b454acae8331"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::playbackProposals </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>If we radically changed our consensus context for some reason, we need to replay recent proposals so that they're not lost. </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01721">1721</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dd/d87/a03235_source.html#l00096">ripple::Overlay::foreach()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">ripple::Application::getOPs()</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00030">ripple::lsINFO</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00031">ripple::lsWARNING</a>, <a class="el" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">ripple::Application::overlay()</a>, <a class="el" href="../../dd/dac/a01008.html#ab4580c4d01c4abbe747d28f766112a6a">ripple::NetworkOPs::peekStoredProposals()</a>, <a class="el" href="../../d5/de9/a03236_source.html#l00102">ripple::send_if_not()</a>, <a class="el" href="../../d0/d7b/a02968_source.html#l00027">SF_RELAYED</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    {</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a> &lt; uint160,</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;              std::list&lt;LedgerProposal::pointer&gt; &gt; &amp; storedProposals </div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;              = <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#ab4580c4d01c4abbe747d28f766112a6a">peekStoredProposals</a> ();</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt; uint160</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;            , std::list&lt;LedgerProposal::pointer&gt; &gt;::iterator it </div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            = storedProposals.begin ()</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;            , end = storedProposals.end (); it != end; ++it)</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        {</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;            <span class="keywordtype">bool</span> relay = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;            BOOST_FOREACH (<a class="code" href="../../df/de8/a00839.html#add6440940c08aea0de0a90ce4f5c701e">LedgerProposal::ref</a> proposal, it-&gt;second)</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;            {</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                <span class="keywordflow">if</span> (proposal-&gt;hasSignature ())</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                {</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                    <span class="comment">// we have the signature but don&#39;t know the </span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                    <span class="comment">//  ledger so couldn&#39;t verify</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;                    proposal-&gt;setPrevLedger (<a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>);</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                    <span class="keywordflow">if</span> (proposal-&gt;checkSign ())</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;                    {</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot;Applying stored proposal&quot;</span>;</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                        relay = <a class="code" href="../../d7/d5f/a00831.html#a15fdcb5c33231ee498ae37bbcb9474cd">peerPosition</a> (proposal);</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;                    }</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;                }</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (proposal-&gt;isPrevLedger (<a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>))</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;                    relay = <a class="code" href="../../d7/d5f/a00831.html#a15fdcb5c33231ee498ae37bbcb9474cd">peerPosition</a> (proposal);</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;                <span class="keywordflow">if</span> (relay)</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;                {</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;                    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a4f9eb9b54b9bf0586ad6249697d4adde">lsWARNING</a>, LedgerConsensus) </div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;We should do delayed relay of this proposal,&quot;</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; but we cannot&quot;</span>;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;                }</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="preprocessor">    #if 0 </span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="preprocessor"></span>    <span class="comment">// FIXME: We can&#39;t do delayed relay because we don&#39;t have the signature</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;                std::set&lt;Peer::ShortId&gt; peers</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;                <span class="keywordflow">if</span> (relay &amp;&amp; <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getHashRouter ().swapSet (proposal.getSuppress (), set, <a class="code" href="../../d0/d7b/a02968.html#af9be45afdb73db8b7ac79729af6a72da">SF_RELAYED</a>))</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;                {</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;                    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Stored proposal delayed relay&quot;</span>;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;                    protocol::TMProposeSet set;</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;                    set.set_proposeseq</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;                    set.set_currenttxhash (, 256 / 8);</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;                    previousledger</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;                    closetime</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;                    nodepubkey</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;                    signature</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;                    <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a> ().<a class="code" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">overlay</a> ().<a class="code" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c">foreach</a> (<a class="code" href="../../d9/d9d/a03417.html#a58e3eee13d40eee082c61c7847587aa7">send_if_not</a> (</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;                        boost::make_shared&lt;Message&gt; (</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;                            set, protocol::mtPROPOSE_LEDGER), </div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                                peer_in_set(peers)));</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;                }</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="preprocessor"></span>            }</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        }</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a0123939fd0cb34122699b454acae8331_cgraph.png" border="0" usemap="#d7/d5f/a00831_a0123939fd0cb34122699b454acae8331_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a0123939fd0cb34122699b454acae8331_cgraph" id="d7/d5f/a00831_a0123939fd0cb34122699b454acae8331_cgraph">
<area shape="rect" id="node3" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c" title="ripple::Overlay::foreach" alt="" coords="243,21,400,51"/><area shape="rect" id="node7" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="271,79,372,108"/><area shape="rect" id="node11" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc" title="ripple::Application\l::getOPs" alt="" coords="259,131,384,178"/><area shape="rect" id="node13" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee" title="ripple::Application\l::overlay" alt="" coords="259,201,384,247"/><area shape="rect" id="node15" href="../../dd/dac/a01008.html#ab4580c4d01c4abbe747d28f766112a6a" title="ripple::NetworkOPs\l::peekStoredProposals" alt="" coords="244,270,399,317"/><area shape="rect" id="node17" href="../../d9/d9d/a03417.html#a58e3eee13d40eee082c61c7847587aa7" title="ripple::send_if_not" alt="" coords="257,340,385,369"/><area shape="rect" id="node5" href="../../de/de6/a01063.html#a5b8ee783b77679fb2fad2543ab521a90" title="ripple::Overlay::getActive\lPeers" alt="" coords="453,5,621,51"/><area shape="rect" id="node9" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="449,74,625,121"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a68b90bb0cadfa356f2377b5c075749aa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::propose </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Make and send a proposal </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01238">1238</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dd/d87/a03235_source.html#l00096">ripple::Overlay::foreach()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00028">ripple::lsTRACE</a>, <a class="el" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">ripple::Application::overlay()</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    {</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a994075b2b57b391e5ba833769ac13487">lsTRACE</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;We propose: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;            (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;isBowOut () ? std::string (<span class="stringliteral">&quot;bowOut&quot;</span>) </div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;            : <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCurrentHash ().GetHex ());</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        protocol::TMProposeSet prop;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        prop.set_currenttxhash (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCurrentHash ().begin ()</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;            , 256 / 8);</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        prop.set_previousledger (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getPrevLedger ().begin ()</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;            , 256 / 8);</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        prop.set_proposeseq (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getProposeSeq ());</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        prop.set_closetime (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCloseTime ());</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a1b87ba4732cf1725393e8dd60bf73b0c">Blob</a> pubKey = <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getPubKey ();</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a1b87ba4732cf1725393e8dd60bf73b0c">Blob</a> sig = <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;sign ();</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        prop.set_nodepubkey (&amp;pubKey[0], pubKey.size ());</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        prop.set_signature (&amp;sig[0], sig.size ());</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a> ().<a class="code" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">overlay</a> ().<a class="code" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c">foreach</a> (send_always (</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            boost::make_shared&lt;Message&gt; (</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                prop, protocol::mtPROPOSE_LEDGER)));</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a68b90bb0cadfa356f2377b5c075749aa_cgraph.png" border="0" usemap="#d7/d5f/a00831_a68b90bb0cadfa356f2377b5c075749aa_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a68b90bb0cadfa356f2377b5c075749aa_cgraph" id="d7/d5f/a00831_a68b90bb0cadfa356f2377b5c075749aa_cgraph">
<area shape="rect" id="node3" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c" title="ripple::Overlay::foreach" alt="" coords="243,21,400,51"/><area shape="rect" id="node7" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="271,79,372,108"/><area shape="rect" id="node11" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee" title="ripple::Application\l::overlay" alt="" coords="259,131,384,178"/><area shape="rect" id="node5" href="../../de/de6/a01063.html#a5b8ee783b77679fb2fad2543ab521a90" title="ripple::Overlay::getActive\lPeers" alt="" coords="453,5,621,51"/><area shape="rect" id="node9" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="449,74,625,121"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae4292911c54b0bcf21a3754a47832b5a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> ripple::LedgerConsensusImp::roundCloseTime </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a>&#160;</td>
          <td class="paramname"><em>closeTime</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01436">1436</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dd/d3f/a02912_source.html#l01883">ripple::Ledger::roundCloseTime()</a>.</p>
<div class="fragment"><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/d5f/a00825.html#aeadbdb41f4d267981aeeeb0e8db8469f">Ledger::roundCloseTime</a> (closeTime, <a class="code" href="../../d7/d5f/a00831.html#a42f8299df43917879af29265ad84a229">mCloseResolution</a>);</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_ae4292911c54b0bcf21a3754a47832b5a_cgraph.png" border="0" usemap="#d7/d5f/a00831_ae4292911c54b0bcf21a3754a47832b5a_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_ae4292911c54b0bcf21a3754a47832b5a_cgraph" id="d7/d5f/a00831_ae4292911c54b0bcf21a3754a47832b5a_cgraph">
<area shape="rect" id="node3" href="../../dd/d5f/a00825.html#aeadbdb41f4d267981aeeeb0e8db8469f" title="ripple::Ledger::roundCloseTime" alt="" coords="243,13,445,43"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a314fbb83a253a22dd2c1267529d4801c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::sendHaveTxSet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;&#160;</td>
          <td class="paramname"><em>hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>direct</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Let peers know that we a particular transactions set so they can fetch it from us. </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01264">1264</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dd/dfa/a02824_source.html#l00094">ripple::base_uint&lt; BITS &gt;::begin()</a>, <a class="el" href="../../dd/d87/a03235_source.html#l00096">ripple::Overlay::foreach()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, and <a class="el" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">ripple::Application::overlay()</a>.</p>
<div class="fragment"><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    {</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        protocol::TMHaveTransactionSet msg;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        msg.set_hash (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>.begin (), 256 / 8);</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        msg.set_status (direct ? protocol::tsHAVE : protocol::tsCAN_GET);</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a> ().<a class="code" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">overlay</a> ().<a class="code" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c">foreach</a> (send_always (</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;            boost::make_shared &lt;Message&gt; (</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                msg, protocol::mtHAVE_SET)));        </div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a314fbb83a253a22dd2c1267529d4801c_cgraph.png" border="0" usemap="#d7/d5f/a00831_a314fbb83a253a22dd2c1267529d4801c_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a314fbb83a253a22dd2c1267529d4801c_cgraph" id="d7/d5f/a00831_a314fbb83a253a22dd2c1267529d4801c_cgraph">
<area shape="rect" id="node3" href="../../d7/d9a/a00152.html#a05af5cdcc33627cb359debe028ab675d" title="ripple::base_uint::\lbegin" alt="" coords="259,5,384,51"/><area shape="rect" id="node7" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c" title="ripple::Overlay::foreach" alt="" coords="243,75,400,104"/><area shape="rect" id="node11" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="271,128,372,157"/><area shape="rect" id="node15" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee" title="ripple::Application\l::overlay" alt="" coords="259,181,384,227"/><area shape="rect" id="node5" href="../../d7/d9a/a00152.html#af39117db8d26ecef7a570cd3448822a6" title="ripple::base_uint::data" alt="" coords="463,13,612,43"/><area shape="rect" id="node9" href="../../de/de6/a01063.html#a5b8ee783b77679fb2fad2543ab521a90" title="ripple::Overlay::getActive\lPeers" alt="" coords="453,66,621,113"/><area shape="rect" id="node13" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="449,135,625,182"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0b6d711af415bbfc1f1333396dff29a9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::simulate </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Simulate a consensus round without any network traffic </p>

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a673e99a25d4de694da3e42f8c1122ca8">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00843">843</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d8/d4b/a03093_source.html#l00030">ripple::lsINFO</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Simulating consensus&quot;</span>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#ac460b24a695acd5d7cf57205ad7ab731">closeLedger</a> ();</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a980f1be83cec80bdd429cc8797f713dd">mCurrentMSeconds</a> = 100;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a5d2d8edb361ed4c7d18a944cf03a9b18">beginAccept</a> (<span class="keyword">true</span>);</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#ae9ac9fe78120048c1c77eddde73e6066">endConsensus</a> ();</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Simulation complete&quot;</span>;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acd7f6e1b2ce2e7bb4888fa2fb5906f81"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::startAcquiring </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/dbc/a01704.html#aec96b8b1497a6c2c54780028a0d52b64">TransactionAcquire::pointer</a>&#160;</td>
          <td class="paramname"><em>acquire</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Begin acquiring a transaction set </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01077">1077</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dd/d87/a03235_source.html#l00096">ripple::Overlay::foreach()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, and <a class="el" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">ripple::Application::overlay()</a>.</p>
<div class="fragment"><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    {</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt; uint256, </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            std::vector&lt; boost::weak_ptr&lt;Peer&gt; &gt; &gt;::iterator it =</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a5b5fb525962ec0bc4480e23f86c8e641">mPeerData</a>.find (acquire-&gt;getHash ());</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        <span class="keywordflow">if</span> (it != <a class="code" href="../../d7/d5f/a00831.html#a5b5fb525962ec0bc4480e23f86c8e641">mPeerData</a>.end ())</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        {</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            <span class="comment">// Add any peers we already know have his transaction set</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            std::vector&lt; boost::weak_ptr&lt;Peer&gt; &gt;&amp; peerList = it-&gt;second;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            std::vector&lt; boost::weak_ptr&lt;Peer&gt; &gt;::iterator pit </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                = peerList.begin ();</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            <span class="keywordflow">while</span> (pit != peerList.end ())</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            {</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                <a class="code" href="../../d5/d17/a01098.html#a74554bf78a38b1c2c190b5b47c1955d4">Peer::ptr</a> pr = pit-&gt;lock ();</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                <span class="keywordflow">if</span> (!pr)</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                {</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                    pit = peerList.erase (pit);</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                {</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                    acquire-&gt;peerHas (pr);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                    ++pit;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            }</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        }</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        <span class="keyword">struct </span>build_acquire_list</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        {</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            <span class="keyword">typedef</span> <span class="keywordtype">void</span> return_type;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            <a class="code" href="../../d0/dbc/a01704.html#aec96b8b1497a6c2c54780028a0d52b64">TransactionAcquire::pointer</a> <span class="keyword">const</span>&amp; acquire;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            build_acquire_list (<a class="code" href="../../d0/dbc/a01704.html#aec96b8b1497a6c2c54780028a0d52b64">TransactionAcquire::pointer</a> <span class="keyword">const</span>&amp; acq)</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                : acquire(acq)</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            { }</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            return_type operator() (<a class="code" href="../../d5/d17/a01098.html#a74554bf78a38b1c2c190b5b47c1955d4">Peer::ptr</a> <span class="keyword">const</span>&amp; peer)<span class="keyword"> const</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="keyword">            </span>{</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                <span class="keywordflow">if</span> (peer-&gt;hasTxSet (acquire-&gt;getHash ()))</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                    acquire-&gt;peerHas (peer);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            }</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        };</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">overlay</a> ().<a class="code" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c">foreach</a> (build_acquire_list (acquire));</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        acquire-&gt;setTimer ();</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_acd7f6e1b2ce2e7bb4888fa2fb5906f81_cgraph.png" border="0" usemap="#d7/d5f/a00831_acd7f6e1b2ce2e7bb4888fa2fb5906f81_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_acd7f6e1b2ce2e7bb4888fa2fb5906f81_cgraph" id="d7/d5f/a00831_acd7f6e1b2ce2e7bb4888fa2fb5906f81_cgraph">
<area shape="rect" id="node3" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c" title="ripple::Overlay::foreach" alt="" coords="243,21,400,51"/><area shape="rect" id="node7" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="271,79,372,108"/><area shape="rect" id="node11" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee" title="ripple::Application\l::overlay" alt="" coords="259,131,384,178"/><area shape="rect" id="node5" href="../../de/de6/a01063.html#a5b8ee783b77679fb2fad2543ab521a90" title="ripple::Overlay::getActive\lPeers" alt="" coords="453,5,621,51"/><area shape="rect" id="node9" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="449,74,625,121"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0f0bd041f578d6f2848d555ebb3fe738"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ripple::LedgerConsensusImp::startup </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a61b8b5816b9e05a5c1962f1348bf7790">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00105">105</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a51704da03e9707c6fbd37a7c6167b7a4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::stateAccepted </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a8520e964d5d8a8f489ddee8b5713494b">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00660">660</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    {</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="comment">// we have accepted a new ledger</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#ae9ac9fe78120048c1c77eddde73e6066">endConsensus</a> ();</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a923c7480e7bb17014e96cadabecb18fc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::stateEstablish </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>We are establishing a consensus </p>

<p>Implements <a class="el" href="../../d9/daf/a00830.html#ad4655556b05089de87aa1b23a8708189">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00630">630</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dc/dc0/a03087_source.html#l00079">CondLog</a>, <a class="el" href="../../da/dad/a02928_source.html#l00038">LEDGER_MIN_CONSENSUS</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00030">ripple::lsINFO</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="comment">// Give everyone a chance to take an initial position</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a980f1be83cec80bdd429cc8797f713dd">mCurrentMSeconds</a> &lt; <a class="code" href="../../da/dad/a02928.html#ab5fd5cb8ad80effe55ec2fc2a038f09e">LEDGER_MIN_CONSENSUS</a>)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a1bf0661799d346e0952ae2a5a0ab5c50">updateOurPositions</a> ();</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5f/a00831.html#a6d2a5574253bae4842079acdcb4fc0ff">mHaveCloseTimeConsensus</a>)</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a22f88ba407917e2f7d6353efcb3e5920">CondLog</a> (<a class="code" href="../../d7/d5f/a00831.html#a57c11b80ae8f601629ad05df912e54ce">haveConsensus</a> (<span class="keyword">false</span>), <a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;We have TX consensus but not CT consensus&quot;</span>;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        }</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a57c11b80ae8f601629ad05df912e54ce">haveConsensus</a> (<span class="keyword">true</span>))</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Converge cutoff (&quot;</span> &lt;&lt; <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.size () </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; participants)&quot;</span>;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a> = <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a3282a0f8d20e057099b9ea73f50673f7">lcsFINISHED</a>;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a5d2d8edb361ed4c7d18a944cf03a9b18">beginAccept</a> (<span class="keyword">false</span>);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        }</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1083994d379de4e3bed8ade0221bcd94"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::stateFinished </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a14d68a92495a4588e97415e7a2e11a53">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00654">654</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="comment">// we are processing the finished ledger</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="comment">// logic of calculating next ledger advances us out of this state</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="comment">// nothing to do</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad90ce0b98c645274d2e595afdca51262"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::statePreClose </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a73335e0f148e9496559bb5d43d48c6c0">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00585">585</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../dd/dac/a01008.html#aeeadbf915d62f00319ce782da0990567">ripple::NetworkOPs::getCloseTimeNC()</a>, <a class="el" href="../../d1/de6/a00837.html#ace5931ca5ba70ad783563663790a5cf8">ripple::LedgerMaster::getCurrentLedger()</a>, <a class="el" href="../../dd/dac/a01008.html#adbdb3df658431f3bcdd9978cdaf17c66">ripple::NetworkOPs::getLastCloseTime()</a>, <a class="el" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">ripple::Application::getLedgerMaster()</a>, <a class="el" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">ripple::Application::getOPs()</a>, <a class="el" href="../../d3/dac/a01777.html#af2c2a17a862003e98972450c4d4c8e05">ripple::Validations::getTrustedValidationCount()</a>, <a class="el" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4">ripple::Application::getValidations()</a>, <a class="el" href="../../da/dad/a02928_source.html#l00026">LEDGER_IDLE_INTERVAL</a>, <a class="el" href="../../d5/dd8/a03083_source.html#l00035">ripple::max()</a>, and <a class="el" href="../../d5/dea/a02927_source.html#l00033">ripple::ContinuousLedgerTiming::shouldClose()</a>.</p>
<div class="fragment"><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="comment">// it is shortly before ledger close time</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="keywordtype">bool</span> anyTransactions </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            = <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">getLedgerMaster</a> ().<a class="code" href="../../d1/de6/a00837.html#ace5931ca5ba70ad783563663790a5cf8">getCurrentLedger</a> ()</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            -&gt;peekTransactionMap ()-&gt;getHash ().isNonZero ();</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="keywordtype">int</span> proposersClosed = <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.size ();</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordtype">int</span> proposersValidated </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            = <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4">getValidations</a> ().<a class="code" href="../../d3/dac/a01777.html#af2c2a17a862003e98972450c4d4c8e05">getTrustedValidationCount</a></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            (<a class="code" href="../../d7/d5f/a00831.html#ac8bd458103616b9f4a861b75f42413ed">mPrevLedgerHash</a>);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="comment">// This ledger is open. This computes how long since last ledger closed</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="keywordtype">int</span> sinceClose;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordtype">int</span> idleInterval = 0;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a> &amp;&amp; <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getCloseAgree ())</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="comment">// we can use consensus timing</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            sinceClose = 1000 * (<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#aeeadbf915d62f00319ce782da0990567">getCloseTimeNC</a> () </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                - <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getCloseTimeNC ());</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            idleInterval = 2 * <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getCloseResolution ();</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="keywordflow">if</span> (idleInterval &lt; <a class="code" href="../../da/dad/a02928.html#abcbd68e697f1d5c36f2dc4c7deca5aaa">LEDGER_IDLE_INTERVAL</a>)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                idleInterval = <a class="code" href="../../da/dad/a02928.html#abcbd68e697f1d5c36f2dc4c7deca5aaa">LEDGER_IDLE_INTERVAL</a>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            sinceClose = 1000 * (<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#aeeadbf915d62f00319ce782da0990567">getCloseTimeNC</a> () </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                - <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#adbdb3df658431f3bcdd9978cdaf17c66">getLastCloseTime</a> ());</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            idleInterval = <a class="code" href="../../da/dad/a02928.html#abcbd68e697f1d5c36f2dc4c7deca5aaa">LEDGER_IDLE_INTERVAL</a>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        idleInterval = <a class="code" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785">std::max</a> (idleInterval, <a class="code" href="../../da/dad/a02928.html#abcbd68e697f1d5c36f2dc4c7deca5aaa">LEDGER_IDLE_INTERVAL</a>);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        idleInterval = <a class="code" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785">std::max</a> (idleInterval, 2 * <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getCloseResolution ());</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d4/dce/a00337.html#af4a68eca6d3af67e06048a0fed03e737">ContinuousLedgerTiming::shouldClose</a> (anyTransactions</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            , <a class="code" href="../../d7/d5f/a00831.html#a0616700feacae724b8e4a7d47cc4f9f6">mPreviousProposers</a>, proposersClosed, proposersValidated</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            , <a class="code" href="../../d7/d5f/a00831.html#a7322d3c6bf824d5f5ff3d050aea3b9a4">mPreviousMSeconds</a>, sinceClose, <a class="code" href="../../d7/d5f/a00831.html#a980f1be83cec80bdd429cc8797f713dd">mCurrentMSeconds</a></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            , idleInterval))</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#ac460b24a695acd5d7cf57205ad7ab731">closeLedger</a> ();</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_ad90ce0b98c645274d2e595afdca51262_cgraph.png" border="0" usemap="#d7/d5f/a00831_ad90ce0b98c645274d2e595afdca51262_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_ad90ce0b98c645274d2e595afdca51262_cgraph" id="d7/d5f/a00831_ad90ce0b98c645274d2e595afdca51262_cgraph">
<area shape="rect" id="node3" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="284,13,385,43"/><area shape="rect" id="node7" href="../../dd/dac/a01008.html#aeeadbf915d62f00319ce782da0990567" title="ripple::NetworkOPs\l::getCloseTimeNC" alt="" coords="267,66,403,113"/><area shape="rect" id="node9" href="../../d1/de6/a00837.html#ace5931ca5ba70ad783563663790a5cf8" title="ripple::LedgerMaster\l::getCurrentLedger" alt="" coords="265,135,404,182"/><area shape="rect" id="node11" href="../../dd/dac/a01008.html#adbdb3df658431f3bcdd9978cdaf17c66" title="ripple::NetworkOPs\l::getLastCloseTime" alt="" coords="267,205,403,251"/><area shape="rect" id="node13" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104" title="ripple::Application\l::getLedgerMaster" alt="" coords="272,274,397,321"/><area shape="rect" id="node15" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc" title="ripple::Application\l::getOPs" alt="" coords="272,343,397,390"/><area shape="rect" id="node17" href="../../d3/dac/a01777.html#af2c2a17a862003e98972450c4d4c8e05" title="ripple::Validations\l::getTrustedValidationCount" alt="" coords="243,413,427,459"/><area shape="rect" id="node19" href="../../da/d74/a00099.html#a4f3da0257883c463e0a561d7ba793dd4" title="ripple::Application\l::getValidations" alt="" coords="272,482,397,529"/><area shape="rect" id="node21" href="../../d9/d9d/a03417.html#a975c0f5f2493f00dbf15e444b085d785" title="ripple::max" alt="" coords="292,552,377,581"/><area shape="rect" id="node23" href="../../d4/dce/a00337.html#af4a68eca6d3af67e06048a0fed03e737" title="ripple::ContinuousLedger\lTiming::shouldClose" alt="" coords="252,605,417,651"/><area shape="rect" id="node5" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="476,5,652,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a69dfdffade06301acafc3220fb358037"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::statusChange </td>
          <td>(</td>
          <td class="paramtype">protocol::NodeEvent&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d5f/a00825.html">Ledger</a> &amp;&#160;</td>
          <td class="paramname"><em>ledger</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Send a node status change message to our peers </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01443">1443</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../dd/dfa/a02824_source.html#l00094">ripple::base_uint&lt; BITS &gt;::begin()</a>, <a class="el" href="../../dd/d87/a03235_source.html#l00096">ripple::Overlay::foreach()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../d1/de6/a00837.html#a95d97589085fb63f268510c8f8cb3577">ripple::LedgerMaster::getEarliestFetch()</a>, <a class="el" href="../../dd/dac/a01008.html#acb432c312dcf63d27724754b3b66b35a">ripple::NetworkOPs::getFullValidatedRange()</a>, <a class="el" href="../../dd/d3f/a02912_source.html#l00550">ripple::Ledger::getHash()</a>, <a class="el" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">ripple::Application::getLedgerMaster()</a>, <a class="el" href="../../d7/da7/a02914_source.html#l00199">ripple::Ledger::getLedgerSeq()</a>, <a class="el" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">ripple::Application::getOPs()</a>, <a class="el" href="../../d7/da7/a02914_source.html#l00171">ripple::Ledger::getParentHash()</a>, <a class="el" href="../../d5/d95/a02720_source.html#l00040">hash</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00028">ripple::lsTRACE</a>, <a class="el" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">ripple::Application::overlay()</a>, <a class="el" href="../../dd/dfa/a02824_source.html#l00442">ripple::base_uint&lt; BITS &gt;::size()</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        protocol::TMStatusChange s;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a>)</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;            s.set_newevent (protocol::neLOST_SYNC);</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;            s.set_newevent (event);</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        s.set_ledgerseq (ledger.getLedgerSeq ());</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        s.set_networktime (<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().getOPs ().getNetworkTimeNC ());</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        uint256 <a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a> = ledger.getParentHash ();</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        s.set_ledgerhashprevious (hash.begin (), hash.size ());</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        hash = ledger.getHash ();</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        s.set_ledgerhash (hash.begin (), hash.size ());</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        <a class="code" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> uMin, uMax;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc">getOPs</a> ().<a class="code" href="../../dd/dac/a01008.html#acb432c312dcf63d27724754b3b66b35a">getFullValidatedRange</a> (uMin, uMax))</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        {</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;            uMin = 0;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;            uMax = 0;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        }</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        {</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;            <span class="comment">// Don&#39;t advertise ledgers we&#39;re not willing to serve</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;            <a class="code" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> early = <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">getLedgerMaster</a>().<a class="code" href="../../d1/de6/a00837.html#a95d97589085fb63f268510c8f8cb3577">getEarliestFetch</a> ();</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;            <span class="keywordflow">if</span> (uMin &lt; early)</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;               uMin = early;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        }</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        s.set_firstseq (uMin);</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        s.set_lastseq (uMax);</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a> ().<a class="code" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee">overlay</a> ().<a class="code" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c">foreach</a> (send_always (</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;            boost::make_shared &lt;Message&gt; (</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;                s, protocol::mtSTATUS_CHANGE)));</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a994075b2b57b391e5ba833769ac13487">lsTRACE</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;send status change to peer&quot;</span>;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a69dfdffade06301acafc3220fb358037_cgraph.png" border="0" usemap="#d7/d5f/a00831_a69dfdffade06301acafc3220fb358037_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a69dfdffade06301acafc3220fb358037_cgraph" id="d7/d5f/a00831_a69dfdffade06301acafc3220fb358037_cgraph">
<area shape="rect" id="node3" href="../../d7/d9a/a00152.html#a05af5cdcc33627cb359debe028ab675d" title="ripple::base_uint::\lbegin" alt="" coords="1091,191,1216,237"/><area shape="rect" id="node7" href="../../de/de6/a01063.html#a7dc745932a8cbc330dfb6c6e5e608b3c" title="ripple::Overlay::foreach" alt="" coords="261,65,419,94"/><area shape="rect" id="node11" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="289,118,391,147"/><area shape="rect" id="node15" href="../../d1/de6/a00837.html#a95d97589085fb63f268510c8f8cb3577" title="ripple::LedgerMaster\l::getEarliestFetch" alt="" coords="271,171,409,217"/><area shape="rect" id="node17" href="../../dd/dac/a01008.html#acb432c312dcf63d27724754b3b66b35a" title="ripple::NetworkOPs\l::getFullValidatedRange" alt="" coords="260,240,420,287"/><area shape="rect" id="node19" href="../../dd/d5f/a00825.html#a16e47eaa1c229298782773ee27eeddaf" title="ripple::Ledger::getHash" alt="" coords="261,310,419,339"/><area shape="rect" id="node44" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104" title="ripple::Application\l::getLedgerMaster" alt="" coords="277,363,403,409"/><area shape="rect" id="node46" href="../../dd/d5f/a00825.html#a2893f1ab622f263d3abccc811106596e" title="ripple::Ledger::getLedgerSeq" alt="" coords="247,433,433,462"/><area shape="rect" id="node48" href="../../da/d74/a00099.html#a7c963aa5c47180b24897ff6b5622e5bc" title="ripple::Application\l::getOPs" alt="" coords="277,485,403,532"/><area shape="rect" id="node50" href="../../dd/d5f/a00825.html#a5069b7b79a71a9cc1b861f806d8b2922" title="ripple::Ledger::getParentHash" alt="" coords="243,555,437,585"/><area shape="rect" id="node52" href="../../da/d74/a00099.html#a0511c5e849c6735036d4667a72ff01ee" title="ripple::Application\l::overlay" alt="" coords="277,608,403,655"/><area shape="rect" id="node54" href="../../d7/d9a/a00152.html#a463054abe1fe73a6f2d2dd9ecc9fb544" title="ripple::base_uint::size" alt="" coords="265,678,415,707"/><area shape="rect" id="node5" href="../../d7/d9a/a00152.html#af39117db8d26ecef7a570cd3448822a6" title="ripple::base_uint::data" alt="" coords="1276,230,1425,259"/><area shape="rect" id="node9" href="../../de/de6/a01063.html#a5b8ee783b77679fb2fad2543ab521a90" title="ripple::Overlay::getActive\lPeers" alt="" coords="491,60,659,107"/><area shape="rect" id="node13" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="487,129,663,176"/><area shape="rect" id="node21" href="../../dd/d5f/a00825.html#a93d2362a14e7d5a802d03ea5ded53fcd" title="ripple::Ledger::updateHash" alt="" coords="485,261,664,290"/><area shape="rect" id="node23" href="../../d7/d9a/a00152.html#a174768646f7fe8d81f4a38f5ccf9e6f5" title="ripple::base_uint::zero" alt="" coords="716,157,865,186"/><area shape="rect" id="node25" href="../../da/d61/a01350.html#a4f09dcca07217744f793fa7473e845fe" title="ripple::Serializer\l::add32" alt="" coords="917,113,1032,160"/><area shape="rect" id="node27" href="../../dd/d5f/a00825.html#a28ccdd7d5313e2cd6b8c9d610656b7b4" title="ripple::Ledger::addRaw" alt="" coords="713,261,868,290"/><area shape="rect" id="node40" href="../../da/d61/a01350.html#afc7187fd3c9e185d29a0ecf5500d0cdf" title="ripple::Serializer\l::getSHA512Half" alt="" coords="731,352,851,399"/><area shape="rect" id="node30" href="../../da/d61/a01350.html#a253e724ffc3143dfd70bde767af71a7e" title="ripple::Serializer\l::add64" alt="" coords="917,183,1032,229"/><area shape="rect" id="node32" href="../../da/d61/a01350.html#a0a59bc79c929b9b01c3fd88ca54195f1" title="ripple::Serializer\l::add256" alt="" coords="917,252,1032,299"/><area shape="rect" id="node38" href="../../da/d61/a01350.html#a0344fccc7552038b51568aa4f93fca4e" title="ripple::Serializer\l::add8" alt="" coords="917,321,1032,368"/><area shape="rect" id="node35" href="../../d7/d9a/a00152.html#afcb87d72a05033f7eafdf7563bf52224" title="ripple::base_uint::end" alt="" coords="1080,261,1227,290"/><area shape="rect" id="node42" href="../../da/d61/a01350.html#ac7bf5cce451c952933b2750d902d848c" title="ripple::Serializer\l::size" alt="" coords="917,391,1032,437"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0765d2d6ea4dfb7efc19addd85ac92b8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::LedgerConsensusImp::stillNeedTXSet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;&#160;</td>
          <td class="paramname"><em>hash</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Determine if we still need to acquire a transaction set from  network.
</pre><p> If a transaction set is popular, we probably have it. If it's unpopular, we probably don't need it (and the peer that initially made us retrieve it has probably already changed its position) </p>

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a0be419f199accf5c7f243e069604b762">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00384">384</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d5/d95/a02720_source.html#l00040">hash</a>.</p>
<div class="fragment"><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.find (<a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>) != <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.end ())</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        BOOST_FOREACH (<a class="code" href="../../d9/d9d/a03417.html#a47337812e8a4d433820ceac3f9ca3047">u160_prop_pair</a> &amp; it, <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>)</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="keywordflow">if</span> (it.second-&gt;getCurrentHash () == <a class="code" href="../../d5/d95/a02720.html#a11ecb029164e055f28f4123ce3748862">hash</a>)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        }</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4f3404f928cc499601e0a7cdf02d016a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::takeInitialPosition </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d5f/a00825.html">Ledger</a> &amp;&#160;</td>
          <td class="paramname"><em>initialLedger</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Take an initial position on what we think the consensus should be based on the transactions that made it into our open ledger </p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01483">1483</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../d0/d2a/a00531.html#a967ec65cbf9ccc9d5bfdbc058d84e686">ripple::FeatureTable::doVoting()</a>, <a class="el" href="../../d9/da5/a02935_source.html#l01387">ripple::getApp()</a>, <a class="el" href="../../d0/dc2/a02477_source.html#l00647">ripple::getConfig()</a>, <a class="el" href="../../da/d74/a00099.html#a58504b1cd16de88b0f8ac0b3428cbe5f">ripple::Application::getFeatureTable()</a>, <a class="el" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">ripple::Application::getLedgerMaster()</a>, <a class="el" href="../../d7/da7/a02914_source.html#l00171">ripple::Ledger::getParentHash()</a>, <a class="el" href="../../d7/da7/a02914_source.html#l00250">ripple::Ledger::hasTransaction()</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00030">ripple::lsINFO</a>, <a class="el" href="../../d7/da7/a02914_source.html#l00222">ripple::Ledger::peekTransactionMap()</a>, <a class="el" href="../../d1/de6/a00837.html#a9e5a001c4c490f9210a91a95084ba070">ripple::LedgerMaster::setBuildingLedger()</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    {</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        <a class="code" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a> initialSet;</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d9d/a03417.html#a3025f0e6e155cf9b7f4b6315f682423d">getConfig</a> ().RUN_STANDALONE || (<a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a> &amp;&amp; <a class="code" href="../../d7/d5f/a00831.html#a305d1dbd83526551156742e4d210089f">mHaveCorrectLCL</a>))</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                &amp;&amp; ((<a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getLedgerSeq () % 256) == 0))</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        {</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            <span class="comment">// previous ledger was flag ledger</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;            <a class="code" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a> preSet </div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;                = initialLedger.peekTransactionMap ()-&gt;snapShot (<span class="keyword">true</span>);</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#aad2345c604e445ae15f1b594d1c9c030">m_feeVote</a>.<a class="code" href="../../d7/d41/a00532.html#a78194bfdf082cb15ba043babde396da7">doVoting</a> (<a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>, preSet);</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;            <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a58504b1cd16de88b0f8ac0b3428cbe5f">getFeatureTable</a> ().<a class="code" href="../../d0/d2a/a00531.html#a967ec65cbf9ccc9d5bfdbc058d84e686">doVoting</a> (<a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>, preSet);</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            initialSet = preSet-&gt;snapShot (<span class="keyword">false</span>);</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        }</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            initialSet = initialLedger.peekTransactionMap ()-&gt;snapShot (<span class="keyword">false</span>);</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        <span class="comment">// Tell the ledger master not to acquire the ledger we&#39;re probably building</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70">getApp</a>().<a class="code" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104">getLedgerMaster</a>().<a class="code" href="../../d1/de6/a00837.html#a9e5a001c4c490f9210a91a95084ba070">setBuildingLedger</a> (<a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getLedgerSeq () + 1);</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        uint256 txSet = initialSet-&gt;getHash ();</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;initial position &quot;</span> &lt;&lt; txSet;</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a37cda218246008eae547bb7b70d3277b">mapComplete</a> (txSet, initialSet, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#a779e52882cd0d007dd8c3d7b53962233">mValidating</a>)</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        {</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a> = boost::make_shared&lt;LedgerProposal&gt;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                           (<a class="code" href="../../d7/d5f/a00831.html#a8c5ce846eef0f0e1bebaf8ced18b9bb6">mValPublic</a>, <a class="code" href="../../d7/d5f/a00831.html#af6bf71a4a3f765224f108598544e2efe">mValPrivate</a></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;                            , initialLedger.getParentHash ()</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                            , txSet, <a class="code" href="../../d7/d5f/a00831.html#a69465d9a39fe6f4e501271b59e6613e5">mCloseTime</a>);</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        }</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        {</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a> </div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                = boost::make_shared&lt;LedgerProposal&gt; </div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                (initialLedger.getParentHash (), txSet, <a class="code" href="../../d7/d5f/a00831.html#a69465d9a39fe6f4e501271b59e6613e5">mCloseTime</a>);</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        }</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        BOOST_FOREACH (<a class="code" href="../../d9/d9d/a03417.html#ab40f03d8b2d67f746e939aa2065499e3">u256_lct_pair</a> &amp; it, <a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>)</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        {</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            it.second-&gt;setOurVote (initialLedger.hasTransaction (it.first));</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        }</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        <span class="comment">// if any peers have taken a contrary position, process disputes</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        boost::unordered_set&lt;uint256&gt; found;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        BOOST_FOREACH (<a class="code" href="../../d9/d9d/a03417.html#a47337812e8a4d433820ceac3f9ca3047">u160_prop_pair</a> &amp; it, <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>)</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        {</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;            uint256 set = it.second-&gt;getCurrentHash ();</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            <span class="keywordflow">if</span> (found.insert (set).second)</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;            {</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;                <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map&lt;uint256, SHAMap::pointer&gt;::iterator</a> iit </div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                    = <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.find (set);</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;                <span class="keywordflow">if</span> (iit != <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>.end ())</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                {</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;                    <a class="code" href="../../d7/d5f/a00831.html#aeb0067cc3a21d698e60ce43a072018fa">mCompares</a>.insert(iit-&gt;second-&gt;getHash());</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                    <a class="code" href="../../d7/d5f/a00831.html#a6a45f1791a8d01d9272e4de85b350ab9">createDisputes</a> (initialSet, iit-&gt;second);</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                }</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;            }</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;        }</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a>)</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a68b90bb0cadfa356f2377b5c075749aa">propose</a> ();</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a4f3404f928cc499601e0a7cdf02d016a_cgraph.png" border="0" usemap="#d7/d5f/a00831_a4f3404f928cc499601e0a7cdf02d016a_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a4f3404f928cc499601e0a7cdf02d016a_cgraph" id="d7/d5f/a00831_a4f3404f928cc499601e0a7cdf02d016a_cgraph">
<area shape="rect" id="node3" href="../../d0/d2a/a00531.html#a967ec65cbf9ccc9d5bfdbc058d84e686" title="ripple::FeatureTable\l::doVoting" alt="" coords="289,5,425,51"/><area shape="rect" id="node5" href="../../d9/d9d/a03417.html#a41dc315618e2f1d4be04cf094a642d70" title="ripple::getApp" alt="" coords="307,75,408,104"/><area shape="rect" id="node9" href="../../d9/d9d/a03417.html#a3025f0e6e155cf9b7f4b6315f682423d" title="ripple::getConfig" alt="" coords="299,128,416,157"/><area shape="rect" id="node11" href="../../da/d74/a00099.html#a58504b1cd16de88b0f8ac0b3428cbe5f" title="ripple::Application\l::getFeatureTable" alt="" coords="295,181,420,227"/><area shape="rect" id="node13" href="../../da/d74/a00099.html#a57929fa83c551514e364fe6981b0c104" title="ripple::Application\l::getLedgerMaster" alt="" coords="295,250,420,297"/><area shape="rect" id="node15" href="../../dd/d5f/a00825.html#a5069b7b79a71a9cc1b861f806d8b2922" title="ripple::Ledger::getParentHash" alt="" coords="260,320,455,349"/><area shape="rect" id="node17" href="../../dd/d5f/a00825.html#a0d92626cff8b9026b2b8487658ab49ae" title="ripple::Ledger::hasTransaction" alt="" coords="259,373,456,403"/><area shape="rect" id="node19" href="../../dd/d5f/a00825.html#a0702586ea0604f4d38af3b927728773d" title="ripple::Ledger::peekTransactionMap" alt="" coords="243,427,472,456"/><area shape="rect" id="node21" href="../../d1/de6/a00837.html#a9e5a001c4c490f9210a91a95084ba070" title="ripple::LedgerMaster\l::setBuildingLedger" alt="" coords="288,479,427,526"/><area shape="rect" id="node7" href="../../d4/d3a/a00101.html#a96693896ee8bf0b18686bce1d0559d95" title="ripple::ApplicationImpBase\l::getInstance" alt="" coords="521,66,697,113"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0afc9333292f3b27cd07f657ff7355fd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::timerEntry </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d9/daf/a00830.html#a8f7e40290739ecc78d3e813e74425d60">ripple::LedgerConsensus</a>.</p>

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l00546">546</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a> != <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a3282a0f8d20e057099b9ea73f50673f7">lcsFINISHED</a>) &amp;&amp; (<a class="code" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a> != <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166aba862e0e4adc5b73d786f70a759118a8">lcsACCEPTED</a>))</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a69ec0de2646aae917b8c87b6768abc65">checkLCL</a> ();</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a980f1be83cec80bdd429cc8797f713dd">mCurrentMSeconds</a> =</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            (boost::posix_time::microsec_clock::universal_time () </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            - <a class="code" href="../../d7/d5f/a00831.html#a9f4ef09e1a39629c53236367f4fbc361">mConsensusStartTime</a>).total_milliseconds ();</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#aa09946e6c5c3c0e47a61f5c32d809b74">mClosePercent</a> = <a class="code" href="../../d7/d5f/a00831.html#a980f1be83cec80bdd429cc8797f713dd">mCurrentMSeconds</a> * 100 / <a class="code" href="../../d7/d5f/a00831.html#a7322d3c6bf824d5f5ff3d050aea3b9a4">mPreviousMSeconds</a>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a>)</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166ad098380ac568dac7811bc4842c55a896">lcsPRE_CLOSE</a>:</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#ad90ce0b98c645274d2e595afdca51262">statePreClose</a> ();</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a5c398eb7456da3c082741dbd1154495a">lcsESTABLISH</a>:</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a923c7480e7bb17014e96cadabecb18fc">stateEstablish</a> ();</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a> != <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a3282a0f8d20e057099b9ea73f50673f7">lcsFINISHED</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            <span class="comment">// Fall through</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166a3282a0f8d20e057099b9ea73f50673f7">lcsFINISHED</a>:</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a1083994d379de4e3bed8ade0221bcd94">stateFinished</a> ();</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#abfdd93db957a9e8181362d22c7375b10">mState</a> != <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166aba862e0e4adc5b73d786f70a759118a8">lcsACCEPTED</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            <span class="comment">// Fall through</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166aba862e0e4adc5b73d786f70a759118a8">lcsACCEPTED</a>:</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a51704da03e9707c6fbd37a7c6167b7a4">stateAccepted</a> ();</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        assert (<span class="keyword">false</span>);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1bf0661799d346e0952ae2a5a0ab5c50"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ripple::LedgerConsensusImp::updateOurPositions </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01549">1549</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

<p>References <a class="el" href="../../da/dad/a02928_source.html#l00077">AV_CT_CONSENSUS_PCT</a>, <a class="el" href="../../da/dad/a02928_source.html#l00066">AV_INIT_CONSENSUS_PCT</a>, <a class="el" href="../../da/dad/a02928_source.html#l00072">AV_LATE_CONSENSUS_PCT</a>, <a class="el" href="../../da/dad/a02928_source.html#l00071">AV_LATE_CONSENSUS_TIME</a>, <a class="el" href="../../da/dad/a02928_source.html#l00069">AV_MID_CONSENSUS_PCT</a>, <a class="el" href="../../da/dad/a02928_source.html#l00068">AV_MID_CONSENSUS_TIME</a>, <a class="el" href="../../da/dad/a02928_source.html#l00075">AV_STUCK_CONSENSUS_PCT</a>, <a class="el" href="../../da/dad/a02928_source.html#l00074">AV_STUCK_CONSENSUS_TIME</a>, <a class="el" href="../../da/d6b/a02352_source.html#l90852">changes()</a>, <a class="el" href="../../dc/dc0/a03087_source.html#l00079">CondLog</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00029">ripple::lsDEBUG</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00030">ripple::lsINFO</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00031">ripple::lsWARNING</a>, <a class="el" href="../../da/dad/a02928_source.html#l00060">PROPOSE_FRESHNESS</a>, <a class="el" href="../../da/dad/a02928_source.html#l00063">PROPOSE_INTERVAL</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>
<div class="fragment"><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    {</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        boost::posix_time::ptime peerCutoff </div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;            = boost::posix_time::second_clock::universal_time ();</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        boost::posix_time::ptime ourCutoff </div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;            = peerCutoff - boost::posix_time::seconds (<a class="code" href="../../da/dad/a02928.html#ac1e40cc1cb904bbf5afc99afc0584b70">PROPOSE_INTERVAL</a>);</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        peerCutoff -= boost::posix_time::seconds (<a class="code" href="../../da/dad/a02928.html#a1051c5d9df7e70e7b1ad8b62eb17f423">PROPOSE_FRESHNESS</a>);</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="../../da/d6b/a02352.html#a098b9c6a88d2ab91cdcbd5ee0b4bfe7f">changes</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        <a class="code" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a> ourPosition;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        <span class="comment">//  std::vector&lt;uint256&gt; addedTx, removedTx;</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        <span class="comment">// Verify freshness of peer positions and compute close times</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;        std::map&lt;std::uint32_t, int&gt; closeTimes;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;        <a class="code" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map&lt;uint160, LedgerProposal::pointer&gt;::iterator</a> it </div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;            = <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.begin ();</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        <span class="keywordflow">while</span> (it != <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.end ())</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        {</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;            <span class="keywordflow">if</span> (it-&gt;second-&gt;isStale (peerCutoff))</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;            {</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                <span class="comment">// proposal is stale</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                uint160 peerID = it-&gt;second-&gt;getPeerID ();</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a4f9eb9b54b9bf0586ad6249697d4adde">lsWARNING</a>, LedgerConsensus) </div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Removing stale proposal from &quot;</span> &lt;&lt; peerID;</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                BOOST_FOREACH (<a class="code" href="../../d9/d9d/a03417.html#ab40f03d8b2d67f746e939aa2065499e3">u256_lct_pair</a> &amp; it, <a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>)</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                it.second-&gt;unVote (peerID);</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                it = <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.erase (it);</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;            }</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;            <a class="code" href="../../d4/d87/a03436.html#afc04d0d2aaea0945960c9fbe27fa19de">else</a></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;            {</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                <span class="comment">// proposal is still fresh</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                ++closeTimes[<a class="code" href="../../d7/d5f/a00831.html#ae4292911c54b0bcf21a3754a47832b5a">roundCloseTime</a> (it-&gt;second-&gt;getCloseTime ())];</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                ++it;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;            }</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;        }</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;        BOOST_FOREACH (<a class="code" href="../../d9/d9d/a03417.html#ab40f03d8b2d67f746e939aa2065499e3">u256_lct_pair</a> &amp; it, <a class="code" href="../../d7/d5f/a00831.html#a37227802a3d7139679874a5193b22722">mDisputes</a>)</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        {</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;            <span class="comment">// Because the threshold for inclusion increases, </span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;            <span class="comment">//  time can change our position on a dispute</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;            <span class="keywordflow">if</span> (it.second-&gt;updateVote (<a class="code" href="../../d7/d5f/a00831.html#aa09946e6c5c3c0e47a61f5c32d809b74">mClosePercent</a>, <a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a>))</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;            {</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;                <span class="keywordflow">if</span> (!changes)</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                {</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;                    ourPosition = <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>[<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCurrentHash ()]</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;                        -&gt;snapShot (<span class="keyword">true</span>);</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;                    assert (ourPosition);</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;                    changes = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;                }</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                <span class="keywordflow">if</span> (it.second-&gt;getOurVote ()) <span class="comment">// now a yes</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                {</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                    ourPosition-&gt;addItem (SHAMapItem (it.first</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;                        , it.second-&gt;peekTransaction ()), <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                    <span class="comment">//              addedTx.push_back(it.first);</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;                }</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;                <span class="keywordflow">else</span> <span class="comment">// now a no</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                {</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                    ourPosition-&gt;delItem (it.first);</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;                    <span class="comment">//              removedTx.push_back(it.first);</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                }</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;            }</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        }</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <span class="keywordtype">int</span> neededWeight;</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#aa09946e6c5c3c0e47a61f5c32d809b74">mClosePercent</a> &lt; <a class="code" href="../../da/dad/a02928.html#a5c0be36ac710b2ed5f1098649c70f13d">AV_MID_CONSENSUS_TIME</a>)</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;            neededWeight = <a class="code" href="../../da/dad/a02928.html#aca1c1eea50e89853decd114d0c9fddb8">AV_INIT_CONSENSUS_PCT</a>;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#aa09946e6c5c3c0e47a61f5c32d809b74">mClosePercent</a> &lt; <a class="code" href="../../da/dad/a02928.html#a705affad5dd52957ec08587e296d985f">AV_LATE_CONSENSUS_TIME</a>)</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            neededWeight = <a class="code" href="../../da/dad/a02928.html#a49a22e0b5c4f0b568f2f459d5b6987eb">AV_MID_CONSENSUS_PCT</a>;</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#aa09946e6c5c3c0e47a61f5c32d809b74">mClosePercent</a> &lt; <a class="code" href="../../da/dad/a02928.html#ae4b4826ddc89e37ce01d5948294e693f">AV_STUCK_CONSENSUS_TIME</a>)</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;            neededWeight = <a class="code" href="../../da/dad/a02928.html#a61237cdefe1cf2a1ec6ec63b9286885a">AV_LATE_CONSENSUS_PCT</a>;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            neededWeight = <a class="code" href="../../da/dad/a02928.html#a6a91d486266dd38f3905b46ea1781058">AV_STUCK_CONSENSUS_PCT</a>;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        <a class="code" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> closeTime = 0;</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        <a class="code" href="../../d7/d5f/a00831.html#a6d2a5574253bae4842079acdcb4fc0ff">mHaveCloseTimeConsensus</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.empty ())</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;        {</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;            <span class="comment">// no other times</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;            <a class="code" href="../../d7/d5f/a00831.html#a6d2a5574253bae4842079acdcb4fc0ff">mHaveCloseTimeConsensus</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;            closeTime = <a class="code" href="../../d7/d5f/a00831.html#ae4292911c54b0bcf21a3754a47832b5a">roundCloseTime</a> (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCloseTime ());</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;        }</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        {</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;            <span class="comment">// Threshold for non-zero vote</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            <span class="keywordtype">int</span> threshVote = <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.size ();</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            <span class="comment">// Threshold to declare consensus</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;            <span class="keywordtype">int</span> threshConsensus = <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.size ();   </div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a>)</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            {</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                ++closeTimes[<a class="code" href="../../d7/d5f/a00831.html#ae4292911c54b0bcf21a3754a47832b5a">roundCloseTime</a> (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCloseTime ())];</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                ++threshVote;</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                ++threshConsensus;</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;            }</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            threshVote = ((threshVote * neededWeight) + (neededWeight / 2)) </div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                / 100;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            threshConsensus = ((threshConsensus * <a class="code" href="../../da/dad/a02928.html#a3020c555548d1f6479b4e4e3d2459f19">AV_CT_CONSENSUS_PCT</a>) </div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                + (<a class="code" href="../../da/dad/a02928.html#a3020c555548d1f6479b4e4e3d2459f19">AV_CT_CONSENSUS_PCT</a> / 2)) / 100;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            <span class="keywordflow">if</span> (threshVote == 0)</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;                threshVote = 1;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;            <span class="keywordflow">if</span> (threshConsensus == 0)</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;                threshConsensus = 1;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;Proposers:&quot;</span> </div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                &lt;&lt; <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.size () &lt;&lt; <span class="stringliteral">&quot; nw:&quot;</span> &lt;&lt; neededWeight</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; thrV:&quot;</span> &lt;&lt; threshVote &lt;&lt; <span class="stringliteral">&quot; thrC:&quot;</span> &lt;&lt; threshConsensus;</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;            <span class="keywordflow">for</span> (std::map&lt;std::uint32_t, int&gt;::iterator it = closeTimes.begin ()</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                , end = closeTimes.end (); it != end; ++it)</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            {</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) &lt;&lt; <span class="stringliteral">&quot;CCTime: seq&quot;</span> </div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                    &lt;&lt; <a class="code" href="../../d7/d5f/a00831.html#a67bcb0f7badeac0c170a110109830d46">mPreviousLedger</a>-&gt;getLedgerSeq () + 1 &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> </div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;                    &lt;&lt; it-&gt;first &lt;&lt; <span class="stringliteral">&quot; has &quot;</span> &lt;&lt; it-&gt;second &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> </div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                    &lt;&lt; threshVote &lt;&lt; <span class="stringliteral">&quot; required&quot;</span>;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                <span class="keywordflow">if</span> (it-&gt;second &gt;= threshVote)</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                {</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;Close time consensus reached: &quot;</span> &lt;&lt; it-&gt;first;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                    closeTime = it-&gt;first;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;                    threshVote = it-&gt;second;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;                    <span class="keywordflow">if</span> (threshVote &gt;= threshConsensus)</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                        <a class="code" href="../../d7/d5f/a00831.html#a6d2a5574253bae4842079acdcb4fc0ff">mHaveCloseTimeConsensus</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                }</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;            }</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a22f88ba407917e2f7d6353efcb3e5920">CondLog</a> (!<a class="code" href="../../d7/d5f/a00831.html#a6d2a5574253bae4842079acdcb4fc0ff">mHaveCloseTimeConsensus</a>, <a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a031699c2a2c25288caf7c5c512da58eb">lsDEBUG</a>, LedgerConsensus) </div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;No CT consensus: Proposers:&quot;</span> &lt;&lt; <a class="code" href="../../d7/d5f/a00831.html#aed5b7c8b2022ecf0730ab4d0f9a8fefa">mPeerPositions</a>.size ()</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; Proposing:&quot;</span> &lt;&lt; (<a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; Thresh:&quot;</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                &lt;&lt; threshConsensus &lt;&lt; <span class="stringliteral">&quot; Pos:&quot;</span> &lt;&lt; closeTime;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;        }</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        <span class="keywordflow">if</span> (!changes &amp;&amp;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;                ((closeTime != <a class="code" href="../../d7/d5f/a00831.html#ae4292911c54b0bcf21a3754a47832b5a">roundCloseTime</a> (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCloseTime ())) </div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                || <a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;isStale (ourCutoff)))</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        {</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;            <span class="comment">// close time changed or our position is stale</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;            ourPosition = <a class="code" href="../../d7/d5f/a00831.html#a6246a8d1f88dd0b9e80afc6abaf831f2">mAcquired</a>[<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;getCurrentHash ()]</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;                -&gt;snapShot (<span class="keyword">true</span>);</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;            assert (ourPosition);</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;            changes = <span class="keyword">true</span>; <span class="comment">// We pretend our position changed to force </span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        }                   <span class="comment">//   a new proposal</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        <span class="keywordflow">if</span> (changes)</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        {</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;            uint256 newHash = ourPosition-&gt;getHash ();</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;            <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, LedgerConsensus) </div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;Position change: CTime &quot;</span> &lt;&lt; closeTime </div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;, tx &quot;</span> &lt;&lt; newHash;</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#ab67645601b59454835041a4f64351e35">mOurPosition</a>-&gt;changePosition (newHash, closeTime))</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;            {</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5f/a00831.html#abe8becec1e0d33e3e31081f588891d20">mProposing</a>)</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;                    <a class="code" href="../../d7/d5f/a00831.html#a68b90bb0cadfa356f2377b5c075749aa">propose</a> ();</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                <a class="code" href="../../d7/d5f/a00831.html#a37cda218246008eae547bb7b70d3277b">mapComplete</a> (newHash, ourPosition, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;            }</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;        }</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d5f/a00831_a1bf0661799d346e0952ae2a5a0ab5c50_cgraph.png" border="0" usemap="#d7/d5f/a00831_a1bf0661799d346e0952ae2a5a0ab5c50_cgraph" alt=""/></div>
<map name="d7/d5f/a00831_a1bf0661799d346e0952ae2a5a0ab5c50_cgraph" id="d7/d5f/a00831_a1bf0661799d346e0952ae2a5a0ab5c50_cgraph">
<area shape="rect" id="node3" href="../../da/d6b/a02352.html#a098b9c6a88d2ab91cdcbd5ee0b4bfe7f" title="changes" alt="" coords="244,13,313,43"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a98a93e0c0cf39778ab8aabcb1e62bec9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/daf/a00830.html#acb1700386f9fc9ebb9ec58260a3b400b">clock_type</a>&amp; ripple::LedgerConsensusImp::m_clock</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01890">1890</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="aad2345c604e445ae15f1b594d1c9c030"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d7/d41/a00532.html">FeeVote</a>&amp; ripple::LedgerConsensusImp::m_feeVote</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01892">1892</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="af11ff7f7aeca802caeb76ca45974c0d6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/dd6/a00896.html">LocalTxs</a>&amp; ripple::LedgerConsensusImp::m_localTX</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01891">1891</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a6246a8d1f88dd0b9e80afc6abaf831f2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt;<a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <a class="el" href="../../d6/dfe/a01366.html#a863e0d49cf8941071ae4a0b0e4d44eca">SHAMap::pointer</a>&gt; ripple::LedgerConsensusImp::mAcquired</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01924">1924</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a6cf65b0f94846ec7f6dc84db61766258"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt;<a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <a class="el" href="../../d0/dbc/a01704.html#aec96b8b1497a6c2c54780028a0d52b64">TransactionAcquire::pointer</a>&gt; ripple::LedgerConsensusImp::mAcquiring</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01925">1925</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a8dcd0c00b5c03a4502c771ed0afbec73"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> ripple::LedgerConsensusImp::mAcquiringLedger</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01907">1907</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="aa09946e6c5c3c0e47a61f5c32d809b74"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ripple::LedgerConsensusImp::mClosePercent</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01913">1913</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a42f8299df43917879af29265ad84a229"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ripple::LedgerConsensusImp::mCloseResolution</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01913">1913</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a69465d9a39fe6f4e501271b59e6613e5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> ripple::LedgerConsensusImp::mCloseTime</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01906">1906</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2519b3393c3aa0c48baad0bd7aa49d45"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a>, int&gt; ripple::LedgerConsensusImp::mCloseTimes</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01936">1936</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="aeb0067cc3a21d698e60ce43a072018fa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::unordered_set&lt;<a class="el" href="../../d0/d4e/a01741.html">uint256</a>&gt; ripple::LedgerConsensusImp::mCompares</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01933">1933</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a3b8a207fbaed3c087f7088211e33a679"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::LedgerConsensusImp::mConsensusFail</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01911">1911</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a9f4ef09e1a39629c53236367f4fbc361"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::posix_time::ptime ripple::LedgerConsensusImp::mConsensusStartTime</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01916">1916</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a980f1be83cec80bdd429cc8797f713dd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ripple::LedgerConsensusImp::mCurrentMSeconds</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01913">1913</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="aa880479ea79d1fe40de04227870409bf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::unordered_set&lt;<a class="el" href="../../df/d2e/a01737.html">uint160</a>&gt; ripple::LedgerConsensusImp::mDeadNodes</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01939">1939</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a37227802a3d7139679874a5193b22722"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt;<a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <a class="el" href="../../d8/de7/a00417.html#a53bf8a87a60c0b020cdf2c8e63022065">DisputedTx::pointer</a>&gt; ripple::LedgerConsensusImp::mDisputes</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01932">1932</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a6d2a5574253bae4842079acdcb4fc0ff"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::LedgerConsensusImp::mHaveCloseTimeConsensus</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01914">1914</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a305d1dbd83526551156742e4d210089f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::LedgerConsensusImp::mHaveCorrectLCL</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01911">1911</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ac9d1b88625c504bd67fa7b85a4755fde"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> ripple::LedgerConsensusImp::mNewLedgerHash</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01907">1907</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ab67645601b59454835041a4f64351e35"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/de8/a00839.html#a0ec96481e000fcb8d977f684d600b86b">LedgerProposal::pointer</a> ripple::LedgerConsensusImp::mOurPosition</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01909">1909</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a5b5fb525962ec0bc4480e23f86c8e641"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt;<a class="el" href="../../d0/d4e/a01741.html">uint256</a> , std::vector&lt; boost::weak_ptr&lt;<a class="el" href="../../d5/d17/a01098.html">Peer</a>&gt; &gt; &gt; ripple::LedgerConsensusImp::mPeerData</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01929">1929</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="aed5b7c8b2022ecf0730ab4d0f9a8fefa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d9d/a03417.html#a1382c24eaaf3ee6a51a5b64d8ad5706c">ripple::unordered_map</a>&lt;<a class="el" href="../../df/d2e/a01737.html">uint160</a>, <a class="el" href="../../df/de8/a00839.html#a0ec96481e000fcb8d977f684d600b86b">LedgerProposal::pointer</a>&gt; ripple::LedgerConsensusImp::mPeerPositions</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01921">1921</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a67bcb0f7badeac0c170a110109830d46"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d5f/a00825.html#a373b6b80e365f42477db12be3ce899ba">Ledger::pointer</a> ripple::LedgerConsensusImp::mPreviousLedger</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01908">1908</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a7322d3c6bf824d5f5ff3d050aea3b9a4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ripple::LedgerConsensusImp::mPreviousMSeconds</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01918">1918</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a0616700feacae724b8e4a7d47cc4f9f6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ripple::LedgerConsensusImp::mPreviousProposers</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01917">1917</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ac8bd458103616b9f4a861b75f42413ed"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> ripple::LedgerConsensusImp::mPrevLedgerHash</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01907">1907</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="abe8becec1e0d33e3e31081f588891d20"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::LedgerConsensusImp::mProposing</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01911">1911</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="abfdd93db957a9e8181362d22c7375b10"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d7/d5f/a00831.html#aad0feafd25c23e1c225e78134513e166">LCState</a> ripple::LedgerConsensusImp::mState</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01905">1905</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a779e52882cd0d007dd8c3d7b53962233"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::LedgerConsensusImp::mValidating</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01911">1911</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="af6bf71a4a3f765224f108598544e2efe"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/d0e/a01272.html">RippleAddress</a> ripple::LedgerConsensusImp::mValPrivate</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01910">1910</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a8c5ce846eef0f0e1bebaf8ced18b9bb6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/d0e/a01272.html">RippleAddress</a> ripple::LedgerConsensusImp::mValPublic</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d57/a02882_source.html#l01910">1910</a> of file <a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>rippled/src/ripple_app/consensus/<a class="el" href="../../d4/d57/a02882_source.html">LedgerConsensus.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d9/d9d/a03417.html">ripple</a></li><li class="navelem"><a class="el" href="../../d7/d5f/a00831.html">LedgerConsensusImp</a></li>
    <li class="footer">Generated on Fri May 2 2014 05:29:10 for rippled by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
