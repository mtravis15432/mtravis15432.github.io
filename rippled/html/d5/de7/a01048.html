<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>rippled: ripple::OfferCreateTransactor Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">rippled
   &#160;<span id="projectnumber">0.24.0-rc1</span>
   </div>
   <div id="projectbrief">Reference implementation of the Ripple Protocol</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="../../classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="../../inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d5/de7/a01048.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="../../d5/dbe/a07622.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ripple::OfferCreateTransactor Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../d7/d8c/a03049_source.html">OfferCreateTransactor.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for ripple::OfferCreateTransactor:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d4f/a07623.png" border="0" usemap="#ripple_1_1_offer_create_transactor_inherit__map" alt="Inheritance graph"/></div>
<map name="ripple_1_1_offer_create_transactor_inherit__map" id="ripple_1_1_offer_create_transactor_inherit__map">
<area shape="rect" id="node2" href="../../d8/df7/a01711.html" title="ripple::Transactor" alt="" coords="39,5,161,35"/></map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for ripple::OfferCreateTransactor:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/ddf/a07624.png" border="0" usemap="#ripple_1_1_offer_create_transactor_coll__map" alt="Collaboration graph"/></div>
<map name="ripple_1_1_offer_create_transactor_coll__map" id="ripple_1_1_offer_create_transactor_coll__map">
<area shape="rect" id="node2" href="../../d8/df7/a01711.html" title="ripple::Transactor" alt="" coords="2755,348,2877,377"/><area shape="rect" id="node4" href="../../d4/d0e/a01272.html" title="ripple::RippleAddress" alt="" coords="2415,257,2561,287"/><area shape="rect" id="node6" href="../../d9/d39/a00257.html" title="ripple::CBase58Data" alt="" coords="2105,256,2247,285"/><area shape="rect" id="node10" href="../../d2/d41/a01493.html" title="ripple::STAmount" alt="" coords="2427,348,2549,377"/><area shape="rect" id="node12" href="../../d7/d57/a01348.html" title="ripple::SerializedType" alt="" coords="919,308,1065,337"/><area shape="rect" id="node43" href="../../db/d1e/a01497.html" title="ripple::STArray" alt="" coords="1296,515,1405,544"/><area shape="rect" id="node66" href="../../de/d1a/a01559.html" title="ripple::STObject" alt="" coords="1293,180,1408,209"/><area shape="rect" id="node14" href="../../d7/d81/a01365.html" title="ripple::SField" alt="" coords="560,308,659,337"/><area shape="rect" id="node18" title="STL class. " alt="" coords="233,279,313,308"/><area shape="rect" id="node20" title="STL class. " alt="" coords="7,270,132,317"/><area shape="rect" id="node22" href="../../df/d2e/a01737.html" title="ripple::uint160" alt="" coords="2125,375,2227,404"/><area shape="rect" id="node26" href="../../d9/dc5/a01705.html" title="ripple::TransactionEngine" alt="" coords="2404,479,2572,508"/><area shape="rect" id="node24" href="../../d7/d9a/a00152.html" title="base_uint160" alt="" coords="1705,360,1804,389"/><area shape="rect" id="node28" href="../../d7/dfc/a00349.html" title="ripple::CountedObject\l\&lt; TransactionEngine \&gt;" alt="" coords="2099,451,2253,498"/><area shape="rect" id="node33" href="../../d0/d08/a00832.html" title="ripple::LedgerEntrySet" alt="" coords="2101,535,2251,564"/><area shape="rect" id="node35" href="../../d7/dfc/a00349.html" title="ripple::CountedObject\l\&lt; LedgerEntrySet \&gt;" alt="" coords="1681,681,1828,727"/><area shape="rect" id="node39" href="../../d1/da7/a01709.html" title="ripple::TransactionMetaSet" alt="" coords="1665,552,1844,581"/><area shape="rect" id="node46" href="../../d7/dfc/a00349.html" title="ripple::CountedObject\l\&lt; STArray \&gt;" alt="" coords="919,506,1065,553"/><area shape="rect" id="node50" href="../../d0/d4e/a01741.html" title="ripple::uint256" alt="" coords="1300,581,1401,611"/><area shape="rect" id="node52" href="../../d7/d9a/a00152.html" title="base_uint256" alt="" coords="943,581,1041,611"/><area shape="rect" id="node56" href="../../dc/d6e/a00833.html" title="ripple::LedgerEntrySetEntry" alt="" coords="1260,387,1441,416"/><area shape="rect" id="node58" href="../../d7/dfc/a00349.html" title="ripple::CountedObject\l\&lt; LedgerEntrySetEntry \&gt;" alt="" coords="909,378,1075,425"/><area shape="rect" id="node64" href="../../d9/de4/a01346.html" title="ripple::SerializedTransaction" alt="" coords="1661,187,1848,216"/><area shape="rect" id="node69" href="../../d7/dfc/a00349.html" title="ripple::CountedObject\l\&lt; STObject \&gt;" alt="" coords="919,106,1065,153"/><area shape="rect" id="node73" href="../../d1/de7/a01434.html" title="ripple::SOTemplate" alt="" coords="925,180,1059,209"/><area shape="rect" id="node77" title="STL class. " alt="" coords="204,180,343,209"/><area shape="rect" id="node83" href="../../d7/dfc/a00349.html" title="ripple::CountedObject\l\&lt; SerializedTransaction \&gt;" alt="" coords="1265,233,1436,279"/><area shape="rect" id="node87" href="../../df/d0c/a00788.html" title="beast::Journal" alt="" coords="2436,152,2540,181"/><area shape="rect" id="node89" href="../../df/d84/a01408.html" title="beast::Journal::Sink" alt="" coords="1685,63,1824,92"/><area shape="rect" id="node91" href="../../d4/d2c/a01575.html" title="beast::Journal::Stream" alt="" coords="2099,123,2253,152"/></map>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3ded6047f1026baeb9f462276d985ea9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/de7/a01048.html#a3ded6047f1026baeb9f462276d985ea9">OfferCreateTransactor</a> (<a class="el" href="../../d9/de4/a01346.html">SerializedTransaction</a> const &amp;txn, <a class="el" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09">TransactionEngineParams</a> params, <a class="el" href="../../d9/dc5/a01705.html">TransactionEngine</a> *engine)</td></tr>
<tr class="separator:a3ded6047f1026baeb9f462276d985ea9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54a40cf030c21f9b4796330011e5eca8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/de7/a01048.html#a54a40cf030c21f9b4796330011e5eca8">doApply</a> ()</td></tr>
<tr class="separator:a54a40cf030c21f9b4796330011e5eca8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_a01711"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_a01711')"><img src="../../closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="../../d8/df7/a01711.html">ripple::Transactor</a></td></tr>
<tr class="memitem:ac2faaa3bfd1c9b9f91ae24f367474d0f inherit pub_methods_a01711"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#ac2faaa3bfd1c9b9f91ae24f367474d0f">apply</a> ()</td></tr>
<tr class="separator:ac2faaa3bfd1c9b9f91ae24f367474d0f inherit pub_methods_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:ab570cc3ecffaf7c479df21c9803cbd21"><td class="memItemLeft" align="right" valign="top">typedef std::pair&lt; <a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <br class="typebreak"/>
<a class="el" href="../../d0/d4e/a01741.html">uint256</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/de7/a01048.html#ab570cc3ecffaf7c479df21c9803cbd21">missingOffer_t</a></td></tr>
<tr class="separator:ab570cc3ecffaf7c479df21c9803cbd21"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:ad23ce85477cc840bf3d7a8210a31d1d9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/de7/a01048.html#ad23ce85477cc840bf3d7a8210a31d1d9">isValidOffer</a> (<a class="el" href="../../dc/d54/a01344.html#ac44431ef1b5e53a01fca8eb46673c519">SLE::ref</a> sleOfferDir, <a class="el" href="../../df/d2e/a01737.html">uint160</a> const &amp;uOfferOwnerID, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;saOfferPays, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;saOfferGets, <a class="el" href="../../df/d2e/a01737.html">uint160</a> const &amp;uTakerAccountID, std::unordered_set&lt; <a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <a class="el" href="../../d4/dc4/a00617.html">beast::hardened_hash</a>&lt; <a class="el" href="../../d0/d4e/a01741.html">uint256</a> &gt;&gt; &amp;usOfferUnfundedBecame, std::unordered_set&lt; <a class="el" href="../../df/d2e/a01737.html">uint160</a>, <a class="el" href="../../d4/dc4/a00617.html">beast::hardened_hash</a>&lt; <a class="el" href="../../df/d2e/a01737.html">uint160</a> &gt;&gt; &amp;usAccountTouched, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saOfferFunds)</td></tr>
<tr class="separator:ad23ce85477cc840bf3d7a8210a31d1d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad481c5e633674c0d78c40df84780bbac"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/de7/a01048.html#ad481c5e633674c0d78c40df84780bbac">applyOffer</a> (const bool bSell, const <a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> uTakerPaysRate, const <a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> uOfferPaysRate, const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saOfferRate, const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saOfferFunds, const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saTakerFunds, const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saOfferPays, const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saOfferGets, const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saTakerPays, const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saTakerGets, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saTakerPaid, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saTakerGot, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saTakerIssuerFee, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saOfferIssuerFee)</td></tr>
<tr class="separator:ad481c5e633674c0d78c40df84780bbac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3a509a2033e29420391d2936d358313"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/de7/a01048.html#aa3a509a2033e29420391d2936d358313">canCross</a> (<a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;saTakerFunds, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;saSubTakerPays, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;saSubTakerGets, <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">std::uint64_t</a> uTipQuality, <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">std::uint64_t</a> uTakeQuality, bool isPassive, bool &amp;isUnfunded, <a class="el" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a> &amp;terResult) const </td></tr>
<tr class="separator:aa3a509a2033e29420391d2936d358313"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad751b1698cdcc386c9e90e86d2e11b1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/de7/a01048.html#aad751b1698cdcc386c9e90e86d2e11b1">takeOffers</a> (bool const bOpenLedger, bool const bPassive, bool const bSell, <a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;uBookBase, <a class="el" href="../../df/d2e/a01737.html">uint160</a> const &amp;uTakerAccountID, <a class="el" href="../../dc/d54/a01344.html#ac44431ef1b5e53a01fca8eb46673c519">SLE::ref</a> sleTakerAccount, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;saTakerPays, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;saTakerGets, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saTakerPaid, <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;saTakerGot, bool &amp;bUnfunded)</td></tr>
<tr class="separator:aad751b1698cdcc386c9e90e86d2e11b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:a8305e465720135a1649d5afad82d97f4"><td class="memTemplParams" colspan="2">template&lt;class T &gt; </td></tr>
<tr class="memitem:a8305e465720135a1649d5afad82d97f4"><td class="memTemplItemLeft" align="right" valign="top">static std::string&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../d5/de7/a01048.html#a8305e465720135a1649d5afad82d97f4">get_compare_sign</a> (<a class="el" href="../../d3/dbb/a02004.html#ad24d0de3f597ca60dd95c4bc59c2ff73">T</a> const &amp;<a class="el" href="../../da/d6b/a02352.html#a1632a2b0ef4f78b5e49dce83d8daad2a">lhs</a>, <a class="el" href="../../d3/dbb/a02004.html#ad24d0de3f597ca60dd95c4bc59c2ff73">T</a> const &amp;rhs)</td></tr>
<tr class="separator:a8305e465720135a1649d5afad82d97f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a885648ff4433731d715b63ef66b31767"><td class="memItemLeft" align="right" valign="top">std::unordered_set&lt; <a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <br class="typebreak"/>
<a class="el" href="../../d4/dc4/a00617.html">beast::hardened_hash</a>&lt; <a class="el" href="../../d0/d4e/a01741.html">uint256</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/de7/a01048.html#a885648ff4433731d715b63ef66b31767">usOfferUnfundedFound</a></td></tr>
<tr class="separator:a885648ff4433731d715b63ef66b31767"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb9adbe1d187e768d4c53ae98dc4aad4"><td class="memItemLeft" align="right" valign="top">std::set&lt; <a class="el" href="../../d5/de7/a01048.html#ab570cc3ecffaf7c479df21c9803cbd21">missingOffer_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/de7/a01048.html#aeb9adbe1d187e768d4c53ae98dc4aad4">usMissingOffers</a></td></tr>
<tr class="separator:aeb9adbe1d187e768d4c53ae98dc4aad4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pub_static_methods_a01711"><td colspan="2" onclick="javascript:toggleInherit('pub_static_methods_a01711')"><img src="../../closed.png" alt="-"/>&#160;Static Public Member Functions inherited from <a class="el" href="../../d8/df7/a01711.html">ripple::Transactor</a></td></tr>
<tr class="memitem:a520fdd34ff865b5de78aac3c40d78630 inherit pub_static_methods_a01711"><td class="memItemLeft" align="right" valign="top">static std::unique_ptr<br class="typebreak"/>
&lt; <a class="el" href="../../d8/df7/a01711.html">Transactor</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a520fdd34ff865b5de78aac3c40d78630">makeTransactor</a> (<a class="el" href="../../d9/de4/a01346.html">SerializedTransaction</a> const &amp;txn, <a class="el" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09">TransactionEngineParams</a> params, <a class="el" href="../../d9/dc5/a01705.html">TransactionEngine</a> *engine)</td></tr>
<tr class="separator:a520fdd34ff865b5de78aac3c40d78630 inherit pub_static_methods_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_methods_a01711"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_a01711')"><img src="../../closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="../../d8/df7/a01711.html">ripple::Transactor</a></td></tr>
<tr class="memitem:acde4aad5a0210a8499cce3dcd629f191 inherit pro_methods_a01711"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#acde4aad5a0210a8499cce3dcd629f191">preCheck</a> ()</td></tr>
<tr class="separator:acde4aad5a0210a8499cce3dcd629f191 inherit pro_methods_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf74bc5b813b1ba1e03d6b8e8efdc2a7 inherit pro_methods_a01711"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#abf74bc5b813b1ba1e03d6b8e8efdc2a7">checkSeq</a> ()</td></tr>
<tr class="separator:abf74bc5b813b1ba1e03d6b8e8efdc2a7 inherit pro_methods_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08d96a396dc3bd9a0a3e39e47e38531c inherit pro_methods_a01711"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a08d96a396dc3bd9a0a3e39e47e38531c">payFee</a> ()</td></tr>
<tr class="separator:a08d96a396dc3bd9a0a3e39e47e38531c inherit pro_methods_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c91d4c75c8c30c402513f254f299931 inherit pro_methods_a01711"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a5c91d4c75c8c30c402513f254f299931">calculateFee</a> ()</td></tr>
<tr class="separator:a5c91d4c75c8c30c402513f254f299931 inherit pro_methods_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af218e14bd594bc67343ec352a53076d5 inherit pro_methods_a01711"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">std::uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#af218e14bd594bc67343ec352a53076d5">calculateBaseFee</a> ()</td></tr>
<tr class="separator:af218e14bd594bc67343ec352a53076d5 inherit pro_methods_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85756113238258794a2a4dd85a4e848c inherit pro_methods_a01711"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a85756113238258794a2a4dd85a4e848c">checkSig</a> ()</td></tr>
<tr class="separator:a85756113238258794a2a4dd85a4e848c inherit pro_methods_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c9537476c88967b3b3b6e087cec7456 inherit pro_methods_a01711"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a5c9537476c88967b3b3b6e087cec7456">Transactor</a> (const <a class="el" href="../../d9/de4/a01346.html">SerializedTransaction</a> &amp;txn, <a class="el" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09">TransactionEngineParams</a> params, <a class="el" href="../../d9/dc5/a01705.html">TransactionEngine</a> *engine, <a class="el" href="../../df/d0c/a00788.html">beast::Journal</a> journal=<a class="el" href="../../df/d0c/a00788.html">beast::Journal</a>())</td></tr>
<tr class="separator:a5c9537476c88967b3b3b6e087cec7456 inherit pro_methods_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd6e2a4ce5330c8048fef30481e6c88f inherit pro_methods_a01711"><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#abd6e2a4ce5330c8048fef30481e6c88f">mustHaveValidAccount</a> ()</td></tr>
<tr class="separator:abd6e2a4ce5330c8048fef30481e6c88f inherit pro_methods_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_attribs_a01711"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_a01711')"><img src="../../closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="../../d8/df7/a01711.html">ripple::Transactor</a></td></tr>
<tr class="memitem:a99b2a46d8f9a1ea5b201164b201bbd31 inherit pro_attribs_a01711"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/de4/a01346.html">SerializedTransaction</a> const &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a99b2a46d8f9a1ea5b201164b201bbd31">mTxn</a></td></tr>
<tr class="separator:a99b2a46d8f9a1ea5b201164b201bbd31 inherit pro_attribs_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8d31b55e657c48fc9664e52955d2ed3 inherit pro_attribs_a01711"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/dc5/a01705.html">TransactionEngine</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a></td></tr>
<tr class="separator:ad8d31b55e657c48fc9664e52955d2ed3 inherit pro_attribs_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef372af604ddaed069ff8b660cea322d inherit pro_attribs_a01711"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09">TransactionEngineParams</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#aef372af604ddaed069ff8b660cea322d">mParams</a></td></tr>
<tr class="separator:aef372af604ddaed069ff8b660cea322d inherit pro_attribs_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a641d7466f1b1abee1cdd77f3777d06fc inherit pro_attribs_a01711"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/d2e/a01737.html">uint160</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a></td></tr>
<tr class="separator:a641d7466f1b1abee1cdd77f3777d06fc inherit pro_attribs_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b4372fa950c38615d221da3ed9df683 inherit pro_attribs_a01711"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/d41/a01493.html">STAmount</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a3b4372fa950c38615d221da3ed9df683">mFeeDue</a></td></tr>
<tr class="separator:a3b4372fa950c38615d221da3ed9df683 inherit pro_attribs_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dd217bcdc20be801bd8bd1effa47b02 inherit pro_attribs_a01711"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/d41/a01493.html">STAmount</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a3dd217bcdc20be801bd8bd1effa47b02">mPriorBalance</a></td></tr>
<tr class="separator:a3dd217bcdc20be801bd8bd1effa47b02 inherit pro_attribs_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04e42fae6a4a96ffc3c1e27c05cdf584 inherit pro_attribs_a01711"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/d41/a01493.html">STAmount</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a04e42fae6a4a96ffc3c1e27c05cdf584">mSourceBalance</a></td></tr>
<tr class="separator:a04e42fae6a4a96ffc3c1e27c05cdf584 inherit pro_attribs_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae67d05c15fb94a1f913d4801768d36a8 inherit pro_attribs_a01711"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dc/d54/a01344.html#abf05184c020b05e80bdf996c9bee96eb">SLE::pointer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#ae67d05c15fb94a1f913d4801768d36a8">mTxnAccount</a></td></tr>
<tr class="separator:ae67d05c15fb94a1f913d4801768d36a8 inherit pro_attribs_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a120051537f82cf0b052599e6c1e9e543 inherit pro_attribs_a01711"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a120051537f82cf0b052599e6c1e9e543">mHasAuthKey</a></td></tr>
<tr class="separator:a120051537f82cf0b052599e6c1e9e543 inherit pro_attribs_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a623eca50d03ea019f760ba4a3966815e inherit pro_attribs_a01711"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a623eca50d03ea019f760ba4a3966815e">mSigMaster</a></td></tr>
<tr class="separator:a623eca50d03ea019f760ba4a3966815e inherit pro_attribs_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7a8451e64bbf462fa759c367cadbd8d inherit pro_attribs_a01711"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d4/d0e/a01272.html">RippleAddress</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#aa7a8451e64bbf462fa759c367cadbd8d">mSigningPubKey</a></td></tr>
<tr class="separator:aa7a8451e64bbf462fa759c367cadbd8d inherit pro_attribs_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13c709e8f4b7574a290cd1e2bf1ff370 inherit pro_attribs_a01711"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/d0c/a00788.html">beast::Journal</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a></td></tr>
<tr class="separator:a13c709e8f4b7574a290cd1e2bf1ff370 inherit pro_attribs_a01711"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="../../d7/d8c/a03049_source.html#l00036">36</a> of file <a class="el" href="../../d7/d8c/a03049_source.html">OfferCreateTransactor.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="ab570cc3ecffaf7c479df21c9803cbd21"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::pair&lt;<a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <a class="el" href="../../d0/d4e/a01741.html">uint256</a>&gt; <a class="el" href="../../d5/de7/a01048.html#ab570cc3ecffaf7c479df21c9803cbd21">ripple::OfferCreateTransactor::missingOffer_t</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/d8c/a03049_source.html#l00117">117</a> of file <a class="el" href="../../d7/d8c/a03049_source.html">OfferCreateTransactor.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a3ded6047f1026baeb9f462276d985ea9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ripple::OfferCreateTransactor::OfferCreateTransactor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/de4/a01346.html">SerializedTransaction</a> const &amp;&#160;</td>
          <td class="paramname"><em>txn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09">TransactionEngineParams</a>&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/dc5/a01705.html">TransactionEngine</a> *&#160;</td>
          <td class="paramname"><em>engine</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/d8c/a03049_source.html#l00055">55</a> of file <a class="el" href="../../d7/d8c/a03049_source.html">OfferCreateTransactor.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        : <a class="code" href="../../d8/df7/a01711.html#a5c9537476c88967b3b3b6e087cec7456">Transactor</a> (</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            txn,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            params,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            engine,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            LogPartition::getJournal &lt;OfferCreateTransactorLog&gt; ())</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ad481c5e633674c0d78c40df84780bbac"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::OfferCreateTransactor::applyOffer </td>
          <td>(</td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bSell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a>&#160;</td>
          <td class="paramname"><em>uTakerPaysRate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a>&#160;</td>
          <td class="paramname"><em>uOfferPaysRate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saOfferRate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saOfferFunds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saTakerFunds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saOfferPays</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saOfferGets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saTakerPays</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saTakerGets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saTakerPaid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saTakerGot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saTakerIssuerFee</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saOfferIssuerFee</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Apply a particular offer</p>
<p>An existing offer is on the books. The price is the offer owner's, which might be better for taker. The taker pays what they can and gets all taker can pay for with <code>saTakerFunds</code>/<code>uTakerPaysRate</code>, limited by <code>saOfferPays</code> and <code>saOfferFunds</code>/<code>uOfferPaysRate</code>. If taker is an offer, taker is spending at same or better rate than they wanted. The taker should consider themselves as wanting to buy X amount and as willing to pay at most the rate of Y/X each. After having some part of their offer fulfilled at a better rate their offer should be reduced accordingly. There are no quality costs for offer vs offer taking.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bSell</td><td><code>true</code> if using sell semantics. </td></tr>
    <tr><td class="paramname">uTakerPaysRate</td><td>&gt;= QUALITY_ONE | TransferRate for third party IOUs paid by taker. </td></tr>
    <tr><td class="paramname">uOfferPaysRate</td><td>&gt;= QUALITY_ONE | TransferRate for third party IOUs paid by offer owner. </td></tr>
    <tr><td class="paramname">saOfferRate</td><td>Original saOfferGets/saOfferPays, when offer was made. </td></tr>
    <tr><td class="paramname">saOfferFunds</td><td>Limit for saOfferPays : How much can pay including fees. </td></tr>
    <tr><td class="paramname">saTakerFunds</td><td>Limit for saOfferGets : How much can pay including fees. </td></tr>
    <tr><td class="paramname">saOfferPays</td><td>Request : this should be reduced as the offer is fullfilled. </td></tr>
    <tr><td class="paramname">saOfferGets</td><td>Request : this should be reduced as the offer is fullfilled. </td></tr>
    <tr><td class="paramname">saTakerPays</td><td>Limit for taker to pay. </td></tr>
    <tr><td class="paramname">saTakerGets</td><td>Limit for taker to get. </td></tr>
    <tr><td class="paramname">saTakerPaid</td><td>Actual amount the taker paid </td></tr>
    <tr><td class="paramname">saTakerGot</td><td>Actual amount the taker got </td></tr>
    <tr><td class="paramname">saTakerIssuerFee</td><td>Actual </td></tr>
    <tr><td class="paramname">saOfferIssuerFee</td><td>Actual</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Buy vs. Sell semantics:</dd></dl>
<p>In Ripple, placed offers are always executed at the rate at which they were placed. However, the offer we are processing hasn't been placed yet and it can cross with offers that have. Such crossing offers can be consumed by existing offers that give a better rate.</p>
<p>The only difference between buy and sell offers is the way in which we calculate what remains to be placed on the books after crossing offers are consumed.</p>
<p>First, consider the case where a user is trying to place an offer to buy 1 BTC for 700 USD: If an offer to giving 0.5 BTC for 300 USD is on the books, the offers cross and under buy semantics the user buys 0.5 BTC for 300 USD (less than the 350 USD he was willing to pay) and the offer is adjusted and placed on the books as: "give 0.5 BTC for 350 USD" which is the amount left to buy at the original rate.</p>
<p>Now consider the case where a user is trying to place an offer to sell 700 USD for 1 BTC instead: If an offer to giving 0.5 BTC for 300 USD is on the books, the offers cross and under sell semantics the user will sell 350 USD for 0.5 BTC (more than he was willing to get) and his offer will be be adjusted and placed on the books as: "give 0.57 BTC for 400 USD" which is what is left to sell at the original rate. </p>

<p>Definition at line <a class="el" href="../../dc/d92/a03048_source.html#l00192">192</a> of file <a class="el" href="../../dc/d92/a03048_source.html">OfferCreateTransactor.cpp</a>.</p>

<p>References <a class="el" href="../../d8/dd4/a03195_source.html#l00068">ACCOUNT_ONE</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00065">CURRENCY_ONE</a>, <a class="el" href="../../da/dd3/a03198_source.html#l00920">ripple::STAmount::divide()</a>, <a class="el" href="../../db/d47/a03199_source.html#l00267">ripple::STAmount::divRound()</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00663">ripple::STAmount::getCurrency()</a>, <a class="el" href="../../da/dd3/a03198_source.html#l01090">ripple::STAmount::getFullText()</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00653">ripple::STAmount::getIssuer()</a>, <a class="el" href="../../d8/d4b/a03093_source.html#l00030">ripple::lsINFO</a>, <a class="el" href="../../d5/dd8/a03083_source.html#l00031">ripple::min()</a>, <a class="el" href="../../db/d47/a03199_source.html#l00203">ripple::STAmount::mulRound()</a>, <a class="el" href="../../da/d4a/a03107_source.html#l00031">QUALITY_ONE</a>, <a class="el" href="../../da/dd3/a03198_source.html#l00694">ripple::STAmount::throwComparable()</a>, and <a class="el" href="../../dc/dc0/a03087_source.html#l00075">WriteLog</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d92/a03048_source.html#l00330">takeOffers()</a>.</p>
<div class="fragment"><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;{</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    saOfferGets.throwComparable (saTakerFunds);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    assert (saOfferFunds &gt; zero &amp;&amp; saTakerFunds &gt; zero); <span class="comment">// Both must have funds.</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    assert (saOfferGets &gt; zero &amp;&amp; saOfferPays &gt; zero); <span class="comment">// Must not be a null offer.</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// Available = limited by funds.</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// Limit offerer funds available, by transfer fees.</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    STAmount    saOfferFundsAvailable   = <a class="code" href="../../da/d4a/a03107.html#a5efda0277380b020b74dfbf26ded15fe">QUALITY_ONE</a> == uOfferPaysRate</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                          ? saOfferFunds          <span class="comment">// As is.</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                          : <a class="code" href="../../d2/d41/a01493.html#a547cf5be1bf2fdd7f7cd4cc076d77196">STAmount::divide</a> (saOfferFunds, STAmount (<a class="code" href="../../d8/dd4/a03195.html#aa47e551f32708d9a2bcf3d0eda6e75e4">CURRENCY_ONE</a>, <a class="code" href="../../d8/dd4/a03195.html#ad55eb3b0f8711599b73d311ac52eced0">ACCOUNT_ONE</a>, uOfferPaysRate, -9)); <span class="comment">// Reduce by offer fees.</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: uOfferPaysRate=&quot;</span> &lt;&lt; uOfferPaysRate;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saOfferFundsAvailable=&quot;</span> &lt;&lt; saOfferFundsAvailable.getFullText ();</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">// Limit taker funds available, by transfer fees.</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    STAmount    saTakerFundsAvailable   = <a class="code" href="../../da/d4a/a03107.html#a5efda0277380b020b74dfbf26ded15fe">QUALITY_ONE</a> == uTakerPaysRate</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                          ? saTakerFunds          <span class="comment">// As is.</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                          : <a class="code" href="../../d2/d41/a01493.html#a547cf5be1bf2fdd7f7cd4cc076d77196">STAmount::divide</a> (saTakerFunds, STAmount (<a class="code" href="../../d8/dd4/a03195.html#aa47e551f32708d9a2bcf3d0eda6e75e4">CURRENCY_ONE</a>, <a class="code" href="../../d8/dd4/a03195.html#ad55eb3b0f8711599b73d311ac52eced0">ACCOUNT_ONE</a>, uTakerPaysRate, -9)); <span class="comment">// Reduce by taker fees.</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: TAKER_FEES=&quot;</span> &lt;&lt; STAmount (<a class="code" href="../../d8/dd4/a03195.html#aa47e551f32708d9a2bcf3d0eda6e75e4">CURRENCY_ONE</a>, <a class="code" href="../../d8/dd4/a03195.html#ad55eb3b0f8711599b73d311ac52eced0">ACCOUNT_ONE</a>, uTakerPaysRate, -9).getFullText ();</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: uTakerPaysRate=&quot;</span> &lt;&lt; uTakerPaysRate;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saTakerFundsAvailable=&quot;</span> &lt;&lt; saTakerFundsAvailable.getFullText ();</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    STAmount    saOfferPaysAvailable;   <span class="comment">// Amount offer can pay out, limited by offer and offerer funds.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    STAmount    saOfferGetsAvailable;   <span class="comment">// Amount offer would get, limited by offer funds.</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">if</span> (saOfferFundsAvailable &gt;= saOfferPays)</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="comment">// Offer was fully funded, avoid math shenanigans.</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        saOfferPaysAvailable    = saOfferPays;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        saOfferGetsAvailable    = saOfferGets;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="comment">// Offer has limited funding, limit offer gets and pays by funds available.</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        saOfferPaysAvailable    = saOfferFundsAvailable;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        saOfferGetsAvailable    = <a class="code" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff">std::min</a> (saOfferGets, <a class="code" href="../../d2/d41/a01493.html#a789b3ee5edaf69eb840e57b4c7fc395e">STAmount::mulRound</a> (saOfferPaysAvailable, saOfferRate, saOfferGets, <span class="keyword">true</span>));</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saOfferPaysAvailable=&quot;</span> &lt;&lt; saOfferPaysAvailable.getFullText ();</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saOfferGetsAvailable=&quot;</span> &lt;&lt; saOfferGetsAvailable.getFullText ();</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    STAmount    saTakerPaysAvailable    = <a class="code" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff">std::min</a> (saTakerPays, saTakerFundsAvailable);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saTakerPaysAvailable=&quot;</span> &lt;&lt; saTakerPaysAvailable.getFullText ();</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">// Limited = limited by other sides raw numbers.</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">// Taker can&#39;t pay more to offer than offer can get.</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    STAmount    saTakerPaysLimited      = <a class="code" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff">std::min</a> (saTakerPaysAvailable, saOfferGetsAvailable);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saTakerPaysLimited=&quot;</span> &lt;&lt; saTakerPaysLimited.getFullText ();</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// Align saTakerGetsLimited with saTakerPaysLimited.</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    STAmount    saTakerGetsLimited      = saTakerPaysLimited &gt;= saOfferGetsAvailable              <span class="comment">// Cannot actually be greater</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                          ? saOfferPaysAvailable                                  <span class="comment">// Potentially take entire offer. Avoid math shenanigans.</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                                          : <a class="code" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff">std::min</a> (saOfferPaysAvailable, <a class="code" href="../../d2/d41/a01493.html#a5a04a9b52239427b2faf80438dcda832">STAmount::divRound</a> (saTakerPaysLimited, saOfferRate, saTakerGets, <span class="keyword">true</span>)); <span class="comment">// Take a portion of offer.</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saOfferRate=&quot;</span> &lt;&lt; saOfferRate.getFullText ();</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saTakerGetsLimited=&quot;</span> &lt;&lt; saTakerGetsLimited.getFullText ();</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">// Got &amp; Paid = Calculated by price and transfered without fees.</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// Compute from got as when !bSell, we want got to be exact to finish off offer if possible.</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    saTakerGot  = bSell</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                  ? saTakerGetsLimited                            <span class="comment">// Get all available that are paid for.</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                  : <a class="code" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff">std::min</a> (saTakerGets, saTakerGetsLimited);   <span class="comment">// Limit by wanted.</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    saTakerPaid = saTakerGot &gt;= saTakerGetsLimited</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                  ? saTakerPaysLimited</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                  : <a class="code" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff">std::min</a> (saTakerPaysLimited, <a class="code" href="../../d2/d41/a01493.html#a789b3ee5edaf69eb840e57b4c7fc395e">STAmount::mulRound</a> (saTakerGot, saOfferRate, saTakerFunds, <span class="keyword">true</span>));</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saTakerGot=&quot;</span> &lt;&lt; saTakerGot.getFullText ();</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saTakerPaid=&quot;</span> &lt;&lt; saTakerPaid.getFullText ();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">if</span> (uTakerPaysRate == <a class="code" href="../../da/d4a/a03107.html#a5efda0277380b020b74dfbf26ded15fe">QUALITY_ONE</a>)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        saTakerIssuerFee    = STAmount (saTakerPaid.getCurrency (), saTakerPaid.getIssuer ());</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="comment">// Compute fees in a rounding safe way.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        STAmount    saTransferRate  = STAmount (<a class="code" href="../../d8/dd4/a03195.html#aa47e551f32708d9a2bcf3d0eda6e75e4">CURRENCY_ONE</a>, <a class="code" href="../../d8/dd4/a03195.html#ad55eb3b0f8711599b73d311ac52eced0">ACCOUNT_ONE</a>, uTakerPaysRate, -9);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saTransferRate=&quot;</span> &lt;&lt; saTransferRate.getFullText ();</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="comment">// TakerCost includes transfer fees.</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        STAmount    saTakerCost     = <a class="code" href="../../d2/d41/a01493.html#a789b3ee5edaf69eb840e57b4c7fc395e">STAmount::mulRound</a> (saTakerPaid, saTransferRate, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saTakerCost=&quot;</span> &lt;&lt; saTakerCost.getFullText ();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saTakerFunds=&quot;</span> &lt;&lt; saTakerFunds.getFullText ();</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        saTakerIssuerFee    = saTakerCost &gt; saTakerFunds</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                              ? saTakerFunds - saTakerPaid <span class="comment">// Not enough funds to cover fee, stiff issuer the rounding error.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                              : saTakerCost - saTakerPaid;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saTakerIssuerFee=&quot;</span> &lt;&lt; saTakerIssuerFee.getFullText ();</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        assert (saTakerIssuerFee &gt;= zero);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">if</span> (uOfferPaysRate == <a class="code" href="../../da/d4a/a03107.html#a5efda0277380b020b74dfbf26ded15fe">QUALITY_ONE</a>)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        saOfferIssuerFee    = STAmount (saTakerGot.getCurrency (), saTakerGot.getIssuer ());</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="comment">// Compute fees in a rounding safe way.</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        STAmount    saOfferCost = <a class="code" href="../../d2/d41/a01493.html#a789b3ee5edaf69eb840e57b4c7fc395e">STAmount::mulRound</a> (saTakerGot, STAmount (<a class="code" href="../../d8/dd4/a03195.html#aa47e551f32708d9a2bcf3d0eda6e75e4">CURRENCY_ONE</a>, <a class="code" href="../../d8/dd4/a03195.html#ad55eb3b0f8711599b73d311ac52eced0">ACCOUNT_ONE</a>, uOfferPaysRate, -9), <span class="keyword">true</span>);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        saOfferIssuerFee    = saOfferCost &gt; saOfferFunds</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                              ? saOfferFunds - saTakerGot <span class="comment">// Not enough funds to cover fee, stiff issuer the rounding error.</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                              : saOfferCost - saTakerGot;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="../../dc/dc0/a03087.html#a5308b5072b82addfc9132f3aa5d0e45f">WriteLog</a> (<a class="code" href="../../d9/d9d/a03417.html#afc7159a6877417e38472fbbd425f2244a275905728c3e58efd16146a7e25c5df6">lsINFO</a>, STAmount) &lt;&lt; <span class="stringliteral">&quot;applyOffer: saTakerGot=&quot;</span> &lt;&lt; saTakerGot.getFullText ();</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">return</span> saTakerGot &gt;= saOfferPaysAvailable;              <span class="comment">// True, if consumed offer.</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d5/de7/a01048_ad481c5e633674c0d78c40df84780bbac_cgraph.png" border="0" usemap="#d5/de7/a01048_ad481c5e633674c0d78c40df84780bbac_cgraph" alt=""/></div>
<map name="d5/de7/a01048_ad481c5e633674c0d78c40df84780bbac_cgraph" id="d5/de7/a01048_ad481c5e633674c0d78c40df84780bbac_cgraph">
<area shape="rect" id="node3" href="../../d2/d41/a01493.html#a547cf5be1bf2fdd7f7cd4cc076d77196" title="ripple::STAmount::divide" alt="" coords="280,163,445,192"/><area shape="rect" id="node17" href="../../d2/d41/a01493.html#a5a04a9b52239427b2faf80438dcda832" title="ripple::STAmount::divRound" alt="" coords="269,216,456,245"/><area shape="rect" id="node28" href="../../d2/d41/a01493.html#a61429db7fed5872fca90d726f3088325" title="ripple::STAmount::getCurrency" alt="" coords="261,269,464,299"/><area shape="rect" id="node30" href="../../d2/d41/a01493.html#acacb1c47b480b33d3d7fd6cd0d63cbed" title="ripple::STAmount::getFullText" alt="" coords="265,604,460,633"/><area shape="rect" id="node98" href="../../d2/d41/a01493.html#ac88b3e8c68c4fbda4e493471be3f074c" title="ripple::STAmount::getIssuer" alt="" coords="271,376,455,405"/><area shape="rect" id="node100" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="321,429,404,459"/><area shape="rect" id="node102" href="../../d2/d41/a01493.html#a789b3ee5edaf69eb840e57b4c7fc395e" title="ripple::STAmount::mulRound" alt="" coords="268,323,457,352"/><area shape="rect" id="node115" href="../../d2/d41/a01493.html#ab0b901062f0b7e67b0832d0601cd665e" title="ripple::STAmount::throwComparable" alt="" coords="247,723,479,752"/><area shape="rect" id="node5" href="../../d2/d41/a01493.html#abd4fd82bc6fbef164e509b1436722aea" title="ripple::STAmount::STAmount" alt="" coords="537,163,729,192"/><area shape="rect" id="node7" href="../../d9/d9d/a03417.html#a6a718ea1b5de0444d1c41e60dc800640" title="ripple::BN_add_word64" alt="" coords="555,216,712,245"/><area shape="rect" id="node9" href="../../d9/d9d/a03417.html#a3f8ae51567332338f0bc009416f7fb6c" title="ripple::BN_mul_word64" alt="" coords="555,269,712,299"/><area shape="rect" id="node11" href="../../d9/d9d/a03417.html#a6695464b272d36f5cf768f472395d2f7" title="ripple::BN_div_word64" alt="" coords="557,5,709,35"/><area shape="rect" id="node13" href="../../d7/d2f/a00258.html#aa953d5910038dd334c8ff41d856bc4dd" title="ripple::CBigNum::getuint64" alt="" coords="544,59,723,88"/><area shape="rect" id="node15" href="../../d7/d2f/a00258.html#a89d1765e542c2a44a13f2470add46cbe" title="ripple::CBigNum::getulong" alt="" coords="788,59,961,88"/><area shape="rect" id="node24" href="../../d2/d41/a01493.html#ab683af712f5bfcfa66c66f09f5a8399a" title="ripple::STAmount::canonicalize\lRound" alt="" coords="532,322,735,369"/><area shape="rect" id="node26" href="../../d7/d9a/a00152.html#a25e873c7d069c6c2d44655736f2b6c21" title="ripple::base_uint::\lisZero" alt="" coords="1027,378,1152,425"/><area shape="rect" id="node32" href="../../d2/d41/a01493.html#a207b1e769e476310cc294e5a3d6d299f" title="ripple::STAmount::getText" alt="" coords="547,635,720,664"/><area shape="rect" id="node34" href="../../d2/d41/a01493.html#a0f7eda3369139764c0dd4c6dc806a9d7" title="ripple::STAmount::getHuman\lCurrency" alt="" coords="539,565,728,611"/><area shape="rect" id="node64" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59" title="ripple::RippleAddress\l::createHumanAccountID" alt="" coords="548,687,719,734"/><area shape="rect" id="node36" href="../../d2/d41/a01493.html#aefb662aaabfc521cb4cdcdb715c7d4b8" title="ripple::STAmount::create\lHumanCurrency" alt="" coords="792,529,957,575"/><area shape="rect" id="node39" href="../../d7/d9a/a00152.html#ad19bda12f3725584ac179f2e091e30d7" title="ripple::base_uint::\lToString" alt="" coords="1027,498,1152,545"/><area shape="rect" id="node41" href="../../d7/d9a/a00152.html#a348c4019943a8b3a05f39f1efcb589c9" title="ripple::base_uint::\lGetHex" alt="" coords="1259,479,1384,526"/><area shape="rect" id="node53" href="../../da/d61/a01350.html#a509771bf1109949d4bee7b71aecc3757" title="ripple::Serializer\l::add160" alt="" coords="1264,549,1379,595"/><area shape="rect" id="node59" href="../../d0/d85/a01352.html#a28779f2e8d8ceb7882acfb5534d70754" title="ripple::SerializerIterator\l::getRaw" alt="" coords="1012,618,1167,665"/><area shape="rect" id="node43" href="../../d7/d9a/a00152.html#a05af5cdcc33627cb359debe028ab675d" title="ripple::base_uint::\lbegin" alt="" coords="1532,547,1657,594"/><area shape="rect" id="node47" href="../../d7/d9a/a00152.html#a463054abe1fe73a6f2d2dd9ecc9fb544" title="ripple::base_uint::size" alt="" coords="1520,437,1669,467"/><area shape="rect" id="node49" href="../../d9/d9d/a03417.html#a138db8803faea25db74891325f6b0073" title="ripple::strHex" alt="" coords="1545,491,1644,520"/><area shape="rect" id="node45" href="../../d7/d9a/a00152.html#af39117db8d26ecef7a570cd3448822a6" title="ripple::base_uint::data" alt="" coords="1967,588,2116,617"/><area shape="rect" id="node51" href="../../d9/d9d/a03417.html#aca6318bcfeb25f74477566a7ddc06a63" title="ripple::charHex" alt="" coords="1785,491,1895,520"/><area shape="rect" id="node56" href="../../d7/d9a/a00152.html#afcb87d72a05033f7eafdf7563bf52224" title="ripple::base_uint::end" alt="" coords="1767,616,1913,645"/><area shape="rect" id="node61" href="../../da/d61/a01350.html#aae6a2808959bee786fa30c815a6d2306" title="ripple::Serializer\l::getRaw" alt="" coords="1264,618,1379,665"/><area shape="rect" id="node66" href="../../d4/d0e/a01272.html#a4d666ed35a56048234a86e53d129ad66" title="ripple::RippleAddress\l::createAccountID" alt="" coords="801,687,948,734"/><area shape="rect" id="node77" href="../../d4/d0e/a01272.html#a2a8201537b6969c0e186c9b1d889c52b" title="ripple::RippleAddress\l::humanAccountID" alt="" coords="801,757,948,803"/><area shape="rect" id="node68" href="../../d4/d0e/a01272.html#ad33487a0716edddfc083c5a0fd68bbc9" title="ripple::RippleAddress\l::setAccountID" alt="" coords="1016,687,1163,734"/><area shape="rect" id="node70" href="../../d9/d39/a00257.html#a47491f73d2b42a10e3f72172ced83c3d" title="ripple::CBase58Data\l::SetString" alt="" coords="1251,687,1392,734"/><area shape="rect" id="node72" href="../../d9/d7d/a00150.html#a85c405829839e85edb721241fd8d4203" title="ripple::Base58::decodeWith\lCheck" alt="" coords="1504,677,1685,723"/><area shape="rect" id="node74" href="../../d9/d7d/a00150.html#a0c2d621faceac43aeb30f4797f03b12c" title="ripple::Base58::decode" alt="" coords="1763,685,1917,715"/><area shape="rect" id="node79" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158" title="rocksdb::if" alt="" coords="1048,765,1131,795"/><area shape="rect" id="node85" href="../../d9/d39/a00257.html#a18a7bfe8bbf61262472b03f1dfe5c887" title="ripple::CBase58Data\l::ToString" alt="" coords="1019,818,1160,865"/><area shape="rect" id="node94" href="../../d4/d0e/a01272.html#a57f127faa6e0af4093b8397e368c2899" title="ripple::RippleAddress\l::getAccountID" alt="" coords="1016,887,1163,934"/><area shape="rect" id="node81" href="../../da/d71/a00814.html#ab25c6d03dbcd6168b3ae3762dc98fd51" title="rocksdb::LDBCommandExecute\lResult::FAILED" alt="" coords="1216,757,1427,803"/><area shape="rect" id="node83" href="../../da/d71/a00814.html#ae4210d600639c8c6ac04486ebc43c39b" title="rocksdb::LDBCommandExecute\lResult::LDBCommandExecuteResult" alt="" coords="1475,757,1715,803"/><area shape="rect" id="node87" href="../../d9/d7d/a00150.html#a085fa82e1453fd6e5460a0cd960b5816" title="ripple::Base58::encodeWith\lCheck" alt="" coords="1231,826,1412,873"/><area shape="rect" id="node89" href="../../d9/d7d/a00150.html#ac6c6ad62e7ed916bfe1c652721d3fe26" title="ripple::Base58::encode" alt="" coords="1517,831,1672,860"/><area shape="rect" id="node91" href="../../d9/d7d/a00150.html#a24f49360e730224f1d16edb1b504e32a" title="ripple::Base58::getCurrent\lAlphabet" alt="" coords="1508,883,1681,930"/><area shape="rect" id="node96" href="../../d9/d9d/a03417.html#a67af9cb9a9d5c158f9a56acde5f27e4e" title="ripple::Hash160" alt="" coords="1265,896,1377,925"/><area shape="rect" id="node106" href="../../d2/d41/a01493.html#a70bbf21b0b886f5b8739293022a3c3e3" title="ripple::STAmount::getSNValue" alt="" coords="533,443,733,472"/><area shape="rect" id="node108" href="../../d7/d57/a01348.html#a79472b7634153a0478119634c9e82d7e" title="ripple::SerializedType\l::getFName" alt="" coords="560,495,707,542"/><area shape="rect" id="node117" href="../../d2/d41/a01493.html#a3cf020f0636f8cbc302a6261b9145c11" title="ripple::STAmount::isComparable" alt="" coords="528,757,739,787"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d5/de7/a01048_ad481c5e633674c0d78c40df84780bbac_icgraph.png" border="0" usemap="#d5/de7/a01048_ad481c5e633674c0d78c40df84780bbac_icgraph" alt=""/></div>
<map name="d5/de7/a01048_ad481c5e633674c0d78c40df84780bbac_icgraph" id="d5/de7/a01048_ad481c5e633674c0d78c40df84780bbac_icgraph">
<area shape="rect" id="node3" href="../../d5/de7/a01048.html#aad751b1698cdcc386c9e90e86d2e11b1" title="ripple::OfferCreateTransactor\l::takeOffers" alt="" coords="247,5,436,51"/><area shape="rect" id="node5" href="../../d5/de7/a01048.html#a54a40cf030c21f9b4796330011e5eca8" title="ripple::OfferCreateTransactor\l::doApply" alt="" coords="487,5,676,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa3a509a2033e29420391d2936d358313"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::OfferCreateTransactor::canCross </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;&#160;</td>
          <td class="paramname"><em>saTakerFunds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;&#160;</td>
          <td class="paramname"><em>saSubTakerPays</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;&#160;</td>
          <td class="paramname"><em>saSubTakerGets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">std::uint64_t</a>&#160;</td>
          <td class="paramname"><em>uTipQuality</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">std::uint64_t</a>&#160;</td>
          <td class="paramname"><em>uTakeQuality</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isPassive</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>isUnfunded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a> &amp;&#160;</td>
          <td class="paramname"><em>terResult</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../dc/d92/a03048_source.html#l00100">100</a> of file <a class="el" href="../../dc/d92/a03048_source.html">OfferCreateTransactor.cpp</a>.</p>

<p>References <a class="el" href="../../d5/d73/a03203_source.html#l00141">ripple::tesSUCCESS</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d92/a03048_source.html#l00330">takeOffers()</a>.</p>
<div class="fragment"><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;{</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">if</span> (saTakerFunds &lt;= zero)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="comment">// Taker is out of funds. Don&#39;t create the offer.</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        isUnfunded = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        terResult = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">if</span> (saSubTakerPays &lt;= zero || saSubTakerGets &lt;= zero)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="comment">// Offer is completely consumed</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        terResult = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// TODO We must also consider the synthesized tip as well</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span> ((uTakeQuality &lt; uTipQuality) || (isPassive &amp;&amp; (uTakeQuality == uTipQuality)))</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="comment">// Offer does not cross this offer</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        terResult = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d5/de7/a01048_aa3a509a2033e29420391d2936d358313_icgraph.png" border="0" usemap="#d5/de7/a01048_aa3a509a2033e29420391d2936d358313_icgraph" alt=""/></div>
<map name="d5/de7/a01048_aa3a509a2033e29420391d2936d358313_icgraph" id="d5/de7/a01048_aa3a509a2033e29420391d2936d358313_icgraph">
<area shape="rect" id="node3" href="../../d5/de7/a01048.html#aad751b1698cdcc386c9e90e86d2e11b1" title="ripple::OfferCreateTransactor\l::takeOffers" alt="" coords="247,5,436,51"/><area shape="rect" id="node5" href="../../d5/de7/a01048.html#a54a40cf030c21f9b4796330011e5eca8" title="ripple::OfferCreateTransactor\l::doApply" alt="" coords="487,5,676,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a54a40cf030c21f9b4796330011e5eca8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a> ripple::OfferCreateTransactor::doApply </td>
          <td>(</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="../../d8/df7/a01711.html#af0192505cdcebc1bb31be32dfb62aa72">ripple::Transactor</a>.</p>

<p>Definition at line <a class="el" href="../../dc/d92/a03048_source.html#l00728">728</a> of file <a class="el" href="../../dc/d92/a03048_source.html">OfferCreateTransactor.cpp</a>.</p>

<p>References <a class="el" href="../../d4/db9/a02918_source.html#l01323">ripple::LedgerEntrySet::accountFunds()</a>, <a class="el" href="../../d0/d75/a03105_source.html#l00028">BIND_TYPE</a>, <a class="el" href="../../db/da5/a02919_source.html#l00128">ripple::LedgerEntrySet::bumpSeq()</a>, <a class="el" href="../../d7/d49/a03187_source.html#l00125">ripple::RippleAddress::createHumanAccountID()</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00066">CURRENCY_BAD</a>, <a class="el" href="../../dd/d07/a02132_source.html#l00244">beast::Journal::debug</a>, <a class="el" href="../../d4/db9/a02918_source.html#l00655">ripple::LedgerEntrySet::dirAdd()</a>, <a class="el" href="../../da/d5d/a03068_source.html#l00093">ripple::TransactionEngine::entryCache()</a>, <a class="el" href="../../d4/db9/a02918_source.html#l00136">ripple::LedgerEntrySet::entryCache()</a>, <a class="el" href="../../da/d5d/a03068_source.html#l00088">ripple::TransactionEngine::entryCreate()</a>, <a class="el" href="../../d4/db9/a02918_source.html#l00199">ripple::LedgerEntrySet::entryModify()</a>, <a class="el" href="../../dd/d3f/a02912_source.html#l01489">ripple::Ledger::getAccountRootIndex()</a>, <a class="el" href="../../dd/d3f/a02912_source.html#l01670">ripple::Ledger::getBookBase()</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00663">ripple::STAmount::getCurrency()</a>, <a class="el" href="../../de/de3/a03190_source.html#l00816">ripple::STObject::getFieldAmount()</a>, <a class="el" href="../../de/de3/a03190_source.html#l00671">ripple::STObject::getFieldU32()</a>, <a class="el" href="../../de/de3/a03190_source.html#l00566">ripple::STObject::getFlags()</a>, <a class="el" href="../../da/dd3/a03198_source.html#l01090">ripple::STAmount::getFullText()</a>, <a class="el" href="../../da/dd3/a03198_source.html#l00091">ripple::STAmount::getHumanCurrency()</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00653">ripple::STAmount::getIssuer()</a>, <a class="el" href="../../dd/d2f/a02983_source.html#l00244">ripple::SerializedTransaction::getJson()</a>, <a class="el" href="../../da/d5d/a03068_source.html#l00077">ripple::TransactionEngine::getLedger()</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00583">ripple::STAmount::getNValue()</a>, <a class="el" href="../../dd/d3f/a02912_source.html#l01736">ripple::Ledger::getOfferIndex()</a>, <a class="el" href="../../dd/d3f/a02912_source.html#l01747">ripple::Ledger::getOwnerDirIndex()</a>, <a class="el" href="../../dd/d3f/a02912_source.html#l01459">ripple::Ledger::getQualityIndex()</a>, <a class="el" href="../../da/dd3/a03198_source.html#l01030">ripple::STAmount::getRate()</a>, <a class="el" href="../../dd/d3f/a02912_source.html#l01757">ripple::Ledger::getRippleStateIndex()</a>, <a class="el" href="../../dd/d7e/a02984_source.html#l00093">ripple::SerializedTransaction::getSequence()</a>, <a class="el" href="../../d0/d75/a03105_source.html#l00040">ripple::is_bit_set()</a>, <a class="el" href="../../de/de3/a03190_source.html#l00511">ripple::STObject::isFieldPresent()</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00604">ripple::STAmount::isLegalNet()</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00600">ripple::STAmount::isNative()</a>, <a class="el" href="../../d0/d08/a03184_source.html#l00114">ripple::lsfHighAuth</a>, <a class="el" href="../../d0/d08/a03184_source.html#l00113">ripple::lsfLowAuth</a>, <a class="el" href="../../d0/d08/a03184_source.html#l00107">ripple::lsfPassive</a>, <a class="el" href="../../d0/d08/a03184_source.html#l00102">ripple::lsfRequireAuth</a>, <a class="el" href="../../d0/d08/a03184_source.html#l00108">ripple::lsfSell</a>, <a class="el" href="../../d0/d08/a03184_source.html#l00038">ripple::ltACCOUNT_ROOT</a>, <a class="el" href="../../d0/d08/a03184_source.html#l00049">ripple::ltDIR_NODE</a>, <a class="el" href="../../d0/d08/a03184_source.html#l00062">ripple::ltOFFER</a>, <a class="el" href="../../d0/d08/a03184_source.html#l00056">ripple::ltRIPPLE_STATE</a>, <a class="el" href="../../df/d0c/a03055_source.html#l00049">ripple::Transactor::m_journal</a>, <a class="el" href="../../df/d0c/a03055_source.html#l00037">ripple::Transactor::mEngine</a>, <a class="el" href="../../df/d0c/a03055_source.html#l00038">ripple::Transactor::mParams</a>, <a class="el" href="../../df/d0c/a03055_source.html#l00042">ripple::Transactor::mPriorBalance</a>, <a class="el" href="../../df/d0c/a03055_source.html#l00036">ripple::Transactor::mTxn</a>, <a class="el" href="../../df/d0c/a03055_source.html#l00044">ripple::Transactor::mTxnAccount</a>, <a class="el" href="../../df/d0c/a03055_source.html#l00040">ripple::Transactor::mTxnAccountID</a>, <a class="el" href="../../d0/d75/a03105_source.html#l00047">nothing</a>, <a class="el" href="../../d4/db9/a02918_source.html#l01096">ripple::LedgerEntrySet::offerDelete()</a>, <a class="el" href="../../d4/db9/a02918_source.html#l01052">ripple::LedgerEntrySet::ownerCountAdjust()</a>, <a class="el" href="../../dd/d3f/a02912_source.html#l01938">ripple::Ledger::ownerDirDescriber()</a>, <a class="el" href="../../d0/d75/a03105_source.html#l00029">P_1</a>, <a class="el" href="../../d0/d75/a03105_source.html#l00030">P_2</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l01566">ripple::STVector256::peekValue()</a>, <a class="el" href="../../dd/d3f/a02912_source.html#l01943">ripple::Ledger::qualityDirDescriber()</a>, <a class="el" href="../../d4/db9/a02918_source.html#l00061">ripple::LedgerEntrySet::swapWith()</a>, <a class="el" href="../../dc/d92/a03048_source.html#l00330">takeOffers()</a>, <a class="el" href="../../db/da5/a02919_source.html#l00031">ripple::tapOPEN_LEDGER</a>, <a class="el" href="../../db/da5/a02919_source.html#l00035">ripple::tapRETRY</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00158">ripple::tecFAILED_PROCESSING</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00161">ripple::tecINSUF_RESERVE_OFFER</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00172">ripple::tecNO_AUTH</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00171">ripple::tecNO_ISSUER</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00173">ripple::tecNO_LINE</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00156">ripple::tecUNFUNDED_OFFER</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00044">ripple::telFAILED_PROCESSING</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00057">ripple::temBAD_AMOUNT</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00059">ripple::temBAD_CURRENCY</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00061">ripple::temBAD_EXPIRATION</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00062">ripple::temBAD_ISSUER</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00064">ripple::temBAD_OFFER</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00076">ripple::temBAD_SEQUENCE</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00080">ripple::temINVALID_FLAG</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00081">ripple::temREDUNDANT</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00127">ripple::terNO_ACCOUNT</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00128">ripple::terNO_AUTH</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00129">ripple::terNO_LINE</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00141">ripple::tesSUCCESS</a>, <a class="el" href="../../d6/d75/a03204_source.html#l00070">ripple::tfFillOrKill</a>, <a class="el" href="../../d6/d75/a03204_source.html#l00069">ripple::tfImmediateOrCancel</a>, <a class="el" href="../../d6/d75/a03204_source.html#l00072">ripple::tfOfferCreateMask</a>, <a class="el" href="../../d6/d75/a03204_source.html#l00068">ripple::tfPassive</a>, <a class="el" href="../../d6/d75/a03204_source.html#l00071">ripple::tfSell</a>, <a class="el" href="../../dd/dfa/a02824_source.html#l00437">ripple::base_uint&lt; BITS &gt;::ToString()</a>, <a class="el" href="../../dd/d07/a02132_source.html#l00243">beast::Journal::trace</a>, <a class="el" href="../../d6/d9b/a03202_source.html#l00140">ripple::transToken()</a>, <a class="el" href="../../d7/d8c/a03049_source.html#l00118">usMissingOffers</a>, <a class="el" href="../../d7/d8c/a03049_source.html#l00115">usOfferUnfundedFound</a>, <a class="el" href="../../da/d5d/a03068_source.html#l00073">ripple::TransactionEngine::view()</a>, and <a class="el" href="../../dd/d07/a02132_source.html#l00246">beast::Journal::warning</a>.</p>
<div class="fragment"><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;{</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a>) <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="stringliteral">&quot;OfferCreate&gt; &quot;</span> &lt;&lt; <a class="code" href="../../d8/df7/a01711.html#a99b2a46d8f9a1ea5b201164b201bbd31">mTxn</a>.<a class="code" href="../../d9/de4/a01346.html#a436d1b0b2d422540cd39c117f5f6816d">getJson</a> (0);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <a class="code" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> <span class="keyword">const</span> uTxFlags = <a class="code" href="../../d8/df7/a01711.html#a99b2a46d8f9a1ea5b201164b201bbd31">mTxn</a>.<a class="code" href="../../de/d1a/a01559.html#a69de0d6b35d375f05afb08982ce8b7ee">getFlags</a> ();</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordtype">bool</span> <span class="keyword">const</span> bPassive = <a class="code" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c">is_bit_set</a> (uTxFlags, <a class="code" href="../../d9/d9d/a03417.html#af16188617a6d8abff264150016b2dc43">tfPassive</a>);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keywordtype">bool</span> <span class="keyword">const</span> bImmediateOrCancel = <a class="code" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c">is_bit_set</a> (uTxFlags, <a class="code" href="../../d9/d9d/a03417.html#a5b34df7946340873d74bb02bfea1faab">tfImmediateOrCancel</a>);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordtype">bool</span> <span class="keyword">const</span> bFillOrKill = <a class="code" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c">is_bit_set</a> (uTxFlags, <a class="code" href="../../d9/d9d/a03417.html#a42d0740567b18c792db00b70a44c03b8">tfFillOrKill</a>);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordtype">bool</span> <span class="keyword">const</span> bSell = <a class="code" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c">is_bit_set</a> (uTxFlags, <a class="code" href="../../d9/d9d/a03417.html#adafd11da2168f16934fcf2764864cc86">tfSell</a>);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    STAmount saTakerPays = <a class="code" href="../../d8/df7/a01711.html#a99b2a46d8f9a1ea5b201164b201bbd31">mTxn</a>.<a class="code" href="../../de/d1a/a01559.html#aad5f49acb4c7b95cabee5d8463d4ce4a">getFieldAmount</a> (sfTakerPays);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    STAmount saTakerGets = <a class="code" href="../../d8/df7/a01711.html#a99b2a46d8f9a1ea5b201164b201bbd31">mTxn</a>.<a class="code" href="../../de/d1a/a01559.html#aad5f49acb4c7b95cabee5d8463d4ce4a">getFieldAmount</a> (sfTakerGets);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">if</span> (!saTakerPays.isLegalNet () || !saTakerGets.isLegalNet ())</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a07dedb576e47ed9570e5acc5b4b1d3ea">temBAD_AMOUNT</a>;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="stringliteral">&quot;saTakerPays=&quot;</span> &lt;&lt; saTakerPays.getFullText () &lt;&lt;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="stringliteral">&quot; saTakerGets=&quot;</span> &lt;&lt; saTakerGets.getFullText ();</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    uint160 <span class="keyword">const</span> uPaysIssuerID = saTakerPays.getIssuer ();</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    uint160 <span class="keyword">const</span> uGetsIssuerID = saTakerGets.getIssuer ();</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordtype">bool</span> <span class="keyword">const</span> bHaveExpiration (<a class="code" href="../../d8/df7/a01711.html#a99b2a46d8f9a1ea5b201164b201bbd31">mTxn</a>.<a class="code" href="../../de/d1a/a01559.html#a6f0b6f41c14e975d5fc91f00b0bcbc87">isFieldPresent</a> (sfExpiration));</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keywordtype">bool</span> <span class="keyword">const</span> bHaveCancel (<a class="code" href="../../d8/df7/a01711.html#a99b2a46d8f9a1ea5b201164b201bbd31">mTxn</a>.<a class="code" href="../../de/d1a/a01559.html#a6f0b6f41c14e975d5fc91f00b0bcbc87">isFieldPresent</a> (sfOfferSequence));</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <a class="code" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> <span class="keyword">const</span> uExpiration = <a class="code" href="../../d8/df7/a01711.html#a99b2a46d8f9a1ea5b201164b201bbd31">mTxn</a>.<a class="code" href="../../de/d1a/a01559.html#ab3e8074cfab6e1c525b2d9a474c60f23">getFieldU32</a> (sfExpiration);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <a class="code" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> <span class="keyword">const</span> uCancelSequence = <a class="code" href="../../d8/df7/a01711.html#a99b2a46d8f9a1ea5b201164b201bbd31">mTxn</a>.<a class="code" href="../../de/d1a/a01559.html#ab3e8074cfab6e1c525b2d9a474c60f23">getFieldU32</a> (sfOfferSequence);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="comment">// FIXME understand why we use SequenceNext instead of current transaction</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="comment">//       sequence to determine the transaction. Why is the offer seuqnce</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="comment">//       number insufficient?</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <a class="code" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> <span class="keyword">const</span> uAccountSequenceNext = <a class="code" href="../../d8/df7/a01711.html#ae67d05c15fb94a1f913d4801768d36a8">mTxnAccount</a>-&gt;getFieldU32 (sfSequence);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <a class="code" href="../../db/d86/a02663.html#a435d1572bf3f880d55459d9805097f62">std::uint32_t</a> <span class="keyword">const</span> uSequence = <a class="code" href="../../d8/df7/a01711.html#a99b2a46d8f9a1ea5b201164b201bbd31">mTxn</a>.<a class="code" href="../../d9/de4/a01346.html#aaff9c0480235e2b982777311a9e5f7fd">getSequence</a> ();</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keyword">const</span> uint256 uLedgerIndex = <a class="code" href="../../dd/d5f/a00825.html#abb618e1d764497e2ad646aa55c56061a">Ledger::getOfferIndex</a> (<a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>, uSequence);</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="stringliteral">&quot;Creating offer node: &quot;</span> &lt;&lt; uLedgerIndex.ToString () &lt;&lt;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="stringliteral">&quot; uSequence=&quot;</span> &lt;&lt; uSequence;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keyword">const</span> uint160 uPaysCurrency = saTakerPays.getCurrency ();</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keyword">const</span> uint160 uGetsCurrency = saTakerGets.getCurrency ();</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">std::uint64_t</a> uRate = <a class="code" href="../../d2/d41/a01493.html#ad04578f94f5fcc11e1086f59c9afe238">STAmount::getRate</a> (saTakerGets, saTakerPays);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a>                        terResult                = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a>;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    uint256                    uDirectory;        <span class="comment">// Delete hints.</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">std::uint64_t</a>              uOwnerNode;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">std::uint64_t</a>              uBookNode;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    LedgerEntrySet&amp; lesActive = <a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#a4d2df7ee54a081d8855771939d4e44dc">view</a> ();</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    LedgerEntrySet lesCheckpoint = lesActive; <span class="comment">// Checkpoint with just fees paid.</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    lesActive.<a class="code" href="../../d0/d08/a00832.html#a4dd8c4302dca994ccb88d4e17a78a395">bumpSeq</a> (); <span class="comment">// Begin ledger variance.</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <a class="code" href="../../dc/d54/a01344.html#abf05184c020b05e80bdf996c9bee96eb">SLE::pointer</a> sleCreator = <a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#a5766d606e55b9ede4b004ff170f967cc">entryCache</a> (</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <a class="code" href="../../d8/dbb/a03480.html#ggaf6e0324b257fc9992b83ecf827c2a07bac03405d2da6d19e17f321a6b7f7a412e">ltACCOUNT_ROOT</a>, <a class="code" href="../../dd/d5f/a00825.html#ab0ca75e1c5fa67568377f9962687cf90">Ledger::getAccountRootIndex</a> (<a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>));</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">if</span> (uTxFlags &amp; <a class="code" href="../../d9/d9d/a03417.html#a9d8c82889876f162f2ca36cb29b6e4fd">tfOfferCreateMask</a>)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            <span class="stringliteral">&quot;Malformed transaction: Invalid flags set.&quot;</span>;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0aa4754e0f122658747650b3b1c0a846a8">temINVALID_FLAG</a>;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bImmediateOrCancel &amp;&amp; bFillOrKill)</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            <span class="stringliteral">&quot;Malformed transaction: both IoC and FoK set.&quot;</span>;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0aa4754e0f122658747650b3b1c0a846a8">temINVALID_FLAG</a>;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bHaveExpiration &amp;&amp; !uExpiration)</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    {</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            <span class="stringliteral">&quot;Malformed offer: bad expiration&quot;</span>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        terResult   = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a8845e05d481141ea5e8e5274796f45a7">temBAD_EXPIRATION</a>;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (saTakerPays.isNative () &amp;&amp; saTakerGets.isNative ())</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    {</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            <span class="stringliteral">&quot;Malformed offer: XRP for XRP&quot;</span>;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        terResult   = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a961ba30ab4cc6d8c450612fbaa7d9680">temBAD_OFFER</a>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (saTakerPays &lt;= zero || saTakerGets &lt;= zero)</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    {</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            <span class="stringliteral">&quot;Malformed offer: bad amount&quot;</span>;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        terResult   = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a961ba30ab4cc6d8c450612fbaa7d9680">temBAD_OFFER</a>;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    }</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uPaysCurrency == uGetsCurrency &amp;&amp; uPaysIssuerID == uGetsIssuerID)</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    {</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            <span class="stringliteral">&quot;Malformed offer: redundant offer&quot;</span>;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        terResult   = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a0b220bf6f780bf2ec67b6a6e18e9440f">temREDUNDANT</a>;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="comment">// FIXME: XRP is not a bad currency, not not allowed as IOU</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d8/dd4/a03195.html#a26b660a8a3b54bb18034f1b8d047da98">CURRENCY_BAD</a> == uPaysCurrency || <a class="code" href="../../d8/dd4/a03195.html#a26b660a8a3b54bb18034f1b8d047da98">CURRENCY_BAD</a> == uGetsCurrency)</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="stringliteral">&quot;Malformed offer: Bad currency.&quot;</span>;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        terResult   = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a47ebc45c5ddd8a242d47c055bec0de63">temBAD_CURRENCY</a>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (saTakerPays.isNative () != !uPaysIssuerID || saTakerGets.isNative () != !uGetsIssuerID)</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    {</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            <span class="stringliteral">&quot;Malformed offer: bad issuer&quot;</span>;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        terResult   = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a02872f8cb2a55f507f839f28918933f0">temBAD_ISSUER</a>;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lesActive.accountFunds (<a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>, saTakerGets) &lt;= zero)</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="stringliteral">&quot;delay: Offers must be at least partially funded.&quot;</span>;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        terResult   = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a5d1f0daadc43667fc3775d53cd6e3420">tecUNFUNDED_OFFER</a>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    }</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="comment">// This can probably be simplified to make sure that you cancel sequences</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="comment">// before the transaction sequence number.</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bHaveCancel &amp;&amp; (!uCancelSequence || uAccountSequenceNext - 1 &lt;= uCancelSequence))</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    {</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            <span class="stringliteral">&quot;uAccountSequenceNext=&quot;</span> &lt;&lt; uAccountSequenceNext &lt;&lt;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <span class="stringliteral">&quot; uOfferSequence=&quot;</span> &lt;&lt; uCancelSequence;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        terResult   = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a53a64dd14cce4cae9e2f063ad33faaff">temBAD_SEQUENCE</a>;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    }</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">// Cancel offer.</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a> == terResult) &amp;&amp; bHaveCancel)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="keyword">const</span> uint256   uCancelIndex = <a class="code" href="../../dd/d5f/a00825.html#abb618e1d764497e2ad646aa55c56061a">Ledger::getOfferIndex</a> (<a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>, uCancelSequence);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <a class="code" href="../../dc/d54/a01344.html#abf05184c020b05e80bdf996c9bee96eb">SLE::pointer</a>    sleCancel    = <a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#a5766d606e55b9ede4b004ff170f967cc">entryCache</a> (<a class="code" href="../../d8/dbb/a03480.html#ggaf6e0324b257fc9992b83ecf827c2a07ba8a24a7b08fcdd8a76109f80f056a176d">ltOFFER</a>, uCancelIndex);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="keywordflow">if</span> (sleCancel)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        {</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                <span class="stringliteral">&quot;uCancelSequence=&quot;</span> &lt;&lt; uCancelSequence;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            terResult   = <a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#a4d2df7ee54a081d8855771939d4e44dc">view</a> ().<a class="code" href="../../d0/d08/a00832.html#a47e828204b1fc11c80899fadd55f4c63">offerDelete</a> (sleCancel);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        }</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        {</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            <span class="comment">// It&#39;s not an error to not find the offer to cancel: it might have</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            <span class="comment">// been consumed or removed as we are processing. Additionally, it</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            <span class="comment">// might not even have been an offer - we don&#39;t care.</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a>) <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                <span class="stringliteral">&quot;offer not found: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                <a class="code" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59">RippleAddress::createHumanAccountID</a> (<a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>) &lt;&lt;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; uCancelSequence &lt;&lt;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; uCancelIndex.ToString ();</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        }</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="comment">// We definitely know the time that the parent ledger closed but we do not</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="comment">// know the closing time of the ledger under construction.</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="comment">// FIXME: Make sure that expiration is documented in terms of the close time</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="comment">//        of the previous ledger.</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordtype">bool</span> bExpired =</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        bHaveExpiration &amp;&amp;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        (<a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#ad9f745c60450a463895760958fb240e1">getLedger</a> ()-&gt;getParentCloseTimeNC () &gt;= uExpiration);</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="comment">// If all is well and this isn&#39;t an offer to XRP, then we make sure we are</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="comment">// authorized to hold what the taker will pay.</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a> == terResult &amp;&amp; !saTakerPays.isNative () &amp;&amp; !bExpired)</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    {</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <a class="code" href="../../dc/d54/a01344.html#abf05184c020b05e80bdf996c9bee96eb">SLE::pointer</a> sleTakerPays = <a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#a5766d606e55b9ede4b004ff170f967cc">entryCache</a> (</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            <a class="code" href="../../d8/dbb/a03480.html#ggaf6e0324b257fc9992b83ecf827c2a07bac03405d2da6d19e17f321a6b7f7a412e">ltACCOUNT_ROOT</a>, <a class="code" href="../../dd/d5f/a00825.html#ab0ca75e1c5fa67568377f9962687cf90">Ledger::getAccountRootIndex</a> (uPaysIssuerID));</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <span class="keywordflow">if</span> (!sleTakerPays)</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        {</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                <span class="stringliteral">&quot;delay: can&#39;t receive IOUs from non-existent issuer: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                <a class="code" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59">RippleAddress::createHumanAccountID</a> (uPaysIssuerID);</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            terResult   = <a class="code" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c">is_bit_set</a> (<a class="code" href="../../d8/df7/a01711.html#aef372af604ddaed069ff8b660cea322d">mParams</a>, <a class="code" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09ad993a03ae0b72db5c62a616b69eaccff">tapRETRY</a>) ? <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0aa7ab9460c6755719dd1a4e74b83f34c4">terNO_ACCOUNT</a> : <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a33d363e51ee15c8bd4f5d7c4e4518def">tecNO_ISSUER</a>;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        }</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c">is_bit_set</a> (sleTakerPays-&gt;getFieldU32 (sfFlags), <a class="code" href="../../d8/dbb/a03480.html#gga4a9c7b33fef9015d6406302ef80b63c5a44c3bc643086a0beb87e3aaeb544e6ad">lsfRequireAuth</a>))</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            <a class="code" href="../../dc/d54/a01344.html#abf05184c020b05e80bdf996c9bee96eb">SLE::pointer</a> sleRippleState (<a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#a5766d606e55b9ede4b004ff170f967cc">entryCache</a> (</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                <a class="code" href="../../d8/dbb/a03480.html#ggaf6e0324b257fc9992b83ecf827c2a07ba0dca36851b869200981387f3b9f5cdee">ltRIPPLE_STATE</a>,</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                <a class="code" href="../../dd/d5f/a00825.html#a5fd86d78b17725e35684e77543e538d2">Ledger::getRippleStateIndex</a> (</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                    <a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>, uPaysIssuerID, uPaysCurrency)));</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            <span class="comment">// Entries have a canonical representation, determined by a</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            <span class="comment">// lexicographical &quot;greater than&quot; comparison employing strict weak</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            <span class="comment">// ordering.</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            <span class="comment">// Determine which entry we need to access.</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            <span class="keywordtype">bool</span> <span class="keyword">const</span> canonical_gt (<a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a> &gt; uPaysIssuerID);</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            <span class="keywordflow">if</span> (!sleRippleState)</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                terResult   = <a class="code" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c">is_bit_set</a> (<a class="code" href="../../d8/df7/a01711.html#aef372af604ddaed069ff8b660cea322d">mParams</a>, <a class="code" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09ad993a03ae0b72db5c62a616b69eaccff">tapRETRY</a>)</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                    ? <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0ae9a023686bac48d78ee1d9d7aaa95b5f">terNO_LINE</a></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                    : <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0ac480d742e7760c48047bb3ccc50a40ef">tecNO_LINE</a>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            }</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c">is_bit_set</a> (sleRippleState-&gt;getFieldU32 (sfFlags), (canonical_gt ? <a class="code" href="../../d8/dbb/a03480.html#gga4a9c7b33fef9015d6406302ef80b63c5ae6db21adf463a223e362b44f0fd54663">lsfHighAuth</a> : <a class="code" href="../../d8/dbb/a03480.html#gga4a9c7b33fef9015d6406302ef80b63c5af37617abe9ad741cd823746961f1fb3a">lsfLowAuth</a>)))</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            {</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                    <span class="stringliteral">&quot;delay: can&#39;t receive IOUs from issuer without auth.&quot;</span>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                terResult   = <a class="code" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c">is_bit_set</a> (<a class="code" href="../../d8/df7/a01711.html#aef372af604ddaed069ff8b660cea322d">mParams</a>, <a class="code" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09ad993a03ae0b72db5c62a616b69eaccff">tapRETRY</a>) ? <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0accec22dfce11ac7d31150921b257ee80">terNO_AUTH</a> : <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0af5820ac855eaa9dfcd635cd411019a31">tecNO_AUTH</a>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            }</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        }</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    STAmount        saPaid;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    STAmount        saGot;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordtype">bool</span>            bUnfunded   = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span>      bOpenLedger = <a class="code" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c">is_bit_set</a> (<a class="code" href="../../d8/df7/a01711.html#aef372af604ddaed069ff8b660cea322d">mParams</a>, <a class="code" href="../../d9/d9d/a03417.html#ae2a321a3f2099e098fdcc670a60c7a09ab3ffb3bd2975db520632d6f5f42606e1">tapOPEN_LEDGER</a>);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a> == terResult) &amp;&amp; !bExpired)</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <span class="keyword">const</span> uint256   uTakeBookBase   = <a class="code" href="../../dd/d5f/a00825.html#a75205d48fe6ecf924cfed352ce21fa0a">Ledger::getBookBase</a> (</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            uGetsCurrency, uGetsIssuerID, uPaysCurrency, uPaysIssuerID);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a>) <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            <span class="stringliteral">&quot;take against book:&quot;</span> &lt;&lt; uTakeBookBase.ToString () &lt;&lt;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            <span class="stringliteral">&quot; for &quot;</span> &lt;&lt; saTakerGets.getFullText () &lt;&lt;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; saTakerPays.getFullText ();</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="comment">// Take using the parameters of the offer.</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a>) <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            <span class="stringliteral">&quot;takeOffers: BEFORE saTakerGets=&quot;</span> &lt;&lt; saTakerGets.getFullText ();</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        terResult   = <a class="code" href="../../d5/de7/a01048.html#aad751b1698cdcc386c9e90e86d2e11b1">takeOffers</a> (</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                          bOpenLedger,</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                          bPassive,</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                          bSell,</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                          uTakeBookBase,</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                          <a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>,</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                          sleCreator,</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                          saTakerGets,    <span class="comment">// Reverse as we are the taker for taking.</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                          saTakerPays,</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                          saPaid,         <span class="comment">// Buy semantics: how much would have sold at full price. Sell semantics: how much was sold.</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                          saGot,          <span class="comment">// How much was got.</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                          bUnfunded);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a>)</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        {</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt; <span class="stringliteral">&quot;takeOffers=&quot;</span> &lt;&lt; terResult;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt; <span class="stringliteral">&quot;takeOffers: saPaid=&quot;</span> &lt;&lt; saPaid.getFullText ();</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt; <span class="stringliteral">&quot;takeOffers:  saGot=&quot;</span> &lt;&lt; saGot.getFullText ();</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        }</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a> == terResult &amp;&amp; !bUnfunded)</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        {</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            <span class="comment">// Reduce pay in from takers by what offer just got.</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            saTakerPays -= saGot;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            <span class="comment">// Reduce pay out to takers by what srcAccount just paid.</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            saTakerGets -= saPaid;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a>)</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            {</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                    <span class="stringliteral">&quot;takeOffers: AFTER saTakerPays=&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                    saTakerPays.getFullText ();</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                    <span class="stringliteral">&quot;takeOffers: AFTER saTakerGets=&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                    saTakerGets.getFullText ();</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            }</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        }</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    }</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a>)</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            <span class="stringliteral">&quot;takeOffers: saTakerPays=&quot;</span> &lt;&lt;saTakerPays.getFullText ();</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            <span class="stringliteral">&quot;takeOffers: saTakerGets=&quot;</span> &lt;&lt; saTakerGets.getFullText ();</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            <span class="stringliteral">&quot;takeOffers: mTxnAccountID=&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            <a class="code" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59">RippleAddress::createHumanAccountID</a> (<a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            <span class="stringliteral">&quot;takeOffers:         FUNDS=&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            lesActive.accountFunds (<a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>, saTakerGets).getFullText ();</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a> != terResult)</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="comment">// Fail as is.</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <a class="code" href="../../d0/d75/a03105.html#afc5c6ba8fe8a6402e1f14c610c2bf146">nothing</a> ();</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    }</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bExpired)</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    {</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <span class="comment">// nothing to do</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <a class="code" href="../../d0/d75/a03105.html#afc5c6ba8fe8a6402e1f14c610c2bf146">nothing</a> ();</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (saTakerPays &lt; zero || saTakerGets &lt; zero)</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    {</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <span class="comment">// If ledger is not final, can vote no.</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="comment">// When we are processing an open ledger, failures are local and we charge no fee;</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="comment">// otherwise we must claim a fee (even if they do nothing else due to an error)</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <span class="comment">// to prevent a DoS.</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        terResult   = bOpenLedger ? <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a453d7db3d36a5516e925c466d1dc0ac1">telFAILED_PROCESSING</a> : <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0aecd11145ac07375d1c0793e699932969">tecFAILED_PROCESSING</a>;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    }</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bFillOrKill &amp;&amp; (saTakerPays || saTakerGets))</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    {</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        <span class="comment">// Fill or kill and have leftovers.</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        lesActive.swapWith (lesCheckpoint); <span class="comment">// Restore with just fees paid.</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    }</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        saTakerPays &lt;= zero                                             <span class="comment">// Wants nothing more.</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        || saTakerGets &lt;= zero                                          <span class="comment">// Offering nothing more.</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        || bImmediateOrCancel                                           <span class="comment">// Do not persist.</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        || lesActive.accountFunds (<a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>, saTakerGets) &lt;= zero  <span class="comment">// Not funded.</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        || bUnfunded)                                                   <span class="comment">// Consider unfunded.</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    {</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        <span class="comment">// Complete as is.</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <a class="code" href="../../d0/d75/a03105.html#afc5c6ba8fe8a6402e1f14c610c2bf146">nothing</a> ();</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    }</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a3dd217bcdc20be801bd8bd1effa47b02">mPriorBalance</a>.<a class="code" href="../../d2/d41/a01493.html#ae3870bf43687a085235279f483e0e731">getNValue</a> () &lt; <a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#ad9f745c60450a463895760958fb240e1">getLedger</a> ()-&gt;getReserve (sleCreator-&gt;getFieldU32 (sfOwnerCount) + 1))</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    {</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="comment">// If we are here, the signing account had an insufficient reserve</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        <span class="comment">// *prior* to our processing. We use the prior balance to simplify</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="comment">// client writing and make the user experience better.</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keywordflow">if</span> (bOpenLedger) <span class="comment">// Ledger is not final, can vote no.</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        {</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            <span class="comment">// Hope for more reserve to come in or more offers to consume. If we</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            <span class="comment">// specified a local error this transaction will not be retried, so</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            <span class="comment">// specify a tec to distribute the transaction and allow it to be</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;            <span class="comment">// retried. In particular, it may have been was successful to a</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            <span class="comment">// degree (partially filled) and if it hasn&#39;t, it might succeed.</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;            terResult   = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a30792765079d182f869612fc3b96ef8c">tecINSUF_RESERVE_OFFER</a>;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        }</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!saPaid &amp;&amp; !saGot)</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        {</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            <span class="comment">// Ledger is final, insufficent reserve to create offer, processed</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            <span class="comment">// nothing.</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            terResult   = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a30792765079d182f869612fc3b96ef8c">tecINSUF_RESERVE_OFFER</a>;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        }</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        {</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;            <span class="comment">// Ledger is final, insufficent reserve to create offer, processed</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;            <span class="comment">// something.</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            <span class="comment">// Consider the offer unfunded. Treat as tesSUCCESS.</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;            <a class="code" href="../../d0/d75/a03105.html#afc5c6ba8fe8a6402e1f14c610c2bf146">nothing</a> ();</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        }</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    }</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    {</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="comment">// We need to place the remainder of the offer into its order book.</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a>) <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            <span class="stringliteral">&quot;offer not fully consumed:&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <span class="stringliteral">&quot; saTakerPays=&quot;</span> &lt;&lt; saTakerPays.getFullText () &lt;&lt;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <span class="stringliteral">&quot; saTakerGets=&quot;</span> &lt;&lt; saTakerGets.getFullText ();</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        <span class="comment">// Add offer to owner&#39;s directory.</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        terResult   = lesActive.dirAdd (uOwnerNode,</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            <a class="code" href="../../dd/d5f/a00825.html#af9e2fc76175c63a6695eb9fac39c1888">Ledger::getOwnerDirIndex</a> (<a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>), uLedgerIndex,</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            <a class="code" href="../../d0/d75/a03105.html#a6c0c867ff5909fab21adb4d253d4bcc5">BIND_TYPE</a> (&amp;<a class="code" href="../../dd/d5f/a00825.html#aca09ad3ce73422292e04fd690ad45521">Ledger::ownerDirDescriber</a>, <a class="code" href="../../d0/d75/a03105.html#af188598d0d6f186e4b5b0ec4b8da5be1">P_1</a>, <a class="code" href="../../d0/d75/a03105.html#abb9cce698fe6446abdf9d14a5e34dd55">P_2</a>, <a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>));</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a> == terResult)</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        {</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            <span class="comment">// Update owner count.</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            lesActive.ownerCountAdjust (<a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>, 1, sleCreator);</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            uint256 uBookBase   = <a class="code" href="../../dd/d5f/a00825.html#a75205d48fe6ecf924cfed352ce21fa0a">Ledger::getBookBase</a> (</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                uPaysCurrency,</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                uPaysIssuerID,</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                uGetsCurrency,</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                uGetsIssuerID);</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a>) <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                <span class="stringliteral">&quot;adding to book: &quot;</span> &lt;&lt; uBookBase.ToString () &lt;&lt;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; saTakerPays.getHumanCurrency () &lt;&lt;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; <a class="code" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59">RippleAddress::createHumanAccountID</a> (saTakerPays.getIssuer ()) &lt;&lt;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; saTakerGets.getHumanCurrency () &lt;&lt;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; <a class="code" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59">RippleAddress::createHumanAccountID</a> (saTakerGets.getIssuer ());</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            uDirectory  = <a class="code" href="../../dd/d5f/a00825.html#a320888896e14c9ac9a91da0b113cad1a">Ledger::getQualityIndex</a> (uBookBase, uRate);   <span class="comment">// Use original rate.</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            <span class="comment">// Add offer to order book.</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            terResult   = lesActive.dirAdd (uBookNode, uDirectory, uLedgerIndex,</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                <a class="code" href="../../d0/d75/a03105.html#a6c0c867ff5909fab21adb4d253d4bcc5">BIND_TYPE</a> (&amp;<a class="code" href="../../dd/d5f/a00825.html#aadc914d1816ab8a6f5fe38ccb891fce8">Ledger::qualityDirDescriber</a>, <a class="code" href="../../d0/d75/a03105.html#af188598d0d6f186e4b5b0ec4b8da5be1">P_1</a>, <a class="code" href="../../d0/d75/a03105.html#abb9cce698fe6446abdf9d14a5e34dd55">P_2</a>,</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                    saTakerPays.getCurrency (), uPaysIssuerID,</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                    saTakerGets.getCurrency (), uGetsIssuerID, uRate));</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        }</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a> == terResult)</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        {</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a>)</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            {</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                    <span class="stringliteral">&quot;sfAccount=&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                    <a class="code" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59">RippleAddress::createHumanAccountID</a> (<a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                    <span class="stringliteral">&quot;uPaysIssuerID=&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                    <a class="code" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59">RippleAddress::createHumanAccountID</a> (uPaysIssuerID);</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                    <span class="stringliteral">&quot;uGetsIssuerID=&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                    <a class="code" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59">RippleAddress::createHumanAccountID</a> (uGetsIssuerID);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                    <span class="stringliteral">&quot;saTakerPays.isNative()=&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                    saTakerPays.isNative ();</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                    <span class="stringliteral">&quot;saTakerGets.isNative()=&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                    saTakerGets.isNative ();</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                    <span class="stringliteral">&quot;uPaysCurrency=&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                    saTakerPays.getHumanCurrency ();</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                    <span class="stringliteral">&quot;uGetsCurrency=&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                    saTakerGets.getHumanCurrency ();</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            }</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;            <a class="code" href="../../dc/d54/a01344.html#abf05184c020b05e80bdf996c9bee96eb">SLE::pointer</a> sleOffer (<a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#a8d361a71b2a03803cd82a9c1ebe5ba21">entryCreate</a> (<a class="code" href="../../d8/dbb/a03480.html#ggaf6e0324b257fc9992b83ecf827c2a07ba8a24a7b08fcdd8a76109f80f056a176d">ltOFFER</a>, uLedgerIndex));</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            sleOffer-&gt;setFieldAccount (sfAccount, <a class="code" href="../../d8/df7/a01711.html#a641d7466f1b1abee1cdd77f3777d06fc">mTxnAccountID</a>);</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;            sleOffer-&gt;setFieldU32 (sfSequence, uSequence);</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;            sleOffer-&gt;setFieldH256 (sfBookDirectory, uDirectory);</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;            sleOffer-&gt;setFieldAmount (sfTakerPays, saTakerPays);</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;            sleOffer-&gt;setFieldAmount (sfTakerGets, saTakerGets);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;            sleOffer-&gt;setFieldU64 (sfOwnerNode, uOwnerNode);</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;            sleOffer-&gt;setFieldU64 (sfBookNode, uBookNode);</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;            <span class="keywordflow">if</span> (uExpiration)</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                sleOffer-&gt;setFieldU32 (sfExpiration, uExpiration);</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            <span class="keywordflow">if</span> (bPassive)</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                sleOffer-&gt;setFlag (<a class="code" href="../../d8/dbb/a03480.html#gga4a9c7b33fef9015d6406302ef80b63c5af5bb4ed279c86f7c4ddfe0b2ed89af00">lsfPassive</a>);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;            <span class="keywordflow">if</span> (bSell)</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                sleOffer-&gt;setFlag (<a class="code" href="../../d8/dbb/a03480.html#gga4a9c7b33fef9015d6406302ef80b63c5ab4f5e24467c127ce07228288a7b54760">lsfSell</a>);</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a>) <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;                <span class="stringliteral">&quot;final terResult=&quot;</span> &lt;&lt; <a class="code" href="../../d9/d9d/a03417.html#a14963d35eeab76c974e033beb7fdddb0">transToken</a> (terResult) &lt;&lt;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;                <span class="stringliteral">&quot; sleOffer=&quot;</span> &lt;&lt; sleOffer-&gt;getJson (0);</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        }</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    }</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="comment">// On storing meta data, delete offers that were found unfunded to prevent</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="comment">// encountering them in future.</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a> == terResult)</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    {</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        <span class="comment">// Go through the list of unfunded offers and remove them</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; uOfferIndex : <a class="code" href="../../d5/de7/a01048.html#a885648ff4433731d715b63ef66b31767">usOfferUnfundedFound</a>)</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        {</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                <span class="stringliteral">&quot;takeOffers: found unfunded: &quot;</span> &lt;&lt; uOfferIndex.ToString ();</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            lesActive.offerDelete (uOfferIndex);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        }</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;        <span class="comment">// Go through the list of offers not found and remove them from the</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        <span class="comment">// order book.</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        <span class="comment">// DAVIDSCHWARTZ - is this a fix to remove corrupted entries?</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; indexes : <a class="code" href="../../d5/de7/a01048.html#aeb9adbe1d187e768d4c53ae98dc4aad4">usMissingOffers</a>)</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        {</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            <a class="code" href="../../dc/d54/a01344.html#abf05184c020b05e80bdf996c9bee96eb">SLE::pointer</a> sleDirectory (</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                lesActive.entryCache (<a class="code" href="../../d8/dbb/a03480.html#ggaf6e0324b257fc9992b83ecf827c2a07ba1ca6f5da9e86f814af3d6f8b3631ebe8">ltDIR_NODE</a>, indexes.second));</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            <span class="keywordflow">if</span> (sleDirectory)</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;            {</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                STVector256 svIndexes = sleDirectory-&gt;getFieldV256 (sfIndexes);</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                std::vector&lt;uint256&gt;&amp; vuiIndexes = svIndexes.peekValue();</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                <span class="keyword">auto</span> it = std::find (</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                    vuiIndexes.begin (), vuiIndexes.end (), indexes.first);</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                <span class="keywordflow">if</span> (it != vuiIndexes.end ())</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                {</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                    vuiIndexes.erase (it);</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                    sleDirectory-&gt;setFieldV256 (sfIndexes, svIndexes);</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                    lesActive.entryModify (sleDirectory);</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                    <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                        <span class="stringliteral">&quot;takeOffers: offer &quot;</span> &lt;&lt; indexes.first &lt;&lt;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                        <span class="stringliteral">&quot; removed from directory &quot;</span> &lt;&lt; indexes.second;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                }</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                {</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                    <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                        <span class="stringliteral">&quot;takeOffers: offer &quot;</span> &lt;&lt; indexes.first &lt;&lt;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                        <span class="stringliteral">&quot; not found in directory &quot;</span> &lt;&lt; indexes.second;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                }</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;            }</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;            {</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                    <span class="stringliteral">&quot;takeOffers: directory &quot;</span> &lt;&lt; indexes.second &lt;&lt;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                    <span class="stringliteral">&quot; not found for offer &quot;</span> &lt;&lt; indexes.first;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        }</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    }</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a> != terResult) <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        <span class="stringliteral">&quot;final terResult=&quot;</span> &lt;&lt; <a class="code" href="../../d9/d9d/a03417.html#a14963d35eeab76c974e033beb7fdddb0">transToken</a> (terResult);</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="keywordflow">return</span> terResult;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d5/de7/a01048_a54a40cf030c21f9b4796330011e5eca8_cgraph.png" border="0" usemap="#d5/de7/a01048_a54a40cf030c21f9b4796330011e5eca8_cgraph" alt=""/></div>
<map name="d5/de7/a01048_a54a40cf030c21f9b4796330011e5eca8_cgraph" id="d5/de7/a01048_a54a40cf030c21f9b4796330011e5eca8_cgraph">
<area shape="rect" id="node3" href="../../d0/d08/a00832.html#ae736ed965650c098f9d572bc157b00c0" title="ripple::LedgerEntrySet\l::accountFunds" alt="" coords="511,297,660,343"/><area shape="rect" id="node7" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59" title="ripple::RippleAddress\l::createHumanAccountID" alt="" coords="1237,541,1408,587"/><area shape="rect" id="node13" href="../../d0/d08/a00832.html#ad13594cf847a6c56ef479ee44ae3c329" title="ripple::LedgerEntrySet\l::entryCache" alt="" coords="1005,819,1155,866"/><area shape="rect" id="node15" href="../../dd/d5f/a00825.html#ab0ca75e1c5fa67568377f9962687cf90" title="ripple::Ledger::getAccount\lRootIndex" alt="" coords="993,1326,1167,1373"/><area shape="rect" id="node23" href="../../d2/d41/a01493.html#acacb1c47b480b33d3d7fd6cd0d63cbed" title="ripple::STAmount::getFullText" alt="" coords="983,301,1177,331"/><area shape="rect" id="node25" href="../../d2/d41/a01493.html#a0f7eda3369139764c0dd4c6dc806a9d7" title="ripple::STAmount::getHuman\lCurrency" alt="" coords="1228,138,1417,185"/><area shape="rect" id="node29" href="../../d2/d41/a01493.html#a61429db7fed5872fca90d726f3088325" title="ripple::STAmount::getCurrency" alt="" coords="731,405,933,435"/><area shape="rect" id="node32" href="../../d2/d41/a01493.html#ac88b3e8c68c4fbda4e493471be3f074c" title="ripple::STAmount::getIssuer" alt="" coords="740,247,924,276"/><area shape="rect" id="node34" href="../../d2/d41/a01493.html#af327650875d5657bc9999fac9751a0eb" title="ripple::STAmount::isNative" alt="" coords="743,193,921,223"/><area shape="rect" id="node36" href="../../d0/d08/a00832.html#a4dd8c4302dca994ccb88d4e17a78a395" title="ripple::LedgerEntrySet\l::bumpSeq" alt="" coords="268,1851,417,1898"/><area shape="rect" id="node39" href="../../d0/d08/a00832.html#a10d4393cdc1b75dd4aca38add0ea1dad" title="ripple::LedgerEntrySet\l::dirAdd" alt="" coords="268,1662,417,1709"/><area shape="rect" id="node44" href="../../d0/d08/a00832.html#a566a4d723aabbf98f55afc88f9159b18" title="ripple::LedgerEntrySet\l::entryModify" alt="" coords="511,1611,660,1658"/><area shape="rect" id="node50" href="../../db/d51/a01603.html#ac1d1c102b952d362e77c419487110ec2" title="ripple::STVector256\l::peekValue" alt="" coords="517,1905,653,1951"/><area shape="rect" id="node54" href="../../d7/d9a/a00152.html#ad19bda12f3725584ac179f2e091e30d7" title="ripple::base_uint::\lToString" alt="" coords="523,966,648,1013"/><area shape="rect" id="node56" href="../../d9/dc5/a01705.html#a5766d606e55b9ede4b004ff170f967cc" title="ripple::TransactionEngine\l::entryCache" alt="" coords="748,850,916,897"/><area shape="rect" id="node60" href="../../d9/dc5/a01705.html#a8d361a71b2a03803cd82a9c1ebe5ba21" title="ripple::TransactionEngine\l::entryCreate" alt="" coords="259,1731,427,1778"/><area shape="rect" id="node65" href="../../dd/d5f/a00825.html#a75205d48fe6ecf924cfed352ce21fa0a" title="ripple::Ledger::getBookBase" alt="" coords="249,1136,436,1165"/><area shape="rect" id="node70" href="../../dd/d5f/a00825.html#a320888896e14c9ac9a91da0b113cad1a" title="ripple::Ledger::getQuality\lIndex" alt="" coords="503,1238,668,1285"/><area shape="rect" id="node75" href="../../de/d1a/a01559.html#aad5f49acb4c7b95cabee5d8463d4ce4a" title="ripple::STObject::getField\lAmount" alt="" coords="257,1921,428,1967"/><area shape="rect" id="node77" href="../../de/d1a/a01559.html#ab3e8074cfab6e1c525b2d9a474c60f23" title="ripple::STObject::getFieldU32" alt="" coords="488,2019,683,2048"/><area shape="rect" id="node79" href="../../de/d1a/a01559.html#a69de0d6b35d375f05afb08982ce8b7ee" title="ripple::STObject::getFlags" alt="" coords="256,2111,429,2140"/><area shape="rect" id="node84" href="../../d9/de4/a01346.html#a436d1b0b2d422540cd39c117f5f6816d" title="ripple::SerializedTransaction\l::getJson" alt="" coords="249,2163,436,2210"/><area shape="rect" id="node86" href="../../d9/dc5/a01705.html#ad9f745c60450a463895760958fb240e1" title="ripple::TransactionEngine\l::getLedger" alt="" coords="259,2233,427,2279"/><area shape="rect" id="node88" href="../../d2/d41/a01493.html#ae3870bf43687a085235279f483e0e731" title="ripple::STAmount::getNValue" alt="" coords="247,2303,439,2332"/><area shape="rect" id="node90" href="../../dd/d5f/a00825.html#abb618e1d764497e2ad646aa55c56061a" title="ripple::Ledger::getOffer\lIndex" alt="" coords="1003,1395,1157,1442"/><area shape="rect" id="node95" href="../../dd/d5f/a00825.html#af9e2fc76175c63a6695eb9fac39c1888" title="ripple::Ledger::getOwner\lDirIndex" alt="" coords="999,1257,1161,1303"/><area shape="rect" id="node101" href="../../d2/d41/a01493.html#ad04578f94f5fcc11e1086f59c9afe238" title="ripple::STAmount::getRate" alt="" coords="497,639,673,668"/><area shape="rect" id="node103" href="../../dd/d5f/a00825.html#a5fd86d78b17725e35684e77543e538d2" title="ripple::Ledger::getRipple\lStateIndex" alt="" coords="999,1187,1161,1234"/><area shape="rect" id="node108" href="../../d9/de4/a01346.html#aaff9c0480235e2b982777311a9e5f7fd" title="ripple::SerializedTransaction\l::getSequence" alt="" coords="249,2041,436,2087"/><area shape="rect" id="node111" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c" title="ripple::is_bit_set" alt="" coords="284,2356,401,2385"/><area shape="rect" id="node113" href="../../de/d1a/a01559.html#a6f0b6f41c14e975d5fc91f00b0bcbc87" title="ripple::STObject::isField\lPresent" alt="" coords="261,2409,424,2455"/><area shape="rect" id="node115" href="../../d2/d41/a01493.html#a06886e194d8fa93f2dc848c84f2876e7" title="ripple::STAmount::isLegalNet" alt="" coords="247,2479,439,2508"/><area shape="rect" id="node118" href="../../d0/d08/a00832.html#a47e828204b1fc11c80899fadd55f4c63" title="ripple::LedgerEntrySet\l::offerDelete" alt="" coords="511,569,660,615"/><area shape="rect" id="node121" href="../../d0/d08/a00832.html#ad74df15d6d95eec5eb5a76b68867fca7" title="ripple::LedgerEntrySet\l::ownerCountAdjust" alt="" coords="268,1491,417,1538"/><area shape="rect" id="node126" href="../../dd/d5f/a00825.html#aca09ad3ce73422292e04fd690ad45521" title="ripple::Ledger::ownerDir\lDescriber" alt="" coords="263,2531,423,2578"/><area shape="rect" id="node129" href="../../dd/d5f/a00825.html#aadc914d1816ab8a6f5fe38ccb891fce8" title="ripple::Ledger::qualityDir\lDescriber" alt="" coords="261,2601,424,2647"/><area shape="rect" id="node131" href="../../d0/d08/a00832.html#aa62d1ee0b07890ca743f3b5404cc86ba" title="ripple::LedgerEntrySet\l::swapWith" alt="" coords="268,2670,417,2717"/><area shape="rect" id="node133" href="../../d5/de7/a01048.html#aad751b1698cdcc386c9e90e86d2e11b1" title="ripple::OfferCreateTransactor\l::takeOffers" alt="" coords="248,514,437,561"/><area shape="rect" id="node136" href="../../d9/dc5/a01705.html#a4d2df7ee54a081d8855771939d4e44dc" title="ripple::TransactionEngine\l::view" alt="" coords="501,691,669,738"/><area shape="rect" id="node145" href="../../d9/d9d/a03417.html#a14963d35eeab76c974e033beb7fdddb0" title="ripple::transToken" alt="" coords="523,761,648,791"/><area shape="rect" id="node5" href="../../d0/d08/a00832.html#ae4e35f7f501fdd92b8f488ce1237ab83" title="ripple::LedgerEntrySet\l::accountHolds" alt="" coords="757,509,907,555"/><area shape="rect" id="node9" href="../../d4/d0e/a01272.html#a4d666ed35a56048234a86e53d129ad66" title="ripple::RippleAddress\l::createAccountID" alt="" coords="1467,506,1613,553"/><area shape="rect" id="node11" href="../../d4/d0e/a01272.html#a2a8201537b6969c0e186c9b1d889c52b" title="ripple::RippleAddress\l::humanAccountID" alt="" coords="1467,575,1613,622"/><area shape="rect" id="node17" href="../../da/d61/a01350.html#a10b908daaabf22ae052bfc7fd221157c" title="ripple::Serializer\l::add16" alt="" coords="1265,1395,1380,1442"/><area shape="rect" id="node19" href="../../da/d61/a01350.html#a509771bf1109949d4bee7b71aecc3757" title="ripple::Serializer\l::add160" alt="" coords="1265,1257,1380,1303"/><area shape="rect" id="node21" href="../../da/d61/a01350.html#afc7187fd3c9e185d29a0ecf5500d0cdf" title="ripple::Serializer\l::getSHA512Half" alt="" coords="1263,1326,1383,1373"/><area shape="rect" id="node42" href="../../d0/d08/a00832.html#a244ab2612caabab2e499f7ed3a12895c" title="ripple::LedgerEntrySet\l::entryCreate" alt="" coords="511,1835,660,1882"/><area shape="rect" id="node46" href="../../dd/d5f/a00825.html#a0d50fe89b5f50adf3cea06fdb94a03b5" title="ripple::Ledger::getDirNode\lIndex" alt="" coords="993,1465,1167,1511"/><area shape="rect" id="node52" href="../../d9/d9d/a03417.html#a138db8803faea25db74891325f6b0073" title="ripple::strHex" alt="" coords="536,1783,635,1812"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8305e465720135a1649d5afad82d97f4"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static std::string ripple::OfferCreateTransactor::get_compare_sign </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d3/dbb/a02004.html#ad24d0de3f597ca60dd95c4bc59c2ff73">T</a> const &amp;&#160;</td>
          <td class="paramname"><em>lhs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/dbb/a02004.html#ad24d0de3f597ca60dd95c4bc59c2ff73">T</a> const &amp;&#160;</td>
          <td class="paramname"><em>rhs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/d8c/a03049_source.html#l00042">42</a> of file <a class="el" href="../../d7/d8c/a03049_source.html">OfferCreateTransactor.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../da/d6b/a02352.html#a1632a2b0ef4f78b5e49dce83d8daad2a">lhs</a> &gt; rhs)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;&gt;&quot;</span>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordflow">if</span> (rhs &gt; <a class="code" href="../../da/d6b/a02352.html#a1632a2b0ef4f78b5e49dce83d8daad2a">lhs</a>)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;&quot;</span>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="comment">// If neither is bigger than the other, they must be equal</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;=&quot;</span>;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad23ce85477cc840bf3d7a8210a31d1d9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ripple::OfferCreateTransactor::isValidOffer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d54/a01344.html#ac44431ef1b5e53a01fca8eb46673c519">SLE::ref</a>&#160;</td>
          <td class="paramname"><em>sleOffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d2e/a01737.html">uint160</a> const &amp;&#160;</td>
          <td class="paramname"><em>uOfferOwnerID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;&#160;</td>
          <td class="paramname"><em>saOfferPays</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;&#160;</td>
          <td class="paramname"><em>saOfferGets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d2e/a01737.html">uint160</a> const &amp;&#160;</td>
          <td class="paramname"><em>uTakerAccountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unordered_set&lt; <a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <a class="el" href="../../d4/dc4/a00617.html">beast::hardened_hash</a>&lt; <a class="el" href="../../d0/d4e/a01741.html">uint256</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>usOfferUnfundedBecame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unordered_set&lt; <a class="el" href="../../df/d2e/a01737.html">uint160</a>, <a class="el" href="../../d4/dc4/a00617.html">beast::hardened_hash</a>&lt; <a class="el" href="../../df/d2e/a01737.html">uint160</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>usAccountTouched</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saOfferFunds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Determine if an order is still valid If the order is not valid it will be marked as unfunded. </p>

<p>Definition at line <a class="el" href="../../dc/d92/a03048_source.html#l00025">25</a> of file <a class="el" href="../../dc/d92/a03048_source.html">OfferCreateTransactor.cpp</a>.</p>

<p>References <a class="el" href="../../d4/db9/a02918_source.html#l01323">ripple::LedgerEntrySet::accountFunds()</a>, <a class="el" href="../../dd/d07/a02132_source.html#l00244">beast::Journal::debug</a>, <a class="el" href="../../da/dd3/a03198_source.html#l01090">ripple::STAmount::getFullText()</a>, <a class="el" href="../../da/d5d/a03068_source.html#l00077">ripple::TransactionEngine::getLedger()</a>, <a class="el" href="../../df/d0c/a03055_source.html#l00049">ripple::Transactor::m_journal</a>, <a class="el" href="../../df/d0c/a03055_source.html#l00037">ripple::Transactor::mEngine</a>, <a class="el" href="../../dd/d07/a02132_source.html#l00243">beast::Journal::trace</a>, <a class="el" href="../../d7/d8c/a03049_source.html#l00115">usOfferUnfundedFound</a>, <a class="el" href="../../da/d5d/a03068_source.html#l00073">ripple::TransactionEngine::view()</a>, and <a class="el" href="../../dd/d07/a02132_source.html#l00246">beast::Journal::warning</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d92/a03048_source.html#l00330">takeOffers()</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">if</span> (sleOffer-&gt;isFieldPresent (sfExpiration) &amp;&amp;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        sleOffer-&gt;getFieldU32 (sfExpiration) &lt;= <a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#ad9f745c60450a463895760958fb240e1">getLedger</a> ()-&gt;getParentCloseTimeNC ())</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="comment">// Offer is expired. Expired offers are considered unfunded. Delete it.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt; <span class="stringliteral">&quot;isValidOffer: encountered expired offer&quot;</span>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <a class="code" href="../../d5/de7/a01048.html#a885648ff4433731d715b63ef66b31767">usOfferUnfundedFound</a>.insert (sleOffer-&gt;getIndex());</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">if</span> (uOfferOwnerID == uTakerAccountID)</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="comment">// Would take own offer. Consider old offer expired. Delete it.</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt; <span class="stringliteral">&quot;isValidOffer: encountered taker&#39;s own old offer&quot;</span>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <a class="code" href="../../d5/de7/a01048.html#a885648ff4433731d715b63ef66b31767">usOfferUnfundedFound</a>.insert (sleOffer-&gt;getIndex());</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    }</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">if</span> (saOfferGets &lt;= zero || saOfferPays &lt;= zero)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="comment">// Offer has bad amounts. Consider offer expired. Delete it.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt; <span class="stringliteral">&quot;isValidOffer: BAD OFFER:&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            <span class="stringliteral">&quot; saOfferPays=&quot;</span> &lt;&lt; saOfferPays &lt;&lt;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            <span class="stringliteral">&quot; saOfferGets=&quot;</span> &lt;&lt; saOfferGets;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <a class="code" href="../../d5/de7/a01048.html#a885648ff4433731d715b63ef66b31767">usOfferUnfundedFound</a>.insert (sleOffer-&gt;getIndex());</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="stringliteral">&quot;isValidOffer: saOfferPays=&quot;</span> &lt;&lt; saOfferPays.getFullText ();</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    saOfferFunds = <a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#a4d2df7ee54a081d8855771939d4e44dc">view</a> ().<a class="code" href="../../d0/d08/a00832.html#ae736ed965650c098f9d572bc157b00c0">accountFunds</a> (uOfferOwnerID, saOfferPays);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">if</span> (saOfferFunds &lt;= zero)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="comment">// Offer is unfunded, possibly due to previous balance action.</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt; <span class="stringliteral">&quot;isValidOffer: offer unfunded: delete&quot;</span>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keyword">auto</span> account = usAccountTouched.find (uOfferOwnerID);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">if</span> (account != usAccountTouched.end ())</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            <span class="comment">// Previously touched account. Delete unfunded offer on success</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            usOfferUnfundedBecame.insert (sleOffer-&gt;getIndex());</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="comment">// Never touched source account.  Delete found unfunded offer</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="comment">// when possible.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <a class="code" href="../../d5/de7/a01048.html#a885648ff4433731d715b63ef66b31767">usOfferUnfundedFound</a>.insert (sleOffer-&gt;getIndex());</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d5/de7/a01048_ad23ce85477cc840bf3d7a8210a31d1d9_cgraph.png" border="0" usemap="#d5/de7/a01048_ad23ce85477cc840bf3d7a8210a31d1d9_cgraph" alt=""/></div>
<map name="d5/de7/a01048_ad23ce85477cc840bf3d7a8210a31d1d9_cgraph" id="d5/de7/a01048_ad23ce85477cc840bf3d7a8210a31d1d9_cgraph">
<area shape="rect" id="node3" href="../../d0/d08/a00832.html#ae736ed965650c098f9d572bc157b00c0" title="ripple::LedgerEntrySet\l::accountFunds" alt="" coords="256,418,405,465"/><area shape="rect" id="node62" href="../../d2/d41/a01493.html#acacb1c47b480b33d3d7fd6cd0d63cbed" title="ripple::STAmount::getFullText" alt="" coords="716,247,911,276"/><area shape="rect" id="node113" href="../../d9/dc5/a01705.html#ad9f745c60450a463895760958fb240e1" title="ripple::TransactionEngine\l::getLedger" alt="" coords="247,487,415,534"/><area shape="rect" id="node115" href="../../d9/dc5/a01705.html#a4d2df7ee54a081d8855771939d4e44dc" title="ripple::TransactionEngine\l::view" alt="" coords="247,557,415,603"/><area shape="rect" id="node5" href="../../d0/d08/a00832.html#ae4e35f7f501fdd92b8f488ce1237ab83" title="ripple::LedgerEntrySet\l::accountHolds" alt="" coords="491,418,640,465"/><area shape="rect" id="node9" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59" title="ripple::RippleAddress\l::createHumanAccountID" alt="" coords="971,630,1141,677"/><area shape="rect" id="node105" href="../../d2/d41/a01493.html#a61429db7fed5872fca90d726f3088325" title="ripple::STAmount::getCurrency" alt="" coords="464,488,667,517"/><area shape="rect" id="node108" href="../../d2/d41/a01493.html#ac88b3e8c68c4fbda4e493471be3f074c" title="ripple::STAmount::getIssuer" alt="" coords="473,541,657,571"/><area shape="rect" id="node110" href="../../d2/d41/a01493.html#af327650875d5657bc9999fac9751a0eb" title="ripple::STAmount::isNative" alt="" coords="476,315,655,344"/><area shape="rect" id="node7" href="../../d2/d41/a01493.html#ae1e71aef94d7a8d5730eb85804b710da" title="ripple::STAmount::clear" alt="" coords="977,508,1135,537"/><area shape="rect" id="node46" href="../../d0/d08/a00832.html#ad13594cf847a6c56ef479ee44ae3c329" title="ripple::LedgerEntrySet\l::entryCache" alt="" coords="981,561,1131,607"/><area shape="rect" id="node48" href="../../dd/d5f/a00825.html#ab0ca75e1c5fa67568377f9962687cf90" title="ripple::Ledger::getAccount\lRootIndex" alt="" coords="1201,315,1375,362"/><area shape="rect" id="node90" href="../../d0/d08/a00832.html#acdef4a4acda92a8c7eb5905f6429abcd" title="ripple::LedgerEntrySet\l::rippleHolds" alt="" coords="739,418,888,465"/><area shape="rect" id="node11" href="../../d4/d0e/a01272.html#a4d666ed35a56048234a86e53d129ad66" title="ripple::RippleAddress\l::createAccountID" alt="" coords="1215,663,1361,710"/><area shape="rect" id="node25" href="../../d4/d0e/a01272.html#a2a8201537b6969c0e186c9b1d889c52b" title="ripple::RippleAddress\l::humanAccountID" alt="" coords="1215,594,1361,641"/><area shape="rect" id="node13" href="../../d4/d0e/a01272.html#ad33487a0716edddfc083c5a0fd68bbc9" title="ripple::RippleAddress\l::setAccountID" alt="" coords="1429,663,1576,710"/><area shape="rect" id="node15" href="../../d9/d39/a00257.html#a47491f73d2b42a10e3f72172ced83c3d" title="ripple::CBase58Data\l::SetString" alt="" coords="1664,663,1805,710"/><area shape="rect" id="node17" href="../../d9/d7d/a00150.html#a85c405829839e85edb721241fd8d4203" title="ripple::Base58::decodeWith\lCheck" alt="" coords="1917,663,2099,710"/><area shape="rect" id="node19" href="../../d9/d7d/a00150.html#a0c2d621faceac43aeb30f4797f03b12c" title="ripple::Base58::decode" alt="" coords="2176,672,2331,701"/><area shape="rect" id="node21" href="../../d7/d9a/a00152.html#afcb87d72a05033f7eafdf7563bf52224" title="ripple::base_uint::end" alt="" coords="2180,327,2327,356"/><area shape="rect" id="node23" href="../../d7/d9a/a00152.html#af39117db8d26ecef7a570cd3448822a6" title="ripple::base_uint::data" alt="" coords="2380,299,2529,328"/><area shape="rect" id="node27" href="../../d4/d87/a03436.html#a6f17c6df7ce20ec52aecef2475cd4158" title="rocksdb::if" alt="" coords="1461,541,1544,571"/><area shape="rect" id="node33" href="../../d9/d39/a00257.html#a18a7bfe8bbf61262472b03f1dfe5c887" title="ripple::CBase58Data\l::ToString" alt="" coords="1432,594,1573,641"/><area shape="rect" id="node42" href="../../d4/d0e/a01272.html#a57f127faa6e0af4093b8397e368c2899" title="ripple::RippleAddress\l::getAccountID" alt="" coords="1429,471,1576,518"/><area shape="rect" id="node29" href="../../da/d71/a00814.html#ab25c6d03dbcd6168b3ae3762dc98fd51" title="rocksdb::LDBCommandExecute\lResult::FAILED" alt="" coords="1629,525,1840,571"/><area shape="rect" id="node31" href="../../da/d71/a00814.html#ae4210d600639c8c6ac04486ebc43c39b" title="rocksdb::LDBCommandExecute\lResult::LDBCommandExecuteResult" alt="" coords="1888,471,2128,518"/><area shape="rect" id="node35" href="../../d9/d7d/a00150.html#a085fa82e1453fd6e5460a0cd960b5816" title="ripple::Base58::encodeWith\lCheck" alt="" coords="1644,594,1825,641"/><area shape="rect" id="node37" href="../../d9/d7d/a00150.html#ac6c6ad62e7ed916bfe1c652721d3fe26" title="ripple::Base58::encode" alt="" coords="1931,611,2085,640"/><area shape="rect" id="node39" href="../../d9/d7d/a00150.html#a24f49360e730224f1d16edb1b504e32a" title="ripple::Base58::getCurrent\lAlphabet" alt="" coords="1921,541,2095,587"/><area shape="rect" id="node44" href="../../d9/d9d/a03417.html#a67af9cb9a9d5c158f9a56acde5f27e4e" title="ripple::Hash160" alt="" coords="1679,472,1791,501"/><area shape="rect" id="node50" href="../../da/d61/a01350.html#a10b908daaabf22ae052bfc7fd221157c" title="ripple::Serializer\l::add16" alt="" coords="1445,333,1560,379"/><area shape="rect" id="node52" href="../../da/d61/a01350.html#a509771bf1109949d4bee7b71aecc3757" title="ripple::Serializer\l::add160" alt="" coords="1445,263,1560,310"/><area shape="rect" id="node58" href="../../da/d61/a01350.html#afc7187fd3c9e185d29a0ecf5500d0cdf" title="ripple::Serializer\l::getSHA512Half" alt="" coords="1443,402,1563,449"/><area shape="rect" id="node54" href="../../d7/d9a/a00152.html#a05af5cdcc33627cb359debe028ab675d" title="ripple::base_uint::\lbegin" alt="" coords="1945,258,2071,305"/><area shape="rect" id="node60" href="../../da/d61/a01350.html#ac7bf5cce451c952933b2750d902d848c" title="ripple::Serializer\l::size" alt="" coords="1677,402,1792,449"/><area shape="rect" id="node64" href="../../d2/d41/a01493.html#a207b1e769e476310cc294e5a3d6d299f" title="ripple::STAmount::getText" alt="" coords="969,247,1143,276"/><area shape="rect" id="node66" href="../../d2/d41/a01493.html#a0f7eda3369139764c0dd4c6dc806a9d7" title="ripple::STAmount::getHuman\lCurrency" alt="" coords="961,166,1151,213"/><area shape="rect" id="node68" href="../../d2/d41/a01493.html#aefb662aaabfc521cb4cdcdb715c7d4b8" title="ripple::STAmount::create\lHumanCurrency" alt="" coords="1205,137,1371,183"/><area shape="rect" id="node70" href="../../d7/d9a/a00152.html#a25e873c7d069c6c2d44655736f2b6c21" title="ripple::base_uint::\lisZero" alt="" coords="1440,125,1565,171"/><area shape="rect" id="node72" href="../../d7/d9a/a00152.html#ad19bda12f3725584ac179f2e091e30d7" title="ripple::base_uint::\lToString" alt="" coords="1440,194,1565,241"/><area shape="rect" id="node74" href="../../d7/d9a/a00152.html#a348c4019943a8b3a05f39f1efcb589c9" title="ripple::base_uint::\lGetHex" alt="" coords="1672,194,1797,241"/><area shape="rect" id="node84" href="../../d0/d85/a01352.html#a28779f2e8d8ceb7882acfb5534d70754" title="ripple::SerializerIterator\l::getRaw" alt="" coords="1425,5,1580,51"/><area shape="rect" id="node77" href="../../d7/d9a/a00152.html#a463054abe1fe73a6f2d2dd9ecc9fb544" title="ripple::base_uint::size" alt="" coords="1933,151,2083,180"/><area shape="rect" id="node79" href="../../d9/d9d/a03417.html#a138db8803faea25db74891325f6b0073" title="ripple::strHex" alt="" coords="1959,204,2057,233"/><area shape="rect" id="node81" href="../../d9/d9d/a03417.html#aca6318bcfeb25f74477566a7ddc06a63" title="ripple::charHex" alt="" coords="2199,204,2308,233"/><area shape="rect" id="node86" href="../../da/d61/a01350.html#aae6a2808959bee786fa30c815a6d2306" title="ripple::Serializer\l::getRaw" alt="" coords="1677,5,1792,51"/><area shape="rect" id="node94" href="../../dd/d5f/a00825.html#a5fd86d78b17725e35684e77543e538d2" title="ripple::Ledger::getRipple\lStateIndex" alt="" coords="1207,394,1369,441"/><area shape="rect" id="node100" href="../../d2/d41/a01493.html#ad9cebdb647da68f740009f9cda4dbe83" title="ripple::STAmount::negate" alt="" coords="971,455,1141,484"/><area shape="rect" id="node102" href="../../d2/d41/a01493.html#a9c0e550741c6a42146b6bed092f45643" title="ripple::STAmount::setIssuer" alt="" coords="964,351,1148,380"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d5/de7/a01048_ad23ce85477cc840bf3d7a8210a31d1d9_icgraph.png" border="0" usemap="#d5/de7/a01048_ad23ce85477cc840bf3d7a8210a31d1d9_icgraph" alt=""/></div>
<map name="d5/de7/a01048_ad23ce85477cc840bf3d7a8210a31d1d9_icgraph" id="d5/de7/a01048_ad23ce85477cc840bf3d7a8210a31d1d9_icgraph">
<area shape="rect" id="node3" href="../../d5/de7/a01048.html#aad751b1698cdcc386c9e90e86d2e11b1" title="ripple::OfferCreateTransactor\l::takeOffers" alt="" coords="247,5,436,51"/><area shape="rect" id="node5" href="../../d5/de7/a01048.html#a54a40cf030c21f9b4796330011e5eca8" title="ripple::OfferCreateTransactor\l::doApply" alt="" coords="487,5,676,51"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aad751b1698cdcc386c9e90e86d2e11b1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a> ripple::OfferCreateTransactor::takeOffers </td>
          <td>(</td>
          <td class="paramtype">bool const&#160;</td>
          <td class="paramname"><em>bOpenLedger</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool const&#160;</td>
          <td class="paramname"><em>bPassive</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool const&#160;</td>
          <td class="paramname"><em>bSell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d4e/a01741.html">uint256</a> const &amp;&#160;</td>
          <td class="paramname"><em>uBookBase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d2e/a01737.html">uint160</a> const &amp;&#160;</td>
          <td class="paramname"><em>uTakerAccountID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/d54/a01344.html#ac44431ef1b5e53a01fca8eb46673c519">SLE::ref</a>&#160;</td>
          <td class="paramname"><em>sleTakerAccount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;&#160;</td>
          <td class="paramname"><em>saTakerPays</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> const &amp;&#160;</td>
          <td class="paramname"><em>saTakerGets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saTakerPaid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/d41/a01493.html">STAmount</a> &amp;&#160;</td>
          <td class="paramname"><em>saTakerGot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bUnfunded</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Take as much as possible. We adjusts account balances and charges fees on top to taker.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">uBookBase</td><td>The order book to take against. </td></tr>
    <tr><td class="paramname">saTakerPays</td><td>What the taker offers (w/ issuer) </td></tr>
    <tr><td class="paramname">saTakerGets</td><td>What the taker wanted (w/ issuer) </td></tr>
    <tr><td class="paramname">saTakerPaid</td><td>What taker could have paid including saved not including fees. To reduce an offer. </td></tr>
    <tr><td class="paramname">saTakerGot</td><td>What taker got not including fees. To reduce an offer. </td></tr>
    <tr><td class="paramname">bUnfunded</td><td>if tesSUCCESS, consider offer unfunded after taking. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>tesSUCCESS, terNO_ACCOUNT, telFAILED_PROCESSING, or tecFAILED_PROCESSING </dd></dl>

<p>Definition at line <a class="el" href="../../dc/d92/a03048_source.html#l00330">330</a> of file <a class="el" href="../../dc/d92/a03048_source.html">OfferCreateTransactor.cpp</a>.</p>

<p>References <a class="el" href="../../d8/dd4/a03195_source.html#l00068">ACCOUNT_ONE</a>, <a class="el" href="../../d4/db9/a02918_source.html#l01323">ripple::LedgerEntrySet::accountFunds()</a>, <a class="el" href="../../d4/db9/a02918_source.html#l01636">ripple::LedgerEntrySet::accountSend()</a>, <a class="el" href="../../dc/d92/a03048_source.html#l00192">applyOffer()</a>, <a class="el" href="../../dc/d92/a03048_source.html#l00100">canCross()</a>, <a class="el" href="../../d7/d49/a03187_source.html#l00125">ripple::RippleAddress::createHumanAccountID()</a>, <a class="el" href="../../da/dd3/a03198_source.html#l00220">ripple::STAmount::createHumanCurrency()</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00065">CURRENCY_ONE</a>, <a class="el" href="../../dd/d07/a02132_source.html#l00244">beast::Journal::debug</a>, <a class="el" href="../../da/dd3/a03198_source.html#l00920">ripple::STAmount::divide()</a>, <a class="el" href="../../da/d5d/a03068_source.html#l00103">ripple::TransactionEngine::entryModify()</a>, <a class="el" href="../../dd/d07/a02132_source.html#l00247">beast::Journal::error</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00663">ripple::STAmount::getCurrency()</a>, <a class="el" href="../../da/dd3/a03198_source.html#l01090">ripple::STAmount::getFullText()</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00653">ripple::STAmount::getIssuer()</a>, <a class="el" href="../../da/dd3/a03198_source.html#l01030">ripple::STAmount::getRate()</a>, <a class="el" href="../../d8/dd4/a03195_source.html#l00600">ripple::STAmount::isNative()</a>, <a class="el" href="../../dc/d92/a03048_source.html#l00025">isValidOffer()</a>, <a class="el" href="../../df/d0c/a03055_source.html#l00049">ripple::Transactor::m_journal</a>, <a class="el" href="../../df/d0c/a03055_source.html#l00037">ripple::Transactor::mEngine</a>, <a class="el" href="../../d5/dd8/a03083_source.html#l00031">ripple::min()</a>, <a class="el" href="../../da/dd3/a03198_source.html#l00963">ripple::STAmount::multiply()</a>, <a class="el" href="../../d4/db9/a02918_source.html#l01096">ripple::LedgerEntrySet::offerDelete()</a>, <a class="el" href="../../d4/db9/a02918_source.html#l01166">ripple::LedgerEntrySet::rippleTransferRate()</a>, <a class="el" href="../../da/dd3/a03198_source.html#l01055">ripple::STAmount::setRate()</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00158">ripple::tecFAILED_PROCESSING</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00044">ripple::telFAILED_PROCESSING</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00084">ripple::temUNCERTAIN</a>, <a class="el" href="../../d5/d73/a03203_source.html#l00141">ripple::tesSUCCESS</a>, <a class="el" href="../../dd/dfa/a02824_source.html#l00437">ripple::base_uint&lt; BITS &gt;::ToString()</a>, <a class="el" href="../../dd/d07/a02132_source.html#l00243">beast::Journal::trace</a>, <a class="el" href="../../d6/d9b/a03202_source.html#l00140">ripple::transToken()</a>, <a class="el" href="../../d7/d8c/a03049_source.html#l00118">usMissingOffers</a>, <a class="el" href="../../da/d5d/a03068_source.html#l00073">ripple::TransactionEngine::view()</a>, and <a class="el" href="../../dd/d07/a02132_source.html#l00246">beast::Journal::warning</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d92/a03048_source.html#l00728">doApply()</a>.</p>
<div class="fragment"><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;{</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// The book has the most elements. Take the perspective of the book.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">// Book is ordered for taker: taker pays / taker gets (smaller is better)</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="comment">// The order is for the other book&#39;s currencies for get and pays are</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// opposites.</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">// We want the same ratio for the respective currencies so we swap paid and</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">// gets for determing take quality.</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    assert (saTakerPays &amp;&amp; saTakerGets);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="stringliteral">&quot;takeOffers: bSell: &quot;</span> &lt;&lt; bSell &lt;&lt;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="stringliteral">&quot;: against book: &quot;</span> &lt;&lt; uBookBase.ToString ();</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    LedgerEntrySet&amp; lesActive = <a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#a4d2df7ee54a081d8855771939d4e44dc">view</a> ();</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">std::uint64_t</a> <span class="keyword">const</span> uTakeQuality = <a class="code" href="../../d2/d41/a01493.html#ad04578f94f5fcc11e1086f59c9afe238">STAmount::getRate</a> (saTakerGets, saTakerPays);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    STAmount saTakerRate = <a class="code" href="../../d2/d41/a01493.html#a05d8d9a9e3e2fa2f6f6ced24bed4d224">STAmount::setRate</a> (uTakeQuality);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    uint160 <span class="keyword">const</span> uTakerPaysAccountID = saTakerPays.getIssuer ();</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    uint160 <span class="keyword">const</span> uTakerGetsAccountID = saTakerGets.getIssuer ();</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0">TER</a> terResult = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a3f4aacb3a231bc64f3056eb28a6026fd">temUNCERTAIN</a>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">// Offers that became unfunded.</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    std::unordered_set&lt;uint256, beast::hardened_hash&lt;uint256&gt;&gt; usOfferUnfundedBecame;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="comment">// Accounts touched.</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    std::unordered_set&lt;uint160, beast::hardened_hash&lt;uint160&gt;&gt; usAccountTouched;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    saTakerPaid = STAmount (saTakerPays.getCurrency (), saTakerPays.getIssuer ());</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    saTakerGot = STAmount (saTakerGets.getCurrency (), saTakerGets.getIssuer ());</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    bUnfunded = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">// TODO: need to track the synthesized book (source-&gt;XRP + XRP-&gt;target)</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment">//       here as well.</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    OrderBookIterator directBookIter (lesActive,</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        saTakerPays.getCurrency(), saTakerPays.getIssuer(),</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        saTakerGets.getCurrency(), saTakerGets.getIssuer());</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="preprocessor">#ifdef RIPPLE_AUTOBRIDGE</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="preprocessor"></span>    std::unique_ptr&lt;OrderBookIterator&gt; bridgeBookIn;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    std::unique_ptr&lt;OrderBookIterator&gt; bridgeBookOut;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">// If XRP isn&#39;t an already an endpoint, then we also create two additional</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="comment">// iterators:</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">//  (1) source -&gt; XPR</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="comment">//  (2) XRP -&gt; target</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">if</span> (!saTakerPays.isNative () &amp;&amp; !saTakerGets.isNative ())</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a>)</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <a class="code" href="../../d5/df4/a01322.html">beast::Journal::ScopedStream</a> ss (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a>);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            ss &lt;&lt;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                <span class="stringliteral">&quot;Autobridging offer &#39;&quot;</span> &lt;&lt; saTakerPays.getFullText () &lt;&lt;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                <span class="stringliteral">&quot;&#39; to &#39;&quot;</span> &lt;&lt; saTakerGets.getFullText () &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            ss &lt;&lt;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                <span class="stringliteral">&quot;Selected bridge: &#39;&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    <a class="code" href="../../d2/d41/a01493.html#aefb662aaabfc521cb4cdcdb715c7d4b8">STAmount::createHumanCurrency</a>(saTakerPays.getCurrency()) &lt;&lt;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    <span class="stringliteral">&quot;/&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                    <a class="code" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59">RippleAddress::createHumanAccountID</a> (saTakerPays.getIssuer()) &lt;&lt;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                <span class="stringliteral">&quot;&#39; - XRP - &#39;&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                    <a class="code" href="../../d2/d41/a01493.html#aefb662aaabfc521cb4cdcdb715c7d4b8">STAmount::createHumanCurrency</a>(saTakerGets.getCurrency ()) &lt;&lt;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    <span class="stringliteral">&quot;/&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                    <a class="code" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59">RippleAddress::createHumanAccountID</a> (saTakerGets.getIssuer()) &lt;&lt;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                <span class="stringliteral">&quot;&#39;&quot;</span>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">while</span> ((<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a3f4aacb3a231bc64f3056eb28a6026fd">temUNCERTAIN</a> == terResult) &amp;&amp; directBookIter.nextOffer())</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        STAmount saTakerFunds = lesActive.accountFunds (uTakerAccountID, saTakerPays);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        STAmount saSubTakerPays = saTakerPays - saTakerPaid; <span class="comment">// How much more to spend.</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        STAmount saSubTakerGets = saTakerGets - saTakerGot; <span class="comment">// How much more is wanted.</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <a class="code" href="../../db/d86/a02663.html#aaa5d1cd013383c889537491c3cfd9aad">std::uint64_t</a> uTipQuality = directBookIter.getCurrentQuality();</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="preprocessor">#ifdef RIPPLE_AUTOBRIDGE</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">if</span> (bridgeBookIn &amp;&amp; bridgeBookIn-&gt;nextOffer() &amp;&amp;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            bridgeBookOut &amp;&amp; bridgeBookOut-&gt;nextOffer())</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            STAmount bridgeIn = <a class="code" href="../../d2/d41/a01493.html#a05d8d9a9e3e2fa2f6f6ced24bed4d224">STAmount::setRate</a> (bridgeBookIn-&gt;getCurrentQuality());</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            STAmount bridgeOut = <a class="code" href="../../d2/d41/a01493.html#a05d8d9a9e3e2fa2f6f6ced24bed4d224">STAmount::setRate</a> (bridgeBookOut-&gt;getCurrentQuality());</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a754a7a96d490fbc7f53f69572b9c1514">error</a> &lt;&lt;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                <span class="stringliteral">&quot;The direct quality is: &quot;</span> &lt;&lt; <a class="code" href="../../d2/d41/a01493.html#a05d8d9a9e3e2fa2f6f6ced24bed4d224">STAmount::setRate</a> (uTipQuality);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a754a7a96d490fbc7f53f69572b9c1514">error</a> &lt;&lt;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                <span class="stringliteral">&quot;The bridge-to-XRP quality is: &quot;</span> &lt;&lt; bridgeIn;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a754a7a96d490fbc7f53f69572b9c1514">error</a> &lt;&lt;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                <span class="stringliteral">&quot;The bridge-from-XRP quality is: &quot;</span> &lt;&lt; bridgeOut;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a754a7a96d490fbc7f53f69572b9c1514">error</a> &lt;&lt;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                <span class="stringliteral">&quot;The bridge synthetic quality is: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                <a class="code" href="../../d2/d41/a01493.html#a12cf6e60ed96232c0595ebe39a7c65ac">STAmount::multiply</a> (bridgeIn, bridgeOut, <a class="code" href="../../d8/dd4/a03195.html#aa47e551f32708d9a2bcf3d0eda6e75e4">CURRENCY_ONE</a>, <a class="code" href="../../d8/dd4/a03195.html#ad55eb3b0f8711599b73d311ac52eced0">ACCOUNT_ONE</a>);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de7/a01048.html#aa3a509a2033e29420391d2936d358313">canCross</a>(</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                saTakerFunds,</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                saSubTakerPays,</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                saSubTakerGets,</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                uTipQuality,</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                uTakeQuality,</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                bPassive,</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                bUnfunded,</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                terResult))</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="comment">// We have a crossing offer to consider.</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="comment">// TODO Must consider the synthesized orderbook instead of just the</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="comment">// direct one (i.e. look at A-&gt;XRP-&gt;B)</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <a class="code" href="../../dc/d54/a01344.html#abf05184c020b05e80bdf996c9bee96eb">SLE::pointer</a> sleOffer = directBookIter.getCurrentOffer ();</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keywordflow">if</span> (!sleOffer)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        { <span class="comment">// offer is in directory but not in ledger</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="comment">// CHECKME is this cleaning up corruption?</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            uint256 offerIndex = directBookIter.getCurrentIndex ();</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                <span class="stringliteral">&quot;takeOffers: offer not found : &quot;</span> &lt;&lt; offerIndex;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <a class="code" href="../../d5/de7/a01048.html#aeb9adbe1d187e768d4c53ae98dc4aad4">usMissingOffers</a>.insert (<a class="code" href="../../d5/de7/a01048.html#ab570cc3ecffaf7c479df21c9803cbd21">missingOffer_t</a> (</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                directBookIter.getCurrentIndex (),</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                directBookIter.getCurrentDirectory ()));</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <span class="stringliteral">&quot;takeOffers: considering offer : &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            sleOffer-&gt;getJson (0);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        uint160 <span class="keyword">const</span>&amp;  uOfferOwnerID = sleOffer-&gt;getFieldAccount160 (sfAccount);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        STAmount saOfferPays = sleOffer-&gt;getFieldAmount (sfTakerGets);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        STAmount saOfferGets = sleOffer-&gt;getFieldAmount (sfTakerPays);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        STAmount        saOfferFunds;   <span class="comment">// Funds of offer owner to payout.</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keywordtype">bool</span> <span class="keyword">const</span> bValid = <a class="code" href="../../d5/de7/a01048.html#ad23ce85477cc840bf3d7a8210a31d1d9">isValidOffer</a> (</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            sleOffer,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            uOfferOwnerID,</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            saOfferPays,</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            saOfferGets,</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            uTakerAccountID,</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            usOfferUnfundedBecame,</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            usAccountTouched,</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            saOfferFunds);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keywordflow">if</span> (bValid)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            STAmount    saSubTakerPaid;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            STAmount    saSubTakerGot;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            STAmount    saTakerIssuerFee;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            STAmount    saOfferIssuerFee;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            STAmount    saOfferRate = <a class="code" href="../../d2/d41/a01493.html#a05d8d9a9e3e2fa2f6f6ced24bed4d224">STAmount::setRate</a> (uTipQuality);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a>)</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer:    saTakerPays: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                    saTakerPays.getFullText ();</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer:    saTakerPaid: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                    saTakerPaid.getFullText ();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer:   saTakerFunds: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                    saTakerFunds.getFullText ();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer:   saOfferFunds: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                    saOfferFunds.getFullText ();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer:    saOfferPays: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                    saOfferPays.getFullText ();</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer:    saOfferGets: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                    saOfferGets.getFullText ();</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer:    saOfferRate: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                    saOfferRate.getFullText ();</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer: saSubTakerPays: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                    saSubTakerPays.getFullText ();</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer: saSubTakerGets: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                    saSubTakerGets.getFullText ();</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer:    saTakerPays: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                    saTakerPays.getFullText ();</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#af70bab6f3469226387fb6018e14d83fc">trace</a> &lt;&lt;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer:    saTakerGets: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                    saTakerGets.getFullText ();</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="keywordtype">bool</span> <span class="keyword">const</span> bOfferDelete = <a class="code" href="../../d5/de7/a01048.html#ad481c5e633674c0d78c40df84780bbac">applyOffer</a> (</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                bSell,</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                lesActive.rippleTransferRate (</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                    uTakerAccountID,</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                    uOfferOwnerID,</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                    uTakerPaysAccountID),</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                lesActive.rippleTransferRate (</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                    uOfferOwnerID,</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                    uTakerAccountID,</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                    uTakerGetsAccountID),</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                saOfferRate,</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                saOfferFunds,</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                saTakerFunds,</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                saOfferPays,</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                saOfferGets,</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                saSubTakerPays,</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                saSubTakerGets,</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                saSubTakerPaid,</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                saSubTakerGot,</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                saTakerIssuerFee,</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                saOfferIssuerFee);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a>)</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer: saSubTakerPaid: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                    saSubTakerPaid.getFullText ();</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                    <span class="stringliteral">&quot;takeOffers: applyOffer:  saSubTakerGot: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                    saSubTakerGot.getFullText ();</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            }</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            <span class="comment">// Adjust offer</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            <span class="comment">// TODO We need to consider the combined (synthesized)</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            <span class="comment">// order book.</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <span class="comment">// Offer owner will pay less.  Subtract what taker just got.</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            saOfferPays -= saSubTakerGot;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            sleOffer-&gt;setFieldAmount (sfTakerGets, saOfferPays);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="comment">// Offer owner will get less.  Subtract what owner just paid.</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            saOfferGets -= saSubTakerPaid;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            sleOffer-&gt;setFieldAmount (sfTakerPays, saOfferGets);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#ad8d31b55e657c48fc9664e52955d2ed3">mEngine</a>-&gt;<a class="code" href="../../d9/dc5/a01705.html#a6a68406aec8713a4b3543b5c1a299d4b">entryModify</a> (sleOffer);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <span class="keywordflow">if</span> (bOfferDelete)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                <span class="comment">// TODO need to handle the synthetic case here</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                <span class="comment">// Offer now fully claimed or now unfunded.</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                    <span class="stringliteral">&quot;takeOffers: Offer claimed: Delete.&quot;</span>;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                <span class="comment">// Delete unfunded offer on success.</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                usOfferUnfundedBecame.insert (sleOffer-&gt;getIndex());</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                <span class="comment">// Offer owner&#39;s account is no longer pristine.</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                usAccountTouched.insert (uOfferOwnerID);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (saSubTakerGot)</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                    <span class="stringliteral">&quot;takeOffers: Offer partial claim.&quot;</span>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                <span class="comment">// TODO check the synthetic case here (to ensure there</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                <span class="comment">//      is no corruption)</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                <span class="keywordflow">if</span> (saOfferPays &lt;= zero || saOfferGets &lt;= zero)</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                    <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#a876412c0a487a7a8840b1556cc04cb57">warning</a> &lt;&lt;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                        <span class="stringliteral">&quot;takeOffers: ILLEGAL OFFER RESULT.&quot;</span>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                    bUnfunded   = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                    terResult   = bOpenLedger</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                                    ? <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a453d7db3d36a5516e925c466d1dc0ac1">telFAILED_PROCESSING</a></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                                    : <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0aecd11145ac07375d1c0793e699932969">tecFAILED_PROCESSING</a>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            {</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                <span class="comment">// Taker got nothing, probably due to rounding. Consider</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <span class="comment">// taker unfunded.</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt; <span class="stringliteral">&quot;takeOffers: No claim.&quot;</span>;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                bUnfunded   = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                terResult   = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a>;                   <span class="comment">// Done.</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            assert (uTakerGetsAccountID == saSubTakerGot.getIssuer ());</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            assert (uTakerPaysAccountID == saSubTakerPaid.getIssuer ());</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            <span class="keywordflow">if</span> (!bUnfunded)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                <span class="comment">// Distribute funds. The sends charge appropriate fees</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                <span class="comment">// which are implied by offer.</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                <span class="comment">// TODO Adjust for synthetic transfers - pay into A-&gt;XRP</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                <span class="comment">// and pay out of XRP-&gt;B</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                <span class="comment">// Offer owner pays taker.</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                terResult = lesActive.accountSend (</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                    uOfferOwnerID, uTakerAccountID, saSubTakerGot);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a> == terResult)</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                    <span class="comment">// TODO: in the synthesized case, pay from B to the original taker</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                    <span class="comment">// Taker -&gt; A -&gt; XRP -&gt; B -&gt; ... -&gt; Taker</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                    <span class="comment">// Taker pays offer owner.</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                    terResult   = lesActive.accountSend (</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                        uTakerAccountID, uOfferOwnerID, saSubTakerPaid);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                }</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                <span class="keywordflow">if</span> (bSell)</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                {</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                    <span class="comment">// Sell semantics:</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                    <span class="comment">// Reduce amount considered received to original</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                    <span class="comment">// offer&#39;s rate. Not by the crossing rate, which is</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                    <span class="comment">// higher.</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                    STAmount saEffectiveGot = <a class="code" href="../../d2/d41/a01493.html#a547cf5be1bf2fdd7f7cd4cc076d77196">STAmount::divide</a>(</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                        saSubTakerPaid, saTakerRate, saTakerGets);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                    saSubTakerGot = <a class="code" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff">std::min</a>(saEffectiveGot, saSubTakerGot);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                {</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                    <span class="comment">// Buy semantics: Reduce amount considered paid by</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                    <span class="comment">// taker&#39;s rate. Not by actual cost which is lower.</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                    <span class="comment">// That is, take less as to just satify our buy</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                    <span class="comment">// requirement.</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                    <span class="comment">// Taker could pay.</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                    STAmount saTakerCould = saTakerPays - saTakerPaid;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                    <span class="keywordflow">if</span> (saTakerFunds &lt; saTakerCould)</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                        saTakerCould = saTakerFunds;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                    STAmount saTakerUsed = <a class="code" href="../../d2/d41/a01493.html#a12cf6e60ed96232c0595ebe39a7c65ac">STAmount::multiply</a> (</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                        saSubTakerGot, saTakerRate, saTakerPays);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a>)</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                    {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                            <span class="stringliteral">&quot;takeOffers: applyOffer:   saTakerCould: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                            saTakerCould.getFullText ();</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                            <span class="stringliteral">&quot;takeOffers: applyOffer:  saSubTakerGot: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                            saSubTakerGot.getFullText ();</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                            <span class="stringliteral">&quot;takeOffers: applyOffer:    saTakerRate: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                            saTakerRate.getFullText ();</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                        <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                            <span class="stringliteral">&quot;takeOffers: applyOffer:    saTakerUsed: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                            saTakerUsed.getFullText ();</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                    }</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                    saSubTakerPaid  = <a class="code" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff">std::min</a> (saTakerCould, saTakerUsed);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                }</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                saTakerPaid     += saSubTakerPaid;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                saTakerGot      += saSubTakerGot;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a> == terResult)</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                    terResult   = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a3f4aacb3a231bc64f3056eb28a6026fd">temUNCERTAIN</a>;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a3f4aacb3a231bc64f3056eb28a6026fd">temUNCERTAIN</a> == terResult)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        terResult = <a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="stringliteral">&quot;takeOffers: &quot;</span> &lt;&lt; <a class="code" href="../../d9/d9d/a03417.html#a14963d35eeab76c974e033beb7fdddb0">transToken</a> (terResult);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9d/a03417.html#ac6c7d57554e8bab72ad93e40ceb3f6c0a28c7d8b3ed759d363503a05fcd59f151">tesSUCCESS</a> == terResult)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <span class="comment">// On success, delete offers that became unfunded.</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> uOfferIndex : usOfferUnfundedBecame)</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                <span class="stringliteral">&quot;takeOffers: became unfunded: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                    uOfferIndex.ToString ();</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            lesActive.offerDelete (uOfferIndex);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        }</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <a class="code" href="../../d8/df7/a01711.html#a13c709e8f4b7574a290cd1e2bf1ff370">m_journal</a>.<a class="code" href="../../df/d0c/a00788.html#aed264b891ebfe8df4c5b6b2231786491">debug</a> &lt;&lt;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="stringliteral">&quot;takeOffers&lt; &quot;</span> &lt;&lt; <a class="code" href="../../d9/d9d/a03417.html#a14963d35eeab76c974e033beb7fdddb0">transToken</a> (terResult);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">return</span> terResult;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d5/de7/a01048_aad751b1698cdcc386c9e90e86d2e11b1_cgraph.png" border="0" usemap="#d5/de7/a01048_aad751b1698cdcc386c9e90e86d2e11b1_cgraph" alt=""/></div>
<map name="d5/de7/a01048_aad751b1698cdcc386c9e90e86d2e11b1_cgraph" id="d5/de7/a01048_aad751b1698cdcc386c9e90e86d2e11b1_cgraph">
<area shape="rect" id="node3" href="../../d0/d08/a00832.html#ae736ed965650c098f9d572bc157b00c0" title="ripple::LedgerEntrySet\l::accountFunds" alt="" coords="528,677,677,724"/><area shape="rect" id="node7" href="../../d4/d0e/a01272.html#a5e27ec0a3b2b853272958e1b522bfd59" title="ripple::RippleAddress\l::createHumanAccountID" alt="" coords="1275,438,1445,485"/><area shape="rect" id="node19" href="../../d2/d41/a01493.html#acacb1c47b480b33d3d7fd6cd0d63cbed" title="ripple::STAmount::getFullText" alt="" coords="1020,786,1215,815"/><area shape="rect" id="node25" href="../../d2/d41/a01493.html#aefb662aaabfc521cb4cdcdb715c7d4b8" title="ripple::STAmount::create\lHumanCurrency" alt="" coords="1505,1080,1671,1126"/><area shape="rect" id="node29" href="../../d7/d9a/a00152.html#ad19bda12f3725584ac179f2e091e30d7" title="ripple::base_uint::\lToString" alt="" coords="1736,1161,1861,1208"/><area shape="rect" id="node39" href="../../d2/d41/a01493.html#a61429db7fed5872fca90d726f3088325" title="ripple::STAmount::getCurrency" alt="" coords="768,986,971,1015"/><area shape="rect" id="node42" href="../../d2/d41/a01493.html#ac88b3e8c68c4fbda4e493471be3f074c" title="ripple::STAmount::getIssuer" alt="" coords="1025,732,1209,762"/><area shape="rect" id="node44" href="../../d2/d41/a01493.html#af327650875d5657bc9999fac9751a0eb" title="ripple::STAmount::isNative" alt="" coords="780,628,959,658"/><area shape="rect" id="node46" href="../../d0/d08/a00832.html#adb4c10b0043957922ce2b5b5abd67549" title="ripple::LedgerEntrySet\l::accountSend" alt="" coords="528,378,677,425"/><area shape="rect" id="node62" href="../../d5/de7/a01048.html#ad481c5e633674c0d78c40df84780bbac" title="ripple::OfferCreateTransactor\l::applyOffer" alt="" coords="247,1341,436,1388"/><area shape="rect" id="node64" href="../../d2/d41/a01493.html#a547cf5be1bf2fdd7f7cd4cc076d77196" title="ripple::STAmount::divide" alt="" coords="520,1507,685,1536"/><area shape="rect" id="node87" href="../../d9/d9d/a03417.html#aa3091bec2c625018fadb6aefef12b9ff" title="ripple::min" alt="" coords="561,1614,644,1643"/><area shape="rect" id="node103" href="../../d5/de7/a01048.html#aa3a509a2033e29420391d2936d358313" title="ripple::OfferCreateTransactor\l::canCross" alt="" coords="247,1618,436,1665"/><area shape="rect" id="node108" href="../../d9/dc5/a01705.html#a6a68406aec8713a4b3543b5c1a299d4b" title="ripple::TransactionEngine\l::entryModify" alt="" coords="257,298,425,345"/><area shape="rect" id="node114" href="../../d2/d41/a01493.html#ad04578f94f5fcc11e1086f59c9afe238" title="ripple::STAmount::getRate" alt="" coords="253,1512,429,1542"/><area shape="rect" id="node122" href="../../d5/de7/a01048.html#ad23ce85477cc840bf3d7a8210a31d1d9" title="ripple::OfferCreateTransactor\l::isValidOffer" alt="" coords="247,857,436,904"/><area shape="rect" id="node128" href="../../d9/dc5/a01705.html#a4d2df7ee54a081d8855771939d4e44dc" title="ripple::TransactionEngine\l::view" alt="" coords="519,917,687,964"/><area shape="rect" id="node131" href="../../d2/d41/a01493.html#a12cf6e60ed96232c0595ebe39a7c65ac" title="ripple::STAmount::multiply" alt="" coords="515,1347,691,1376"/><area shape="rect" id="node141" href="../../d0/d08/a00832.html#a47e828204b1fc11c80899fadd55f4c63" title="ripple::LedgerEntrySet\l::offerDelete" alt="" coords="267,182,416,229"/><area shape="rect" id="node144" href="../../d0/d08/a00832.html#a6ba791d34f583690720665440d1bc3ca" title="ripple::LedgerEntrySet\l::rippleTransferRate" alt="" coords="795,94,944,141"/><area shape="rect" id="node149" href="../../d2/d41/a01493.html#a05d8d9a9e3e2fa2f6f6ced24bed4d224" title="ripple::STAmount::setRate" alt="" coords="253,1566,429,1595"/><area shape="rect" id="node153" href="../../d9/d9d/a03417.html#a14963d35eeab76c974e033beb7fdddb0" title="ripple::transToken" alt="" coords="279,1688,404,1718"/><area shape="rect" id="node5" href="../../d0/d08/a00832.html#ae4e35f7f501fdd92b8f488ce1237ab83" title="ripple::LedgerEntrySet\l::accountHolds" alt="" coords="795,438,944,485"/><area shape="rect" id="node13" href="../../d0/d08/a00832.html#ad13594cf847a6c56ef479ee44ae3c329" title="ripple::LedgerEntrySet\l::entryCache" alt="" coords="1043,305,1192,352"/><area shape="rect" id="node15" href="../../dd/d5f/a00825.html#ab0ca75e1c5fa67568377f9962687cf90" title="ripple::Ledger::getAccount\lRootIndex" alt="" coords="1031,146,1204,193"/><area shape="rect" id="node9" href="../../d4/d0e/a01272.html#a4d666ed35a56048234a86e53d129ad66" title="ripple::RippleAddress\l::createAccountID" alt="" coords="1515,473,1661,520"/><area shape="rect" id="node11" href="../../d4/d0e/a01272.html#a2a8201537b6969c0e186c9b1d889c52b" title="ripple::RippleAddress\l::humanAccountID" alt="" coords="1515,404,1661,450"/><area shape="rect" id="node17" href="../../da/d61/a01350.html#a509771bf1109949d4bee7b71aecc3757" title="ripple::Serializer\l::add160" alt="" coords="1741,590,1856,637"/><area shape="rect" id="node21" href="../../d2/d41/a01493.html#a207b1e769e476310cc294e5a3d6d299f" title="ripple::STAmount::getText" alt="" coords="1273,786,1447,815"/><area shape="rect" id="node23" href="../../d2/d41/a01493.html#a0f7eda3369139764c0dd4c6dc806a9d7" title="ripple::STAmount::getHuman\lCurrency" alt="" coords="1265,929,1455,976"/><area shape="rect" id="node27" href="../../d7/d9a/a00152.html#a25e873c7d069c6c2d44655736f2b6c21" title="ripple::base_uint::\lisZero" alt="" coords="1736,1318,1861,1365"/><area shape="rect" id="node31" href="../../d7/d9a/a00152.html#a348c4019943a8b3a05f39f1efcb589c9" title="ripple::base_uint::\lGetHex" alt="" coords="1925,1132,2051,1178"/><area shape="rect" id="node34" href="../../d0/d85/a01352.html#a28779f2e8d8ceb7882acfb5534d70754" title="ripple::SerializerIterator\l::getRaw" alt="" coords="1721,1041,1876,1088"/><area shape="rect" id="node50" href="../../d0/d08/a00832.html#a566a4d723aabbf98f55afc88f9159b18" title="ripple::LedgerEntrySet\l::entryModify" alt="" coords="795,214,944,261"/><area shape="rect" id="node54" href="../../d9/d9d/a03417.html#a31cb07ee73687ab40f31634269f9f43c" title="ripple::is_bit_set" alt="" coords="811,284,928,314"/><area shape="rect" id="node57" href="../../d0/d08/a00832.html#a0ffde547dd05d6b0816345b9a5123942" title="ripple::LedgerEntrySet\l::rippleSend" alt="" coords="795,508,944,554"/><area shape="rect" id="node76" href="../../d2/d41/a01493.html#a5a04a9b52239427b2faf80438dcda832" title="ripple::STAmount::divRound" alt="" coords="509,1560,696,1590"/><area shape="rect" id="node89" href="../../d2/d41/a01493.html#a789b3ee5edaf69eb840e57b4c7fc395e" title="ripple::STAmount::mulRound" alt="" coords="508,1454,697,1483"/><area shape="rect" id="node101" href="../../d2/d41/a01493.html#ab0b901062f0b7e67b0832d0601cd665e" title="ripple::STAmount::throwComparable" alt="" coords="487,1400,719,1430"/><area shape="rect" id="node66" href="../../d2/d41/a01493.html#abd4fd82bc6fbef164e509b1436722aea" title="ripple::STAmount::STAmount" alt="" coords="773,1679,965,1708"/><area shape="rect" id="node68" href="../../d9/d9d/a03417.html#a6a718ea1b5de0444d1c41e60dc800640" title="ripple::BN_add_word64" alt="" coords="791,1519,948,1548"/><area shape="rect" id="node70" href="../../d9/d9d/a03417.html#a3f8ae51567332338f0bc009416f7fb6c" title="ripple::BN_mul_word64" alt="" coords="791,1572,948,1602"/><area shape="rect" id="node72" href="../../d9/d9d/a03417.html#a6695464b272d36f5cf768f472395d2f7" title="ripple::BN_div_word64" alt="" coords="793,1626,945,1655"/><area shape="rect" id="node74" href="../../d7/d2f/a00258.html#aa953d5910038dd334c8ff41d856bc4dd" title="ripple::CBigNum::getuint64" alt="" coords="780,1466,959,1495"/><area shape="rect" id="node93" href="../../d2/d41/a01493.html#a70bbf21b0b886f5b8739293022a3c3e3" title="ripple::STAmount::getSNValue" alt="" coords="769,1362,969,1391"/><area shape="rect" id="node95" href="../../d7/d57/a01348.html#a79472b7634153a0478119634c9e82d7e" title="ripple::SerializedType\l::getFName" alt="" coords="796,1292,943,1338"/><area shape="rect" id="node117" href="../../d2/d41/a01493.html#a9c1b7de857997d436881a627c784630b" title="ripple::STAmount::getExponent" alt="" coords="501,1720,704,1750"/><area shape="rect" id="node119" href="../../d2/d41/a01493.html#a870f2c6aad807d85bdc620d7493525a9" title="ripple::STAmount::getMantissa" alt="" coords="501,1667,704,1696"/><area shape="rect" id="node126" href="../../d9/dc5/a01705.html#ad9f745c60450a463895760958fb240e1" title="ripple::TransactionEngine\l::getLedger" alt="" coords="519,797,687,844"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d5/de7/a01048_aad751b1698cdcc386c9e90e86d2e11b1_icgraph.png" border="0" usemap="#d5/de7/a01048_aad751b1698cdcc386c9e90e86d2e11b1_icgraph" alt=""/></div>
<map name="d5/de7/a01048_aad751b1698cdcc386c9e90e86d2e11b1_icgraph" id="d5/de7/a01048_aad751b1698cdcc386c9e90e86d2e11b1_icgraph">
<area shape="rect" id="node3" href="../../d5/de7/a01048.html#a54a40cf030c21f9b4796330011e5eca8" title="ripple::OfferCreateTransactor\l::doApply" alt="" coords="247,5,436,51"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="aeb9adbe1d187e768d4c53ae98dc4aad4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::set&lt;<a class="el" href="../../d5/de7/a01048.html#ab570cc3ecffaf7c479df21c9803cbd21">missingOffer_t</a>&gt; ripple::OfferCreateTransactor::usMissingOffers</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/d8c/a03049_source.html#l00118">118</a> of file <a class="el" href="../../d7/d8c/a03049_source.html">OfferCreateTransactor.h</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d92/a03048_source.html#l00728">doApply()</a>, and <a class="el" href="../../dc/d92/a03048_source.html#l00330">takeOffers()</a>.</p>

</div>
</div>
<a class="anchor" id="a885648ff4433731d715b63ef66b31767"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_set&lt;<a class="el" href="../../d0/d4e/a01741.html">uint256</a>, <a class="el" href="../../d4/dc4/a00617.html">beast::hardened_hash</a>&lt;<a class="el" href="../../d0/d4e/a01741.html">uint256</a>&gt; &gt; ripple::OfferCreateTransactor::usOfferUnfundedFound</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/d8c/a03049_source.html#l00115">115</a> of file <a class="el" href="../../d7/d8c/a03049_source.html">OfferCreateTransactor.h</a>.</p>

<p>Referenced by <a class="el" href="../../dc/d92/a03048_source.html#l00728">doApply()</a>, and <a class="el" href="../../dc/d92/a03048_source.html#l00025">isValidOffer()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>rippled/src/ripple_app/transactors/<a class="el" href="../../d7/d8c/a03049_source.html">OfferCreateTransactor.h</a></li>
<li>rippled/src/ripple_app/transactors/<a class="el" href="../../dc/d92/a03048_source.html">OfferCreateTransactor.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d9/d9d/a03417.html">ripple</a></li><li class="navelem"><a class="el" href="../../d5/de7/a01048.html">OfferCreateTransactor</a></li>
    <li class="footer">Generated on Fri May 2 2014 05:29:13 for rippled by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
